# TOPMed Variable Documentation
## Contents
* [atherosclerosis](#atherosclerosis)
* [atherosclerosis_events_incident](#atherosclerosis_events_incident)
* [atherosclerosis_events_prior](#atherosclerosis_events_prior)
* [baseline_common_covariates](#baseline_common_covariates)
* [blood_cell_count](#blood_cell_count)
* [blood_pressure](#blood_pressure)
* [demographic](#demographic)
* [inflammation](#inflammation)
* [lipids](#lipids)
* [sleep](#sleep)
* [vte](#vte)


# atherosclerosis

### Variables in this section:
* [cac_score_1](#cac_score_1)
* [cac_volume_1](#cac_volume_1)
* [carotid_plaque_1](#carotid_plaque_1)
* [carotid_stenosis_1](#carotid_stenosis_1)
* [cimt_1](#cimt_1)
* [cimt_2](#cimt_2)

<a id="cac_score_1"></a>
## atherosclerosis: **cac_score_1** (cac_score)
  Coronary artery calcification (CAC) score using Agatston scoring of CT scan(s) of coronary arteries
  * **Harmonization Units**:
    * [Amish](#cac_score_1-amish)
    * [CHS](#cac_score_1-chs)
    * [FHS_Gen3](#cac_score_1-fhs_gen3)
    * [FHS_Offspring](#cac_score_1-fhs_offspring)
    * [FHS_Omnis](#cac_score_1-fhs_omnis)
    * [GENOA](#cac_score_1-genoa)
    * [JHS](#cac_score_1-jhs)
    * [MESA_AirNR](#cac_score_1-mesa_airnr)
    * [MESA_Classic](#cac_score_1-mesa_classic)
    * [MESA_Family](#cac_score_1-mesa_family)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: None, **`Version`**: 2, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-01-18 19:10:10
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C2825178
  * **DCC Harmonization Comments**:

    All component study variables used for the harmonized `cac_score` variable recorded scores using the Agatston scoring method from computed tomography (CT) scans.
    Coronary calcium measurements were determined by summing individual lesion measurements from each of four anatomic sites (left main, left anterior descending, circumflex, and right coronary arteries).  
    
    Studies used different computed tomography scanners to ascertain CAC scoring. 
    Information on the scanning technology used can be found in Table 1 in the Data Supplement of the paper:  
     Natarajan, P., Bis, J.C., _et al_ (2016). Multiethnic exome-wide association study of subclinical atherosclerosis, 
     Circ. Cardiovasc. Genet. _9_, 511 510.
    
    The following information was either obtained from protocol documents in dbGaP or from communication with the studies.
    
    * For MESA (phs000209), the score was the average of the scores from two consecutive CT scans and the scores were phantom adjusted.
    * For FHS (phs000007), sub-cohorts "Offspring" and "Generation 3", the score was the average of scores from two consecutive CT scans and the scores were phantom adjusted.
    (For a small number of subjects in these FHS sub-cohorts, the score was based on only one scan.)
    * For FHS (phs000007), sub-cohorts Omni1 and Omni2, the score was based on only one scan and the score was phantom adjusted.
    * For JHS (phs000286), Amish (phs000965), CHS (phs000287), and GENOA (phs001238) the scores were based on only one scan and were not phantom adjusted.
    
    
<a id="cac_score_1-amish"></a>
  * ### atherosclerosis/cac_score_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252986.v1`, `phs000956.v2.pht005002.v1.phv00252987.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score Amish
         source_data <- phen_list$source_data
      
         dat <- source_data[["pht005002"]]
      
      # change variable names and type
      # mutate age to reflect age winsorized at 90 and change missing code "." to NA
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_score = as.numeric(cac_agatston_score)) %>%
             mutate(age = ifelse(cac_score_age %in% "90+", 90, cac_score_age)) %>%
             mutate(age = ifelse(age %in% ".", NA, age)) %>%
             select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_score_1-chs"></a>
  * ### atherosclerosis/cac_score_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001459.v1.phv00100691.v1`, `phs000287.v6.pht001475.v1.phv00102583.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score CHS
         source_data <- phen_list$source_data
      
      # CAC data set
         dat1 <- source_data[["pht001459"]]
      
      # for age info
      # reviewing CAC data set: year of CAC measurement was given as 11 for all subjects
      # age information found in YR11 dataset
         dat2 <- source_data[["pht001475"]]
      
         dat <- inner_join(dat1, dat2)
      
      # change variable names
      # select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_score = as.numeric(CACSCORE), age = AGEY11) %>%
                select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_score_1-fhs_gen3"></a>
  * ### atherosclerosis/cac_score_1 -- **FHS_Gen3**:
    * 4 component_study_variables: `phs000007.v29.pht000144.v4.phv00023194.v3`, `phs000007.v29.pht000144.v4.phv00023195.v3`, `phs000007.v29.pht000144.v4.phv00023197.v3`, `phs000007.v29.pht003099.v4.phv00177930.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score FHS Generation 3 2002-2005
      # use earliest exam time to maximize sample size
      
         source_data <- phen_list$source_data
      
      # CAC data set
         dat1 <- source_data[["pht000144"]]
      
      # for baseline age info
         dat2 <- source_data[["pht003099"]]
      
         dat <- inner_join(dat1, dat2)
      
      # define score as  average of the 2 scans for subjects with 2 scans
      # else define equal to the non-missing scan score
         dat <- dat %>%
         mutate(cac_score = rowMeans(cbind(as.numeric(CA1), as.numeric(CA2)), na.rm = TRUE))
      
      # compute age at scoring using age at Exam 1 and days since Exam 1 for scan date
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(age = (as.numeric(age1) + as.numeric(studydat) / 365.25)) %>%
                select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_score_1-fhs_offspring"></a>
  * ### atherosclerosis/cac_score_1 -- **FHS_Offspring**:
    * 4 component_study_variables: `phs000007.v29.pht000145.v4.phv00023200.v3`, `phs000007.v29.pht000145.v4.phv00023201.v3`, `phs000007.v29.pht000145.v4.phv00023203.v3`, `phs000007.v29.pht003099.v4.phv00177930.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score FHS Offspring  2002-2005
      # use earliest exam time to maximize sample size
      
         source_data <- phen_list$source_data
      
      # CAC data set
         dat1 <- source_data[["pht000145"]]
      
      # for baseline age info
         dat2 <- source_data[["pht003099"]]
      
         dat <- inner_join(dat1, dat2)
      
      # define score as  average of the 2 scans for subjects with 2 scans
      # else define as equal to the non-missing scan score
         dat <- dat %>%
         mutate(cac_score = rowMeans(cbind(as.numeric(CA1), as.numeric(CA2)), na.rm = TRUE))
      
      # compute age at scoring using age at Exam 1 and days since Exam 1 for scan date
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(age = (as.numeric(age1) + as.numeric(studydat) / 365.25)) %>%
                select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_score_1-fhs_omnis"></a>
  * ### atherosclerosis/cac_score_1 -- **FHS_Omnis**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht005161.v1.phv00257669.v1`, `phs000007.v29.pht005161.v1.phv00257670.v1`, `phs000007.v29.pht005161.v1.phv00257672.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score FHS for Omni's 2008-2011
         source_data <- phen_list$source_data
      
      # CAC data set
         dat1 <- source_data[["pht005161"]]
      
      # for age info
         dat2 <- source_data[["pht003099"]]
      
         dat <- inner_join(dat1, dat2)
      
      # filter to obtain Omni cohorts 7 and 72 (other cohorts done separately)
      # change variable name then
      # compute age at scoring using age at Exam 1 and days since Exam 1 for scan date
      # then select final variables and omit missing records
      
         dat <- dat %>% filter(IDTYPE %in% c(7, 72)) %>% mutate(cac_score = as.numeric(CAC_S)) %>%
                mutate(age = (as.numeric(age1) + as.numeric(scan_date) / 365.25)) %>%
                select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_score_1-genoa"></a>
  * ### atherosclerosis/cac_score_1 -- **GENOA**:
    * 2 component_study_variables: `phs001238.v1.pht006034.v1.phv00277327.v1`, `phs001238.v1.pht006034.v1.phv00277347.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score GENOA
         source_data <- phen_list$source_data
      
         dat <- source_data[["pht006034"]]
      
      # change variable names
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_score = as.numeric(MD1CAC_S)) %>%
             mutate(age = AGE) %>%
             select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_score_1-jhs"></a>
  * ### atherosclerosis/cac_score_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001948.v1.phv00126002.v1`, `phs000286.v5.pht001949.v1.phv00126009.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score JHS
         source_data <- phen_list$source_data
      
      # CAC data set
         dat1 <- source_data[["pht001948"]]
      
      # for age info
         dat2 <- source_data[["pht001949"]]
      
         dat <- inner_join(dat1, dat2)
      
      # change variable names
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_score = as.numeric(CSTA24), age = AGE01) %>%
                select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_score_1-mesa_airnr"></a>
  * ### atherosclerosis/cac_score_1 -- **MESA_AirNR**:
    * 2 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082660.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score MESA AirNR
      # use Exam 1 to maximize sample size
         source_data <- phen_list$source_data
      
         dat <- source_data[["pht001111"]]
      
      # change variable names and type
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_score = as.numeric(agatpm1c), age = as.numeric(age1c)) %>%
                select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_score_1-mesa_classic"></a>
  * ### atherosclerosis/cac_score_1 -- **MESA_Classic**:
    * 2 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084521.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score MESA Classic
      # use Exam 1 to maximize sample size
         source_data <- phen_list$source_data
      
         dat <- source_data[["pht001116"]]
      
      # change variable names
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_score = as.numeric(agatpm1c), age = age1c) %>%
                select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_score_1-mesa_family"></a>
  * ### atherosclerosis/cac_score_1 -- **MESA_Family**:
    * 2 component_study_variables: `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087105.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC Agatston score MESA Family
      
         source_data <- phen_list$source_data
      
         dat <- source_data[["pht001121"]]
      
      # change variable names
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_score = as.numeric(agatpmfc), age = agefc) %>%
                select(topmed_subject_id, cac_score, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_volume_1"></a>
## atherosclerosis: **cac_volume_1** (cac_volume)
  Coronary artery calcium volume using CT scan(s) of coronary arteries
  * **Harmonization Units**:
    * [FHS](#cac_volume_1-fhs)
    * [MESA_AirNR](#cac_volume_1-mesa_airnr)
    * [MESA_Classic](#cac_volume_1-mesa_classic)
    * [MESA_Family](#cac_volume_1-mesa_family)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: cubic millimeters, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2017-10-30 17:31:30
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C2825178
  * **DCC Harmonization Comments**:

    The harmonized `cac_volume` variable uses given study component variables for calcium volume measurements.
    Coronary calcium measurements were determined by summing individual lesion measurements from each of four anatomic sites (left main, left anterior descending, circumflex, and right coronary arteries).  
    
    Studies used different computed tomography (CT) scanners to ascertain CAC scoring. 
    Information on the scanning technology used can be found in Table 1 in the Data Supplement of the paper:  
     Natarajan, P., Bis, J.C., _et al_ (2016). Multiethnic exome-wide association study of subclinical atherosclerosis, 
     Circ. Cardiovasc. Genet. _9_, 511 510.
     
    The following information was either obtained from protocol documents in dbGaP or from communication with the studies:
    
    * For FHS (phs000007), the volume component variables were based on one CT scan and were phantom adjusted. 
    * For MESA (phs000209), the volume component variables were the average of two consecutive CT scans and were phantom adjusted. 
    
    Please note that the study component calcium volume variables for FHS sub-cohorts "Offspring" and "Generation 3" were measured at a later time than the component study variables used for harmonized `cac_score`.
<a id="cac_volume_1-fhs"></a>
  * ### atherosclerosis/cac_volume_1 -- **FHS**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht005161.v1.phv00257671.v1`, `phs000007.v29.pht005161.v1.phv00257672.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC volume for FHS from CT scans in 2008-2011
         source_data <- phen_list$source_data
      
      # CAC data set
         dat1 <- source_data[["pht005161"]]
      
      # for age info
         dat2 <- source_data[["pht003099"]]
      
         dat <- inner_join(dat1, dat2)
      
      # change variable name and type then
      # compute age at scoring using age at Exam 1 and days since Exam 1 for scan date
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_volume = as.numeric(CAC_V)) %>%
                mutate(age = (as.numeric(age1) + as.numeric(scan_date) / 365.25)) %>%
                select(topmed_subject_id, cac_volume, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_volume_1-mesa_airnr"></a>
  * ### atherosclerosis/cac_volume_1 -- **MESA_AirNR**:
    * 2 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082663.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC volume MESA AirNR
      # use Exam 1 to maximize sample size
         source_data <- phen_list$source_data
      
         dat <- source_data[["pht001111"]]
      
      # change variable names and type
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_volume = as.numeric(volpm1c), age = as.numeric(age1c)) %>%
                select(topmed_subject_id, cac_volume, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_volume_1-mesa_classic"></a>
  * ### atherosclerosis/cac_volume_1 -- **MESA_Classic**:
    * 2 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084524.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC volume MESA Classic
      # use Exam 1 to maximize sample size
         source_data <- phen_list$source_data
      
         dat <- source_data[["pht001116"]]
      
      # change variable names and type
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_volume = as.numeric(volpm1c), age = as.numeric(age1c)) %>%
                select(topmed_subject_id, cac_volume, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="cac_volume_1-mesa_family"></a>
  * ### atherosclerosis/cac_volume_1 -- **MESA_Family**:
    * 2 component_study_variables: `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087108.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
      # harmonize CAC volume MESA Family
      
         source_data <- phen_list$source_data
      
         dat <- source_data[["pht001121"]]
      
      # change variable names and type
      # then select final variables and omit missing records
      
         dat <- dat %>% mutate(cac_volume = as.numeric(volpmfc), age = as.numeric(agefc)) %>%
                select(topmed_subject_id, cac_volume, age) %>% na.omit
      
         return(dat)
      }
      ```
<a id="carotid_plaque_1"></a>
## atherosclerosis: **carotid_plaque_1** (carotid_plaque)
  Presence or absence of carotid plaque.
  * **Harmonization Units**:
    * [Amish](#carotid_plaque_1-amish)
    * [ARIC](#carotid_plaque_1-aric)
    * [CHS](#carotid_plaque_1-chs)
    * [JHS](#carotid_plaque_1-jhs)
    * [MESA](#carotid_plaque_1-mesa)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-05-30 13:40:57
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0751633
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting encoded component variables indicating the presence or type of carotid plaque or lesion, to a binary variable indicating the presence or absence of carotid plaque. Carotid plaque or lesion was defined as the presence of abnormal wall thickness, wall shape (surface focality or roughness), or wall texture. 
    
    Measurements of stenosis were originally considered for harmonization for this variable, as a proxy measurement of plaque. However, since stenosis is a fundamentally different phenotypic concept, the DCC created a separate harmonized variable `carotid_stenosis_1`.
    
    #### Amish
    
    *_Amish_* defined the presence of carotid plaque as "measured by intima-media thickness" (component variable phv00252989.v1.p1) on the far wall of the common carotid arteries.
    
    #### CHS
    
    Baseline carotid ultrasound scans for the Original cohort were reread due to reader drift. Reread measurements of *_CHS_* subjects were used for harmonization.[^1]
    
    #### MESA
    
    The *_MESA_* Family subcohort is not included in this harmonized phenotype at this time.
    
    #### Instrumentation
    
    Studies used different instruments at their carotid ultrasound exams:
    
    | Study | Instrument                 |
    |-------|----------------------------|
    | Amish | ATL Phillps HDI 5000       |
    | ARIC  | Biosound 2000 II SA        |
    | CHS   | Toshiba SSA-270A           |
    | JHS   | Hewlett Packard SONOS 4500 |
    | MESA  | GE Logiq 700               |
    
    
    [^1]:[Documentation Without Data Collection Forms phd002779.1](https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/document.cgi?study_id=phs000287.v6.p1&phd=2779)
    
<a id="carotid_plaque_1-amish"></a>
  * ### atherosclerosis/carotid_plaque_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00252989.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005002 %>%
          rename(age = age_baseline, carotid_plaque = imt_anyplaque_baseline)
      
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        dataset$age[dataset$age %in% '90+'] <- 90
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$carotid_plaque[dataset$carotid_plaque %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$carotid_plaque), ]
      
        # Convert character values to numeric.
        dataset <- mutate(dataset, age = as.numeric(age))
      
        return(dataset)
      }
      ```
<a id="carotid_plaque_1-aric"></a>
  * ### atherosclerosis/carotid_plaque_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v3.pht004063.v1.phv00204712.v1`, `phs000280.v3.pht004063.v1.phv00204791.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        dataset <- phen_list$source_data$pht004063
      
        # Rename age and plaque variables
        dataset <- rename(dataset, age = V1AGE01, carotid_plaque = PLAQUE01)
      
        # Convert "T" entry to NA. "T" is interpreted as "missing data"
        dataset[which(dataset$carotid_plaque == "T"), ]$carotid_plaque <- NA
      
        # Exclude missing records
        dataset <- na.omit(dataset)
      
        # Convert numeric to character.
        dataset$carotid_plaque <- as.character(dataset$carotid_plaque)
      
        return(dataset)
      }
      ```
<a id="carotid_plaque_1-chs"></a>
  * ### atherosclerosis/carotid_plaque_1 -- **CHS**:
    * 6 component_study_variables: `phs000287.v6.pht001452.v1.phv00100290.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001473.v1.phv00101306.v1`, `phs000287.v6.pht001473.v1.phv00101307.v1`, `phs000287.v6.pht001473.v1.phv00101317.v1`, `phs000287.v6.pht001473.v1.phv00101318.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Join age data and lesion data.
        dataset <- plyr::join_all(phen_list$source_data) %>%
      
          # Rename age and lesion variables.
          rename(age = AGEBL,
                 subcohort = PERSTAT,
                 r_les_aa = LMRPH141,
                 l_les_aa = LMRPH241,
                 r_les_orig_rr = LMRPH155,
                 l_les_orig_rr = LMRPH255)
      
        # Convert from character to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Subset cohort 1 and create plaque variable.
        dataset_orig <- subset(dataset, select = c(topmed_subject_id,
                                                   age,
                                                   subcohort,
                                                   r_les_orig_rr,
                                                   l_les_orig_rr))
        dataset_orig <- dataset_orig[dataset_orig$subcohort == 1, ]
        dataset_orig$carotid_plaque <-
          (dataset_orig$r_les_orig_rr > 0 | dataset_orig$l_les_orig_rr > 0) %>%
          as.logical() %>%
          as.integer() %>%
          as.character()
      
        # Subset cohort 2 and create plaque variable.
        dataset_new <- subset(dataset, select = c(topmed_subject_id,
                                                  age,
                                                  subcohort,
                                                  r_les_aa,
                                                  l_les_aa))
        dataset_new <- dataset_new[dataset_new$subcohort == 2, ]
        dataset_new$carotid_plaque <- (dataset_new$r_les_aa > 0 | dataset_new$l_les_aa > 0) %>%
          as.logical() %>%
          as.integer() %>%
          as.character()
      
        # Combine plaque variable from both cohorts.
        dataset_orig <- subset(dataset_orig, select = c(topmed_subject_id, age, carotid_plaque))
        dataset_new <- subset(dataset_new, select = c(topmed_subject_id, age, carotid_plaque))
        dataset <- dplyr::full_join(dataset_orig,
                                     dataset_new,
                                     by = c("topmed_subject_id", "age", "carotid_plaque"))
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        # Convert to character.
        dataset$carotid_plaque <- as.character(dataset$carotid_plaque)
      
        return(dataset)
      
      }
      ```
<a id="carotid_plaque_1-jhs"></a>
  * ### atherosclerosis/carotid_plaque_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001978.v1.phv00128573.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        source_data <- phen_list$source_data
        dataset <- inner_join(source_data$pht001949,
                              source_data$pht001978,
                              by = "topmed_subject_id") %>%
          rename(age = AGE01, carotid_plaque = plq01)
      
        # Substitute the value of 'NA' to missing.
        dataset$carotid_plaque[dataset$carotid_plaque %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$carotid_plaque), ]
      
        # Convert character values to numeric.
        dataset <- mutate(dataset, age = as.numeric(age))
      
        return(dataset)
      }
      ```
<a id="carotid_plaque_1-mesa"></a>
  * ### atherosclerosis/carotid_plaque_1 -- **MESA**:
    * 5 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084797.v2`, `phs000209.v13.pht001116.v10.phv00084802.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        harmonized <- phen_list$source_data$pht001116 %>%
          # Recode 8 as NA.
          mutate_at(vars(rmorph1, lmorph1), funs(na_if(., "8"))) %>%
          # Filter out rows where left and right lesion morphology are missing.
          filter(!(is.na(rmorph1) & is.na(lmorph1))) %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Specify transformations will be by row.
          rowwise() %>%
          # Select ID and age and convert plaque to 0/1.
          transmute(
            topmed_subject_id,
            age = age1c,
            carotid_plaque = as.character(as.numeric(as.logical(max(rmorph1, lmorph1, na.rm = TRUE))))
          ) %>%
          # Exclude rows with missing data.
          na.omit()
        return(harmonized)
      }
      ```
<a id="carotid_stenosis_1"></a>
## atherosclerosis: **carotid_stenosis_1** (carotid_stenosis)
  Extent of narrowing of the carotid artery.
  * **Harmonization Units**:
    * [CHS](#carotid_stenosis_1-chs)
    * [FHS](#carotid_stenosis_1-fhs)
    * [MESA](#carotid_stenosis_1-mesa)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-05-30 13:32:01
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0007282
  * **DCC Harmonization Comments**:

    This variable was harmonized by calculating the maximum of left and right carotid artery stenosis grade where possible, or by selecting an existing maximum stenosis variable. Component study variables estimated narrowing using a combination of visual inspection and ultrasound Doppler values.
    
    #### CHS
    
    Baseline carotid ultrasound scans for the Original cohort were reread due to reader drift. Reread measurements of *_CHS_* subjects were used for harmonization.[^1]
    
    #### FHS
    
    *_FHS_* measured stenosis in the common carotid, internal carotid and bulb.
    
    #### MESA 
    
    *_MESA_* measured stenosis in the internal carotid and the bulb.
    
    The *_MESA_* Family subcohort is not included in this harmonized phenotype at this time.
    
    #### Instrumentation
    
    Studies used different instruments at their carotid ultrasound exams:
    
    | Study    | Instrument       |
    |----------|------------------|
    | CHS      | Toshiba SSA-270A |
    | FHS      | Toshiba SSH-140A |
    | MESA     | GE Logiq 700     |
    
    
    [^1]:[Documentation Without Data Collection Forms phd002779.1](https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/document.cgi?study_id=phs000287.v6.p1&phd=2779)
    
<a id="carotid_stenosis_1-chs"></a>
  * ### atherosclerosis/carotid_stenosis_1 -- **CHS**:
    * 6 component_study_variables: `phs000287.v6.pht001452.v1.phv00100290.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001473.v1.phv00101302.v1`, `phs000287.v6.pht001473.v1.phv00101303.v1`, `phs000287.v6.pht001473.v1.phv00101313.v1`, `phs000287.v6.pht001473.v1.phv00101314.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Join age data and lesion data.
        dataset <- plyr::join_all(phen_list$source_data)
      
        # Code any missing values to NA
        dataset$PSTEN141[dataset$PSTEN141 %in% '9'] <- NA
        dataset$PSTEN241[dataset$PSTEN241 %in% '9'] <- NA
        dataset$PSTEN155[dataset$PSTEN155 %in% '9'] <- NA
        dataset$PSTEN255[dataset$PSTEN255 %in% '9'] <- NA
      
        # Rename age and lesion variables.
        dataset <- rename(dataset, age = AGEBL,
                                   subcohort = PERSTAT,
                                   stenRT_aa = PSTEN141,
                                   stenLFT_aa = PSTEN241,
                                   stenRT_orig = PSTEN155,
                                   stenLFT_orig = PSTEN255)
      
        # Convert from character to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Get subset of cohort 1 and create stenosis variable.
        dataset_orig <- subset(dataset, select = c(topmed_subject_id,
                                                   age,
                                                   subcohort,
                                                   stenRT_orig,
                                                   stenLFT_orig))
      
        dataset_orig <- dataset_orig[dataset_orig$subcohort == 1, ] %>%
      
          # Only include rows with at least one measurement.
          filter(!(is.na(stenRT_orig) & is.na(stenLFT_orig)))
      
        # Isolate left and right stenosis variables.
        sten_lft_rt_1 <- c("stenRT_orig", "stenLFT_orig")
      
        # Take maximum stenosis value of left and right sides.
        dataset_orig$max_sten <- apply(dataset_orig[, sten_lft_rt_1], 1,
                                    function(x) ifelse(all(is.na(x)), NA, max(x, na.rm = TRUE)))
      
        # Get subset of cohort 2 and create stenosis variable.
        dataset_new <- subset(dataset, select = c(topmed_subject_id,
                                                  age,
                                                  subcohort,
                                                  stenRT_aa,
                                                  stenLFT_aa))
      
        dataset_new <- dataset_new[dataset_new$subcohort == 2, ] %>%
      
          # Only include rows with at least one measurement.
          filter(!(is.na(stenRT_aa) & is.na(stenLFT_aa)))
      
        # Isolate left and right stenosis variables.
        sten_lft_rt_2 <- c("stenRT_aa", "stenLFT_aa")
      
        # Take maximum stenosis value of left and right sides.
        dataset_new$max_sten <- apply(dataset_new[, sten_lft_rt_2], 1,
                                    function(x) ifelse(all(is.na(x)), NA, max(x, na.rm = TRUE)))
      
      
        # Combine max stenosis variable from both cohorts.
        dataset_orig <- subset(dataset_orig, select = c(topmed_subject_id, age, max_sten))
        dataset_new <- subset(dataset_new, select = c(topmed_subject_id, age, max_sten))
        dataset <- dplyr::full_join(dataset_orig,
                                     dataset_new,
                                     by = c("topmed_subject_id", "age", "max_sten")) %>%
      
          # Rename max_sten to stenosis
          rename(carotid_stenosis = max_sten) %>%
      
          # Convert stenosis to character and select topmed ID and age variables.
          transmute(topmed_subject_id, age, carotid_stenosis = as.character(carotid_stenosis))
      
      
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
      
        return(dataset)
      
      }
      ```
<a id="carotid_stenosis_1-fhs"></a>
  * ### atherosclerosis/carotid_stenosis_1 -- **FHS**:
    * 3 component_study_variables: `phs000007.v29.pht000083.v6.phv00021700.v5`, `phs000007.v29.pht000083.v6.phv00021702.v5`, `phs000007.v29.pht003099.v4.phv00177940.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        harmonized <- phen_list$source_data$pht000083 %>%
          # Only include rows with at least one measurement.
          filter(!(is.na(R_STENO) & is.na(L_STENO))) %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Perform calculations row-wise.
          rowwise() %>%
          # Code stenosis as max of left and right stenosis.
          mutate(carotid_stenosis = as.character(max(R_STENO, L_STENO, na.rm = TRUE))) %>%
          # Join stenosis and age data.
          left_join(phen_list$source_data$pht003099, "topmed_subject_id") %>%
          # Select relevant variables, and rename/convert age variable.
          transmute(topmed_subject_id, carotid_stenosis, age = as.numeric(age6)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(harmonized)
      }
      ```
<a id="carotid_stenosis_1-mesa"></a>
  * ### atherosclerosis/carotid_stenosis_1 -- **MESA**:
    * 5 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084798.v2`, `phs000209.v13.pht001116.v10.phv00084803.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        harmonized <- phen_list$source_data$pht001116 %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Recode 6 as 0, and 7 and 8 as NA.
          mutate_at(vars(rsten1, lsten1), funs(ifelse(. == 6, 0, .) %>% na_if(7) %>% na_if(8))) %>%
          # Specify transformations will be row-wise.
          rowwise() %>%
          # Subset to rows with values for at least one stenosis variable.
          filter(!(is.na(rsten1) & is.na(lsten1))) %>%
          # Convert and rename age, and calculate maximum stenosis.
          transmute(topmed_subject_id, age = as.numeric(age1c),
                    carotid_stenosis = as.character(max(rsten1, lsten1, na.rm = TRUE))) %>%
          # Exclude rows with any missing data.
          na.omit()
        return(harmonized)
      }
      ```
<a id="cimt_1"></a>
## atherosclerosis: **cimt_1** (cimt)
  Common carotid intima-media thickness, calculated as the mean of two values: mean of multiple thickness estimates from the left far wall and from the right far wall.
  * **Harmonization Units**:
    * [Amish](#cimt_1-amish)
    * [ARIC](#cimt_1-aric)
    * [CHS](#cimt_1-chs)
    * [FHS](#cimt_1-fhs)
    * [JHS](#cimt_1-jhs)
    * [MESA_AirNR](#cimt_1-mesa_airnr)
    * [MESA_classic_family](#cimt_1-mesa_classic_family)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: mm, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-05-30 11:44:19
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C1960466
  * **DCC Harmonization Comments**:

    This variable was harmonized by taking the mean of mean left common carotid artery far wall intima-media thickness (IMT) and mean right common carotid artery far wall IMT. In cases where values for mean left far wall thickness or mean right far wall thickness was missing, mean IMT was calculated ignoring the missing values. Where possible, this variable was derived with component measures of IMT, but in cases where the components were not available in dbGaP, mean-of-mean IMT variables derived by the studies were used for harmonization.
    
    #### MESA
    
    Mean left IMT was not available for the *_MESA_* Family subcohort, so the only component study variable used for this group is mean right IMT.
    
    
    #### Instrumentation
    
    Studies used different instruments at their carotid ultrasound exams:
    
    | Study | Instrument                 |
    |-------|----------------------------|
    | Amish | ATL Phillps HDI 5000       |
    | ARIC  | Biosound 2000 II SA        |
    | CHS   | Toshiba SSA-270A           |
    | FHS   | Toshiba SSH-140A           |
    | JHS   | Hewlett Packard SONOS 4500 |
    | MESA  | GE Logiq 700               |
    
<a id="cimt_1-amish"></a>
  * ### atherosclerosis/cimt_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00252988.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005002 %>%
          rename(age = age_baseline, cimt = imt_mean_farwall_cca_baseline)
      
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        dataset$age[dataset$age %in% '90+'] <- 90
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$cimt[dataset$cimt %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$cimt), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="cimt_1-aric"></a>
  * ### atherosclerosis/cimt_1 -- **ARIC**:
    * 7 component_study_variables: `phs000280.v3.pht004063.v1.phv00204712.v1`, `phs000280.v3.pht004207.v1.phv00211095.v1`, `phs000280.v3.pht004207.v1.phv00211096.v1`, `phs000280.v3.pht004207.v1.phv00211097.v1`, `phs000280.v3.pht004207.v1.phv00211101.v1`, `phs000280.v3.pht004207.v1.phv00211102.v1`, `phs000280.v3.pht004207.v1.phv00211103.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        # Join dataset containing Age with dataset containing IMT.
        dataset <- plyr::join_all(phen_list$source_data)
      
        # Rename variables.
        dataset <- rename(dataset,
                          age = V1AGE01,
                          ropt = ROPAAV45,
                          rant = RANAAV45,
                          rpos = RPOAAV45,
                          lopt = LOPAAV45,
                          lant = LANAAV45,
                          lpos = LPOAAV45)
      
        # Convert from character to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Calculate mean of the Right IMT measurements.
        dataset_R <- subset(dataset, select = c(topmed_subject_id, ropt, rant, rpos))
        dataset$mean_imt_R <- rowMeans(subset(dataset_R, select = -c(topmed_subject_id)), na.rm = TRUE)
      
        # Calculate mean of the Left IMT measurements.
        dataset_L <- subset(dataset, select = c(topmed_subject_id, lopt, lant, lpos))
        dataset$mean_imt_L <- rowMeans(subset(dataset_L, select = -c(topmed_subject_id)), na.rm = TRUE)
      
        # Calculate mean of Right IMT mean measurement and Left IMT mean measurement.
        means_RL <- subset(dataset, select = c(topmed_subject_id, mean_imt_R, mean_imt_L))
        dataset$cimt <- rowMeans(subset(means_RL, select = -c(topmed_subject_id)), na.rm = TRUE)
      
        # Include only relevant variables in final dataset.
        dataset <- subset(dataset, select = c(topmed_subject_id, age, cimt))
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="cimt_1-chs"></a>
  * ### atherosclerosis/cimt_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001468.v1.phv00100864.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Join age and imt data into one dataset.
        dataset <- plyr::join_all(phen_list$source_data) %>%
      
          # Rename age and far wall mean cimt variables.
          rename(age = AGEBL, cimt = CCA_FWME) %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric) %>%
      
          # Remove NAs
          na.omit() %>%
      
          return()
      }
      ```
<a id="cimt_1-fhs"></a>
  * ### atherosclerosis/cimt_1 -- **FHS**:
    * 2 component_study_variables: `phs000007.v29.pht000907.v5.phv00076366.v4`, `phs000007.v29.pht003099.v4.phv00177940.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        harmonized <- source_data$pht000907 %>%
          # Join age dataset and cimt dataset.
          full_join(source_data$pht003099, "topmed_subject_id") %>%
          # Select, convert and rename variables.
          transmute(topmed_subject_id,
                    cimt = as.numeric(cca_fw_mean_imt),
                    age = as.numeric(age6)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(harmonized)
      }
      ```
<a id="cimt_1-jhs"></a>
  * ### atherosclerosis/cimt_1 -- **JHS**:
    * 7 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001978.v1.phv00128531.v1`, `phs000286.v5.pht001978.v1.phv00128532.v1`, `phs000286.v5.pht001978.v1.phv00128533.v1`, `phs000286.v5.pht001978.v1.phv00128534.v1`, `phs000286.v5.pht001978.v1.phv00128535.v1`, `phs000286.v5.pht001978.v1.phv00128536.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        source_data <- phen_list$source_data
        dataset <- inner_join(source_data$pht001949,
                              source_data$pht001978,
                              by = "topmed_subject_id") %>%
          rename(age = AGE01)
      
        # Substitute the value of 'NA' to missing.
        dataset$lcl_av45[dataset$lcl_av45 %in% 'NA'] <- NA
        dataset$lca_av45[dataset$lca_av45 %in% 'NA'] <- NA
        dataset$lcp_av45[dataset$lcp_av45 %in% 'NA'] <- NA
        dataset$rcl_av45[dataset$rcl_av45 %in% 'NA'] <- NA
        dataset$rca_av45[dataset$rca_av45 %in% 'NA'] <- NA
        dataset$rcp_av45[dataset$rcp_av45 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Take mean of the 3 measurements from the left common carotid artery.
        left <- c("lcl_av45", "lca_av45", "lcp_av45")
        dataset <- mutate(dataset, left_av = rowMeans(dataset[, left], na.rm = TRUE))
      
        # Take mean of the 3 measurements from the right common carotid artery.
        right <- c("rcl_av45", "rca_av45", "rcp_av45")
        dataset <- mutate(dataset, right_av = rowMeans(dataset[, right], na.rm = TRUE))
      
        # Take mean of the left and right means.
        av <- c("left_av", "right_av")
        dataset <- mutate(dataset, cimt = rowMeans(dataset[, av], na.rm = TRUE))
      
        # Select the columns for output.
        dataset <- select(dataset, topmed_subject_id, age, cimt)
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$cimt), ]
      
        return(dataset)
      }
      ```
<a id="cimt_1-mesa_airnr"></a>
  * ### atherosclerosis/cimt_1 -- **MESA_AirNR**:
    * 3 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001528.v1.phv00111973.v1`, `phs000209.v13.pht001528.v1.phv00112049.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        harmonized <- source_data$pht001528 %>%
          # Join age dataset and phenotype dataset.
          inner_join(source_data$pht001111, "topmed_subject_id") %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Specify operations on dataframe are row-wise.
          rowwise() %>%
          # Rename variables and calculate the mean of left and right far-wall
          # thickness.
          transmute(topmed_subject_id, age = age1c,
                    cimt = mean(c(rcfwmn4, lcfwmn4), na.rm = TRUE)) %>%
          # Exlcude rows with missing data.
          na.omit()
        return(harmonized)
      }
      ```
<a id="cimt_1-mesa_classic_family"></a>
  * ### atherosclerosis/cimt_1 -- **MESA_classic_family**:
    * 5 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084879.v2`, `phs000209.v13.pht001116.v10.phv00084958.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00128698.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Rename variables from Family exam dataset to match Classic variable names.
        harmonized <- rename(source_data$pht001121, rcfwmn1 = rcfwmnf,
                             age1c = agefc) %>%
          # Bind dataframes row-wise.
          bind_rows(source_data$pht001116) %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Specify operations will be row-wise.
          rowwise() %>%
          # Rename variables, and calculate mean-of-mean cimt.
          transmute(topmed_subject_id, cimt = mean(c(rcfwmn1, lcfwmn1), na.rm = TRUE),
                    age = age1c) %>%
          # Exclude rows with missing data.
          na.omit()
        return(harmonized)
      }
      ```
<a id="cimt_2"></a>
## atherosclerosis: **cimt_2** (cimt)
  Common carotid intima-media thickness, calculated as the mean of four values: maximum of multiple thickness estimates from the left far wall, left near wall, right far wall, and right near wall.
  * **Harmonization Units**:
    * [ARIC](#cimt_2-aric)
    * [CHS](#cimt_2-chs)
    * [FHS](#cimt_2-fhs)
    * [JHS](#cimt_2-jhs)
    * [MESA_airnr](#cimt_2-mesa_airnr)
    * [MESA_classic_family](#cimt_2-mesa_classic_family)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: mm, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-05-30 12:10:37
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C1960466
  * **DCC Harmonization Comments**:

    This variable was harmonized by taking the mean of the following four measurements of common carotid intima-media thickness (IMT): maximum left near wall IMT, maximum left far wall IMT, maximum right near wall IMT and maximum right far wall IMT. In cases where values for individual measures of IMT were missing, mean IMT was calculated ignoring the missing values. Where possible, this variable was derived with component measures of IMT, but in cases where the components were not available in dbGaP, mean-of-max IMT variables derived by the studies were used for harmonization.
    
    #### CHS
    
    Baseline carotid ultrasound scans for the Original cohort were reread due to reader drift. Reread measurements of *_CHS_* subjects were used for harmonization.[^1]
    
    #### FHS
    
    Measurements of *_FHS_* subjects were taken in systole and diastole. Measurements in diastole were used for harmonization.
    
    #### Instrumentation
    
    Studies used different instruments at their carotid ultrasound exams:
    
    | Study | Instrument                 |
    |-------|----------------------------|
    | ARIC  | Biosound 2000 II SA        |
    | CHS   | Toshiba SSA-270A           |
    | FHS   | Toshiba SSH-140A           |
    | JHS   | Hewlett Packard SONOS 4500 |
    | MESA  | GE Logiq 700               |
    
    
    [^1]:[Documentation Without Data Collection Forms phd002779.1](https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/document.cgi?study_id=phs000287.v6.p1&phd=2779)
    
<a id="cimt_2-aric"></a>
  * ### atherosclerosis/cimt_2 -- **ARIC**:
    * 13 component_study_variables: `phs000280.v3.pht004063.v1.phv00204712.v1`, `phs000280.v3.pht004207.v1.phv00211053.v1`, `phs000280.v3.pht004207.v1.phv00211054.v1`, `phs000280.v3.pht004207.v1.phv00211055.v1`, `phs000280.v3.pht004207.v1.phv00211059.v1`, `phs000280.v3.pht004207.v1.phv00211060.v1`, `phs000280.v3.pht004207.v1.phv00211061.v1`, `phs000280.v3.pht004207.v1.phv00211081.v1`, `phs000280.v3.pht004207.v1.phv00211082.v1`, `phs000280.v3.pht004207.v1.phv00211083.v1`, `phs000280.v3.pht004207.v1.phv00211087.v1`, `phs000280.v3.pht004207.v1.phv00211088.v1`, `phs000280.v3.pht004207.v1.phv00211089.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        # Join dataset containing Age with dataset containing IMT.
        dataset_0 <- plyr::join_all(phen_list$source_data)
      
        # Rename variables.
        dataset_0 <- rename(dataset_0,
                          age = V1AGE01,
                          lopt_nw = LOPAMX23,
                          lant_nw = LANAMX23,
                          lpos_nw = LPOAMX23,
                          ropt_nw = ROPAMX23,
                          rant_nw = RANAMX23,
                          rpos_nw = RPOAMX23,
                          lopt_fw = LOPAMX45,
                          lant_fw = LANAMX45,
                          lpos_fw = LPOAMX45,
                          ropt_fw = ROPAMX45,
                          rant_fw = RANAMX45,
                          rpos_fw = RPOAMX45)
      
        # Convert from character to numeric.
        dataset_0 <- mutate_if(dataset_0, is.character, as.numeric)
      
        # Find max of Left Near Wall IMT.
        L_nw_ds <- subset(dataset_0, select = c(lopt_nw, lant_nw, lpos_nw))
        dataset_0$L_nw_max <- apply(L_nw_ds, 1,
                                    function(x) ifelse(all(is.na(x)), NA, max(x, na.rm = TRUE)))
      
        # Find max of Right Near Wall IMT.
        R_nw_ds <- subset(dataset_0, select = c(ropt_nw, rant_nw, rpos_nw))
        dataset_0$R_nw_max <- apply(R_nw_ds, 1,
                                    function(x) ifelse(all(is.na(x)), NA, max(x, na.rm = TRUE)))
      
        # Find max of Left Far Wall IMT.
        L_fw_ds <- subset(dataset_0, select = c(lopt_fw, lant_fw, lpos_fw))
        dataset_0$L_fw_max <- apply(L_fw_ds, 1,
                                    function(x) ifelse(all(is.na(x)), NA, max(x, na.rm = TRUE)))
      
        # Find max of Right Far Wall IMT.
        R_fw_ds <- subset(dataset_0, select = c(ropt_fw, rant_fw, rpos_fw))
        dataset_0$R_fw_max <- apply(R_fw_ds, 1,
                                    function(x) ifelse(all(is.na(x)), NA, max(x, na.rm = TRUE)))
      
        # Find mean of max LNW, RNW, LFW, RFW.
        maxCols <- subset(dataset_0, select = c(L_nw_max, R_nw_max, L_fw_max, R_fw_max))
        dataset_0$cimt <- rowMeans(maxCols)
      
        # Create harmonized cimt dataset.
        dataset <- subset(dataset_0, select = c(topmed_subject_id, age, cimt))
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="cimt_2-chs"></a>
  * ### atherosclerosis/cimt_2 -- **CHS**:
    * 10 component_study_variables: `phs000287.v6.pht001452.v1.phv00100290.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001473.v1.phv00101238.v1`, `phs000287.v6.pht001473.v1.phv00101239.v1`, `phs000287.v6.pht001473.v1.phv00101250.v1`, `phs000287.v6.pht001473.v1.phv00101251.v1`, `phs000287.v6.pht001473.v1.phv00101264.v1`, `phs000287.v6.pht001473.v1.phv00101265.v1`, `phs000287.v6.pht001473.v1.phv00101276.v1`, `phs000287.v6.pht001473.v1.phv00101277.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        # Join dataset containing Age with dataset containing IMT.
        dataset_0 <- plyr::join_all(phen_list$source_data)
      
        # Rename variables.
        dataset_0 <- rename(dataset_0,
                            age = AGEBL,
                            subcohort = PERSTAT,
                            O_R_max_nw = NMAX155,
                            O_R_max_fw = FMAX155,
                            O_L_max_nw = NMAX555,
                            O_L_max_fw = FMAX555,
                            A_R_max_nw = NMAX141,
                            A_R_max_fw = FMAX141,
                            A_L_max_nw = NMAX541,
                            A_L_max_fw = FMAX541)
      
        # Convert from character to numeric.
        dataset_0 <- mutate_if(dataset_0, is.character, as.numeric)
      
        # Subset cohort 1 and create cimt variable.
        dataset_orig <- subset(dataset_0, select = c(topmed_subject_id,
                                                     age,
                                                     subcohort,
                                                     O_R_max_nw,
                                                     O_R_max_fw,
                                                     O_L_max_nw,
                                                     O_L_max_fw))
      
        dataset_orig <- dataset_orig[dataset_orig$subcohort == 1, ]
        maxCols <- c("O_R_max_nw", "O_R_max_fw", "O_L_max_nw", "O_L_max_fw")
        dataset_orig$cimt <- rowMeans(dataset_orig[, maxCols], na.rm = TRUE)
      
        # Subset cohort 2 and create cimt variable.
        dataset_new <- subset(dataset_0, select = c(topmed_subject_id,
                                                    age,
                                                    subcohort,
                                                    A_R_max_nw,
                                                    A_R_max_fw,
                                                    A_L_max_nw,
                                                    A_L_max_fw))
      
        dataset_new <- dataset_new[dataset_new$subcohort == 2, ]
        maxCols <- c("A_R_max_nw", "A_R_max_fw", "A_L_max_nw", "A_L_max_fw")
        dataset_new$cimt <- rowMeans(dataset_new[, maxCols], na.rm = TRUE)
      
        # Join cohort 1 and cohort 2 cimt variable by Topmed IDs.
        dataset_orig_1 <- subset(dataset_orig, select = c(topmed_subject_id, age, cimt))
        dataset_new_1 <- subset(dataset_new, select = c(topmed_subject_id, age, cimt))
        dataset <- dplyr::full_join(dataset_orig_1,
                                    dataset_new_1,
                                    by = c("topmed_subject_id", "age", "cimt"))
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      }
      ```
<a id="cimt_2-fhs"></a>
  * ### atherosclerosis/cimt_2 -- **FHS**:
    * 2 component_study_variables: `phs000007.v29.pht000083.v6.phv00021728.v5`, `phs000007.v29.pht003099.v4.phv00177940.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        source_data <- phen_list$source_data
        # Join ultrasound dataset with age dataset.
        harmonized <- left_join(source_data$pht000083, source_data$pht003099,
                                "topmed_subject_id") %>%
          # Rename variables and convert to numeric.
          transmute(topmed_subject_id, cimt = as.numeric(CCD_MEMX), age = as.numeric(age6)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(harmonized)
      }
      ```
<a id="cimt_2-jhs"></a>
  * ### atherosclerosis/cimt_2 -- **JHS**:
    * 13 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001978.v1.phv00128541.v1`, `phs000286.v5.pht001978.v1.phv00128542.v1`, `phs000286.v5.pht001978.v1.phv00128543.v1`, `phs000286.v5.pht001978.v1.phv00128544.v1`, `phs000286.v5.pht001978.v1.phv00128545.v1`, `phs000286.v5.pht001978.v1.phv00128546.v1`, `phs000286.v5.pht001978.v1.phv00128561.v1`, `phs000286.v5.pht001978.v1.phv00128562.v1`, `phs000286.v5.pht001978.v1.phv00128563.v1`, `phs000286.v5.pht001978.v1.phv00128564.v1`, `phs000286.v5.pht001978.v1.phv00128565.v1`, `phs000286.v5.pht001978.v1.phv00128566.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        source_data <- phen_list$source_data
        dataset <- inner_join(source_data$pht001949,
                              source_data$pht001978,
                              by = "topmed_subject_id") %>%
          rename(age = AGE01)
      
        # Substitute the value of 'NA' to missing.
        dataset$lcl_mx45[dataset$lcl_mx45 %in% 'NA'] <- NA
        dataset$lca_mx45[dataset$lca_mx45 %in% 'NA'] <- NA
        dataset$lcp_mx45[dataset$lcp_mx45 %in% 'NA'] <- NA
        dataset$rcl_mx45[dataset$rcl_mx45 %in% 'NA'] <- NA
        dataset$rca_mx45[dataset$rca_mx45 %in% 'NA'] <- NA
        dataset$rcp_mx45[dataset$rcp_mx45 %in% 'NA'] <- NA
        dataset$lcl_mx23[dataset$lcl_mx23 %in% 'NA'] <- NA
        dataset$lca_mx23[dataset$lca_mx23 %in% 'NA'] <- NA
        dataset$lcp_mx23[dataset$lcp_mx23 %in% 'NA'] <- NA
        dataset$rcl_mx23[dataset$rcl_mx23 %in% 'NA'] <- NA
        dataset$rca_mx23[dataset$rca_mx23 %in% 'NA'] <- NA
        dataset$rcp_mx23[dataset$rcp_mx23 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Take max of the 3 measurements from the left common carotid artery far wall.
        left_fw <- c("lca_mx45", "lcl_mx45", "lcp_mx45")
        dataset$left_fw_max <- apply(dataset[, left_fw],
                                     1,
                                     function(x) ifelse(all(is.na(x)),
                                                        NA,
                                                        max(x, na.rm = TRUE)))
      
        # Take max of the 3 measurements from the right common carotid artery far wall.
        right_fw <- c("rca_mx45", "rcl_mx45", "rcp_mx45")
        dataset$right_fw_max <- apply(dataset[, right_fw],
                                      1,
                                      function(x) ifelse(all(is.na(x)),
                                                         NA,
                                                         max(x, na.rm = TRUE)))
      
        # Take max of the 3 measurements from the left common carotid artery near wall.
        left_nw <- c("lca_mx23", "lcl_mx23", "lcp_mx23")
        dataset$left_nw_max <- apply(dataset[, left_nw],
                                     1,
                                     function(x) ifelse(all(is.na(x)),
                                                        NA,
                                                        max(x, na.rm = TRUE)))
      
        # Take max of the 3 measurements from the right common carotid artery near wall.
        right_nw <- c("rca_mx23", "rcl_mx23", "rcp_mx23")
        dataset$right_nw_max <- apply(dataset[, right_nw],
                                      1,
                                      function(x) ifelse(all(is.na(x)),
                                                         NA,
                                                         max(x, na.rm = TRUE)))
      
        # Take mean of the left and right, far and near wall max.
        wmax <- c("left_fw_max", "right_fw_max", "left_nw_max", "right_nw_max")
        dataset <- mutate(dataset, cimt = rowMeans(dataset[, wmax], na.rm = TRUE))
      
        # Select the columns for output.
        dataset <- select(dataset, topmed_subject_id, age, cimt)
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$cimt), ]
      
        return(dataset)
      }
      ```
<a id="cimt_2-mesa_airnr"></a>
  * ### atherosclerosis/cimt_2 -- **MESA_airnr**:
    * 5 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001528.v1.phv00111971.v1`, `phs000209.v13.pht001528.v1.phv00111975.v1`, `phs000209.v13.pht001528.v1.phv00112047.v1`, `phs000209.v13.pht001528.v1.phv00112051.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Join age dataset with ultrasound dataset.
        harmonized <- left_join(source_data$pht001528, source_data$pht001111,
                                "topmed_subject_id") %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Specify calculations will be row-wise.
          rowwise() %>%
          # Select and rename necessary variables, calculate mean cimt.
          transmute(topmed_subject_id, age = age1c,
                    cimt = mean(c(rcfwmax4, rcnwmax4, lcfwmax4, lcnwmax4), na.rm = TRUE)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(harmonized)
      }
      ```
<a id="cimt_2-mesa_classic_family"></a>
  * ### atherosclerosis/cimt_2 -- **MESA_classic_family**:
    * 10 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084877.v2`, `phs000209.v13.pht001116.v10.phv00084881.v2`, `phs000209.v13.pht001116.v10.phv00084956.v2`, `phs000209.v13.pht001116.v10.phv00084959.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087557.v1`, `phs000209.v13.pht001121.v3.phv00087558.v1`, `phs000209.v13.pht001121.v3.phv00087559.v1`, `phs000209.v13.pht001121.v3.phv00087560.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Rename variables in Family Exam dataset to match Classic.
        source_data$pht001121 <- rename(source_data$pht001121, age1c = agefc,
                                        rcfwmax1 = rcfwmaxf, rcnwmax1 = rcnwmaxf,
                                        lcfwmax1 = lcfwmaxf, lcnwmax1 = lcnwmaxf)
        # Bind dataframe row-wise.
        harmonized <- bind_rows(source_data) %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Specify calculations will be row-wise.
          rowwise() %>%
          # Select and rename necessary variables, calculate mean cimt.
          transmute(topmed_subject_id, age = age1c,
                    cimt = mean(c(lcfwmax1, lcnwmax1, rcfwmax1, rcnwmax1), na.rm = TRUE)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(harmonized)
      }
      ```

# atherosclerosis_events_incident

### Variables in this section:
* [angina_incident_1](#angina_incident_1)
* [cabg_incident_1](#cabg_incident_1)
* [cad_followup_start_age_1](#cad_followup_start_age_1)
* [chd_death_definite_1](#chd_death_definite_1)
* [chd_death_probable_1](#chd_death_probable_1)
* [coronary_angioplasty_incident_1](#coronary_angioplasty_incident_1)
* [mi_incident_1](#mi_incident_1)
* [pad_incident_1](#pad_incident_1)

<a id="angina_incident_1"></a>
## atherosclerosis_events_incident: **angina_incident_1** (angina_incident)
  An indicator of whether a subject had an angina event (that was verified by adjudication or by medical professionals) during the follow-up period.
  * **Harmonization Units**:
    * [FHS](#angina_incident_1-fhs)
    * [WHI](#angina_incident_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:33:13
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0002962
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the occurrence of an angina event during follow-up. If a study recorded multiple events, the DCC harmonized only the earliest event after the start of follow-up, and the corresponding age at event was used for the accompanying age variable. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when the angina event occurred or the age at last follow-up or death for those participants who did not have an angina event.
    
    ### Study-specific comments
    
    #### FHS
    
    The data available for angina includes events through December 2016. The data available for participants who did not have an angina event is through December 2014. Therefore, the age at censorship for participants who did not have an angina event is recorded through 2014, while participants who did have an angina event have their age recorded through 2016.
    
    
<a id="angina_incident_1-fhs"></a>
  * ### atherosclerosis_events_incident/angina_incident_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000309.v13.phv00036469.v12`, `phs000007.v30.pht000309.v13.phv00036471.v12`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          # Join datasets.
          dat <- full_join(source_data$pht003099, source_data$pht000309, by = "topmed_subject_id") %>%
      
            # Convert age to numeric.
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      event = as.numeric(EVENT),
                      date = as.numeric(DATE))
      
          # Create angina_incident variable. Gather all angina_incident events.
          dat$angina_incident  <- case_when(
            dat$event == 6 ~ 1,
            dat$event != 6 ~ 0,
            is.na(dat$event) ~ NA_real_
          )
      
          # Calculate age at event.
          dat$age_at_event <- dat$cad_followup_start_age + (dat$date / 365.25)
      
          # Identify prior angina events.
          dat <- dat %>%
            mutate(angina_incident = case_when(date <= 0 ~ 0,
                                           angina_incident == 1 & date > 0 ~ 1,
                                           TRUE ~ angina_incident))
      
          # Find subjects with multiple angina events and select first angina event.
          angina_event <- dat %>%
            filter(angina_incident == 1) %>%
            arrange(topmed_subject_id, date) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-event)
      
          # Gather all non-angina-event subjects.
          non_angina_event <- dat %>%
            filter(angina_incident == 0) %>%
            select(-event)
      
          # Gather all non-event subjects from surv dataset.
          dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      cvd_status = as.numeric(cvd),
                      date = as.numeric(cvddate))
      
          # Create a non-event specific dataset and remove duplicates.
          non_event <- dat2 %>%
            filter(cvd_status == 0) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-cvd_status)
      
          # Create an angina_incident variable for non-event subjects.
          non_event$angina_incident <- 0
      
          # Create an age at censoring variable for non-event subjects.
          non_event$age_at_event <-
            non_event$cad_followup_start_age + (non_event$date / 365.25)
      
          # Bind non_event and non_angina_event datasets and remove duplicates.
          non_event_all <- rbind(non_event, non_angina_event) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Combine all angina-event subjects with non-angina-event subjects.
          dat_combined <- bind_rows(angina_event, non_event_all) %>%
            arrange(topmed_subject_id, desc(angina_incident)) %>%
      
            # Remove duplicate subjects with multiple events.
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            transmute(topmed_subject_id,
                      angina_incident = as.character(angina_incident),
                      age = age_at_event) %>%
            na.omit()
      
          return(dat_combined)
      }
      ```
<a id="angina_incident_1-whi"></a>
  * ### atherosclerosis_events_incident/angina_incident_1 -- **WHI**:
    * 7 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht003395.v3.phv00192302.v3`, `phs000200.v11.pht003407.v3.phv00193145.v3`, `phs000200.v11.pht003407.v3.phv00193146.v3`, `phs000200.v11.pht003407.v3.phv00193504.v3`, `phs000200.v11.pht003407.v3.phv00193505.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join all dataframes in the list.
          dat <- plyr::join_all(phen_list$source_data, "topmed_subject_id", "full") %>%
              # Convert numeric variables to numeric type.
              mutate_at(vars(ends_with("DY"), AGE, F2DAYS), as.numeric) %>%
              # Set positive F2DAYS values to 0.
              mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ x)) %>%
              # Calculate time to last followup.
              mutate(censordy = case_when(EXT2MRC == 1 ~ ENDFOLLOWDY, TRUE ~ ENDEXT1DY),
                     # Use time-to_event when an event occured; otherwise use time to end-of-followup.
                     eventdy = case_when(ANGINA == 1 ~ ANGINADY, ANGINA == 0 ~ censordy),
                     # Calculate age at event/end-of-followup.
                     age = AGE + (abs(F2DAYS) + eventdy) / 365.25) %>%
              # Drop old variables.
              select(topmed_subject_id, angina_incident = ANGINA, age) %>%
              # Exclude rows with missing data.
              na.omit()
          return(dat)
      }
      ```
<a id="cabg_incident_1"></a>
## atherosclerosis_events_incident: **cabg_incident_1** (cabg_incident)
  An indicator of whether a subject had a coronary artery bypass graft (CABG) procedure (that was verified by adjudication or by medical professionals) during the follow-up period.
  * **Harmonization Units**:
    * [FHS](#cabg_incident_1-fhs)
    * [WHI](#cabg_incident_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:33:20
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0010055
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the occurrence of a CABG procedure during follow-up. If a study recorded multiple procedures, the DCC harmonized only the earliest event after the start of follow-up, and the corresponding age at event was used for the accompanying age variable. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when the CABG procedure occurred or the age at last follow-up or death for those participants who did not have a CABG procedure.
    
    
    ### Study-specific comments
    
    #### FHS
    
    The data available for CABG includes procedures through December 2016. The data available for participants who did not have a CABG procedure is through December 2014. Therefore, the accompanying age variable for participants who did not have a CABG procedure is recorded through 2014, while participants who did have a CABG procedure have their age recorded through 2016. 
    
    
<a id="cabg_incident_1-fhs"></a>
  * ### atherosclerosis_events_incident/cabg_incident_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000389.v10.phv00054697.v8`, `phs000007.v30.pht000389.v10.phv00163410.v7`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          # Join datasets.
          dat <- full_join(source_data$pht003099, source_data$pht000389, by = "topmed_subject_id") %>%
            # Convert age to numeric.
            transmute(topmed_subject_id,
                      cabg_incident = ifelse(as.numeric(VESSEL) > 0, 1, 0),
                      date = as.numeric(PROCDATE),
                      cad_followup_start_age = as.numeric(age1))
      
          ## Calculate age at event.
          dat$age_at_event <- replicate(length(dat$cabg_incident), 0)
          dat$age_at_event <- floor(dat$cad_followup_start_age + (dat$date / 365.25))
      
          # Identify prior cabg events.
          dat <- dat %>%
            mutate(cabg_incident = case_when(date <= 0 ~ 0,
                                           cabg_incident == 1 & date > 0 ~ 1,
                                           TRUE ~ cabg_incident))
      
          # Find subjects with multiple cabg events and select first cabg event.
          cabg_event <- dat %>%
            filter(cabg_incident == 1) %>%
            arrange(topmed_subject_id, date) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Gather all non-cabg-event subjects and remove duplicate subjects.
          non_cabg_event <- dat %>%
            filter(cabg_incident == 0)
      
          # Gather all non-event subjects from surv dataset.
          dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      cvd_status = as.numeric(cvd),
                      date = as.numeric(cvddate))
      
          # Create a non-event specific dataset and remove duplicates.
          non_event <- dat2 %>%
            filter(cvd_status == 0) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-cvd_status)
      
          # Create an cabg_incident variable for non-event subjects.
          non_event$cabg_incident <- 0
      
          # Create an age at censoring variable for non-event subjects.
          non_event$age_at_event <-
            non_event$cad_followup_start_age + (non_event$date / 365.25)
      
          # Bind non_event and non_cabg_event datasets and remove duplicates.
          non_event_all <- rbind(non_event, non_cabg_event) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Combine all cabg-event subjects with non-cabg-event subjects.
          dat_combined <- bind_rows(cabg_event, non_event_all) %>%
            arrange(topmed_subject_id, desc(cabg_incident)) %>%
      
            # Remove duplicate subjects with multiple events.
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            transmute(topmed_subject_id,
                      cabg_incident = as.character(cabg_incident),
                      age = age_at_event) %>%
            na.omit()
      
          return(dat_combined)
      }
      ```
<a id="cabg_incident_1-whi"></a>
  * ### atherosclerosis_events_incident/cabg_incident_1 -- **WHI**:
    * 7 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht003395.v3.phv00192302.v3`, `phs000200.v11.pht003407.v3.phv00193157.v3`, `phs000200.v11.pht003407.v3.phv00193158.v3`, `phs000200.v11.pht003407.v3.phv00193504.v3`, `phs000200.v11.pht003407.v3.phv00193505.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join all dataframes in the list.
          dat <- plyr::join_all(phen_list$source_data, "topmed_subject_id", "full") %>%
              # Convert numeric variables to numeric type.
              mutate_at(vars(ends_with("DY"), AGE, F2DAYS), as.numeric) %>%
              # Set positive F2DAYS values to 0.
              mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ x)) %>%
              # Calculate age at event/censoring.
              mutate(censordy = case_when(EXT2MRC == 1 ~ ENDFOLLOWDY, TRUE ~ ENDEXT1DY),
                     eventdy = case_when(CABG == 1 ~ CABGDY, CABG == 0 ~ censordy),
                     age = AGE + (abs(F2DAYS) + eventdy) / 365.25) %>%
              # Drop old variables.
              select(topmed_subject_id, cabg_incident = CABG, age) %>%
              # Exclude rows with missing data.
              na.omit()
          return(dat)
      }
      ```
<a id="cad_followup_start_age_1"></a>
## atherosclerosis_events_incident: **cad_followup_start_age_1** (cad_followup_start_age)
  Age of subject at the start of the follow-up period during which atherosclerosis events were reviewed and adjudicated.
  * **Harmonization Units**:
    * [FHS](#cad_followup_start_age_1-fhs)
    * [WHI](#cad_followup_start_age_1-whi)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: cad_followup_start_age, **`Version`**: 1, **`Has Age Variable`**: No, **`Date Harmonized`**: 2019-10-31 16:32:31
  * **DCC Harmonization Comments**:

    This variable represents the age at which the follow-up period began for the following incident event variables: `mi_incident_1`, `cabg_incident_1`, `coronary_angioplasty_incident_1`, `angina_incident_1`, `pad_incident_1`. For most studies, this variable was harmonized from component variables indicating the age at baseline visit.
    
    ### Study-specific comments
    
    #### WHI
    
    The age at follow-up start does not directly correspond to the age at which prior history of CAD indicators were determined.
    
    
<a id="cad_followup_start_age_1-fhs"></a>
  * ### atherosclerosis_events_incident/cad_followup_start_age_1 -- **FHS**:
    * 1 component_study_variables: `phs000007.v30.pht003099.v5.phv00177930.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Rename age variable and convert to numeric.
        dat <- transmute(phen_list$source_data$pht003099, topmed_subject_id,
                         cad_followup_start_age = as.numeric(age1)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="cad_followup_start_age_1-whi"></a>
  * ### atherosclerosis_events_incident/cad_followup_start_age_1 -- **WHI**:
    * 1 component_study_variables: `phs000200.v11.pht000998.v6.phv00078437.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Rename age variable and convert to numeric.
        dat <- transmute(phen_list$source_data$pht000998, topmed_subject_id,
                         cad_followup_start_age = as.numeric(AGE)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="chd_death_definite_1"></a>
## atherosclerosis_events_incident: **chd_death_definite_1** (chd_death_definite)
  An indicator of whether the cause of death was determined by medical professionals or technicians to be "definite" coronary heart disease for subjects who died during the follow-up period.
  * **Harmonization Units**:
    * [FHS](#chd_death_definite_1-fhs)
    * [WHI](#chd_death_definite_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:34:13
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C3844303
  * **DCC Harmonization Comments**:

    This variable was harmonized by using  "death type" and "death status" variables to classify individuals whose cause of death was determined to be definitely related to CHD.
    
    This variable should be consistent with the harmonized variable `chd_death_probable_1` in that all "definite" cases should also be "probable" cases.
    
    
<a id="chd_death_definite_1-fhs"></a>
  * ### atherosclerosis_events_incident/chd_death_definite_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000309.v13.phv00036469.v12`, `phs000007.v30.pht000309.v13.phv00036471.v12`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
            # Join datasets.
            dat <- full_join(source_data$pht003099, source_data$pht000309, by = "topmed_subject_id") %>%
      
              # Convert age to numeric.
              transmute(topmed_subject_id,
                        cad_followup_start_age = as.numeric(age1),
                        event = as.numeric(EVENT),
                        date = as.numeric(DATE))
      
            # Create chd_death_definite variable. Gather all chd_death_definite events.
            dat$chd_death_definite <- replicate(length(dat$event), 0)
            dat$chd_death_definite  <- case_when(
              dat$event == 9 | dat$event == 21 | dat$event == 22 | dat$event == 23 | dat$event == 24 ~ 1,
              dat$event != 9 & dat$event < 21 | dat$event > 24 ~ 0,
              is.na(dat$event) ~ NA_real_
            )
      
            # Calculate age at event.
            dat$age_at_event <- replicate(length(dat$event), 0)
            dat$age_at_event <- floor(dat$cad_followup_start_age + (dat$date / 365.25))
      
            # Create a chd_death event dataset.
            chd_death_event <- dat %>%
              filter(chd_death_definite == 1)
      
            # Gather all non-chd_death-event subjects and remove duplicate subjects.
            non_chd_death_event <- dat %>%
              filter(chd_death_definite == 0) %>%
              arrange(topmed_subject_id, desc(date)) %>%
              distinct(topmed_subject_id, .keep_all = TRUE)
      
            # Gather all non-event subjects from surv dataset and remove duplicates.
            dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
              transmute(topmed_subject_id,
                        cad_followup_start_age = as.numeric(age1),
                        cvd_status = as.numeric(cvd),
                        surv_date = as.numeric(cvddate))
      
            # Create a non-event specific dataset.
            non_event <- dat2 %>%
              filter(cvd_status == 0) %>%
              arrange(topmed_subject_id, desc(surv_date)) %>%
              distinct(topmed_subject_id, .keep_all = TRUE)
      
            # Create a chd_death variable for non-event subjects.
            non_event$chd_death_definite <- replicate(length(non_event$cvd_status), 0)
      
            # Create an age at censoring variable for non-event subjects.
            non_event$age_at_event <- replicate(length(non_event$cvd_status), 0)
            non_event$age_at_event <-
              floor(non_event$cad_followup_start_age + (non_event$surv_date / 365.25))
      
            # Create an event variable for non_event subjects.
            non_event$event <- replicate(length(non_event$cvd_status), 0)
      
            # Combine all chd_death-event subjects with non-chd_death-event subjects.
            dat_combined <- bind_rows(chd_death_event, non_chd_death_event)
      
            # Remove duplicate subjects with multiple events.
            dat_combined <- dat_combined %>%
              arrange(topmed_subject_id, desc(chd_death_definite)) %>%
              distinct(topmed_subject_id, .keep_all = TRUE)
      
            # Join combined events data with non-events data.
            all_dat <- full_join(dat_combined, non_event, by = "topmed_subject_id")
      
            # Set all remaining non-event subjects to chd_death_definite = 0.
            inds_event <- which(is.na(all_dat$chd_death_definite.x) & all_dat$chd_death_definite.y == 0)
            all_dat$chd_death_definite.x[inds_event] <- 0
      
            # Combine age at censoring with age at event into one variable.
            inds_age <- which(is.na(all_dat$age_at_event.x) & !is.na(all_dat$age_at_event.y))
            all_dat$age_at_event.x[inds_age] <- all_dat$age_at_event.y[inds_age]
      
            # Set follow up start age for all remaining subjects.
            inds_age_start <-
              which(is.na(all_dat$cad_followup_start_age.x) & !is.na(all_dat$cad_followup_start_age.y))
            all_dat$cad_followup_start_age.x[inds_age_start] <-
              all_dat$cad_followup_start_age.y[inds_age_start]
      
            # Select columns for final dataset.
            all_dat <- all_dat %>%
              transmute(topmed_subject_id,
                        chd_death_definite = as.character(chd_death_definite.x),
                        age = age_at_event.x) %>%
              na.omit()
      
          return(all_dat)
      }
      ```
<a id="chd_death_definite_1-whi"></a>
  * ### atherosclerosis_events_incident/chd_death_definite_1 -- **WHI**:
    * 8 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht003395.v3.phv00192302.v3`, `phs000200.v11.pht003407.v3.phv00193498.v3`, `phs000200.v11.pht003407.v3.phv00193504.v3`, `phs000200.v11.pht003407.v3.phv00193505.v3`, `phs000200.v11.pht003409.v3.phv00193531.v2`, `phs000200.v11.pht003409.v3.phv00193532.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Join all datasets.
        dat <- plyr::join_all(phen_list$source_data, "topmed_subject_id", "full") %>%
          # Convert numeric variables to numeric type.
          mutate_at(vars(ends_with("DY"), AGE, F2DAYS), as.numeric) %>%
          # Set positive F2DAYS values to 0.
          mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ x)) %>%
          # Calculate age at event/censoring.
          mutate(censordy = ifelse(EXT2MRC == 1, ENDFOLLOWDY, ENDEXT1DY),
                 eventdy = ifelse(DEATH %in% 1, DEATHDY, censordy),
                 age = AGE + (abs(F2DAYS) + eventdy) / 365.25,
                 # Compute harmonized CHD death from death and cause-of-death variables.
                 chd_death_definite = case_when(DEATH == 1 & DEATHCAUSE %in% 11 ~ "1", TRUE ~ "0")) %>%
          select(topmed_subject_id, chd_death_definite, age) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="chd_death_probable_1"></a>
## atherosclerosis_events_incident: **chd_death_probable_1** (chd_death_probable)
  An indicator of whether the cause of death was determined by medical professionals or technicians to be "probable" or "definite" coronary heart disease for subjects who died during the follow-up period.
  * **Harmonization Units**:
    * [FHS](#chd_death_probable_1-fhs)
    * [WHI](#chd_death_probable_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:34:30
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C3844302
  * **DCC Harmonization Comments**:

    This variable was harmonized by using "death type" and "death status" variables to classify individuals whose cause of death was determined to be at least "probable". 
    
    This variable should be consistent with the harmonized variable `chd_death_definite_1` in that all "definite" cases should also be "probable" cases.
    
    
<a id="chd_death_probable_1-fhs"></a>
  * ### atherosclerosis_events_incident/chd_death_probable_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000309.v13.phv00036469.v12`, `phs000007.v30.pht000309.v13.phv00036471.v12`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
            # Join datasets.
            dat <- full_join(source_data$pht003099, source_data$pht000309, by = "topmed_subject_id") %>%
      
              # Convert age to numeric.
              transmute(topmed_subject_id,
                        cad_followup_start_age = as.numeric(age1),
                        event = as.numeric(EVENT),
                        date = as.numeric(DATE))
      
            # Create chd_death_probable variable. Gather all chd_death_probable events.
            dat$chd_death_probable <- replicate(length(dat$event), 0)
            dat$chd_death_probable  <- case_when(
              dat$event == 9 | dat$event == 21 | dat$event == 22 | dat$event == 23 | dat$event == 24 ~ 1,
              dat$event != 9 & dat$event < 21 | dat$event > 24 ~ 0,
              is.na(dat$event) ~ NA_real_
            )
      
            # Calculate age at event.
            dat$age_at_event <- replicate(length(dat$event), 0)
            dat$age_at_event <- floor(dat$cad_followup_start_age + (dat$date / 365.25))
      
            # Create a chd_death event dataset.
            chd_death_event <- dat %>%
              filter(chd_death_probable == 1)
      
            # Gather all non-chd_death-event subjects and remove duplicate subjects.
            non_chd_death_event <- dat %>%
              filter(chd_death_probable == 0) %>%
              arrange(topmed_subject_id, desc(date)) %>%
              distinct(topmed_subject_id, .keep_all = TRUE)
      
            # Gather all non-event subjects from surv dataset and remove duplicates.
            dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
              transmute(topmed_subject_id,
                        cad_followup_start_age = as.numeric(age1),
                        cvd_status = as.numeric(cvd),
                        surv_date = as.numeric(cvddate))
      
            # Create a non-event specific dataset.
            non_event <- dat2 %>%
              filter(cvd_status == 0) %>%
              arrange(topmed_subject_id, desc(surv_date)) %>%
              distinct(topmed_subject_id, .keep_all = TRUE)
      
            # Create a chd_death variable for non-event subjects.
            non_event$chd_death_probable <- replicate(length(non_event$cvd_status), 0)
      
            # Create an age at censoring variable for non-event subjects.
            non_event$age_at_event <- replicate(length(non_event$cvd_status), 0)
            non_event$age_at_event <-
              floor(non_event$cad_followup_start_age + (non_event$surv_date / 365.25))
      
            # Create an event variable for non_event subjects.
            non_event$event <- replicate(length(non_event$cvd_status), 0)
      
            # Combine all chd_death-event subjects with non-chd_death-event subjects.
            dat_combined <- bind_rows(chd_death_event, non_chd_death_event)
      
            # Remove duplicate subjects with multiple events.
            dat_combined <- dat_combined %>%
              arrange(topmed_subject_id, desc(chd_death_probable)) %>%
              distinct(topmed_subject_id, .keep_all = TRUE)
      
            # Join combined events data with non-events data.
            all_dat <- full_join(dat_combined, non_event, by = "topmed_subject_id")
      
            # Set all remaining non-event subjects to chd_death_probable = 0.
            inds_event <- which(is.na(all_dat$chd_death_probable.x) & all_dat$chd_death_probable.y == 0)
            all_dat$chd_death_probable.x[inds_event] <- 0
      
            # Combine age at censoring with age at event into one variable.
            inds_age <- which(is.na(all_dat$age_at_event.x) & !is.na(all_dat$age_at_event.y))
            all_dat$age_at_event.x[inds_age] <- all_dat$age_at_event.y[inds_age]
      
            # Set follow up start age for all remaining subjects.
            inds_age_start <-
              which(is.na(all_dat$cad_followup_start_age.x) & !is.na(all_dat$cad_followup_start_age.y))
            all_dat$cad_followup_start_age.x[inds_age_start] <-
              all_dat$cad_followup_start_age.y[inds_age_start]
      
            # Select columns for final dataset.
            all_dat <- all_dat %>%
              transmute(topmed_subject_id,
                        chd_death_probable = as.character(chd_death_probable.x),
                        age = age_at_event.x) %>%
              na.omit()
      
          return(all_dat)
      }
      ```
<a id="chd_death_probable_1-whi"></a>
  * ### atherosclerosis_events_incident/chd_death_probable_1 -- **WHI**:
    * 8 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht003395.v3.phv00192302.v3`, `phs000200.v11.pht003407.v3.phv00193498.v3`, `phs000200.v11.pht003407.v3.phv00193504.v3`, `phs000200.v11.pht003407.v3.phv00193505.v3`, `phs000200.v11.pht003409.v3.phv00193531.v2`, `phs000200.v11.pht003409.v3.phv00193532.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Join all datasets.
        dat <- plyr::join_all(phen_list$source_data, "topmed_subject_id", "full") %>%
          # Convert numeric variables to numeric type.
          mutate_at(vars(ends_with("DY"), AGE, F2DAYS), as.numeric) %>%
          # Set positive F2DAYS values to 0.
          mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ x)) %>%
          # Calculate age at event/censoring.
          mutate(censordy = ifelse(EXT2MRC == 1, ENDFOLLOWDY, ENDEXT1DY),
                 eventdy = ifelse(DEATH %in% 1, DEATHDY, censordy),
                 age = AGE + (abs(F2DAYS) + eventdy) / 365.25,
                 # Compute harmonized CHD death from death and cause-of-death variables.
                 chd_death_probable = case_when(DEATH == 1 & DEATHCAUSE %in% c(11, 14) ~ "1",
                                                TRUE ~ "0")) %>%
          select(topmed_subject_id, chd_death_probable, age) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="coronary_angioplasty_incident_1"></a>
## atherosclerosis_events_incident: **coronary_angioplasty_incident_1** (coronary_angioplasty_incident)
  An indicator of whether a subject had a coronary angioplasty procedure (that was verified by adjudication or by medical professionals) during the follow-up period.
  * **Harmonization Units**:
    * [WHI](#coronary_angioplasty_incident_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:34:10
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0002997
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the occurrence of a coronary angioplasty procedure during follow-up. If a study recorded multiple events, the DCC harmonized only the earliest event after the start of follow-up, and the corresponding age at event was used for the accompanying age variable. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when the coronary angioplasty procedure occurred or the age at last follow-up or death for those participants who did not have a coronary angioplasty procedure.
    
<a id="coronary_angioplasty_incident_1-whi"></a>
  * ### atherosclerosis_events_incident/coronary_angioplasty_incident_1 -- **WHI**:
    * 7 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht003395.v3.phv00192302.v3`, `phs000200.v11.pht003407.v3.phv00193199.v3`, `phs000200.v11.pht003407.v3.phv00193200.v3`, `phs000200.v11.pht003407.v3.phv00193504.v3`, `phs000200.v11.pht003407.v3.phv00193505.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join all dataframes in the list.
          dat <- plyr::join_all(phen_list$source_data, "topmed_subject_id", "full") %>%
              # Convert numeric variables to numeric type.
              mutate_at(vars(ends_with("DY"), AGE, F2DAYS), as.numeric) %>%
              # Set positive F2DAYS values to 0.
              mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ x)) %>%
              # Calculate age at event/censoring.
              mutate(censordy = case_when(EXT2MRC == 1 ~ ENDFOLLOWDY, TRUE ~ ENDEXT1DY),
                     eventdy = case_when(PTCA == 1 ~ PTCADY, PTCA == 0 ~ censordy),
                     age = AGE + (abs(F2DAYS) + eventdy) / 365.25) %>%
              # Drop old variables.
              select(topmed_subject_id, coronary_angioplasty_incident = PTCA, age) %>%
              # Exclude rows with missing data.
              na.omit()
          return(dat)
      }
      ```
<a id="mi_incident_1"></a>
## atherosclerosis_events_incident: **mi_incident_1** (mi_incident)
  An indicator of whether a subject had a myocardial infarction (MI) event (that was verified by adjudication or by medical professionals) during the follow-up period.
  * **Harmonization Units**:
    * [FHS](#mi_incident_1-fhs)
    * [WHI](#mi_incident_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:35:32
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0027051
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the occurrence of an MI event during follow-up. If a study recorded multiple events, the DCC harmonized only the earliest event after the start of follow-up, and the corresponding age at event was used for the accompanying age variable. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when the MI event occurred or the age at last follow-up or death for those participants who did not experience an MI event.
    
    
    ### Study-specific comments
    
    #### FHS
    
    The data available for MI includes events through December 2016. The data available for participants who did not have an MI event is through December 2014. Therefore, the age at censorship for participants who did not have an MI event is recorded through 2014, while participants who did have an MI event have their age recorded through 2016.
    
<a id="mi_incident_1-fhs"></a>
  * ### atherosclerosis_events_incident/mi_incident_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000309.v13.phv00036469.v12`, `phs000007.v30.pht000309.v13.phv00036471.v12`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          # Join datasets.
          dat <- full_join(source_data$pht003099, source_data$pht000309, by = "topmed_subject_id") %>%
      
            # Convert age to numeric.
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      event = as.numeric(EVENT),
                      date = as.numeric(DATE))
      
          # Create mi_incident variable. Gather all mi_incident events.
          dat$mi_incident <- replicate(length(dat$event), 0)
          dat$mi_incident  <- case_when(
            dat$event == 1 | dat$event == 2 | dat$event == 3 | dat$event == 4 | dat$event == 5 ~ 1,
            dat$event > 5 ~ 0,
            is.na(dat$event) ~ NA_real_
          )
      
          # Calculate age at event.
          dat$age_at_event <- replicate(length(dat$event), 0)
          dat$age_at_event <- floor(dat$cad_followup_start_age + (dat$date / 365.25))
      
          # Identify prior mi events.
          dat <- dat %>%
            mutate(mi_incident = case_when(date <= 0 ~ 0,
                                           mi_incident == 1 & date > 0 ~ 1,
                                           TRUE ~ mi_incident))
      
      # Find subjects with multiple mi events and select first mi event.
          mi_event <- dat %>%
            filter(mi_incident == 1) %>%
            arrange(topmed_subject_id, date) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-event)
      
          # Gather all non-mi-event subjects.
          non_mi_event <- dat %>%
            filter(mi_incident == 0) %>%
            select(-event)
      
          # Gather all non-event subjects from surv dataset.
          dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      cvd_status = as.numeric(cvd),
                      date = as.numeric(cvddate))
      
          # Create a non-event specific dataset and remove duplicates.
          non_event <- dat2 %>%
            filter(cvd_status == 0) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-cvd_status)
      
          # Create an mi_incident variable for non-event subjects.
          non_event$mi_incident <- 0
      
          # Create an age at censoring variable for non-event subjects.
          non_event$age_at_event <-
            non_event$cad_followup_start_age + (non_event$date / 365.25)
      
          # Bind non_event and non_mi_event datasets and remove duplicates.
          non_event_all <- rbind(non_event, non_mi_event) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Combine all mi-event subjects with non-mi-event subjects.
          dat_combined <- bind_rows(mi_event, non_event_all) %>%
            arrange(topmed_subject_id, desc(mi_incident)) %>%
      
            # Remove duplicate subjects with multiple events.
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            transmute(topmed_subject_id, mi_incident = as.character(mi_incident), age = age_at_event) %>%
            na.omit()
      
          return(dat_combined)
      }
      ```
<a id="mi_incident_1-whi"></a>
  * ### atherosclerosis_events_incident/mi_incident_1 -- **WHI**:
    * 7 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht003395.v3.phv00192302.v3`, `phs000200.v11.pht003407.v3.phv00193169.v3`, `phs000200.v11.pht003407.v3.phv00193170.v3`, `phs000200.v11.pht003407.v3.phv00193504.v3`, `phs000200.v11.pht003407.v3.phv00193505.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join all dataframes in the list.
          dat <- plyr::join_all(phen_list$source_data, "topmed_subject_id", "full") %>%
              # Convert numeric variables to numeric type.
              mutate_at(vars(ends_with("DY"), AGE, F2DAYS), as.numeric) %>%
              # Set positive F2DAYS values to 0.
              mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ x)) %>%
              # Calculate age at event/censoring.
              mutate(censordy = case_when(EXT2MRC == 1 ~ ENDFOLLOWDY, TRUE ~ ENDEXT1DY),
                     eventdy = case_when(MI == 1 ~ MIDY, MI == 0 ~ censordy),
                     age = AGE + (abs(F2DAYS) + eventdy) / 365.25) %>%
              # Drop old variables.
              select(topmed_subject_id, mi_incident = MI, age) %>%
              # Exclude rows with missing data.
              na.omit()
          return(dat)
      }
      ```
<a id="pad_incident_1"></a>
## atherosclerosis_events_incident: **pad_incident_1** (pad_incident)
  An indicator of whether a subject had peripheral arterial disease (that was verified by adjudication or by medical professionals) during the follow-up period.
  * **Harmonization Units**:
    * [FHS](#pad_incident_1-fhs)
    * [WHI](#pad_incident_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:35:34
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0085096
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the presence or absence of a PAD diagnosis during follow-up. If a study recorded multiple events, the DCC harmonized only the earliest event after the start of follow-up, and the corresponding age at event was used for the accompanying age variable. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when the PAD diagnosis occurred or the age at last follow-up or death for those participants who did not have a PAD diagnosis. 
    
    ### Study-specific comments
    
    #### WHI
    
    Source variables contained some abdominal aortic aneurysm (AAA) cases. Observations where a subject had an abdominal aortic aneurysm (AAA) and not another PAD event had their value set to "0".
    
    #### FHS
    
    The data available for PAD includes events through December 2016. The data available for participants who did not have PAD is through December 2014. Therefore, the accompanying age variable for participants who did not have PAD is recorded through 2014, while participants who did have PAD have their age recorded through 2016. 
    
    
<a id="pad_incident_1-fhs"></a>
  * ### atherosclerosis_events_incident/pad_incident_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000309.v13.phv00036469.v12`, `phs000007.v30.pht000309.v13.phv00036471.v12`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          # Join datasets.
          dat <- full_join(source_data$pht003099, source_data$pht000309, by = "topmed_subject_id") %>%
      
            # Convert age to numeric.
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      event = as.numeric(EVENT),
                      date = as.numeric(DATE))
      
          # Create pad_incident variable. Gather all pad_incident events.
          dat$pad_incident <- replicate(length(dat$event), 0)
          dat$pad_incident  <- case_when(
            dat$event == 30 ~ 1,
            dat$event != 30 ~ 0,
            is.na(dat$event) ~ NA_real_
          )
      
          # Calculate age at event.
          dat$age_at_event <- replicate(length(dat$event), 0)
          dat$age_at_event <- floor(dat$cad_followup_start_age + (dat$date / 365.25))
      
          # Identify prior pad events.
          dat <- dat %>%
            mutate(pad_incident = case_when(date <= 0 ~ 0,
                                           pad_incident == 1 & date > 0 ~ 1,
                                           TRUE ~ pad_incident))
      
          # Find subjects with multiple pad events and select first pad event.
          pad_event <- dat %>%
            filter(pad_incident == 1) %>%
            arrange(topmed_subject_id, date) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-event)
      
          # Gather all non-pad-event subjects.
          non_pad_event <- dat %>%
            filter(pad_incident == 0) %>%
            select(-event)
      
          # Gather all non-event subjects from surv dataset.
          dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      cvd_status = as.numeric(cvd),
                      date = as.numeric(cvddate))
      
          # Create a non-event specific dataset and remove duplicates.
          non_event <- dat2 %>%
            filter(cvd_status == 0) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-cvd_status)
      
          # Create a pad_incident variable for non-event subjects.
          non_event$pad_incident <- 0
      
          # Create an age at censoring variable for non-event subjects.
          non_event$age_at_event <-
            non_event$cad_followup_start_age + (non_event$date / 365.25)
      
          # Bind non_event and non_pad_event datasets and remove duplicates.
          non_event_all <- rbind(non_event, non_pad_event) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Combine all pad-event subjects with non-pad-event subjects.
          dat_combined <- bind_rows(pad_event, non_event_all) %>%
            arrange(topmed_subject_id, desc(pad_incident)) %>%
      
            # Remove duplicate subjects with multiple events.
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            transmute(topmed_subject_id,
                      pad_incident = as.character(pad_incident),
                      age = age_at_event) %>%
            na.omit()
      
          return(dat_combined)
      }
      ```
<a id="pad_incident_1-whi"></a>
  * ### atherosclerosis_events_incident/pad_incident_1 -- **WHI**:
    * 14 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht003395.v3.phv00192302.v3`, `phs000200.v11.pht003406.v3.phv00193101.v3`, `phs000200.v11.pht003406.v3.phv00193102.v3`, `phs000200.v11.pht003406.v3.phv00193103.v3`, `phs000200.v11.pht003406.v3.phv00193104.v3`, `phs000200.v11.pht003406.v3.phv00193105.v3`, `phs000200.v11.pht003406.v3.phv00193106.v3`, `phs000200.v11.pht003406.v3.phv00193107.v3`, `phs000200.v11.pht003407.v3.phv00193190.v3`, `phs000200.v11.pht003407.v3.phv00193191.v3`, `phs000200.v11.pht003407.v3.phv00193504.v3`, `phs000200.v11.pht003407.v3.phv00193505.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          # Subset to rows with at least one relevant value.
          dat_pad <- filter(source_data$pht003406, !is.na(PADLEG) | !is.na(PADAMP) |
                            !is.na(PADSURG) | !is.na(PADEXER) | !is.na(PADABDOP) |
                            !is.na(PADPLAQ) | !is.na(PADDX)) %>%
            # Convert character vectors to integer.
            mutate_if(is.character, as.integer) %>%
            # Code PAD events based on subtypes.
            mutate(pad1 = PADDX %in% 1:3 | PADPLAQ | PADABDOP | PADEXER | PADSURG |
                   PADAMP | PADLEG) %>%
            # Code pad2 as FALSE when pad1 is missing and PAD diagnosis is AAA.
            mutate(pad2 = case_when(is.na(pad1) & PADDX == 4 ~ FALSE, TRUE ~ pad1))
      
          dat <- full_join(dat_pad, source_data$pht003407, "topmed_subject_id") %>%
              # Use PERIPH value for PAD when pad2 is missing; otherwise use pad2.
              mutate(pad_incident = case_when(is.na(pad2) ~ as.logical(as.integer(PERIPH)),
                                              TRUE ~ pad2)) %>%
              # Join with MRC indicator.
              left_join(source_data$pht003395, "topmed_subject_id") %>%
              # Join with age.
              left_join(source_data$pht000998, "topmed_subject_id") %>%
              # Convert numeric variables to numeric type.
              mutate_at(vars(ends_with("DY"), AGE, F2DAYS), as.numeric) %>%
              # Set positive F2DAYS values to 0.
              mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ x)) %>%
              # Calculate age at event/censoring.
              mutate(censordy = case_when(EXT2MRC == 1 ~ ENDFOLLOWDY, TRUE ~ ENDEXT1DY),
                     eventdy = case_when(pad_incident ~ PERIPHDY, !pad_incident ~ censordy),
                     age = AGE + (abs(F2DAYS) + eventdy) / 365.25) %>%
              # Drop old variables and convert PAD to binary.
              transmute(topmed_subject_id, pad_incident = as.character(as.integer(pad_incident)),
                        age) %>%
              # Exclude rows with missing data.
              na.omit()
          return(dat)
      }
      ```

# atherosclerosis_events_prior

### Variables in this section:
* [angina_prior_1](#angina_prior_1)
* [cabg_prior_1](#cabg_prior_1)
* [coronary_angioplasty_prior_1](#coronary_angioplasty_prior_1)
* [coronary_revascularization_prior_1](#coronary_revascularization_prior_1)
* [mi_prior_1](#mi_prior_1)
* [pad_prior_1](#pad_prior_1)

<a id="angina_prior_1"></a>
## atherosclerosis_events_prior: **angina_prior_1** (angina_prior)
  An indicator of whether a subject had an angina event prior to the baseline visit.
  * **Harmonization Units**:
    * [CHS](#angina_prior_1-chs)
    * [COPDGene](#angina_prior_1-copdgene)
    * [FHS](#angina_prior_1-fhs)
    * [MESA](#angina_prior_1-mesa)
    * [WHI](#angina_prior_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: angina_prior, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:33:19
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0002962
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the occurrence of angina before the baseline visit. Component variables included could indicate occurrence of angina either by self-report or by study adjudication. If a study recorded multiple events, the DCC harmonized only the earliest event prior to baseline. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when history of angina was recorded, _not_ the age at which angina occurred.
    
    ### Study-specific comments
    
    #### FHS
    
    The age variable accompanying this variable represents the age at which the angina occurred, not the age when the history of angina was recorded. 
    
    ### Reporting method for component study variables
    
    The table below shows the reporting method (self-reported or adjudicated by the study) for component study variables from each study included in this harmonized variable.
    
    | Study or subcohort | Self-report or Adjudicated|
    |---------|----------|
    | FHS | Adjudicated|
    | MESA | Self-report |
    | CHS | Both |
    | COPDGene | Self-report |
    | WHI | Self-report |
    
    
<a id="angina_prior_1-chs"></a>
  * ### atherosclerosis_events_prior/angina_prior_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001452.v1.phv00100504.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Convert age to numeric and rename angina variable.
        dat <- transmute(phen_list$source_data$pht001452, topmed_subject_id, age = as.numeric(AGEBL),
                         angina_prior = ANBLMOD) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="angina_prior_1-copdgene"></a>
  * ### atherosclerosis_events_prior/angina_prior_1 -- **COPDGene**:
    * 2 component_study_variables: `phs000179.v5.pht002239.v4.phv00159608.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        dataset <- phen_list$source_data$pht002239 %>%
          rename(age = Age_Enroll, angina_prior = Angina )
      
        # Convert angina_prior to character, age to numeric.
        dataset$angina_prior <- as.character(dataset$angina_prior)
        dataset$age <- as.numeric(dataset$age)
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="angina_prior_1-fhs"></a>
  * ### atherosclerosis_events_prior/angina_prior_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000309.v13.phv00036469.v12`, `phs000007.v30.pht000309.v13.phv00036471.v12`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          # Join datasets.
          dat <- full_join(source_data$pht003099, source_data$pht000309, by = "topmed_subject_id") %>%
      
            # Convert age to numeric.
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      event = as.numeric(EVENT),
                      date = as.numeric(DATE))
      
          # Create mi_prior variable. Gather all mi events.
          dat$angina_prior <- replicate(length(dat$event), 0)
          dat$angina_prior  <- case_when(
            dat$event == 6 ~ 1,
            dat$event != 6 ~ 0,
            is.na(dat$event) ~ NA_real_
          )
      
          # Calculate age at event.
          dat$age_at_event <- replicate(length(dat$event), 0)
          dat$age_at_event <- floor(dat$cad_followup_start_age + (dat$date / 365.25))
      
          # Identify prior angina events.
          dat <- dat %>%
            mutate(angina_prior = case_when(angina_prior == 1 & date <= 0 ~ 1,
                                           angina_prior == 1 & date > 0 ~ 0,
                                           TRUE ~ angina_prior))
        # Find subjects with multiple angina events and select first angina event.
          angina_event <- dat %>%
            filter(angina_prior == 1) %>%
            arrange(topmed_subject_id, date) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-event)
      
          # Gather all non-angina-event subjects.
          non_angina_event <- dat %>%
            filter(angina_prior == 0) %>%
            select(-event)
      
          # Gather all non-event subjects from surv dataset.
          dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      cvd_status = as.numeric(cvd),
                      date = as.numeric(cvddate))
      
          # Create a non-event specific dataset and remove duplicates.
          non_event <- dat2 %>%
            filter(cvd_status == 0) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-cvd_status)
      
          # Create an angina_prior variable for non-event subjects.
          non_event$angina_prior <- 0
      
          # Create an age at censoring variable for non-event subjects.
          non_event$age_at_event <-
            non_event$cad_followup_start_age + (non_event$date / 365.25)
      
          # Bind non_event and non_angina_event datasets and remove duplicates.
          non_event_all <- rbind(non_event, non_angina_event) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Combine all angina-event subjects with non-angina-event subjects.
          dat_combined <- bind_rows(angina_event, non_event_all) %>%
            arrange(topmed_subject_id, desc(angina_prior)) %>%
      
            # Remove duplicate subjects with multiple events.
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            transmute(topmed_subject_id,
                      angina_prior = as.character(angina_prior),
                      age = age_at_event) %>%
            na.omit()
      
          return(dat_combined)
      }
      ```
<a id="angina_prior_1-mesa"></a>
  * ### atherosclerosis_events_prior/angina_prior_1 -- **MESA**:
    * 1 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Convert age to numeric and set all participants to 0.
        dat <- transmute(phen_list$source_data$pht001116, topmed_subject_id, age = as.numeric(age1c),
                         angina_prior = "0")
        return(dat)
      }
      ```
<a id="angina_prior_1-whi"></a>
  * ### atherosclerosis_events_prior/angina_prior_1 -- **WHI**:
    * 4 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht000999.v6.phv00078507.v6`, `phs000200.v11.pht000999.v6.phv00078560.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        source_data <- phen_list$source_data
        # Join Form 2 data with Form 30 data
        dat <- full_join(source_data$pht000998, source_data$pht000999, "topmed_subject_id") %>%
          # Set positive F2DAYS values to 0.
          mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ as.numeric(x))) %>%
          # Calculate age, rename angina variable, and drop remaining variables.
          transmute(age = as.numeric(AGE) + (as.numeric(F30DAYS) + abs(F2DAYS)) / 365.25,
                    angina_prior = ANGINA, topmed_subject_id) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="cabg_prior_1"></a>
## atherosclerosis_events_prior: **cabg_prior_1** (cabg_prior)
  An indicator of whether a subject had a coronary artery bypass graft (CABG) procedure prior to the start of the baseline visit.
  * **Harmonization Units**:
    * [ARIC](#cabg_prior_1-aric)
    * [CHS](#cabg_prior_1-chs)
    * [COPDGene](#cabg_prior_1-copdgene)
    * [FHS](#cabg_prior_1-fhs)
    * [JHS](#cabg_prior_1-jhs)
    * [MESA](#cabg_prior_1-mesa)
    * [WHI](#cabg_prior_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: cabg_prior, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:33:58
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0010055
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting encoded component variables indicating the occurrence of a CABG procedure by self-report or adjudication to a binary variable indicating the occurrence of a CABG procedure before the baseline visit. If a study recorded multiple CABG procedures, the DCC harmonized only the earliest procedure prior to baseline. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when history of the CABG procedure was recorded, _not_ the age when the procedure occurred. 
    
    ### Study-specific comments
    
    #### FHS
    
    The age variable accompanying this variable represents the age at which the CABG procedure occurred, not the age when the history of any CABG procedures was recorded. 
    
    ### Reporting method for component study variables
    
    The table below shows the reporting method (self-reported or adjudicated by the study) for component study variables from each study included in this harmonized variable.
    
    | Study or subcohort | Self-report or Adjudicated|
    |---------|----------|
    | FHS | Adjudicated|
    | MESA | Self-report |
    | JHS | Self-report |
    | ARIC | Self-report |
    | CHS | Both |
    | COPDGene | Self-report |
    | WHI | Self-report |
    
    
<a id="cabg_prior_1-aric"></a>
  * ### atherosclerosis_events_prior/cabg_prior_1 -- **ARIC**:
    * 4 component_study_variables: `phs000280.v5.pht004063.v2.phv00204712.v1`, `phs000280.v5.pht004143.v2.phv00208845.v1`, `phs000280.v5.pht004143.v2.phv00208846.v1`, `phs000280.v5.pht004143.v2.phv00208853.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        # Join datasets with age and revascularization events.
        dataset <- plyr::join_all(phen_list$source_data) %>%
          rename(age = V1AGE01, cabg_prior = PHEA07A, ever_surgery = PHEA06,
                 ever_balloon_angio = PHEA08)
      
        # Set 'T' and 'E' to missing.
        dataset$cabg_prior[dataset$cabg_prior %in% 'T'] <- NA
        dataset$ever_surgery[dataset$ever_surgery %in% 'E'] <- NA
      
        dataset <- dataset %>%
          mutate(cabg_prior = ifelse(cabg_prior == "N", 0, 1),
                 ever_surgery = ifelse(ever_surgery == "N", 0, 1),
                 ever_balloon_angio = ifelse(ever_balloon_angio == "N", 0, 1)) %>%
          mutate_if(is.character, as.numeric) %>%
      
          # Remove rows with all missing values.
          filter(rowSums(is.na(.)) < 3)
      
        # Set cabg_prior values.
        dataset$cabg_prior <- ifelse(is.na(dataset$cabg_prior) == TRUE, 0, dataset$cabg_prior)
      
        # Select phenotype of interest.
        dataset <- select(dataset, topmed_subject_id, age, cabg_prior)
      
        # Convert cabg_prior to character and age to numeric.
        dataset$cabg_prior <- as.character(dataset$cabg_prior)
        dataset$age <- as.numeric(dataset$age)
      
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="cabg_prior_1-chs"></a>
  * ### atherosclerosis_events_prior/cabg_prior_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001464.v1.phv00100785.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Join datasets.
        dat <- full_join(source_data$pht001464, source_data$pht001452, "topmed_subject_id") %>%
          # Rename CABG variable and convert age to numeric.
          transmute(topmed_subject_id, age = as.numeric(AGEBL), cabg_prior = BPSSURBL) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="cabg_prior_1-copdgene"></a>
  * ### atherosclerosis_events_prior/cabg_prior_1 -- **COPDGene**:
    * 2 component_study_variables: `phs000179.v5.pht002239.v4.phv00159631.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Rename CABG variable and convert age to numeric.
        dat <- transmute(phen_list$source_data$pht002239, cabg_prior = CABG, topmed_subject_id,
                         age = as.numeric(Age_Enroll)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="cabg_prior_1-fhs"></a>
  * ### atherosclerosis_events_prior/cabg_prior_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000389.v10.phv00054697.v8`, `phs000007.v30.pht000389.v10.phv00163410.v7`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          # Join datasets.
          dat <- full_join(source_data$pht003099, source_data$pht000389, by = "topmed_subject_id") %>%
            # Convert age to numeric.
            transmute(topmed_subject_id,
                      cabg_prior = ifelse(as.numeric(VESSEL) > 0, 1, 0),
                      date = as.numeric(PROCDATE),
                      cad_followup_start_age = as.numeric(age1))
      
          ## Calculate age at event.
          dat$age_at_event <- replicate(length(dat$cabg_prior), 0)
          dat$age_at_event <- floor(dat$cad_followup_start_age + (dat$date / 365.25))
      
          # Identify prior cabg events.
          dat <- dat %>%
            mutate(cabg_prior = case_when(cabg_prior == 1 & date <= 0 ~ 1,
                                           cabg_prior == 1 & date > 0 ~ 0,
                                           TRUE ~ cabg_prior))
      
            # Find subjects with multiple cabg events and select first cabg event.
          cabg_event <- dat %>%
            filter(cabg_prior == 1) %>%
            arrange(topmed_subject_id, date) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Gather all non-cabg-event subjects and remove duplicate subjects.
          non_cabg_event <- dat %>%
            filter(cabg_prior == 0)
      
          # Gather all non-event subjects from surv dataset.
          dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      cvd_status = as.numeric(cvd),
                      date = as.numeric(cvddate))
      
          # Create a non-event specific dataset and remove duplicates.
          non_event <- dat2 %>%
            filter(cvd_status == 0) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-cvd_status)
      
          # Create an cabg_prior variable for non-event subjects.
          non_event$cabg_prior <- 0
      
          # Create an age at censoring variable for non-event subjects.
          non_event$age_at_event <-
            non_event$cad_followup_start_age + (non_event$date / 365.25)
      
          # Bind non_event and non_cabg_event datasets and remove duplicates.
          non_event_all <- rbind(non_event, non_cabg_event) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Combine all cabg-event subjects with non-cabg-event subjects.
          dat_combined <- bind_rows(cabg_event, non_event_all) %>%
            arrange(topmed_subject_id, desc(cabg_prior)) %>%
      
            # Remove duplicate subjects with multiple events.
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            transmute(topmed_subject_id, cabg_prior = as.character(cabg_prior), age = age_at_event) %>%
            na.omit()
      
          return(dat_combined)
      }
      ```
<a id="cabg_prior_1-jhs"></a>
  * ### atherosclerosis_events_prior/cabg_prior_1 -- **JHS**:
    * 6 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001963.v1.phv00127727.v1`, `phs000286.v5.pht001963.v1.phv00127728.v1`, `phs000286.v5.pht001963.v1.phv00127731.v1`, `phs000286.v5.pht001963.v1.phv00127733.v1`, `phs000286.v5.pht001963.v1.phv00127740.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        # Join datasets with age and revascularization events.
        dataset <- plyr::join_all(phen_list$source_data) %>%
          rename(age = AGE01, cabg_prior = MHXA52A,
                ever_surgery = MHXA51, other_revasc = MHXA52E1, heart_cath = MHXA55A,
                carotid_endart = MHXA52C) %>%
          mutate(cabg_prior = ifelse(cabg_prior == "N", 0, 1),
                 ever_surgery = ifelse(ever_surgery == "N", 0, 1),
                 other_revasc = ifelse(other_revasc == "N", 0, 1),
                 heart_cath = ifelse(heart_cath == "N", 0, 1),
                 carotid_endart = ifelse(carotid_endart == "N", 0, 1)) %>%
          mutate_if(is.character, as.numeric) %>%
      
          # Remove rows with all missing data.
          filter(rowSums(is.na(.)) < 5)
      
      
        # Set cabg_prior values.
        dataset$cabg_prior <- ifelse(is.na(dataset$cabg_prior) == TRUE, 0, dataset$cabg_prior)
      
        # Select phenotype of interest.
        dataset <- dataset %>%
          select(topmed_subject_id, age, cabg_prior) %>%
          na.omit()
      
        # Convert cabg_prior to character and age to numeric.
        dataset$cabg_prior <- as.character(dataset$cabg_prior)
        dataset$age <- as.numeric(dataset$age)
      
        return(dataset)
      }
      ```
<a id="cabg_prior_1-mesa"></a>
  * ### atherosclerosis_events_prior/cabg_prior_1 -- **MESA**:
    * 1 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Convert age to numeric and set all participants to 0.
        dat <- transmute(phen_list$source_data$pht001116, topmed_subject_id, age = as.numeric(age1c),
                         cabg_prior = "0")
        return(dat)
      }
      ```
<a id="cabg_prior_1-whi"></a>
  * ### atherosclerosis_events_prior/cabg_prior_1 -- **WHI**:
    * 4 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht000999.v6.phv00078507.v6`, `phs000200.v11.pht000999.v6.phv00078535.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        source_data <- phen_list$source_data
        # Join Form 2 data with Form 30 data
        dat <- full_join(source_data$pht000998, source_data$pht000999, "topmed_subject_id") %>%
          # Set positive F2DAYS values to 0.
          mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ as.numeric(x))) %>%
          # Calculate age, rename CABG variable, and drop remaining variables.
          transmute(age = as.numeric(AGE) + (as.numeric(F30DAYS) + abs(F2DAYS)) / 365.25,
                    cabg_prior = CABG, topmed_subject_id) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="coronary_angioplasty_prior_1"></a>
## atherosclerosis_events_prior: **coronary_angioplasty_prior_1** (coronary_angioplasty_prior)
  An indicator of whether a subject had a coronary angioplasty procedure prior to the start of the baseline visit.
  * **Harmonization Units**:
    * [ARIC](#coronary_angioplasty_prior_1-aric)
    * [CHS](#coronary_angioplasty_prior_1-chs)
    * [COPDGene](#coronary_angioplasty_prior_1-copdgene)
    * [JHS](#coronary_angioplasty_prior_1-jhs)
    * [MESA](#coronary_angioplasty_prior_1-mesa)
    * [WHI](#coronary_angioplasty_prior_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: coronary_angioplasty_prior, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:34:42
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0002997
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the occurrence of a coronary angioplasty procedure before the baseline visit. Component variables included could indicate occurrence of a coronary angioplasty procedure either by self-report or by study adjudication. If a study recorded multiple coronary angioplasty procedures, the DCC harmonized only the earliest procedure prior to baseline. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when history of the coronary angioplasty procedure was recorded, _not_ the age when the procedure occurred. 
    
    
    ### Reporting method for component study variables
    
    The table below shows the reporting method (self-reported or adjudicated by the study) for component study variables from each study included in this harmonized variable.
    
    | Study or subcohort | Self-report or Adjudicated|
    |---------|----------|
    | MESA | Self-report |
    | JHS | Self-report |
    | ARIC | Self-report |
    | CHS | Both |
    | COPDGene | Self-report |
    | WHI | Self-report |
    
    
<a id="coronary_angioplasty_prior_1-aric"></a>
  * ### atherosclerosis_events_prior/coronary_angioplasty_prior_1 -- **ARIC**:
    * 4 component_study_variables: `phs000280.v5.pht004063.v2.phv00204712.v1`, `phs000280.v5.pht004143.v2.phv00208845.v1`, `phs000280.v5.pht004143.v2.phv00208853.v1`, `phs000280.v5.pht004143.v2.phv00208854.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        # Join datasets with age and revascularization events.
        dataset <- plyr::join_all(phen_list$source_data) %>%
          rename(age = V1AGE01, coronary_angioplasty_prior = PHEA09A, ever_surgery = PHEA06,
                 ever_balloon_angio = PHEA08)
      
        # Set 'E' to missing.
        dataset$ever_surgery[dataset$ever_surgery %in% 'E'] <- NA
      
        dataset <- dataset %>%
          mutate(coronary_angioplasty_prior = ifelse(coronary_angioplasty_prior == "N", 0, 1),
                 ever_surgery = ifelse(ever_surgery == "N", 0, 1),
                 ever_balloon_angio = ifelse(ever_balloon_angio == "N", 0, 1)) %>%
          mutate_if(is.character, as.numeric) %>%
          filter(rowSums(is.na(.)) < 3)
      
       # Set coronary_angioplasty_prior values.
       dataset$coronary_angioplasty_prior <-
         ifelse(is.na(dataset$coronary_angioplasty_prior) == TRUE,
                 0, dataset$coronary_angioplasty_prior)
      
       dataset <- select(dataset, topmed_subject_id, age, coronary_angioplasty_prior)
      
        # Convert coronary_angioplasty_prior to character.
        dataset$coronary_angioplasty_prior <- as.character(dataset$coronary_angioplasty_prior)
      
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="coronary_angioplasty_prior_1-chs"></a>
  * ### atherosclerosis_events_prior/coronary_angioplasty_prior_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100322.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Rename angioplasty variable and convert age to numeric.
        dat <- transmute(phen_list$source_data$pht001452, topmed_subject_id, age = as.numeric(AGEBL),
                         coronary_angioplasty_prior = CORART) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="coronary_angioplasty_prior_1-copdgene"></a>
  * ### atherosclerosis_events_prior/coronary_angioplasty_prior_1 -- **COPDGene**:
    * 2 component_study_variables: `phs000179.v5.pht002239.v4.phv00159632.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Rename angioplasty variable and convert age to numeric.
        dat <- transmute(phen_list$source_data$pht002239, topmed_subject_id,
                         coronary_angioplasty_prior = Angioplasty,
                         age = as.numeric(Age_Enroll)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="coronary_angioplasty_prior_1-jhs"></a>
  * ### atherosclerosis_events_prior/coronary_angioplasty_prior_1 -- **JHS**:
    * 6 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001963.v1.phv00127727.v1`, `phs000286.v5.pht001963.v1.phv00127731.v1`, `phs000286.v5.pht001963.v1.phv00127733.v1`, `phs000286.v5.pht001963.v1.phv00127737.v1`, `phs000286.v5.pht001963.v1.phv00127740.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        # Join datasets with age and revascularization events.
        dataset <- plyr::join_all(phen_list$source_data) %>%
          rename(age = AGE01, coronary_angioplasty_prior = MHXA54A,
                ever_surgery = MHXA51, other_revasc = MHXA52E1, heart_cath = MHXA55A,
                carotid_endart = MHXA52C) %>%
          mutate(coronary_angioplasty_prior = ifelse(coronary_angioplasty_prior == "N", 0, 1),
                 ever_surgery = ifelse(ever_surgery == "N", 0, 1),
                 other_revasc = ifelse(other_revasc == "N", 0, 1),
                 heart_cath = ifelse(heart_cath == "N", 0, 1),
                 carotid_endart = ifelse(carotid_endart == "N", 0, 1)) %>%
          filter(rowSums(is.na(.)) < 5)
      
        # Set coronary_angioplasty_prior values.
        dataset$coronary_angioplasty_prior <-
          ifelse(is.na(dataset$coronary_angioplasty_prior) == TRUE,
                  0, dataset$coronary_angioplasty_prior)
      
        dataset <- dataset %>%
          select(topmed_subject_id, age, coronary_angioplasty_prior)
      
        # Convert coronary_angioplasty_prior to character.
        dataset$coronary_angioplasty_prior <- as.character(dataset$coronary_angioplasty_prior)
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="coronary_angioplasty_prior_1-mesa"></a>
  * ### atherosclerosis_events_prior/coronary_angioplasty_prior_1 -- **MESA**:
    * 1 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Convert age to numeric and set all participants to 0.
        dat <- transmute(phen_list$source_data$pht001116, topmed_subject_id, age = as.numeric(age1c),
                         coronary_angioplasty_prior = "0")
        return(dat)
      }
      ```
<a id="coronary_angioplasty_prior_1-whi"></a>
  * ### atherosclerosis_events_prior/coronary_angioplasty_prior_1 -- **WHI**:
    * 4 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht000999.v6.phv00078507.v6`, `phs000200.v11.pht000999.v6.phv00078536.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Join Form 2 data with Form 30 data
        dat <- inner_join(source_data$pht000998, source_data$pht000999, "topmed_subject_id") %>%
          # Set positive F2DAYS values to 0.
          mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ as.numeric(x))) %>%
          # Calculate age, rename angioplasty variable, and drop remaining variables.
          transmute(age = as.numeric(AGE) + (as.numeric(F30DAYS) + abs(F2DAYS)) / 365.25,
                    coronary_angioplasty_prior = PTCA, topmed_subject_id) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="coronary_revascularization_prior_1"></a>
## atherosclerosis_events_prior: **coronary_revascularization_prior_1** (coronary_revascularization_prior)
  An indicator of whether a subject had a coronary revascularization procedure prior to the start of the baseline visit. This includes angioplasty, CABG, and other coronary revascularization procedures.
  * **Harmonization Units**:
    * [GENOA](#coronary_revascularization_prior_1-genoa)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: coronary_revascularization_prior, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:32:57
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0877341
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the occurrence of a coronary revascularization procedure before the baseline visit. Component variables could indicate occurrence of a coronary revascularization procedure either by self-report or by study adjudication. In cases where history of specific revascularization procedures was unavailable, we used component variables for history of _any_ coronary revascularization procedure. 
    
    ### Reporting method for component study variables
    
    The table below shows the reporting method (self-reported or adjudicated by the study) for component study variables from each study included in this harmonized variable.
    
    | Study or subcohort | Self-report or Adjudicated|
    |---------|----------|
    | GENOA | Self-report |
    
    
<a id="coronary_revascularization_prior_1-genoa"></a>
  * ### atherosclerosis_events_prior/coronary_revascularization_prior_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v2.pht006039.v1.phv00277507.v1`, `phs001238.v2.pht006043.v1.phv00277602.v1`, `phs001238.v2.pht006653.v1.phv00307788.v1`, `phs001238.v2.pht006657.v1.phv00307883.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        # Join datasets with age and revascularization events - Eu cohort.
        dataset_eu <- dplyr::full_join(phen_list$source_data$pht006657,
          phen_list$source_data$pht006653) %>%
          rename(age = AGE, coronary_revascularization_prior = ARTERIES)
      
        dataset_eu2 <- dataset_eu %>%
          mutate(coronary_revascularization_prior =
                 case_when(coronary_revascularization_prior == "No" ~ 0,
                           coronary_revascularization_prior == "Yes" ~ 1,
                           TRUE ~ NA_real_))
      
        # Join datasets with age and revascularization events - AA cohort.
        dataset_aa <- dplyr::full_join(phen_list$source_data$pht006043,
          phen_list$source_data$pht006039) %>%
          rename(age = AGE, coronary_revascularization_prior = ARTERIES)
      
        dataset_aa2 <- dataset_aa %>%
          mutate(coronary_revascularization_prior =
               case_when(coronary_revascularization_prior == "No" ~ 0,
                         coronary_revascularization_prior == "Yes" ~ 1,
                         TRUE ~ NA_real_))
      
      
        # Combine AA and Eu datasets.
        dataset <- rbind(dataset_aa2, dataset_eu2)
      
        # Convert revascularization_prior to character, age to numeric.
        dataset$coronary_revascularization_prior <- as.character(dataset$coronary_revascularization_prior)
        dataset$age <- as.numeric(dataset$age)
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="mi_prior_1"></a>
## atherosclerosis_events_prior: **mi_prior_1** (mi_prior)
  An indicator of whether a subject had a myocardial infarction (MI) prior to the start of the baseline visit.
  * **Harmonization Units**:
    * [Amish](#mi_prior_1-amish)
    * [ARIC](#mi_prior_1-aric)
    * [CHS](#mi_prior_1-chs)
    * [COPDGene](#mi_prior_1-copdgene)
    * [FHS](#mi_prior_1-fhs)
    * [GENOA](#mi_prior_1-genoa)
    * [JHS](#mi_prior_1-jhs)
    * [MESA](#mi_prior_1-mesa)
    * [WHI](#mi_prior_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: mi_prior, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:35:15
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0027051
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the occurrence of an MI event before the baseline visit. Component variables included could indicate the occurrence of an MI event either by self-report or by study adjudication. If a study recorded multiple events, the DCC harmonized only the earliest event prior to baseline. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when history of MI was recorded, _not_ the age at which the MI occurred.
    
    ### Study-specific comments
    
    #### FHS
    
    The age variable accompanying this variable represents the age at which the MI occurred, not the age at which the history of MI was recorded. 
    
    ### Reporting method for component study variables
    
    The table below shows the reporting method (self-reported or adjudicated by the study) for component study variables from each study included in this harmonized variable.
    
    | Study or subcohort | Self-report or Adjudicated|
    |---------|----------|
    | FHS | Adjudicated|
    | MESA | Self-report |
    | JHS | Self-report |
    | ARIC | Both |
    | CHS | Both |
    | COPDGene | Self-report |
    | WHI | Self-report |
    
<a id="mi_prior_1-amish"></a>
  * ### atherosclerosis_events_prior/mi_prior_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v3.pht005002.v1.phv00252976.v1`, `phs000956.v3.pht005002.v1.phv00252984.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- transmute(phen_list$source_data$pht005002, topmed_subject_id,
                         # Rename MI variable.
                         mi_prior = mi_baseline,
                         # Recode Winsorized values and convert age to numeric.
                         age = as.numeric(case_when(age_baseline == "90+" ~ "90",
                                                    TRUE ~ age_baseline))) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="mi_prior_1-aric"></a>
  * ### atherosclerosis_events_prior/mi_prior_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v5.pht004063.v2.phv00204705.v1`, `phs000280.v5.pht004063.v2.phv00204712.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        dataset <- phen_list$source_data$pht004063
      
        dataset <- dataset %>%
          rename(age = V1AGE01, mi_prior = PREVMI05)
      
        # Convert missing values to NA.
        dataset$mi_prior[dataset$mi_prior %in% 'T'] <- NA
      
        # Convert age to numeric and mi_prior to character.
        dataset$age <- as.numeric(dataset$age)
        dataset$mi_prior <- as.character(dataset$mi_prior)
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="mi_prior_1-chs"></a>
  * ### atherosclerosis_events_prior/mi_prior_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001452.v1.phv00100508.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Convert age to numeric and rename variables.
        dat <- transmute(phen_list$source_data$pht001452, age = as.numeric(AGEBL),
                         mi_prior = MIBLMOD, topmed_subject_id) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="mi_prior_1-copdgene"></a>
  * ### atherosclerosis_events_prior/mi_prior_1 -- **COPDGene**:
    * 2 component_study_variables: `phs000179.v5.pht002239.v4.phv00159615.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        dataset <- phen_list$source_data$pht002239 %>%
          rename(age = Age_Enroll, mi_prior = HeartAttack)
      
        # Convert age to numeric and mi_prior to character.
        dataset$age <- as.numeric(dataset$age)
        dataset$mi_prior <- as.character(dataset$mi_prior)
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="mi_prior_1-fhs"></a>
  * ### atherosclerosis_events_prior/mi_prior_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000309.v13.phv00036469.v12`, `phs000007.v30.pht000309.v13.phv00036471.v12`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          # Join datasets.
          dat <- full_join(source_data$pht003099, source_data$pht000309, by = "topmed_subject_id") %>%
      
            # Convert age to numeric.
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      event = as.numeric(EVENT),
                      date = as.numeric(DATE))
      
          # Create mi_prior variable. Gather all mi events.
          dat$mi_prior <- replicate(length(dat$event), 0)
          dat$mi_prior  <- case_when(
            dat$event == 1 | dat$event == 2 | dat$event == 3 | dat$event == 4 | dat$event == 5 ~ 1,
            dat$event > 5 ~ 0,
            is.na(dat$event) ~ NA_real_
          )
      
          # Calculate age at event.
          dat$age_at_event <- replicate(length(dat$event), 0)
          dat$age_at_event <- floor(dat$cad_followup_start_age + (dat$date / 365.25))
      
          # Identify prior mi events.
          dat <- dat %>%
            mutate(mi_prior = case_when(mi_prior == 1 & date <= 0 ~ 1,
                                           mi_prior == 1 & date > 0 ~ 0,
                                           TRUE ~ mi_prior))
      
          # Find subjects with multiple mi events and select first mi event.
          mi_event <- dat %>%
            filter(mi_prior == 1) %>%
            arrange(topmed_subject_id, date) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-event)
      
          # Gather all non-mi-event subjects.
          non_mi_event <- dat %>%
            filter(mi_prior == 0) %>%
            select(-event)
      
          # Gather all non-event subjects from surv dataset.
          dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      cvd_status = as.numeric(cvd),
                      date = as.numeric(cvddate))
      
          # Create a non-event specific dataset and remove duplicates.
          non_event <- dat2 %>%
            filter(cvd_status == 0) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-cvd_status)
      
          # Create an mi_prior variable for non-event subjects.
          non_event$mi_prior <- 0
      
          # Create an age at censoring variable for non-event subjects.
          non_event$age_at_event <-
            non_event$cad_followup_start_age + (non_event$date / 365.25)
      
          # Bind non_event and non_mi_event datasets and remove duplicates.
          non_event_all <- rbind(non_event, non_mi_event) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Combine all mi-event subjects with non-mi-event subjects.
          dat_combined <- bind_rows(mi_event, non_event_all) %>%
            arrange(topmed_subject_id, desc(mi_prior)) %>%
      
            # Remove duplicate subjects with multiple events.
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            transmute(topmed_subject_id, mi_prior = as.character(mi_prior), age = age_at_event) %>%
            na.omit()
      
          return(dat_combined)
      }
      ```
<a id="mi_prior_1-genoa"></a>
  * ### atherosclerosis_events_prior/mi_prior_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v2.pht006039.v1.phv00277507.v1`, `phs001238.v2.pht006043.v1.phv00277598.v1`, `phs001238.v2.pht006653.v1.phv00307788.v1`, `phs001238.v2.pht006657.v1.phv00307879.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        # Join datasets with age and MI events - Eu cohort.
        dataset_eu <- dplyr::full_join(phen_list$source_data$pht006657,
          phen_list$source_data$pht006653) %>%
          rename(age = AGE, mi_prior = MI)
      
        dataset_eu2 <- dataset_eu %>%
            mutate(mi_prior =
                   case_when(mi_prior == "No" ~ 0,
                             mi_prior == "Yes" ~ 1,
                             TRUE ~ NA_real_))
      
        # Join datasets with age and MI events - AA cohort.
        dataset_aa <- dplyr::full_join(phen_list$source_data$pht006043,
          phen_list$source_data$pht006039) %>%
          rename(age = AGE, mi_prior = MI)
      
        dataset_aa2 <- dataset_aa %>%
          mutate(mi_prior =
                 case_when(mi_prior == "No" ~ 0,
                           mi_prior == "Yes" ~ 1,
                           TRUE ~ NA_real_))
      
      
        # Combine AA and Eu datasets.
        dataset <- rbind(dataset_aa2, dataset_eu2)
      
        # Convert age to numeric and mi_prior to character.
        dataset$age <- as.numeric(dataset$age)
        dataset$mi_prior <- as.character(dataset$mi_prior)
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="mi_prior_1-jhs"></a>
  * ### atherosclerosis_events_prior/mi_prior_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001949.v1.phv00126088.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        dataset <- phen_list$source_data$pht001949 %>%
          rename(age = AGE01, mi_prior = XMI01)
      
        # Set missing values to NA.
        dataset$mi_prior[dataset$mi_prior %in% 'X'] <- NA
      
        # Convert age to numeric and mi_prior to character.
        dataset$age <- as.numeric(dataset$age)
        dataset$mi_prior <- as.character(dataset$mi_prior)
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="mi_prior_1-mesa"></a>
  * ### atherosclerosis_events_prior/mi_prior_1 -- **MESA**:
    * 1 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Convert age to numeric and set all participants to 0.
        dat <- transmute(phen_list$source_data$pht001116, topmed_subject_id, age = as.numeric(age1c),
                         mi_prior = "0")
        return(dat)
      }
      ```
<a id="mi_prior_1-whi"></a>
  * ### atherosclerosis_events_prior/mi_prior_1 -- **WHI**:
    * 3 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht000998.v6.phv00078482.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          # Convert age to numeric and rename MI variable.
          dat <- transmute(
            phen_list$source_data$pht000998,
            age = as.numeric(AGE),
            mi_prior = MI,
            topmed_subject_id
          ) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="pad_prior_1"></a>
## atherosclerosis_events_prior: **pad_prior_1** (pad_prior)
  An indicator of whether a subject had peripheral arterial disease prior to the baseline visit.
  * **Harmonization Units**:
    * [ARIC](#pad_prior_1-aric)
    * [CHS](#pad_prior_1-chs)
    * [COPDGene](#pad_prior_1-copdgene)
    * [FHS](#pad_prior_1-fhs)
    * [JHS](#pad_prior_1-jhs)
    * [MESA](#pad_prior_1-mesa)
    * [WHI](#pad_prior_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: pad_prior, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-10-31 16:35:19
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0085096
  * **DCC Harmonization Comments**:

    This variable was harmonized by appropriately converting component variables to a binary variable indicating the presence or absence of PAD before the baseline visit. Component variables included could indicate presence or absence of PAD either by self-report or by study adjudication. If a study recorded multiple events, the DCC harmonized only the earliest event prior to baseline. Unless otherwise stated, the age variable accompanying this variable represents the study participants' age when history of PAD was recorded, _not_ the age at which PAD occurred.
    
    
    ### Study-specific comments
    
    #### JHS
    PAD was determined by calculating the ankle-brachial index (ABI) from six total blood pressure measurements: two from the arm and four from the ankle. ABI was determined by dividing the maximum blood pressure of the arm by the maximum blood pressure of the ankle.  A subject was coded as "1" for prior PAD if the calculated ABI value was less than 0.9.
    
    #### FHS
    *_FHS_* uses intermittent claudication to determine PAD. The age variable accompanying this variable represents the age at which the PAD diagnosis occurred, not the age when the history of PAD was recorded. 
    
    ### Reporting method for component study variables
    The table below shows the reporting method (self-reported or adjudicated by the study) for component study variables from each study included in this harmonized variable.
    
    | Study or subcohort | Self-report or Adjudicated|
    |---------|----------|
    | FHS | Adjudicated|
    | MESA | Self-report |
    | JHS | Self-report |
    | ARIC | Self-report |
    | CHS | Both |
    | COPDGene | Self-report |
    | WHI | Self-report |
    
    
<a id="pad_prior_1-aric"></a>
  * ### atherosclerosis_events_prior/pad_prior_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v5.pht004063.v2.phv00204712.v1`, `phs000280.v5.pht004063.v2.phv00204795.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        dataset <- plyr::join_all(phen_list$source_data) %>%
          rename(age = V1AGE01, pad_prior = PAD02)
      
        dataset$pad_prior[dataset$pad_prior %in% 'T'] <- NA
      
        # Convert age to numeric and pad_prior to character.
        dataset$age <- as.numeric(dataset$age)
        dataset$pad_prior <- as.character(dataset$pad_prior)
      
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="pad_prior_1-chs"></a>
  * ### atherosclerosis_events_prior/pad_prior_1 -- **CHS**:
    * 4 component_study_variables: `phs000287.v6.pht001452.v1.phv00100330.v1`, `phs000287.v6.pht001452.v1.phv00100333.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001452.v1.phv00100507.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Filter out rows where all phenotype rows are missing.
        dat <- filter(phen_list$source_data$pht001452, !(is.na(CLBLMOD) & is.na(ABTLEG) &
                                                         is.na(EXTART))) %>%
          # Convert all variables to numeric
          mutate_if(is.character, as.numeric) %>%
          # Rename age and calculate PAD variable.
          transmute(topmed_subject_id, age = as.numeric(AGEBL),
                         pad_prior = data.frame(CLBLMOD, ABTLEG, EXTART) %>%
                                     rowSums(na.rm = TRUE) %>%
                                     as.logical() %>%
                                     as.integer() %>%
                                     as.character()) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="pad_prior_1-copdgene"></a>
  * ### atherosclerosis_events_prior/pad_prior_1 -- **COPDGene**:
    * 2 component_study_variables: `phs000179.v5.pht002239.v4.phv00159618.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        dataset <- phen_list$source_data$pht002239 %>%
          rename(age = Age_Enroll, pad_prior = PeriphVascular)
      
        # Convert age to numeric and pad_prior to character.
        dataset$age <- as.numeric(dataset$age)
        dataset$pad_prior <- as.character(dataset$pad_prior)
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="pad_prior_1-fhs"></a>
  * ### atherosclerosis_events_prior/pad_prior_1 -- **FHS**:
    * 5 component_study_variables: `phs000007.v30.pht000309.v13.phv00036469.v12`, `phs000007.v30.pht000309.v13.phv00036471.v12`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht003316.v7.phv00190817.v7`, `phs000007.v30.pht003316.v7.phv00190823.v7`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          # Join datasets.
          dat <- full_join(source_data$pht003099, source_data$pht000309, by = "topmed_subject_id") %>%
      
            # Convert age to numeric.
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      event = as.numeric(EVENT),
                      date = as.numeric(DATE))
      
          # Create pad_prior variable. Gather all pad_prior events.
          dat$pad_prior <- replicate(length(dat$event), 0)
          dat$pad_prior  <- case_when(
            dat$event == 30 ~ 1,
            dat$event != 30 ~ 0,
            is.na(dat$event) ~ NA_real_
          )
      
          # Calculate age at event.
          dat$age_at_event <- replicate(length(dat$event), 0)
          dat$age_at_event <- floor(dat$cad_followup_start_age + (dat$date / 365.25))
      
          # Identify prior pad events.
          dat <- dat %>%
            mutate(pad_prior = case_when(pad_prior == 1 & date <= 0 ~ 1,
                                         pad_prior == 1 & date > 0 ~ 0,
                                         TRUE ~ pad_prior))
      
          # Find subjects with multiple pad events and select first pad event.
          pad_event <- dat %>%
            filter(pad_prior == 1) %>%
            arrange(topmed_subject_id, date) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-event)
      
          # Gather all non-pad-event subjects.
          non_pad_event <- dat %>%
            filter(pad_prior == 0) %>%
            select(-event)
      
          # Gather all non-event subjects from surv dataset.
          dat2 <- full_join(source_data$pht003099, source_data$pht003316, by = "topmed_subject_id") %>%
            transmute(topmed_subject_id,
                      cad_followup_start_age = as.numeric(age1),
                      cvd_status = as.numeric(cvd),
                      date = as.numeric(cvddate))
      
          # Create a non-event specific dataset and remove duplicates.
          non_event <- dat2 %>%
            filter(cvd_status == 0) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            select(-cvd_status)
      
          # Create a pad_prior variable for non-event subjects.
          non_event$pad_prior <- 0
      
          # Create an age at censoring variable for non-event subjects.
          non_event$age_at_event <-
            non_event$cad_followup_start_age + (non_event$date / 365.25)
      
          # Bind non_event and non_pad_event datasets and remove duplicates.
          non_event_all <- rbind(non_event, non_pad_event) %>%
            arrange(topmed_subject_id, desc(date)) %>%
            distinct(topmed_subject_id, .keep_all = TRUE)
      
          # Combine all pad-event subjects with non-pad-event subjects.
          dat_combined <- bind_rows(pad_event, non_event_all) %>%
            arrange(topmed_subject_id, desc(pad_prior)) %>%
      
            # Remove duplicate subjects with multiple events.
            distinct(topmed_subject_id, .keep_all = TRUE) %>%
            transmute(topmed_subject_id, pad_prior = as.character(pad_prior), age = age_at_event) %>%
            na.omit()
      
          return(dat_combined)
      
      }
      ```
<a id="pad_prior_1-jhs"></a>
  * ### atherosclerosis_events_prior/pad_prior_1 -- **JHS**:
    * 7 component_study_variables: `phs000286.v5.pht001921.v1.phv00124562.v1`, `phs000286.v5.pht001921.v1.phv00124563.v1`, `phs000286.v5.pht001921.v1.phv00124564.v1`, `phs000286.v5.pht001921.v1.phv00124565.v1`, `phs000286.v5.pht001921.v1.phv00124566.v1`, `phs000286.v5.pht001921.v1.phv00124567.v1`, `phs000286.v5.pht001949.v1.phv00126009.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        dataset <- plyr::join_all(phen_list$source_data) %>%
          rename(age = AGE01) %>%
          mutate_if(is.character, as.numeric)
      
        # Take max of the 4 BP measurements from the ankle.
        ankle <- c("ABBA9", "ABBA10", "ABBA8", "ABBA11")
      
        dataset$max_ankle <- apply(dataset[, ankle],
                                       1,
                                       function(x) ifelse(all(is.na(x)),
                                                          NA,
                                                          max(x, na.rm = TRUE)))
      
        # Take max of the 2 BP measurements from the arm.
        arm <- c("ABBA7", "ABBA12")
      
        dataset$max_arm <- apply(dataset[, arm],
                                      1,
                                      function(x) ifelse(all(is.na(x)),
                                                          NA,
                                                          max(x, na.rm = TRUE)))
      
        # Calculate ABI
        dataset$abi <- dataset$max_ankle / dataset$max_arm
      
        # Derive prevalent PAD from ABI calculation (PAD is defined by an ABI < 0.9)
        dataset$pad_prior <- as.character(as.integer(dataset$abi < 0.9))
      
        dataset <- dataset %>%
          select(topmed_subject_id, age, pad_prior)
      
        # Convert pad_prior to character and age to numeric.
        dataset$age <- as.numeric(dataset$age)
      
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="pad_prior_1-mesa"></a>
  * ### atherosclerosis_events_prior/pad_prior_1 -- **MESA**:
    * 1 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Convert age to numeric and set all participants to 0.
        dat <- transmute(phen_list$source_data$pht001116, topmed_subject_id, age = as.numeric(age1c),
                         pad_prior = "0")
        return(dat)
      }
      ```
<a id="pad_prior_1-whi"></a>
  * ### atherosclerosis_events_prior/pad_prior_1 -- **WHI**:
    * 4 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht000999.v6.phv00078507.v6`, `phs000200.v11.pht000999.v6.phv00078562.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        source_data <- phen_list$source_data
        # Join Form 2 data with Form 30 data
        dat <- full_join(source_data$pht000998, source_data$pht000999, "topmed_subject_id") %>%
          # Set positive F2DAYS values to 0.
          mutate_at(vars(F2DAYS), function(x) case_when(x > 0 ~ 0, TRUE ~ as.numeric(x))) %>%
          # Calculate age, rename PAD variable, and drop remaining variables.
          transmute(age = as.numeric(AGE) + (as.numeric(F30DAYS) + abs(F2DAYS)) / 365.25,
                    pad_prior = PAD, topmed_subject_id) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```

# baseline_common_covariates

### Variables in this section:
* [bmi_baseline_1](#bmi_baseline_1)
* [current_smoker_baseline_1](#current_smoker_baseline_1)
* [ever_smoker_baseline_1](#ever_smoker_baseline_1)
* [height_baseline_1](#height_baseline_1)
* [weight_baseline_1](#weight_baseline_1)

<a id="bmi_baseline_1"></a>
## baseline_common_covariates: **bmi_baseline_1** (bmi_baseline)
  Body mass index calculated at baseline.
  * **Harmonization Units**:
    * [DCC_harmonized](#bmi_baseline_1-dcc_harmonized)
    * [GALAII](#bmi_baseline_1-galaii)
    * [GOLDN](#bmi_baseline_1-goldn)
    * [SAGE](#bmi_baseline_1-sage)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: kg/m^2, **`Version`**: 4, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-09-30 16:03:59
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C1305855
  * **DCC Harmonization Comments**:

    This variable was calculated from harmonized baseline height and weight for all available studies using the formula $BMI = weight / height^2$.
    
    #### HVH
    
    There are multiple observations for many subjects in the HVH phenotype data. In
    these instances, we used the earliest observation of each subject for harmonization. Although
    this harmonized phenotype is designated as "baseline", the concept of
    "baseline" does not apply to HVH based on its study design. Consult the study
    documentation for more details (phs001013).
    
    #### BAGS
    
    Using BAGS height and weight data to calculate BMI, we identified 6 implausibly high BMI values. The study investigated and confirmed that these 6 subjects had incorrect values for height and weight component study variables.  The incorrect BMI values for this study can be identified using `bmi_baseline_1` values > 100.  
    
    #### GOLDN
    
    We used a BMI variable calculated by the study as the component variable, not height and weight variables.
    
    #### SAGE
    
    We used a BMI variable calculated by the study as the component variable, not height and weight variables.
    
    #### Exam visit for BMI measurement or measurement of component variables
    
    | Study or subcohort | Visit |
    |---------|----------|
    | Amish | Baseline visit |
    | ARIC | Exam 1 |
    | BAGS | Baseline visit |
    | CARDIA |Year 0/Exam 1 |
    | CCAF | *Unspecified first visit* |
    | CFS | Baseline visit |
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | COPDGene | Baseline visit |
    | CRA | Baseline visit | 
    | DHS | Baseline visit |
    | FHS | Exam 1 |
    | GALAII | Baseline visit |
    | GeneSTAR_ProbandSiblingCohort | Sibling Study Visit |
    | GeneSTAR_OffspringCoparentCohort | Platelet Study Visit |
    | GENOA | Phase 1 |
    | GOLDN | Baseline visit |
    | HCHS_SOL | Visit 1 |
    | HVH | *No visit structure* |
    | JHS | Visit 1 |
    | Mayo_VTE_GENEVA | *Unspecified first visit*  |
    | Mayo_VTE_Olmsted | *Unspecified first visit* |
    | MESA_Classic | Exam 1 Main |
    | MESA_Family | Family Exam Main |
    | MESA_AirNR | AirNR Exam Main | 
    | MGH_AF | *Unspecified first visit* |
    | Partners | Baseline visit |
    | SAGE | Exam 1, initial interview |
    | SAS | Exam 1 |
    | VAFAR | *Unspecified first visit* |
    | VU_AF | *Unspecified first visit* |
    | WGHS | Exam 1 |
    | WHI | Screening, Year 0 |
    
    
<a id="bmi_baseline_1-dcc_harmonized"></a>
  * ### baseline_common_covariates/bmi_baseline_1 -- **DCC_harmonized**:
    * 2 component_harmonized_variables: `height_baseline_1`, `weight_baseline_1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        harmonized_data <- phen_list$harmonized_data
        # Join baseline height and weight datasets on topmed_subject_id
        harmonized_data <- inner_join(harmonized_data$height_baseline_1,
                                      harmonized_data$weight_baseline_1,
                                      "topmed_subject_id") %>%
                           select(-c(unit_height_baseline_1, unit_weight_baseline_1))
      
        # Convert character variables to numeric
        harmonized_data <- replace(harmonized_data, harmonized_data == 'NA', NA) %>%
                           mutate_if(is.character, as.numeric)
        # Filter to observations where age variables match
        harmonized_data <- harmonized_data %>%
                           filter(age_at_height_baseline_1 == age_at_weight_baseline_1) %>%
                           transmute(topmed_subject_id, age = age_at_height_baseline_1,
        # Calculate BMI from weight(in kg) and height (in cm)
        bmi_baseline = weight_baseline_1 / (height_baseline_1 / 100) ^ 2)
      
        # Exclude incomplete records
        harmonized_data <- harmonized_data %>%
        select(topmed_subject_id, bmi_baseline, age) %>%
        na.omit() %>%
        return()
      }
      ```
<a id="bmi_baseline_1-galaii"></a>
  * ### baseline_common_covariates/bmi_baseline_1 -- **GALAII**:
    * 2 component_study_variables: `phs001180.v1.pht006991.v1.phv00320630.v1`, `phs001180.v1.pht006991.v1.phv00320633.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006991
        dataset <- replace(dataset, dataset == 'NA', NA)
        dataset <- dataset %>%
                   transmute(topmed_subject_id,
                             age = as.numeric(AGE),
                             bmi_baseline = as.numeric(BMI)) %>%
                   na.omit() %>%
                   return()
      }
      ```
<a id="bmi_baseline_1-goldn"></a>
  * ### baseline_common_covariates/bmi_baseline_1 -- **GOLDN**:
    * 2 component_study_variables: `phs000741.v2.pht003918.v2.phv00202104.v2`, `phs000741.v2.pht003918.v2.phv00259051.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht003918 %>%
              # Convert BMI to numeric and rename
              transmute(topmed_subject_id, age, bmi_baseline = as.numeric(BMI)) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="bmi_baseline_1-sage"></a>
  * ### baseline_common_covariates/bmi_baseline_1 -- **SAGE**:
    * 2 component_study_variables: `phs000921.v3.pht004883.v3.phv00252283.v3`, `phs000921.v3.pht004883.v3.phv00252286.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        #Dataset
        dataset <- phen_list$source_data$pht004883 %>%
                   rename(age = AGE, bmi_baseline = BMI)
      
        #Convert to numeric variables
        dataset <- replace(dataset, dataset == 'NA', NA) %>%
                   mutate_if(is.character, as.numeric)
      
        #Remove missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="current_smoker_baseline_1"></a>
## baseline_common_covariates: **current_smoker_baseline_1** (current_smoker_baseline)
  Indicates whether subject currently smokes cigarettes.
  * **Harmonization Units**:
    * [Amish](#current_smoker_baseline_1-amish)
    * [ARIC](#current_smoker_baseline_1-aric)
    * [BAGS](#current_smoker_baseline_1-bags)
    * [CARDIA](#current_smoker_baseline_1-cardia)
    * [CFS](#current_smoker_baseline_1-cfs)
    * [CHS](#current_smoker_baseline_1-chs)
    * [COPDGene](#current_smoker_baseline_1-copdgene)
    * [CRA](#current_smoker_baseline_1-cra)
    * [FHS_NOS_Gen3_Omni2](#current_smoker_baseline_1-fhs_nos_gen3_omni2)
    * [FHS_Offspring](#current_smoker_baseline_1-fhs_offspring)
    * [FHS_Omni1](#current_smoker_baseline_1-fhs_omni1)
    * [FHS_Original](#current_smoker_baseline_1-fhs_original)
    * [GALAII](#current_smoker_baseline_1-galaii)
    * [GeneSTAR](#current_smoker_baseline_1-genestar)
    * [GENOA](#current_smoker_baseline_1-genoa)
    * [HCHS_SOL](#current_smoker_baseline_1-hchs_sol)
    * [HVH](#current_smoker_baseline_1-hvh)
    * [JHS](#current_smoker_baseline_1-jhs)
    * [Mayo_VTE_GENEVA](#current_smoker_baseline_1-mayo_vte_geneva)
    * [Mayo_VTE_Olmsted](#current_smoker_baseline_1-mayo_vte_olmsted)
    * [MESA](#current_smoker_baseline_1-mesa)
    * [SAGE](#current_smoker_baseline_1-sage)
    * [SAS](#current_smoker_baseline_1-sas)
    * [WGHS](#current_smoker_baseline_1-wghs)
    * [WHI](#current_smoker_baseline_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 4, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-09-30 14:21:24
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0337667
  * **DCC Harmonization Comments**:

    We used component study variables from smoking history questionnaires to harmonize this phenotype when available, rather than using derived 'current smoker' study variables. When using component questionnaire data, we looked for inconsistencies between subject responses across multiple questions. If a subject's responses were inconsistent, our general approach was to prioritize any positive indication that a subject currently smokes regularly. That is, any positive indication of current regular smoking results in coding as "1" ("Currently smokes cigarettes"). E.g. if a subject responds that they do not currently smoke, but also responds that they currently smoke > 0 cigarettes per day, they will be coded as "1" ("Currently smokes cigarettes") for this harmonized variable. In some cases, subjects who indicated that they had never smoked were not subsequently asked if they currently smoked, resulting in missing data values for the current smoking component study variable. These subjects were coded as "0" ("Does not currently smoke cigarettes").
    
    
    The smoking history questionnaires used by different studies used different
    time cutpoints to classify their subjects as 'current smokers'. Refer to the component variables for each study for details.
    
    #### HVH
    
    There are multiple observations for many subjects in the HVH phenotype data. In
    these instances, we used the earliest observation of each subject for harmonization. Although
    this harmonized phenotype is designated as "baseline", the concept of
    "baseline" does not apply to HVH based on its study design. Consult the study
    documentation for more details (phs001013).
    
    #### Exam visit used for current smoker assignment
    
    | Study or subcohort | Visit |
    |---------|----------|
    | Amish | Baseline visit |
    | ARIC | Exam 1 |
    | BAGS | Baseline visit |
    | CARDIA | Year 0/Exam 1 |
    | CFS | Baseline visit |
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | FHS | Exam 1 |
    | GALAII | Baseline visit |
    | GeneSTAR_ProbandSiblingCohort | Sibling Study Visit |
    | GeneSTAR_OffspringCoparentCohort | Platelet Study Visit |
    | GENOA | Phase 1 |
    | HCHS_SOL | Visit 1 |
    | HVH | *No visit structure* |
    | JHS | Visit 1 |
    | Mayo_VTE_GENEVA | *Unspecified first visit* |
    | Mayo_VTE_Olmsted | *Unspecified first visit* |
    | MESA_Classic | Exam 1 Main |
    | MESA_Family | Family Exam Main |
    | MESA_AirNR | AirNR Exam Main | 
    | SAGE | Exam 1, initial interview |
    | SAS | Exam 1 |
    | WGHS | Exam 1 |
    | WHI | Screening, Year 0 |
    
    
<a id="current_smoker_baseline_1-amish"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v3.pht005002.v1.phv00252976.v1`, `phs000956.v3.pht005002.v1.phv00252990.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht005002 %>%
              # Convert encoded winsorized values to numeric values
              mutate(age_baseline = ifelse(age_baseline == "90+", "90", age_baseline)) %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Rename variables
              rename(age = age_baseline) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-aric"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **ARIC**:
    * 4 component_study_variables: `phs000280.v5.pht004063.v2.phv00204712.v1`, `phs000280.v5.pht004111.v2.phv00207368.v1`, `phs000280.v5.pht004111.v2.phv00207370.v1`, `phs000280.v5.pht004111.v2.phv00207372.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          source_data$pht004111 %>%
              # Code current_smoker_baseline as 0 if HOM28 is "N" and HOM30 is NA
              mutate(current_smoker_baseline = ifelse(HOM28 == "N" & is.na(HOM30), 0,
                      # Code current_smoker_baseline as 0 if HOM30 is "N"
                      ifelse(HOM30 == "N", 0,
                      # Code current_smoker_baseline as 1 if HOM30 is "Y", else code as NA
                      ifelse(HOM30 == "Y", 1, NA))),
                  # Code "A" and NA as zero in HOM32
                  HOM32 = as.numeric(ifelse(HOM32 == "A" | is.na(HOM32), 0, HOM32)),
              # Recode current_smoker_baseline as TRUE if respondent reports smoking a
              # a positive number of cigarettes
              current_smoker_baseline = as.numeric(as.logical(current_smoker_baseline + HOM32))) %>%
              select(topmed_subject_id, current_smoker_baseline) %>%
              # Join with age dataset
              left_join(source_data$pht004063, "topmed_subject_id") %>%
              # Exclude incomplete records
              na.omit() %>%
              # Rename age variable
              rename(age = V1AGE01) %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-bags"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **BAGS**:
    * 4 component_study_variables: `phs001143.v2.pht005905.v2.phv00273211.v2`, `phs001143.v2.pht005905.v2.phv00375339.v1`, `phs001143.v2.pht005905.v2.phv00375341.v1`, `phs001143.v2.pht005905.v2.phv00375343.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Data
        dataset <- phen_list$source_data$pht005905
        #Converting to numeric values
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate_if(is.character, as.numeric)
        #Subjects who report > 0 cigs/day assigned ever smoker
        dataset$EVER_SMOKED_CIGARETTES[dataset$DAILY_NR_CIGARETTES > 0] <- 1
      
        #Assigning current_smoker_baseline variable
        dataset$current_smoker_baseline <- dataset$CURRENT_SMOKING
        #Never smokers assigned not current smoker status
        dataset$current_smoker_baseline[dataset$EVER_SMOKED_CIGARETTES == 0] <- 0
      
        #Selecting varaibles and removing missing
        dataset <- dataset %>%
                   select(topmed_subject_id,
                          age = AGE,
                          current_smoker_baseline) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="current_smoker_baseline_1-cardia"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **CARDIA**:
    * 3 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001572.v2.phv00113168.v2`, `phs000285.v3.pht001573.v2.phv00113213.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        source_data <- phen_list$source_data
        # Join both smoking datasets.
        dat <- full_join(source_data$pht001572, source_data$pht001573, "topmed_subject_id") %>%
          # Recode "M" to NA.
          mutate_at(vars(A09SMKNW, A10CIGS), funs(na_if(., "M")))
        # "Never smokers" were not asked the current smoking question. Code them all as "not current
        # smokers."
        dat$A09SMKNW[dat$A10CIGS == 1 & is.na(dat$A09SMKNW)] <- 1
        # Recode "1" to "0".
        dat$A09SMKNW[dat$A09SMKNW == 1] <- "0"
        # Recode "2" to "1".
        dat$A09SMKNW[dat$A09SMKNW == 2] <- "1"
        # Join smoking data with age data.
        dat <- inner_join(dat, source_data$pht001559, "topmed_subject_id") %>%
          # Rename age and current smoker variables, and convert numeric.
          transmute(age = as.numeric(A01AGE2), current_smoker_baseline = as.numeric(A09SMKNW),
                    topmed_subject_id) %>%
          # Remove rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="current_smoker_baseline_1-cfs"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **CFS**:
    * 4 component_study_variables: `phs000284.v2.pht001902.v1.phv00122012.v1`, `phs000284.v2.pht001902.v1.phv00122015.v1`, `phs000284.v2.pht001902.v1.phv00122343.v1`, `phs000284.v2.pht001902.v1.phv00122344.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          df <- phen_list$source_data$pht001902 %>%
              # Subset to baseline visit. Some respondents baseline is visit 5
              filter(visit %in% c("1", "5")) %>%
              group_by(topmed_subject_id) %>%
              arrange(topmed_subject_id, visit) %>%
              filter(row_number(topmed_subject_id) == 1) %>%
              ungroup() %>%
              # Convert variables to numeric
              mutate_if(is.character, as.numeric)
      
          # Recode -1 and NA as 0 in NOWSMOKE
          df$NOWSMOKE[df$NOWSMOKE == -1] <- 0
          df$NOWSMOKE[is.na(df$NOWSMOKE)] <- 0
          # Recode -1 as 0 in MONSMOKE
          df$MONSMOKE[df$MONSMOKE == -1] <- 0
      
          # Recode current_smoker_baseline to 1 if respondent reports smoking > 1  cigarette
          # per day
          df %>% transmute(topmed_subject_id, age,
                  current_smoker_baseline = as.numeric(as.logical(MONSMOKE + NOWSMOKE))) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-chs"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **CHS**:
    * 5 component_study_variables: `phs000287.v6.pht001450.v1.phv00098844.v1`, `phs000287.v6.pht001450.v1.phv00098845.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001490.v1.phv00105143.v1`, `phs000287.v6.pht001490.v1.phv00105144.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
      
          source_data[c("pht001450", "pht001490")] %>%
              # pht001450 and pht001490 have empty rows for members of the original
              # and new cohorts, respectively. These are filtered out here
              lapply(filter, !(is.na(SMOKE101) & is.na(SMOKE201))) %>%
              # Bind first two datasets row-wise
              bind_rows() %>%
              # Join with age dataset by topmed_subject_id
              full_join(source_data$pht001452, "topmed_subject_id") %>%
              # Transform and rename variables
              # Code current_smoker_baseline as 0 if SMOKE101 is 0 and SMOKE201 is NA
              transmute(current_smoker_baseline = ifelse(SMOKE101 == "0" & is.na(SMOKE201), 0,
                      # Else, use value from SMOKE201
                      as.integer(SMOKE201)),
                  topmed_subject_id, age = AGEBL) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-copdgene"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **COPDGene**:
    * 9 component_study_variables: `phs000179.v5.pht002239.v4.phv00159636.v4`, `phs000179.v5.pht002239.v4.phv00159637.v4`, `phs000179.v5.pht002239.v4.phv00159640.v4`, `phs000179.v5.pht002239.v4.phv00159749.v4`, `phs000179.v5.pht002239.v4.phv00159750.v4`, `phs000179.v5.pht002239.v4.phv00159754.v4`, `phs000179.v5.pht002239.v4.phv00159755.v4`, `phs000179.v5.pht002239.v4.phv00159756.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        df <- phen_list$source_data$pht002239 %>%
          # Convert character variables to numeric
          mutate_if(is.character, as.numeric) %>%
          # Rename variables
          rename_(current_smoker_baseline = "SmokCigNow", age = "Age_Enroll")
      
        modifier <- select(df, -topmed_subject_id, -age, -current_smoker_baseline) %>%
        # Sum other variables that indicate smoking status, counting NA as 0
          rowSums(na.rm = TRUE)
      
        # Add modifier to current_smoker_baseline and convert to 0/1
        transmute(
            df,
            current_smoker_baseline = as.numeric(as.logical(current_smoker_baseline + modifier)),
            topmed_subject_id,
            age
          ) %>%
          # Exclude incomplete records
          na.omit() %>%
          return()
      }
      ```
<a id="current_smoker_baseline_1-cra"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **CRA**:
    * 3 component_study_variables: `phs000988.v2.pht005248.v2.phv00258650.v2`, `phs000988.v2.pht005248.v2.phv00267375.v2`, `phs000988.v2.pht005248.v2.phv00267378.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          phen_list$source_data$pht005248 %>%
              # Convert variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Recode 1 to 0
              mutate(Current_Smoker = ifelse(Current_Smoker == 1, 0, Current_Smoker),
                     # Code NA as 0
                     cigsperday = ifelse(is.na(cigsperday), 0, cigsperday)) %>%
              transmute(topmed_subject_id, age,
                        # Recode current_smoker_baseline from 0 to 1 if respondent smokes > 0 cigarettes
                        # per day
                        current_smoker_baseline = as.numeric(as.logical(Current_Smoker + cigsperday))) %>%
              # exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-fhs_nos_gen3_omni2"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **FHS_NOS_Gen3_Omni2**:
    * 7 component_study_variables: `phs000007.v30.pht000074.v11.phv00020926.v5`, `phs000007.v30.pht000074.v11.phv00020927.v5`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht006005.v1.phv00273760.v1`, `phs000007.v30.pht006005.v1.phv00273761.v1`, `phs000007.v30.pht006006.v2.phv00274253.v2`, `phs000007.v30.pht006006.v2.phv00274254.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          smk <- source_data[c("pht000074", "pht006005", "pht006006")] %>%
              # Select variables in standard order
              lapply(select, topmed_subject_id, matches("g3a071"), matches("g3a072")) %>%
              # Standardize names
              lapply(setNames, c("topmed_subject_id", "smoke_past_year", "smoke_now")) %>%
              # Bind rowwise
              do.call(what = rbind) %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Subset to records with an observation for at least one phenotype
              filter(!(is.na(smoke_past_year) & is.na(smoke_now)))
      
          # Create current_smoker_baseline variable
          current_smoker_baseline <- smk %>%
              # Select smoking phenotypes
              select(smoke_past_year, smoke_now) %>%
              # Sum row-wise, treating NA as 0
              rowSums(na.rm = TRUE) %>%
              # Convert to TRUE/FALSE
              as.logical()
      
              # Add current_smoker_baseline variable to dataframe, and drop old columns
              smk %>% transmute(topmed_subject_id,
                                current_smoker_baseline = as.integer(current_smoker_baseline)) %>%
              # Join with age variable
              left_join(source_data$pht003099, "topmed_subject_id") %>%
              rename(age = age1) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-fhs_offspring"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **FHS_Offspring**:
    * 2 component_study_variables: `phs000007.v30.pht000030.v8.phv00007612.v6`, `phs000007.v30.pht003099.v5.phv00177930.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          source_data$pht000030 %>%
              # Transform smoking variable and drop old version
              transmute(topmed_subject_id,
                  # Code current_smoker_baseline as 0 if A99 is 0 or 2
                  current_smoker_baseline = ifelse(A99 %in% c("0", "2"), 0,
                      # Code current_smoker_baseline as 1 if A99 is 1, else code as NA
                      ifelse(A99 == "1", 1, NA))) %>%
                  # Join with age dataset on topmed_subject_id
              left_join(source_data$pht003099, "topmed_subject_id") %>%
              rename(age = age1) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-fhs_omni1"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **FHS_Omni1**:
    * 2 component_study_variables: `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht004813.v1.phv00250452.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          # Join datasets on topmed_subject_id
          source_data$pht004813 %>% left_join(source_data$pht003099) %>%
              # Rename and convert to numeric
              transmute(topmed_subject_id, age = as.numeric(age1),
                  current_smoker_baseline = as.numeric(e319)) %>%
              # Exclude incomplete results
              na.omit() %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-fhs_original"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **FHS_Original**:
    * 2 component_study_variables: `phs000007.v30.pht000009.v2.phv00000543.v1`, `phs000007.v30.pht003099.v5.phv00177930.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          source_data$pht000009 %>%
              # Join datasets on topmed_subject_id
              left_join(source_data$pht003099, "topmed_subject_id") %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Transform and rename variables
              transmute(topmed_subject_id, age = age1,
                  # Code current_smoker_baseline as 1 if MF71 is 1 or 3
                  current_smoker_baseline = ifelse(MF71 %in% c(1, 3), 1,
                      # Code current_smoker_baseline as 0 if MF71 is 2, 5, or 7, else code it as NA
                      ifelse(MF71 %in% c(2, 5, 7), 0, NA))) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-galaii"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **GALAII**:
    * 2 component_study_variables: `phs001180.v1.pht006991.v1.phv00320630.v1`, `phs001180.v1.pht006991.v1.phv00320635.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006991
        #Assign values
        dataset$current_smoker_baseline <- ifelse(dataset$smoke_current == 'Yes',
                                                  1, 0)
        dataset <- transmute(dataset,
                   topmed_subject_id,
                   age = as.numeric(AGE),
                   current_smoker_baseline)
        return(dataset)
      }
      ```
<a id="current_smoker_baseline_1-genestar"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **GeneSTAR**:
    * 4 component_study_variables: `phs001218.v1.pht007766.v1.phv00369267.v1`, `phs001218.v1.pht007766.v1.phv00369268.v1`, `phs001218.v1.pht007766.v1.phv00369293.v1`, `phs001218.v1.pht007766.v1.phv00369294.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        int <- phen_list$source_data$pht007766
        #Order of levels
        int$VISIT <- int$VISIT %>%
                     as.factor() %>%
                     relevel('SSV')
        #Subset to baseline visits, SSV and PSV
        dataset <- int %>%
                   filter(VISIT %in% c('SSV', 'PSV')) %>%
                   mutate(VISIT = as.factor(VISIT)) %>%
                   group_by(topmed_subject_id) %>%
                   arrange(topmed_subject_id, VISIT) %>%
                   filter(row_number(topmed_subject_id) == 1) %>%
                   ungroup() %>%
                   data.frame()
        #Converting to numeric variable
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(age = as.numeric(AGE))
      
        #Assigning values
        dataset$current_smoker_baseline <- ifelse(dataset$SMOKENOW == '1', 1,
                                                  ifelse(dataset$SMOKENOW == '2', 0,
                                                         ifelse(dataset$SMOKENOW == '3', 1, NA)))
      
        dataset$current_smoker_baseline[dataset$CIGSDAY > '0'] <- 1
      
        #Select variables and remove missing
        dataset <- dataset %>%
                   select(topmed_subject_id, current_smoker_baseline, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="current_smoker_baseline_1-genoa"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **GENOA**:
    * 6 component_study_variables: `phs001238.v2.pht006039.v1.phv00277507.v1`, `phs001238.v2.pht006043.v1.phv00277618.v1`, `phs001238.v2.pht006043.v1.phv00277621.v1`, `phs001238.v2.pht006653.v1.phv00307788.v1`, `phs001238.v2.pht006657.v1.phv00307899.v1`, `phs001238.v2.pht006657.v1.phv00307902.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Row-bind African-American and European-American cohort datasets with age variable.
        age <- bind_rows(source_data[c("pht006039", "pht006653")]) %>%
          # Rename age variable and convert to numeric.
          transmute(topmed_subject_id, age = as.numeric(AGE))
        # Row-bind AA and EA cohort datasets with smoking history.
        smoke <- bind_rows(source_data[c("pht006043", "pht006657")]) %>%
          # Rename smoking status variable.
          rename(current_smoker_baseline = CIGARETT)
        # Recode "Yes" to 1.
        smoke$current_smoker_baseline[smoke$current_smoker_baseline == "Yes"] <- "1"
        # Recode "No" to 0.
        smoke$current_smoker_baseline[smoke$current_smoker_baseline == "No"] <- "0"
        ind <- is.na(smoke$current_smoker_baseline) & smoke$SMOKE100 == "No"
        smoke$current_smoker_baseline[ind] <- "0"
        # There is an observation with an undefined level "Other". Set it to NA.
        smoke$current_smoker_baseline[smoke$current_smoker_baseline == "Other"] <- NA
        # Join the age and smoking datasets.
        harmonized <- inner_join(age, smoke, "topmed_subject_id") %>%
          # Select only ID, age and convert current_smoker to numeric.
          transmute(topmed_subject_id, age,
                    current_smoker_baseline = as.numeric(current_smoker_baseline)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(harmonized)
      }
      ```
<a id="current_smoker_baseline_1-hchs_sol"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **HCHS_SOL**:
    * 5 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00258106.v1`, `phs000810.v1.pht004715.v1.phv00258107.v1`, `phs000810.v1.pht004715.v1.phv00258108.v1`, `phs000810.v1.pht004715.v1.phv00258110.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
        dat <- phen_list$source_data$pht004715 %>%
          # Create empty 'current smoker' variable.
          mutate(current_smoker_baseline = NA)
        # Code 'daily' and 'most days' smokers as '1'.
        dat$current_smoker_baseline[dat$TBEA3 %in% c("1", "2")] <- "1"
        # Code 'not at all' smokers as '0'.
        dat$current_smoker_baseline[dat$TBEA3 %in% "3"] <- "0"
        # Code 'never smokers' as '0'.
        dat$current_smoker_baseline[is_in(dat$TBEA1, "0") & is.na(dat$TBEA3)] <- "0"
        # Create index of participants who report smoking a positive number of
        # cigarettes per day.
        ind <- dat$TBEA4 > 0 | dat$TBEA5A > 0
        # Code those individuals as "1".
        dat$ever_smoker_baseline[ind] <- "1"
        # Rename age and convert age and smoking to numeric.
        dat <- transmute(dat, topmed_subject_id, age = as.numeric(AGE),
                         current_smoker_baseline = as.numeric(current_smoker_baseline)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="current_smoker_baseline_1-hvh"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **HVH**:
    * 4 component_study_variables: `phs001013.v3.pht005311.v2.phv00259376.v2`, `phs001013.v3.pht005311.v2.phv00259377.v2`, `phs001013.v3.pht005311.v2.phv00259378.v2`, `phs001013.v3.pht005311.v2.phv00259394.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$pht005311 %>%
          # Convert character variables to numeric.
          mutate_if(is.character, as.numeric) %>%
          group_by(topmed_subject_id) %>%
          # Select only earliest observations for each participant.
          filter(indexy == min(indexy))
        # Create index of duplicated subject IDs.
        dup_index <- duplicated(select(dat, topmed_subject_id))
        # Create vector of duplicated subject IDs.
        dups <- select(dat, topmed_subject_id)[dup_index, ]
        # Filter out duplicated subject IDs.
        dat <- filter(dat, !(topmed_subject_id %in% unlist(dups))) %>%
          # Drop unnecessary variables.
          select(-ccs, -indexy) %>%
          # Exclude incomplete records.
          na.omit() %>%
          # Code current_smoker_baseline as 1 if smoke is 2, else code as 0.
          mutate(current_smoker_baseline = ifelse(smoke == 2, 1, 0)) %>%
          # Drop old smoking variable.
          select(-smoke)
        return(dat)
      }
      ```
<a id="current_smoker_baseline_1-jhs"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **JHS**:
    * 3 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001977.v1.phv00128496.v1`, `phs000286.v5.pht001977.v1.phv00128498.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join all datasets
          phen_list$source_data %>% plyr::join_all("topmed_subject_id", "left") %>%
          transmute(topmed_subject_id, age = AGE01,
              # Code current_smoker_baseline as 0 if TOBA1 is N and TOBA3 is NA
              current_smoker_baseline = ifelse(TOBA1 == "N" & is.na(TOBA3), 0,
                  # Code current smoker as 0 if TOBA3 is N
                  ifelse(TOBA3 == "N", 0,
                  # Code current smoker as 1 if TOBA3 is Y, else code as NA
                  ifelse(TOBA3 == "Y", 1, NA)))) %>%
          # Exclude incomplete records
          na.omit %>%
          return()
      }
      ```
<a id="current_smoker_baseline_1-mayo_vte_geneva"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **Mayo_VTE_GENEVA**:
    * 2 component_study_variables: `phs000289.v2.pht001886.v2.phv00121846.v1`, `phs000289.v2.pht001886.v2.phv00121874.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$pht001886
        # Initialize empty harmonized variable.
        dat$current_smoker_baseline <- NA
        # Get index of current smokers.
        ind_cs <- dat$smoking %in% "1"
        # Specify current smokers.
        dat$current_smoker_baseline[ind_cs] <- 1
        # Get index of former and never smokers.
        ind_no_cs <- dat$smoking %in% c("0", "2")
        # Specify not-current-smokers.
        dat$current_smoker_baseline[ind_no_cs] <- 0
        # Convert age to numeric and drop old variables.
        dat <- transmute(dat, topmed_subject_id, age = as.numeric(enrollage),
                         current_smoker_baseline) %>%
          # Remove rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="current_smoker_baseline_1-mayo_vte_olmsted"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **Mayo_VTE_Olmsted**:
    * 2 component_study_variables: `phs001402.v1.pht008239.v1.phv00389902.v1`, `phs001402.v1.pht008239.v1.phv00389930.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht008239
      
        #Assigning age '>89' to 90
        dataset$enrollage[dataset$enrollage == '>89'] <- 90
      
        dataset$current_smoker_baseline <- ifelse(dataset$smoking == '0' | dataset$smoking == '2', 0,
                                           ifelse(dataset$smoking == '1', 1, NA))
      
        #Variable type, names and removing missing
        dataset <- dataset %>%
                   select(topmed_subject_id, age = enrollage, current_smoker_baseline) %>%
                   mutate_if(is.character, as.numeric) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="current_smoker_baseline_1-mesa"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **MESA**:
    * 9 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00083243.v1`, `phs000209.v13.pht001111.v4.phv00083245.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085570.v2`, `phs000209.v13.pht001116.v10.phv00085572.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087252.v1`, `phs000209.v13.pht001121.v3.phv00087254.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          smk <- phen_list$source_data %>%
              # Set column order across datasets
              lapply(select, topmed_subject_id, starts_with("age"),
                  starts_with("evsmk"), starts_with("cursmk")) %>%
              # Set standard names across datasets
              lapply(setNames, c("topmed_subject_id", "age", "evsmk", "cursmk")) %>%
              # Bind datasets rowwise
              do.call(what = rbind) %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Subset to records with a value for at least one of the following variables
              filter(!(is.na(evsmk) & is.na(cursmk)))
      
          smk %>% transmute(topmed_subject_id, age,
                  # Code current smoker as 0 if evsmk is 0 and cursmk is NA, else use value for cursmk
                  current_smoker_baseline = ifelse(!evsmk & is.na(cursmk), 0, cursmk)) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="current_smoker_baseline_1-sage"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **SAGE**:
    * 2 component_study_variables: `phs000921.v3.pht004883.v3.phv00252283.v3`, `phs000921.v3.pht004883.v3.phv00347787.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        #Dataset
        dataset <- phen_list$source_data$pht004883
      
        #Variable types
        dataset <- replace(dataset, dataset == 'NA', NA) %>%
                   mutate(age = as.numeric(AGE))
      
        #Relevel current_smoker_baseline
        dataset$current_smoker_baseline <- ifelse(dataset$SMOKE_CURRENT == 'No', 0,
          ifelse(dataset$SMOKE_CURRENT == 'NO', 0,
          ifelse(dataset$SMOKE_CURRENT == 'YES', 1, NA)))
      
        #Select variables, remove missing
        dataset <- select(dataset, topmed_subject_id, age, current_smoker_baseline) %>%
                   na.omit()
      }
      ```
<a id="current_smoker_baseline_1-sas"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **SAS**:
    * 2 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258705.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
          source_data <- phen_list$source_data
          dataset <- source_data[["pht005253"]]
          # Make age column into a numeric value.
          dataset$age <- as.numeric(dataset[["Dec_Age"]])
          # Make an empty column to hold current_smoker_baseline.
          dataset$current_smoker_baseline <- NA
          # Set current_smoker_baseline to 1 if Current_smoke was 1.
          dataset$current_smoker_baseline[dataset[["Current_smoke"]] == "1"] <- 1
          # Set current_smoker_baseline to 0 if Current_smoke was 0.
          dataset$current_smoker_baseline[dataset[["Current_smoke"]] == "0"] <- 0
          # Note that other values were left as NA in the final current_smoker_baseline variable.
          dataset <- dataset[c("topmed_subject_id", "current_smoker_baseline", "age")]
          # Remove rows with missing values.
          dataset <- na.omit(dataset)
          return(dataset)
      }
      ```
<a id="current_smoker_baseline_1-wghs"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **WGHS**:
    * 2 component_study_variables: `phs001040.v3.pht005682.v3.phv00265848.v3`, `phs001040.v3.pht005682.v3.phv00375260.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005682
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(SMK3CAT = as.numeric(SMK3CAT),
                          age = as.integer(age))
      
        #Category assignment for current smokers
        dataset$current_smoker_baseline <- ifelse(dataset$SMK3CAT == 1, 1, 0)
      
        #Final variables and remove missing
        dataset <- dataset %>%
                   select(topmed_subject_id, current_smoker_baseline, age) %>%
                   na.omit() %>%
                   return()
      }
      ```
<a id="current_smoker_baseline_1-whi"></a>
  * ### baseline_common_covariates/current_smoker_baseline_1 -- **WHI**:
    * 5 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001003.v6.phv00078773.v6`, `phs000200.v11.pht001003.v6.phv00078774.v6`, `phs000200.v11.pht001003.v6.phv00078776.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join all datasets by topmed_subject_id
          dataset <- plyr::join_all(phen_list$source_data, "topmed_subject_id") %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric)
          # Values in F2DAYS above zero are likely errors. They are set to zero here
          ind <- dataset$F2DAYS > 0
          dataset$F2DAYS[ind] <- 0
          # Code current smoker as 0 if SMOKEVR is 0
          transmute(dataset, current_smoker_baseline = ifelse(SMOKEVR == 0, 0,
                      # Code current smoker as 1 if SMOKNOW is 1, else use value for SMOKENOW
                      ifelse(SMOKNOW == 1, 1, SMOKNOW)),
                  # To calculate age at measurement, add baseline age, days since
                  # enrollment, and age since randomization
                  age = AGE + (abs(F2DAYS) + F34DAYS) / 365.25,
                  topmed_subject_id)  %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1"></a>
## baseline_common_covariates: **ever_smoker_baseline_1** (ever_smoker_baseline)
  Indicates whether subject ever regularly smoked cigarettes.
  * **Harmonization Units**:
    * [ARIC](#ever_smoker_baseline_1-aric)
    * [BAGS](#ever_smoker_baseline_1-bags)
    * [CARDIA](#ever_smoker_baseline_1-cardia)
    * [CFS](#ever_smoker_baseline_1-cfs)
    * [CHS](#ever_smoker_baseline_1-chs)
    * [COPDGene](#ever_smoker_baseline_1-copdgene)
    * [CRA](#ever_smoker_baseline_1-cra)
    * [FHS_NOS_Gen3_Omni2](#ever_smoker_baseline_1-fhs_nos_gen3_omni2)
    * [FHS_Offspring](#ever_smoker_baseline_1-fhs_offspring)
    * [FHS_Omni1](#ever_smoker_baseline_1-fhs_omni1)
    * [FHS_Original](#ever_smoker_baseline_1-fhs_original)
    * [GeneSTAR](#ever_smoker_baseline_1-genestar)
    * [GENOA](#ever_smoker_baseline_1-genoa)
    * [HCHS_SOL](#ever_smoker_baseline_1-hchs_sol)
    * [HVH](#ever_smoker_baseline_1-hvh)
    * [JHS](#ever_smoker_baseline_1-jhs)
    * [Mayo_VTE_GENEVA](#ever_smoker_baseline_1-mayo_vte_geneva)
    * [Mayo_VTE_Olmsted](#ever_smoker_baseline_1-mayo_vte_olmsted)
    * [MESA](#ever_smoker_baseline_1-mesa)
    * [SAS](#ever_smoker_baseline_1-sas)
    * [WGHS](#ever_smoker_baseline_1-wghs)
    * [WHI](#ever_smoker_baseline_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 4, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-09-30 14:34:02
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C1519384
  * **DCC Harmonization Comments**:

    
    We used component study variables from smoking history questionnaires to harmonize this phenotype when available, rather than using derived 'ever smoker' study variables. When using component questionnaire data, we looked for inconsistencies between subject responses across multiple questions. If a subject's responses were inconsistent, our general approach was to prioritize any positive indication that a subject smoked regularly. That is, any positive indication of regular smoking results in coding as "1" ("Current or former cigarette smoker"). E.g. if a subject responds that they have never smoked, but also responds that they smoked > 0 cigarettes per day, they will be coded as "1" ("Current or former cigarette smoker") for this harmonized variable.
    
    #### FHS
    
    The FHS Omni 1 subcohort did not have 'ever smoker' variables from Exam 1 but did at Exam 2. All current smokers at Exam 1 were coded as "1" ("Current or former cigarette smoker") and subjects that indicated they had never smoked at Exam 2 were coded as "0" ("Never a cigarette smoker"). All other subjects were set to missing. 
    
    Using the variables indicating number of years smoked at Exam 2 (phv00251241), age at Exam 1 (phv00177930), and age at Exam 2 (phv00177932) 69 additional 'ever smokers' at Exam 1 can be extrapolated.
    
    #### HVH
    
    There are multiple observations for many subjects in the HVH phenotype file. In
    these instances, we used the earliest observation for harmonization. Although
    this harmonized phenotype is designated as "baseline", the concept of
    "baseline" does not apply to HVH based on its study design. Consult the study
    documentation for more details (phs001013).
    
    #### Exam visit used for ever smoker assignment
    
    | Study or subcohort | Visit |
    |---------|----------|
    | ARIC | Exam 1 |
    | BAGS | Baseline visit |
    | CARDIA | Year 0/Exam 1 |
    | CFS | Baseline visit |
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | COPDGene | Baseline visit |
    | CRA | Baseline visit | 
    | FHS_Original | Exam 1 |
    | FHS_Offspring | Exam 1 |
    | FHS_NewOffspringSpouse | Exam 1 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 1 and Exam 2 |
    | FHS_Omni2 | Exam 1 |
    | FHS_Original | Exam 1 |
    | GeneSTAR_ProbandSiblingCohort | Sibling Study Visit |
    | GeneSTAR_OffspringCoparentCohort | Platelet Study Visit |
    | GENOA | Phase 1 |
    | HCHS_SOL | Visit 1 |
    | HVH | *No visit structure* |
    | JHS | Visit 1 |
    | Mayo_VTE_GENEVA | *Unspecified first visit* |
    | Mayo_VTE_Olmsted | *Unspecified first visit* |
    | MESA_Classic | Exam 1 Main |
    | MESA_Family | Family Exam Main |
    | MESA_AirNR | AirNR Exam Main | 
    | SAS | Exam 1 |
    | WGHS | Exam 1 |
    | WHI | Screening, Year 0 |
    
<a id="ever_smoker_baseline_1-aric"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **ARIC**:
    * 6 component_study_variables: `phs000280.v5.pht004063.v2.phv00204712.v1`, `phs000280.v5.pht004111.v2.phv00207368.v1`, `phs000280.v5.pht004111.v2.phv00207369.v1`, `phs000280.v5.pht004111.v2.phv00207370.v1`, `phs000280.v5.pht004111.v2.phv00207375.v1`, `phs000280.v5.pht004111.v2.phv00207376.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          source_data$pht004111 %>%
          # Code "A" and NA as 0 in HOM29 and HOM35
              mutate(HOM29 = as.numeric(ifelse(is.na(HOM29) | HOM29 == "A", 0, HOM29)),
              HOM35 = as.numeric(ifelse(is.na(HOM35) | HOM35 == "A", 0, HOM35)),
              # Convert HOM36 to TRUE/FALSE
              HOM36 = !is.na(HOM36),
                  # Code ever_smoker_baseline as 0 if HOM28 is N
              ever_smoker_baseline = ifelse(HOM28 == "N", 0,
                      # Code ever_smoker_baseline as 1 if HOM28 or HOM30 are Y, else code as NA
                      ifelse(HOM28 == "Y" | HOM30 == "Y", 1, NA)),
                      ever_smoker_baseline = as.numeric(as.logical(
                          ever_smoker_baseline + HOM29 + HOM35 + HOM36
                      ))) %>%
              select(topmed_subject_id, ever_smoker_baseline) %>%
              # Join with age dataset on topmed_subject_id
              left_join(source_data$pht004063, "topmed_subject_id") %>%
              # Exclude incomplete records
              na.omit() %>%
              rename(age = V1AGE01) %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-bags"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **BAGS**:
    * 3 component_study_variables: `phs001143.v2.pht005905.v2.phv00273211.v2`, `phs001143.v2.pht005905.v2.phv00375339.v1`, `phs001143.v2.pht005905.v2.phv00375343.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Data
        dataset <- phen_list$source_data$pht005905
        #Converting to numeric values
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate_if(is.character, as.numeric)
        #Subjects who report > 0 cigs/day assigned ever smoker
        dataset$EVER_SMOKED_CIGARETTES[dataset$DAILY_NR_CIGARETTES > 0] <- 1
        #Selecting varaibles and removing missing
        dataset <- dataset %>%
                   select(topmed_subject_id,
                          age = AGE,
                          ever_smoker_baseline = EVER_SMOKED_CIGARETTES) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="ever_smoker_baseline_1-cardia"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001573.v2.phv00113213.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Create dataframe for harmonized phenotype.
        dat <- source_data$pht001573
        # Create empty vector for harmonized variable.
        dat$ever_smoker_baseline <- NA
        # Recode "2" to "1"
        dat$ever_smoker_baseline[dat$A10CIGS == "2"] <- 1L
        # Recode "1" to "0"
        dat$ever_smoker_baseline[dat$A10CIGS == "1"] <- 0L
        # Join smoking data with age variable.
        dat <- inner_join(dat, source_data$pht001559, "topmed_subject_id") %>%
          # Rename and convert age to numeric.
          transmute(topmed_subject_id, ever_smoker_baseline, age = as.numeric(A01AGE2)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="ever_smoker_baseline_1-cfs"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **CFS**:
    * 7 component_study_variables: `phs000284.v2.pht001902.v1.phv00122012.v1`, `phs000284.v2.pht001902.v1.phv00122015.v1`, `phs000284.v2.pht001902.v1.phv00122340.v1`, `phs000284.v2.pht001902.v1.phv00122341.v1`, `phs000284.v2.pht001902.v1.phv00122342.v1`, `phs000284.v2.pht001902.v1.phv00122343.v1`, `phs000284.v2.pht001902.v1.phv00122344.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          df <- phen_list$source_data$pht001902 %>%
              # Subset to baseline visit. Some respondents baseline is visit 5
              filter(visit %in% c("1", "5")) %>%
              group_by(topmed_subject_id) %>%
              arrange(topmed_subject_id, visit) %>%
              filter(row_number(topmed_subject_id) == 1) %>%
              ungroup() %>%
              # Convert variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Recode encoded values and NA as 0
              mutate(AGESMOK = ifelse(AGESMOK %in% c(-1, -2, NA), 0, AGESMOK),
                  AVGSMOK = ifelse(AVGSMOK %in% c(-1, -2, NA), 0, AVGSMOK),
                  MONSMOKE = ifelse(MONSMOKE %in% c(-1, NA), 0, MONSMOKE),
                  NOWSMOKE = ifelse(NOWSMOKE %in% c(-1, NA), 0, NOWSMOKE),
                  # code ever_smoker_baseline as 1 if any smoking variables are positive
                  ever_smoker_baseline = as.numeric(as.logical(
                      SMOKED + AGESMOK + AVGSMOK + MONSMOKE + NOWSMOKE
                  ))) %>%
              # Select only ID, age and phenotype
              select(topmed_subject_id, age, ever_smoker_baseline) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-chs"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **CHS**:
    * 9 component_study_variables: `phs000287.v6.pht001450.v1.phv00098844.v1`, `phs000287.v6.pht001450.v1.phv00098845.v1`, `phs000287.v6.pht001450.v1.phv00099157.v1`, `phs000287.v6.pht001450.v1.phv00099159.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001490.v1.phv00105143.v1`, `phs000287.v6.pht001490.v1.phv00105144.v1`, `phs000287.v6.pht001490.v1.phv00106198.v1`, `phs000287.v6.pht001490.v1.phv00106200.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          source_data <- phen_list$source_data
      
          smk <- source_data[c("pht001450", "pht001490")] %>%
              # Standardize column order
              lapply(select, topmed_subject_id, SMOKE101, SMOKE201,
                     starts_with("SMKAGE"), starts_with("AMOUNT")) %>%
              # Standardize column names
              lapply(setNames, c("topmed_subject_id", "SMOKE101", "SMOKE201",
                                 "SMKAGE", "AMOUNT")) %>%
              # pht001450 and pht001490 have empty rows for members of the new and
              # original cohorts, respectively. They are excluded here
              lapply(filter, !(is.na(SMOKE101) & is.na(SMOKE201) & is.na(SMKAGE) &
                               is.na(AMOUNT)))
          # NA is coded as "9" in SMKAGE
          smk$pht001490$SMKAGE[smk$pht001490$SMKAGE == "9"] <- NA
              # Bind datasets row-wise
          smk %<>% bind_rows() %>%
              # Join with remaining dataset
              full_join(source_data$pht001452, "topmed_subject_id") %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric)
      
          # Code ever_smoker_baseline as TRUE if ANY variables are true
          ever_smoker_baseline <- smk %>% select(SMOKE101, SMOKE201, AMOUNT, SMKAGE) %>%
              rowSums(na.rm = TRUE) %>%
              as.logical()
      
          smk %>% mutate(ever_smoker_baseline = as.integer(ever_smoker_baseline)) %>%
              # exclude if SMOKE101 is NA and ever_smoker_baseline is FALSE
              filter(!(is.na(SMOKE101) & !ever_smoker_baseline)) %>%
              select(topmed_subject_id, age = AGEBL, ever_smoker_baseline) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-copdgene"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **COPDGene**:
    * 16 component_study_variables: `phs000179.v5.pht002239.v4.phv00159636.v4`, `phs000179.v5.pht002239.v4.phv00159637.v4`, `phs000179.v5.pht002239.v4.phv00159638.v4`, `phs000179.v5.pht002239.v4.phv00159639.v4`, `phs000179.v5.pht002239.v4.phv00159640.v4`, `phs000179.v5.pht002239.v4.phv00159641.v4`, `phs000179.v5.pht002239.v4.phv00159747.v4`, `phs000179.v5.pht002239.v4.phv00159748.v4`, `phs000179.v5.pht002239.v4.phv00159749.v4`, `phs000179.v5.pht002239.v4.phv00159750.v4`, `phs000179.v5.pht002239.v4.phv00159752.v4`, `phs000179.v5.pht002239.v4.phv00159754.v4`, `phs000179.v5.pht002239.v4.phv00159755.v4`, `phs000179.v5.pht002239.v4.phv00159756.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`, `phs000179.v5.pht002239.v4.phv00169388.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          df <- phen_list$source_data$pht002239 %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              rename_(ever_smoker_baseline = "EverSmokedCig", age = "Age_Enroll")
      
          modifier <- select(df, -topmed_subject_id, -age, -ever_smoker_baseline) %>%
          # Sum other variables that indicate smoking status, counting NA as 0
              rowSums(na.rm = TRUE)
      
          # Add modifier to ever_smoker_baseline and convert to 0/1
          transmute(df, ever_smoker_baseline = as.numeric(as.logical(ever_smoker_baseline + modifier)),
                  topmed_subject_id, age) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-cra"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **CRA**:
    * 6 component_study_variables: `phs000988.v2.pht005248.v2.phv00258650.v2`, `phs000988.v2.pht005248.v2.phv00267374.v2`, `phs000988.v2.pht005248.v2.phv00267375.v2`, `phs000988.v2.pht005248.v2.phv00267376.v2`, `phs000988.v2.pht005248.v2.phv00267378.v2`, `phs000988.v2.pht005248.v2.phv00267379.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          df <- phen_list$source_data$pht005248 %>%
              # Recode 1/2 as 0/1
              mutate(ever_smoker_baseline = ifelse(ever_Smoker == "1", 0,
                      ifelse(ever_Smoker == "2", 1, NA)))
          modifier <- select(df, Current_Smoker, former_Smoker,
                            cigsperday, cigsperday_average) %>%
              # Convert variables to numeric
              mutate_each(funs(as.numeric))
          # Recode 1 as 0
          modifier[c("Current_Smoker", "former_Smoker")] %<>%
              mutate_each(funs(ifelse(. == 1, 0, .)))
          # Sum variables row-wise
          modifier %<>% rowSums(na.rm = TRUE)
          transmute(df, topmed_subject_id, age,
                    # Switch ever_smoker_baseline from 0 to 1 if respondent answered positively
                    # to other smoking questions.
                    ever_smoker_baseline = as.numeric(as.logical(ever_smoker_baseline + modifier))) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-fhs_nos_gen3_omni2"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **FHS_NOS_Gen3_Omni2**:
    * 4 component_study_variables: `phs000007.v30.pht000074.v11.phv00020925.v5`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht006005.v1.phv00273759.v1`, `phs000007.v30.pht006006.v2.phv00274252.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          source_data[c("pht000074", "pht006006", "pht006005")] %>%
              # Standardize column order
              lapply(select, topmed_subject_id, matches("g3a070")) %>%
              # Set common column names
              lapply(setNames, c("topmed_subject_id", "ever_smoker_baseline")) %>%
              # bind row-wise
              bind_rows() %>%
              # Join with age dataset
              left_join(source_data$pht003099, "topmed_subject_id") %>%
              transmute(topmed_subject_id, age = age1,
                  # Convert ever_smoker_baseline to numeric
                  ever_smoker_baseline = as.numeric(ever_smoker_baseline)) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-fhs_offspring"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **FHS_Offspring**:
    * 2 component_study_variables: `phs000007.v30.pht000030.v8.phv00007612.v6`, `phs000007.v30.pht003099.v5.phv00177930.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data %>%
              # Join all datasets by topmed_subject_id
              plyr::join_all("topmed_subject_id") %>%
              # Convert age to numeric
              transmute(topmed_subject_id, age = as.numeric(age1),
                  # Code ever_smoker_baseline as 1/0
                  ever_smoker_baseline = A99 %>% as.numeric %>% as.logical %>% as.integer) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-fhs_omni1"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **FHS_Omni1**:
    * 5 component_study_variables: `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht004813.v1.phv00250452.v1`, `phs000007.v30.pht004814.v1.phv00251240.v1`, `phs000007.v30.pht004814.v1.phv00251241.v1`, `phs000007.v30.pht004814.v1.phv00251242.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Data
        dataset <- full_join(phen_list$source_data$pht004813,
                             phen_list$source_data$pht004814,
                             by = 'topmed_subject_id') %>%
                   left_join(phen_list$source_data$pht003099,
                   by = 'topmed_subject_id')
        dataset <- replace(dataset, dataset == 'NA', NA)
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Ever smokers at visit 2 corrections
        # cigs/day > 0 make ever smoker
        dataset$g675[dataset$g677 > 0] <- 1
        # years of smoking >0 make ever smoker
        dataset$g675[dataset$g676 > 0] <- 1
      
        #ever_smoker_baseline code assignment
        # all initially set to missing
        dataset$ever_smoker_baseline <- NA
        # never smokers at visit 2, set to 0
        dataset$ever_smoker_baseline[dataset$g675 == 0] <- 0
        # current smokers at visit 1, set to 1
        dataset$ever_smoker_baseline[dataset$e319 == 1] <- 1
      
        #Select final variables, remove missing
        dataset <- dataset %>%
                   select(topmed_subject_id, ever_smoker_baseline, age = age1) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="ever_smoker_baseline_1-fhs_original"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **FHS_Original**:
    * 2 component_study_variables: `phs000007.v30.pht000009.v2.phv00000543.v1`, `phs000007.v30.pht003099.v5.phv00177930.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join al datasets by topmed_subject_id
          phen_list$source_data %>% plyr::join_all("topmed_subject_id") %>%
              # Convert age to numeric
              transmute(topmed_subject_id, age = as.numeric(age1),
                  # Code ever_smoker_baseline as 1 if MF71 is 1, 2 or 3
                  ever_smoker_baseline = ifelse(MF71 %in% c("1", "2", "3"), 1,
                      # Code ever_smoker_baseline as 0 if MF71 is 5 or 7, else code it as NA
                      ifelse(MF71 %in% c("5", "7"), 0, NA))) %>%
              # exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-genestar"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **GeneSTAR**:
    * 4 component_study_variables: `phs001218.v1.pht007766.v1.phv00369267.v1`, `phs001218.v1.pht007766.v1.phv00369268.v1`, `phs001218.v1.pht007766.v1.phv00369293.v1`, `phs001218.v1.pht007766.v1.phv00369296.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        int <- phen_list$source_data$pht007766
        #Order of levels
        int$VISIT <- int$VISIT %>%
                     as.factor() %>%
                     relevel('SSV')
        #Subset to baseline visits, SSV and PSV
        dataset <- int %>%
                   filter(VISIT %in% c('SSV', 'PSV')) %>%
                   mutate(VISIT = as.factor(VISIT)) %>%
                   group_by(topmed_subject_id) %>%
                   arrange(topmed_subject_id, VISIT) %>%
                   filter(row_number(topmed_subject_id) == 1) %>%
                   ungroup() %>%
                   data.frame()
        #Converting to numeric variable
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(age = as.numeric(AGE))
      
        #Assigning values
        dataset$ever_smoker_baseline <- ifelse(dataset$EVERSMOK == 1, 1,
                                               ifelse(dataset$EVERSMOK == 2, 0, NA))
        #Accounting for skip pattern anomalies
        dataset$ever_smoker_baseline[dataset$EVERSMOK == 2 & dataset$SMOKENOW == 3] <- 1
        dataset$ever_smoker_baseline[is.na(dataset$EVERSMOK) & dataset$SMOKENOW == 1] <- 1
        dataset$ever_smoker_baseline[is.na(dataset$EVERSMOK) & dataset$SMOKENOW == 3] <- 1
      
        #Select variables and remove missing
        dataset <- dataset %>%
                   select(topmed_subject_id, ever_smoker_baseline, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="ever_smoker_baseline_1-genoa"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **GENOA**:
    * 8 component_study_variables: `phs001238.v2.pht006039.v1.phv00277507.v1`, `phs001238.v2.pht006043.v1.phv00277618.v1`, `phs001238.v2.pht006043.v1.phv00277621.v1`, `phs001238.v2.pht006043.v1.phv00277624.v1`, `phs001238.v2.pht006653.v1.phv00307788.v1`, `phs001238.v2.pht006657.v1.phv00307899.v1`, `phs001238.v2.pht006657.v1.phv00307902.v1`, `phs001238.v2.pht006657.v1.phv00307905.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
        source_data <- phen_list$source_data
        # Row-bind African-American and European-American cohort datasets with age variable.
        age <- bind_rows(source_data[c("pht006039", "pht006653")]) %>%
          # Rename age variable and convert to numeric.
          transmute(topmed_subject_id, age = as.numeric(AGE))
      
        # Row-bind AA and EA cohort datasets with smoking history.
        smoke <- bind_rows(source_data[c("pht006043", "pht006657")]) %>%
          # Convert AVGCIGDY to numeric.
          mutate_at(vars(AVGCIGDY), as.numeric) %>%
          # Recode CIGARETT from "Yes"/"No" to TRUE/FALSE.
          mutate_at(vars(CIGARETT), funs(CIGARETT == "Yes")) %>%
          # Recode SMOKE100 from "Yes"/"No" to 1/0.
          mutate_at(
            vars(SMOKE100),
            funs(ifelse(SMOKE100 == "No", 0, ifelse(SMOKE100 == "Yes", 1, "Undefined")))
          )
      
        # To create the harmonized variable, select the component traits and convert SMOKE100 to integer.
        smoke$ever_smoker_baseline <- transmute(smoke, as.integer(SMOKE100), CIGARETT, AVGCIGDY) %>%
          # Add them row-wise, ignoring NAs.
          rowSums(na.rm = TRUE) %>%
          # Convert to TRUE/FALSE.
          as.logical() %>%
          # Convert to 1/0.
          as.integer()
      
        # Select only ID and harmonized variable.
        harmonized <- select(smoke, topmed_subject_id, ever_smoker_baseline) %>%
          # Join with age dataset.
          inner_join(age, "topmed_subject_id") %>%
          # Exclude rows with missing data.
          na.omit()
      
        return(harmonized)
      }
      ```
<a id="ever_smoker_baseline_1-hchs_sol"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **HCHS_SOL**:
    * 5 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00258106.v1`, `phs000810.v1.pht004715.v1.phv00258107.v1`, `phs000810.v1.pht004715.v1.phv00258108.v1`, `phs000810.v1.pht004715.v1.phv00258110.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
        dat <- phen_list$source_data$pht004715 %>%
          # Create new 'ever smoker' variable from TBEA1.
          mutate(ever_smoker_baseline = TBEA1) %>%
          # Convert cigarettes-per-day variables to numeric.
          mutate_at(vars(TBEA4, TBEA5A), as.numeric)
      
        # Create index of participants missing a response to the 'ever smoker' survey
        # who report currently smoking cigarettes.
        ind <- is.na(dat$TBEA1) & is_in(dat$TBEA3, c("1", "2"))
        # Code those individuals as "1".
        dat$ever_smoker_baseline[ind] <- "1"
        # Create index of participants who report smoking a positive number of
        # cigarettes per day.
        ind <- dat$TBEA4 > 0 | dat$TBEA5A > 0
        # Code those individuals as "1".
        dat$ever_smoker_baseline[ind] <- "1"
        # Rename age and convert age and smoking to numeric.
        dat <- transmute(dat, topmed_subject_id, age = as.numeric(AGE),
                         ever_smoker_baseline = as.numeric(ever_smoker_baseline)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="ever_smoker_baseline_1-hvh"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **HVH**:
    * 4 component_study_variables: `phs001013.v3.pht005311.v2.phv00259376.v2`, `phs001013.v3.pht005311.v2.phv00259377.v2`, `phs001013.v3.pht005311.v2.phv00259378.v2`, `phs001013.v3.pht005311.v2.phv00259394.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$pht005311 %>%
          # Convert character variables to numeric.
          mutate_if(is.character, as.numeric) %>%
          group_by(topmed_subject_id) %>%
          # Select only earliest observations for each participant.
          filter(indexy == min(indexy))
        # Create index of duplicated subject IDs.
        dup_index <- duplicated(select(dat, topmed_subject_id))
        # Create vector of duplicated subject IDs.
        dups <- select(dat, topmed_subject_id)[dup_index, ]
        # Filter out duplicated subject IDs.
        dat <- filter(dat, !(topmed_subject_id %in% unlist(dups))) %>%
          # Drop unnecessary variables.
          select(-ccs, -indexy) %>%
          # Exclude incomplete records.
          na.omit() %>%
          # Code ever_smoker_baseline as 1 if smoke is greater than 0
          mutate(ever_smoker_baseline = as.numeric(as.logical(smoke))) %>%
          select(-smoke)
        return(dat)
      }
      ```
<a id="ever_smoker_baseline_1-jhs"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **JHS**:
    * 7 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001977.v1.phv00128496.v1`, `phs000286.v5.pht001977.v1.phv00128498.v1`, `phs000286.v5.pht001977.v1.phv00128502.v1`, `phs000286.v5.pht001977.v1.phv00128503.v1`, `phs000286.v5.pht001977.v1.phv00128506.v1`, `phs000286.v5.pht001977.v1.phv00128507.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join all datasets on topmed_subject_id
          df <- phen_list$source_data %>% plyr::join_all("topmed_subject_id", "left") %>%
              # Recode Y/N as 1/0
              mutate_each(funs(recode = ifelse(. == "Y", 1,
                                        ifelse(. == "N", 0, .))),
                  -topmed_subject_id, -TOBA7, -TOBA11, -AGE01) %>%
              # Recode TOBA7 to TRUE/FALSE
              mutate(TOBA7 = !is.na(TOBA7)) %>%
              # Drop old versions of variables
              select(topmed_subject_id, age = AGE01, TOBA1_recode, TOBA3_recode, TOBA6_recode,
                  TOBA7, TOBA10_recode, TOBA11) %>%
              mutate_each(funs(as.numeric))
      
          # Sum additional smoking questions row-wise
          modifier <- select(df, -topmed_subject_id, -age, -TOBA1_recode) %>%
              # Treat NA as 0
              rowSums(na.rm = TRUE)
      
          transmute(df, topmed_subject_id, age,
                  # Code ever_smoker_baseline as 1 if respondent gave positive response to any
                  # smoking question
                  ever_smoker_baseline = as.numeric(as.logical(TOBA1_recode + modifier))) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-mayo_vte_geneva"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **Mayo_VTE_GENEVA**:
    * 2 component_study_variables: `phs000289.v2.pht001886.v2.phv00121846.v1`, `phs000289.v2.pht001886.v2.phv00121874.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht001886
        # Initialize empty harmonized variable.
        dat$ever_smoker_baseline <- NA
        # Get index of current and former smokers.
        ind_es <- dat$smoking %in% c("1", "2")
        # Specify ever smokers.
        dat$ever_smoker_baseline[ind_es] <- 1
        # Get index of never smokers.
        ind_ns <- dat$smoking %in% "0"
        # Specify never smokers.
        dat$ever_smoker_baseline[ind_ns] <- 0
        # Convert age to numeric and drop old variables.
        dat <- transmute(dat, topmed_subject_id, age = as.numeric(enrollage),
                         ever_smoker_baseline)
        # Remove missing
        dat <- na.omit(dat)
      
        return(dat)
      }
      ```
<a id="ever_smoker_baseline_1-mayo_vte_olmsted"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **Mayo_VTE_Olmsted**:
    * 2 component_study_variables: `phs001402.v1.pht008239.v1.phv00389902.v1`, `phs001402.v1.pht008239.v1.phv00389930.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht008239
      
        #Assigning age '>89' to 90
        dataset$enrollage[dataset$enrollage == '>89'] <- 90
      
        dataset$ever_smoker_baseline <- ifelse(dataset$smoking == '0', 0,
                                        ifelse(dataset$smoking >= '1', 1, NA))
      
        #Variable type, names and removing missing
        dataset <- dataset %>%
                   select(topmed_subject_id, age = enrollage, ever_smoker_baseline) %>%
                   mutate_if(is.character, as.numeric) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="ever_smoker_baseline_1-mesa"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **MESA**:
    * 12 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00083243.v1`, `phs000209.v13.pht001111.v4.phv00083245.v1`, `phs000209.v13.pht001111.v4.phv00083247.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085570.v2`, `phs000209.v13.pht001116.v10.phv00085572.v2`, `phs000209.v13.pht001116.v10.phv00085574.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087252.v1`, `phs000209.v13.pht001121.v3.phv00087254.v1`, `phs000209.v13.pht001121.v3.phv00087256.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          smk <- phen_list$source_data %>%
              # Set common column order
              lapply(select, topmed_subject_id, starts_with("age"), starts_with("evsmk"),
                  starts_with("cursmk"), starts_with("cigsday")) %>%
              # Set common column names
              lapply(setNames, c("topmed_subject_id", "age", "evsmk", "cursmk", "cigsday")) %>%
              # bind datasets row-wise
              bind_rows() %>%
              # convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Subset to records with a value for at least one of the following variables
              filter(!(is.na(evsmk) & is.na(cursmk) & is.na(cigsday)))
      
          # Code ever_smoker_baseline as TRUE if any of the following variables are greater than 0
          ever_smoker_baseline <- smk %>%
              select(evsmk, cursmk, cigsday) %>%
              rowSums(na.rm = TRUE) %>%
              as.logical()
      
          smk %>% mutate(ever_smoker_baseline = as.integer(ever_smoker_baseline)) %>%
              # exclude if evsmk is NA and ever_smoker_baseline is FALSE
              filter(!(is.na(evsmk) & !ever_smoker_baseline)) %>%
              select(topmed_subject_id, age, ever_smoker_baseline) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="ever_smoker_baseline_1-sas"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **SAS**:
    * 3 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258705.v1`, `phs000914.v1.pht005253.v1.phv00258713.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
          source_data <- phen_list$source_data
          dataset <- source_data[['pht005253']]
          # Make age column into a numeric value.
          dataset$age <- as.numeric(dataset[['Dec_Age']])
          # Make an empty column to hold current_smoker.
          dataset$ever_smoker_baseline <- NA
          # Set ever_smoker_baseline to 1 if either Current_smoke or Past_smoker was equal to 1.
          dataset$ever_smoker_baseline[dataset$Current_smoke == '1' | dataset$Past_smoker == '1'] <- 1
          # Set ever_smoker_baseline to 0 if both Current_smoke and Past_smoker were equal to 0.
          dataset$ever_smoker_baseline[dataset$Current_smoke == '0' & dataset$Past_smoker == '0'] <- 0
          # Note that other values were left as NA in the final ever_smoker_baseline variable.
          dataset <- dataset[c("topmed_subject_id", "age", "ever_smoker_baseline")]
          # Remove rows with missing values.
          dataset <- na.omit(dataset)
          return(dataset)
      }
      ```
<a id="ever_smoker_baseline_1-wghs"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **WGHS**:
    * 2 component_study_variables: `phs001040.v3.pht005682.v3.phv00265848.v3`, `phs001040.v3.pht005682.v3.phv00375260.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005682
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(SMK3CAT = as.numeric(SMK3CAT),
                          age = as.integer(age))
      
        #Category assignment for ever smokers
        dataset$ever_smoker_baseline <- ifelse(dataset$SMK3CAT == 1, 1,
                                        ifelse(dataset$SMK3CAT == 2, 1, 0))
      
        #Final variables and remove missing
        dataset <- dataset %>%
                   select(topmed_subject_id, ever_smoker_baseline, age) %>%
                   na.omit() %>%
                   return()
      }
      ```
<a id="ever_smoker_baseline_1-whi"></a>
  * ### baseline_common_covariates/ever_smoker_baseline_1 -- **WHI**:
    * 4 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001003.v6.phv00078773.v6`, `phs000200.v11.pht001003.v6.phv00078774.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join all datasets by topmed_subject_id
          dataset <- plyr::join_all(phen_list$source_data, "topmed_subject_id") %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric)
          # Values in F2DAYS above zero are likely errors. They are set to zero here
          ind <- dataset$F2DAYS > 0
          dataset$F2DAYS[ind] <- 0
          # To calculate age at measurement, add baseline age, days since enrollment, and
          # age since randomization
          transmute(dataset, topmed_subject_id,
                  ever_smoker_baseline = as.numeric(SMOKEVR),
                  age = AGE + (abs(F2DAYS) + F34DAYS) / 365.25) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="height_baseline_1"></a>
## baseline_common_covariates: **height_baseline_1** (height_baseline)
  Body height at baseline.
  * **Harmonization Units**:
    * [Amish](#height_baseline_1-amish)
    * [ARIC](#height_baseline_1-aric)
    * [BAGS](#height_baseline_1-bags)
    * [CARDIA](#height_baseline_1-cardia)
    * [CCAF](#height_baseline_1-ccaf)
    * [CFS](#height_baseline_1-cfs)
    * [CHS](#height_baseline_1-chs)
    * [COPDGene](#height_baseline_1-copdgene)
    * [CRA](#height_baseline_1-cra)
    * [DHS](#height_baseline_1-dhs)
    * [FHS_Omni1](#height_baseline_1-fhs_omni1)
    * [FHS_Original](#height_baseline_1-fhs_original)
    * [FHS_Workthru](#height_baseline_1-fhs_workthru)
    * [GeneSTAR](#height_baseline_1-genestar)
    * [GENOA](#height_baseline_1-genoa)
    * [HCHS_SOL](#height_baseline_1-hchs_sol)
    * [HVH](#height_baseline_1-hvh)
    * [JHS](#height_baseline_1-jhs)
    * [Mayo_VTE_GENEVA](#height_baseline_1-mayo_vte_geneva)
    * [Mayo_VTE_Olmsted](#height_baseline_1-mayo_vte_olmsted)
    * [MESA](#height_baseline_1-mesa)
    * [MGH_AF](#height_baseline_1-mgh_af)
    * [Partners](#height_baseline_1-partners)
    * [SAS](#height_baseline_1-sas)
    * [VAFAR](#height_baseline_1-vafar)
    * [VU_AF](#height_baseline_1-vu_af)
    * [WGHS](#height_baseline_1-wghs)
    * [WHI](#height_baseline_1-whi)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: cm, **`Version`**: 5, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-09-30 14:49:13
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0005890
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting component study variables to the appropriate unit, as needed.
    
    #### BAGS
    
    Using BAGS height and weight data to calculate BMI, we identified 6 implausibly high BMI values. The study investigated and confirmed that these 6 subjects had incorrect values for height and weight component study variables.  The incorrect height values for this study can be identified using the harmonized variable `bmi_baseline_1` values > 100. 
    
    #### HVH
    
    There are multiple observations for many subjects in the HVH phenotype data. In
    these instances, we used the earliest observation of each subject for harmonization. Although
    this harmonized phenotype is designated as "baseline", the concept of
    "baseline" does not apply to HVH based on its study design. Consult the study
    documentation for more details (phs001013).
    
    #### WHI
    
    The study set height values below 146.2 cm to 146.2 and set height values above 177 cm to 177 in the component study variable. 
    
    #### Exam visit for height measurement
    
    | Study or subcohort | Visit |
    |---------|----------|
    | Amish | Baseline visit |
    | ARIC | Exam 1 |
    | BAGS | Baseline visit |
    | CARDIA | Year 0/Exam 1 |
    | CCAF | *Unspecified first visit* |
    | CFS | Baseline visit |
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | COPDGene | Baseline visit |
    | CRA | Baseline visit | 
    | DHS | Baseline visit |
    | FHS | Exam 1 |
    | GeneSTAR_ProbandSiblingCohort | Sibling Study Visit |
    | GeneSTAR_OffspringCoparentCohort | Platelet Study Visit |
    | GENOA | Phase 1 |
    | HCHS_SOL | Visit 1 |
    | HVH | *No visit structure* |
    | JHS | Visit 1 |
    | Mayo_VTE_GENEVA | *Unspecified first visit*  |
    | Mayo_VTE_Olmsted | *Unspecified first visit* |
    | MESA_Classic | Exam 1 Main |
    | MESA_Family | Family Exam Main |
    | MESA_AirNR | AirNR Exam Main | 
    | MGH_AF | *Unspecified first visit* |
    | Partners | Baseline visit |
    | SAS | Exam 1 |
    | VAFAR | *Unspecified first visit* |
    | VU_AF | *Unspecified first visit* |
    | WGHS | Exam 1 |
    | WHI | Screening, Year 0 |
    
    
    
<a id="height_baseline_1-amish"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v3.pht005002.v1.phv00252976.v1`, `phs000956.v3.pht005002.v1.phv00252982.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          dataset <- phen_list$source_data[["pht005002"]] %>%
              # Select and rename relevant traits
              transmute(topmed_subject_id,
                  age = age_baseline,
                  height_baseline = as.numeric(height_baseline)) %>%
              # Omit incomplete records
              na.omit()
          # Age is winsorized at 90, as an encoded value. Convert to integer:
          dataset$age[dataset$age == "90+"] <- "90"
          # Convert age to integer
          dataset %<>% mutate(age = as.integer(age))
          return(dataset)
      }
      ```
<a id="height_baseline_1-aric"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v5.pht004032.v2.phv00203151.v1`, `phs000280.v5.pht004063.v2.phv00204712.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          dataset <- phen_list$source_data[["pht004032"]] %>%
              # Join datasets by topmed_subject_id
              full_join(phen_list$source_data[["pht004063"]], "topmed_subject_id") %>%
              # Select and rename relevant variables
              transmute(topmed_subject_id,
                  age = as.integer(V1AGE01),
                  # There is an encoded value 'A' in ANTA01 that is not present in
                  # the the data dictionary. It is coerced to NA here.
                  height_baseline = as.integer(na_if(ANTA01, "A"))) %>%
              # Omit incomplete records
              na.omit()
      
          return(dataset)
      }
      ```
<a id="height_baseline_1-bags"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **BAGS**:
    * 2 component_study_variables: `phs001143.v2.pht005905.v2.phv00273211.v2`, `phs001143.v2.pht005905.v2.phv00375338.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005905
      
        #Numeric values and remove missing
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(height_baseline = as.numeric(HEIGHT_CM),
                          age = as.numeric(AGE)) %>%
                   select(topmed_subject_id, height_baseline, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="height_baseline_1-cardia"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001583.v2.phv00113634.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Join all dataframes.
        dat <- plyr::join_all(phen_list$source_data, "topmed_subject_id") %>%
          # Rename and convert height and age to numeric.
          transmute(topmed_subject_id, age = as.numeric(A01AGE2),
                    height_baseline = as.numeric(A20HGT)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="height_baseline_1-ccaf"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **CCAF**:
    * 2 component_study_variables: `phs001189.v2.pht005979.v2.phv00273546.v2`, `phs001189.v2.pht005979.v2.phv00273551.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005979 %>%
                   rename(height_baseline = height)
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$height_baseline[dataset$height_baseline %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Convert height unit from inch to cm.
        dataset <- mutate(dataset, height_baseline = height_baseline * 2.54)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="height_baseline_1-cfs"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **CFS**:
    * 3 component_study_variables: `phs000284.v2.pht001902.v1.phv00122012.v1`, `phs000284.v2.pht001902.v1.phv00122015.v1`, `phs000284.v2.pht001902.v1.phv00122640.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          source_data$pht001902 %>%
              # Subset to baseline visit. Some respondents baseline is visit 5
              filter(visit %in% c("1", "5")) %>%
              group_by(topmed_subject_id) %>%
              arrange(topmed_subject_id, visit) %>%
              filter(row_number(topmed_subject_id) == 1) %>%
              ungroup() %>%
              # Select, convert and rename relevant variables
              transmute(topmed_subject_id,
                  # Convert age to integer
                  age = as.integer(age),
                  # Height in cm, converted to numeric
                  height_baseline = as.numeric(htcm)) %>%
              # Omit incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="height_baseline_1-chs"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100382.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          dataset <- phen_list$source_data[["pht001452"]] %>%
          # Select, rename and convert relevent variables
          transmute(topmed_subject_id,
              # Convert height to numeric
              height_baseline = as.numeric(STHT13),
              # Convert age to integer
              age = as.integer(AGEBL)) %>%
          # Exclude incomplete records
          na.omit()
          return(dataset)
      }
      ```
<a id="height_baseline_1-copdgene"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **COPDGene**:
    * 2 component_study_variables: `phs000179.v5.pht002239.v4.phv00159592.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht002239 %>%
              # Select, rename and convert relevent variables
              transmute(topmed_subject_id,
                  # Convert height and age to numeric
                  height_baseline = as.numeric(Height_CM),
                  age = as.numeric(Age_Enroll)) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="height_baseline_1-cra"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **CRA**:
    * 2 component_study_variables: `phs000988.v2.pht005248.v2.phv00258650.v2`, `phs000988.v2.pht005248.v2.phv00267371.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          source_data$pht005248 %>%
              # Select and rename relevant variables
              transmute(topmed_subject_id, age, height_baseline = as.numeric(height)) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="height_baseline_1-dhs"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **DHS**:
    * 2 component_study_variables: `phs001412.v1.pht006746.v1.phv00310016.v1`, `phs001412.v1.pht006746.v1.phv00310030.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht006746 %>%
                   select(topmed_subject_id,
                          height_baseline = HEIGHT,
                          age = AGE) %>%
                   mutate_if(is.character, as.numeric) %>%
                   return()
      }
      ```
<a id="height_baseline_1-fhs_omni1"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **FHS_Omni1**:
    * 2 component_study_variables: `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht004813.v1.phv00250288.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Convert columns to numeric.
        source_data <- lapply(source_data, function(x) mutate_if(x, is.character, as.numeric))
        harmonized <- source_data$pht004813 %>%
          # Convert height to cm.
          transmute(topmed_subject_id, height_baseline = 2.54 * e025) %>%
          # Join to dataset to age dataset.
          inner_join(source_data[["pht003099"]], by = "topmed_subject_id") %>%
          # Convert age to integer.
          mutate(age = as.integer(age1)) %>%
          # Drop old age variable.
          select(-age1) %>%
          # Exclude incomplete records.
          na.omit()
        return(harmonized)
      }
      ```
<a id="height_baseline_1-fhs_original"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **FHS_Original**:
    * 3 component_study_variables: `phs000007.v30.pht000009.v2.phv00000539.v1`, `phs000007.v30.pht000009.v2.phv00000540.v1`, `phs000007.v30.pht003099.v5.phv00177930.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        source_data <- phen_list$source_data
        # Convert variables to numeric.
        source_data <- lapply(source_data, function(x) mutate_if(x, is.character, as.numeric))
      
        harmonized <- source_data$pht000009 %>%
          # Convert height to cm from inches and fractional inches.
          transmute(topmed_subject_id, height_baseline = 2.54 * (MF67 + 0.01 * MF68)) %>%
          # Join with age dataset.
          inner_join(source_data[["pht003099"]], by = "topmed_subject_id") %>%
          # Convert age to integer.
          mutate(age = as.integer(age1)) %>%
          # Drop old age variable.
          select(-age1) %>%
          # Exclude incomplete records.
          na.omit()
        return(harmonized)
      }
      ```
<a id="height_baseline_1-fhs_workthru"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **FHS_Workthru**:
    * 4 component_study_variables: `phs000007.v30.pht006026.v2.phv00277020.v2`, `phs000007.v30.pht006026.v2.phv00277042.v2`, `phs000007.v30.pht006027.v2.phv00277077.v2`, `phs000007.v30.pht006027.v2.phv00277171.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Bind dataframes row-wise
          bind_rows(phen_list$source_data) %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Convert HGT1 to numeric
              transmute(age = AGE1, height_baseline = HGT1 * 2.54,
                        topmed_subject_id) %>%
              # Exclude incomplete records
              na.omit() %>%
              return
      }
      ```
<a id="height_baseline_1-genestar"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **GeneSTAR**:
    * 3 component_study_variables: `phs001218.v1.pht007766.v1.phv00369267.v1`, `phs001218.v1.pht007766.v1.phv00369268.v1`, `phs001218.v1.pht007766.v1.phv00369271.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        int <- phen_list$source_data$pht007766
        #Order of levels
        int$VISIT <- int$VISIT %>%
                     as.factor() %>%
                     relevel('SSV')
        #Subset to baseline visits, SSV and PSV
        dataset <- int %>%
                   filter(VISIT %in% c('SSV', 'PSV')) %>%
                   mutate(VISIT = as.factor(VISIT)) %>%
                   group_by(topmed_subject_id) %>%
                   arrange(topmed_subject_id, VISIT) %>%
                   filter(row_number(topmed_subject_id) == 1) %>%
                   ungroup() %>%
                   data.frame()
        #Converting to numeric variable
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(height_baseline = as.numeric(HT),
                          age = as.numeric(AGE))
      
        #Converting to cm from inch
        dataset$height_baseline <- (2.54 * (dataset$height_baseline))
      
        #Selecting final harmonized variables
        dataset <- dataset %>%
                   select(topmed_subject_id, height_baseline, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="height_baseline_1-genoa"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v2.pht006039.v1.phv00277507.v1`, `phs001238.v2.pht006039.v1.phv00277514.v1`, `phs001238.v2.pht006653.v1.phv00307788.v1`, `phs001238.v2.pht006653.v1.phv00307795.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Row-bind African-American and European-American cohort datasets.
        harmonized <- bind_rows(phen_list$source_data) %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename age and height variables.
          rename(age = AGE, height_baseline = HEIGHT) %>%
          # Exclude rows with missing values.
          na.omit()
        return(harmonized)
      }
      ```
<a id="height_baseline_1-hchs_sol"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226281.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht004715 %>%
              # Rename variables; HEIGHT has been corrected. See dbGaP for documentation
              rename(age = AGE, height_baseline = HEIGHT) %>%
              # Convert variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="height_baseline_1-hvh"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **HVH**:
    * 4 component_study_variables: `phs001013.v3.pht005311.v2.phv00259376.v2`, `phs001013.v3.pht005311.v2.phv00259377.v2`, `phs001013.v3.pht005311.v2.phv00259378.v2`, `phs001013.v3.pht005311.v2.phv00259392.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$pht005311 %>%
          # Convert character variables to numeric.
          mutate_if(is.character, as.numeric) %>%
          group_by(topmed_subject_id) %>%
          # Select only earliest observations for each participant.
          filter(indexy == min(indexy))
        # Create index of duplicated subject IDs.
        dup_index <- duplicated(select(dat, topmed_subject_id))
        # Create vector of duplicated subject IDs.
        dups <- select(dat, topmed_subject_id)[dup_index, ]
        # Filter out duplicated subject IDs.
        dat <- filter(dat, !(topmed_subject_id %in% unlist(dups))) %>%
          # Drop unnecessary variables.
          select(-ccs, -indexy) %>%
          # Exclude incomplete records.
          na.omit() %>%
          ungroup() %>%
          # Select relevent variables
          transmute(topmed_subject_id, age,
                    # Convert height in inches to cm
                    height_baseline = as.numeric(height) * 2.54)
        return(dat)
      }
      ```
<a id="height_baseline_1-jhs"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001940.v1.phv00125860.v1`, `phs000286.v5.pht001949.v1.phv00126009.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Join datasets by topmed_subject_id
          dataset <- full_join(phen_list$source_data[["pht001940"]],
                  phen_list$source_data[["pht001949"]],
                  by = "topmed_subject_id") %>%
              # Select and rename relevant variables
              select(topmed_subject_id,
                  height_baseline = antv1,
                  age = AGE01) %>%
              # Convert variables to integer
              mutate_if(is.character, as.integer) %>%
              # exclude incomplete records
              na.omit()
          return(dataset)
      }
      ```
<a id="height_baseline_1-mayo_vte_geneva"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **Mayo_VTE_GENEVA**:
    * 2 component_study_variables: `phs000289.v2.pht001886.v2.phv00121846.v1`, `phs000289.v2.pht001886.v2.phv00121872.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht001886 %>%
              # Rename variables
              rename(age = enrollage, height_baseline = apptht_cms) %>%
              # Convert variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="height_baseline_1-mayo_vte_olmsted"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **Mayo_VTE_Olmsted**:
    * 2 component_study_variables: `phs001402.v1.pht008239.v1.phv00389902.v1`, `phs001402.v1.pht008239.v1.phv00389928.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht008239
      
        #Assigning age '>89' to 90
        dataset$enrollage[dataset$enrollage == '>89'] <- 90
      
        #Variable type, names and removing missing
        dataset <- dataset %>%
                   rename(age = enrollage, height_baseline = apptht_cms) %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate_if(is.character, as.numeric) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="height_baseline_1-mesa"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **MESA**:
    * 6 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082683.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084482.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087078.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Bind datasets rowwise
          dataset <- rbind(phen_list$source_data[["pht001111"]],
                  phen_list$source_data[["pht001116"]]) %>%
              # Rename variables
              rename(age = age1c, height_baseline = htcm1) %>%
              # Bind rowwise with remaining dataset
              rbind(rename(phen_list$source_data[["pht001121"]], age = agefc,
                  height_baseline = htcmf)) %>%
              # convert height to numeric
              mutate(height_baseline = as.numeric(height_baseline),
                  # convert age to integer
                  age = as.integer(age)) %>%
              # Exclude incomplete records
              na.omit()
      
          return(dataset)
      }
      ```
<a id="height_baseline_1-mgh_af"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **MGH_AF**:
    * 2 component_study_variables: `phs001001.v1.pht005655.v1.phv00354560.v1`, `phs001001.v1.pht005655.v1.phv00354564.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht005655
      
        #Converting height to numeric variable
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(height = as.numeric(height), age = as.numeric(age))
      
        #Converting to centimeters
        dataset$height_baseline <- (2.54 * dataset$height)
      
        #Selecting variables and removing NAs
        dataset <- dataset %>%
                   select(topmed_subject_id, height_baseline, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="height_baseline_1-partners"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **Partners**:
    * 2 component_study_variables: `phs001024.v3.pht005693.v1.phv00265978.v1`, `phs001024.v3.pht005693.v1.phv00265982.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005693 %>%
                   rename(age = age_diagnosis)
      
        #Missing values and variable structure
        dataset <- replace(dataset, dataset == 'NA', NA) %>%
                   mutate(age = as.numeric(age),
                          height = as.numeric(height))
      
        #Converting from inches to centimeters
        dataset$height_baseline <- (2.54 * dataset$height)
      
        #Select variables and remove missing
        dataset <- select(dataset, topmed_subject_id, age, height_baseline) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="height_baseline_1-sas"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **SAS**:
    * 2 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258683.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data[["pht005253"]] %>%
              # Select and transform relevent variables
              transmute(topmed_subject_id,
                  # Convert age to numeric
                  age = as.numeric(Dec_Age),
                  # Convert height to numeric and encode "NA" as NA
                  height_baseline = as.numeric(na_if(Height, "NA"))) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="height_baseline_1-vafar"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **VAFAR**:
    * 2 component_study_variables: `phs000997.v3.pht005688.v3.phv00265921.v3`, `phs000997.v3.pht005688.v3.phv00265926.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005688 %>%
                   rename(height_baseline = height)
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$height_baseline[dataset$height_baseline %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Convert height unit from inch to cm.
        dataset <- mutate(dataset, height_baseline = height_baseline * 2.54)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="height_baseline_1-vu_af"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **VU_AF**:
    * 2 component_study_variables: `phs001032.v4.pht005675.v3.phv00265805.v2`, `phs001032.v4.pht005675.v3.phv00265810.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005675 %>%
                   rename(height_baseline = height)
      
        # Substitute the value of 'NA' to missing.
        dataset$height_baseline[dataset$height_baseline %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Convert height unit from inch to cm.
        dataset <- mutate(dataset, height_baseline = height_baseline * 2.54)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="height_baseline_1-wghs"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **WGHS**:
    * 2 component_study_variables: `phs001040.v3.pht005682.v3.phv00265848.v3`, `phs001040.v3.pht005682.v3.phv00375254.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005682
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(HEIGHT = as.numeric(HEIGHT),
                          age = as.integer(age))
      
        #Height in cm
        dataset$height_baseline <- (dataset$HEIGHT * 2.54)
      
        #Final variables and remove missing
        dataset <- dataset %>%
                   select(topmed_subject_id, height_baseline, age) %>%
                   na.omit() %>%
                   return()
      }
      ```
<a id="height_baseline_1-whi"></a>
  * ### baseline_common_covariates/height_baseline_1 -- **WHI**:
    * 5 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001019.v6.phv00079851.v6`, `phs000200.v11.pht001019.v6.phv00079852.v6`, `phs000200.v11.pht001019.v6.phv00079858.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          dataset <- phen_list$source_data[["pht001019"]] %>%
              # Subset to baseline
              filter(F80VY == "0") %>%
              # Join datasets
              inner_join(phen_list$source_data[["pht000998"]],
                  by = "topmed_subject_id") %>%
              mutate_at(vars(F2DAYS), funs(as.numeric))
          # Values in F2DAYS above zero are likely errors. They are set to zero here
          ind <- dataset$F2DAYS > 0
          dataset$F2DAYS[ind] <- 0
          # Select and rename relevent variables
          transmute(dataset, topmed_subject_id,
                  # convert height to numeric
                  height_baseline = as.numeric(HEIGHTX),
                  # To calculate age at measurement, add baseline age, days since
                  # enrollment, and age since randomization
                  age = as.numeric(AGE) +
                      (as.numeric(F80DAYS) + abs(F2DAYS)) / 365.25) %>%
              # Exclude incomplete results
              na.omit() %>%
              return()
      }
      ```
<a id="weight_baseline_1"></a>
## baseline_common_covariates: **weight_baseline_1** (weight_baseline)
  Body weight at baseline.
  * **Harmonization Units**:
    * [Amish](#weight_baseline_1-amish)
    * [ARIC](#weight_baseline_1-aric)
    * [BAGS](#weight_baseline_1-bags)
    * [CARDIA](#weight_baseline_1-cardia)
    * [CCAF](#weight_baseline_1-ccaf)
    * [CFS](#weight_baseline_1-cfs)
    * [CHS](#weight_baseline_1-chs)
    * [COPDGene](#weight_baseline_1-copdgene)
    * [CRA](#weight_baseline_1-cra)
    * [DHS](#weight_baseline_1-dhs)
    * [FHS_Original_Omni1](#weight_baseline_1-fhs_original_omni1)
    * [FHS_Workthru](#weight_baseline_1-fhs_workthru)
    * [GeneSTAR](#weight_baseline_1-genestar)
    * [GENOA](#weight_baseline_1-genoa)
    * [HCHS_SOL](#weight_baseline_1-hchs_sol)
    * [HVH](#weight_baseline_1-hvh)
    * [JHS](#weight_baseline_1-jhs)
    * [Mayo_VTE_GENEVA](#weight_baseline_1-mayo_vte_geneva)
    * [Mayo_VTE_Olmsted](#weight_baseline_1-mayo_vte_olmsted)
    * [MESA](#weight_baseline_1-mesa)
    * [MGH_AF](#weight_baseline_1-mgh_af)
    * [Partners](#weight_baseline_1-partners)
    * [SAS](#weight_baseline_1-sas)
    * [VAFAR](#weight_baseline_1-vafar)
    * [VU_AF](#weight_baseline_1-vu_af)
    * [WGHS](#weight_baseline_1-wghs)
    * [WHI](#weight_baseline_1-whi)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: kg, **`Version`**: 4, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-09-30 15:02:33
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0005910
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting component study variables to the appropriate unit, as needed.
    
    #### BAGS
    
    Using BAGS height and weight data to calculate BMI, we identified 6 implausibly high BMI values. The study investigated and confirmed that these 6 subjects had incorrect values for height and weight component study variables. The incorrect weight values for this study can be identified using the harmonized variable `bmi_baseline_1` values > 100. 
    
    #### GeneSTAR
    
    This variable was harmonized using study-reported height and BMI variables to calculate weight. 
    
    #### HVH
    
    There are multiple observations for many subjects in the HVH phenotype data. In
    these instances, we used the earliest observation of each subject for harmonization. Although
    this harmonized phenotype is designated as "baseline", the concept of
    "baseline" does not apply to HVH based on its study design. Consult the study
    documentation for more details (phs001013).
    
    #### Partners
    
    One subject with a weight value of `400+` was assigned to 400 lbs (181.437 kg).
    
    #### WHI 
    
    The WHI study set weight values below 45.8 kg to 45.8 and set weight values above 130.2 kg to 130.2 in the component study variable. 
    
    #### Exam visit for weight measurement
    
    | Study or subcohort | Visit |
    |---------|----------|
    | Amish | Baseline visit |
    | ARIC | Exam 1 |
    | BAGS | Baseline visit |
    | CARDIA | Year 0/Exam 1 |
    | CCAF | *Unspecified first visit* |
    | CFS | Baseline visit |
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | COPDGene | Baseline visit |
    | CRA | Baseline visit | 
    | DHS | Baseline visit |
    | FHS | Exam 1 |
    | GeneSTAR_ProbandSiblingCohort | Sibling Study Visit |
    | GeneSTAR_OffspringCoparentCohort | Platelet Study Visit |
    | GENOA | Phase 1 |
    | HCHS_SOL | Visit 1 |
    | HVH | *No visit structure* |
    | JHS | Visit 1 |
    | Mayo_VTE_GENEVA | *Unspecified first visit*  |
    | Mayo_VTE_Olmsted | *Unspecified first visit* |
    | MESA_Classic | Exam 1 Main |
    | MESA_Family | Family Exam Main |
    | MESA_AirNR | AirNR Exam Main | 
    | MGH_AF | *Unspecified first visit* |
    | Partners | Baseline visit |
    | SAS | Exam 1 |
    | VAFAR | *Unspecified first visit* |
    | VU_AF | *Unspecified first visit* |
    | WGHS | Exam 1 |
    | WHI | Screening, Year 0 |
    
    
<a id="weight_baseline_1-amish"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v3.pht005002.v1.phv00252976.v1`, `phs000956.v3.pht005002.v1.phv00252979.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          dataset <- phen_list$source_data[["pht005002"]] %>%
              # Rename and select relevant variables
              transmute(topmed_subject_id,
                  age = age_baseline,
                  # Convert weight to numeric
                  weight_baseline = as.numeric(weight_baseline)) %>%
                  # Exclude incomplete records
              na.omit()
          # Age is winsorized at 90, as an encoded value. Convert to integer:
          dataset$age[dataset$age == "90+"] <- "90"
          # Convert age to integer
          dataset %<>% mutate(age = as.integer(age))
          return(dataset)
      }
      ```
<a id="weight_baseline_1-aric"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v5.pht004032.v2.phv00203154.v1`, `phs000280.v5.pht004063.v2.phv00204712.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          dataset <- phen_list$source_data[["pht004032"]] %>%
              # Join datasets by topmed_subject_id
              full_join(phen_list$source_data[["pht004063"]], "topmed_subject_id") %>%
              # Select and rename relevant variables
              transmute(topmed_subject_id,
                  # Convert age to integer
                  age = as.integer(V1AGE01),
                  # There is an encoded value 'A' in ANTA04 that is not described in
                  # the the data dictionary. It is coerced to NA here.
                  # Weight in pounds converted to kilograms
                  weight_baseline = as.numeric(na_if(ANTA04, "A")) * 0.453592) %>%
              # Exclude incomplete records
              na.omit()
      
          return(dataset)
      }
      ```
<a id="weight_baseline_1-bags"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **BAGS**:
    * 2 component_study_variables: `phs001143.v2.pht005905.v2.phv00273211.v2`, `phs001143.v2.pht005905.v2.phv00375337.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005905
      
        #Numeric values
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(weight_baseline = as.numeric(WEIGHT_KG),
                          age = as.numeric(AGE)) %>%
                   select(topmed_subject_id, weight_baseline, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="weight_baseline_1-cardia"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001583.v2.phv00113635.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Join all dataframes.
        dat <- plyr::join_all(phen_list$source_data, "topmed_subject_id") %>%
          # Rename age and convert to numeric, and convert weight to kilograms.
          transmute(topmed_subject_id, age = as.numeric(A01AGE2),
                    weight_baseline = as.numeric(A20WGT) * 0.45359) %>%
          # Exlcue rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="weight_baseline_1-ccaf"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **CCAF**:
    * 2 component_study_variables: `phs001189.v2.pht005979.v2.phv00273546.v2`, `phs001189.v2.pht005979.v2.phv00273552.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005979 %>%
                   rename(weight_baseline = weight)
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$weight_baseline[dataset$weight_baseline %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Convert weight unit from pound to kg.
        dataset <- mutate(dataset, weight_baseline = weight_baseline * 0.453592)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="weight_baseline_1-cfs"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **CFS**:
    * 3 component_study_variables: `phs000284.v2.pht001902.v1.phv00122012.v1`, `phs000284.v2.pht001902.v1.phv00122015.v1`, `phs000284.v2.pht001902.v1.phv00122639.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht001902  %>%
              # Subset to baseline visit. Some respondents baseline is visit 5
              filter(visit %in% c("1", "5")) %>%
              group_by(topmed_subject_id) %>%
              arrange(topmed_subject_id, visit) %>%
              filter(row_number(topmed_subject_id) == 1) %>%
              ungroup() %>%
              # Select and rename relevant variables
              transmute(topmed_subject_id,
                  # Convert age to integer
                  age = as.integer(age),
                  # Convert weight to numeric
                  weight_baseline = as.numeric(wtkg)) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="weight_baseline_1-chs"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100383.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data[["pht001452"]] %>%
              # Select and rename relevant variables
              transmute(topmed_subject_id,
                  # Convert age to integer
                  age = as.integer(AGEBL),
                  # Convert weight to kilograms
                  weight_baseline = as.numeric(WEIGHT13) * 0.453592) %>%
                  # Exclude incomplete records
              na.omit()
      }
      ```
<a id="weight_baseline_1-copdgene"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **COPDGene**:
    * 2 component_study_variables: `phs000179.v5.pht002239.v4.phv00159591.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht002239 %>%
              # Select and rename relevatn variables
              transmute(topmed_subject_id,
                  # convert age to numeric
                  age = as.numeric(Age_Enroll),
                  # convert weight to numeric
                  weight_baseline = as.numeric(Weight_KG)) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="weight_baseline_1-cra"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **CRA**:
    * 2 component_study_variables: `phs000988.v2.pht005248.v2.phv00258650.v2`, `phs000988.v2.pht005248.v2.phv00267372.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          source_data$pht005248 %>%
              # Select, rename and convert to numeric relevant variables
              transmute(topmed_subject_id, age = as.numeric(age),
                        weight_baseline = as.numeric(weight)) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="weight_baseline_1-dhs"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **DHS**:
    * 2 component_study_variables: `phs001412.v1.pht006746.v1.phv00310016.v1`, `phs001412.v1.pht006746.v1.phv00310029.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht006746 %>%
                   select(topmed_subject_id,
                          weight_baseline = WEIGHT,
                          age = AGE) %>%
                   mutate_if(is.character, as.numeric) %>%
                   return()
      }
      ```
<a id="weight_baseline_1-fhs_original_omni1"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **FHS_Original_Omni1**:
    * 3 component_study_variables: `phs000007.v30.pht000009.v2.phv00000541.v1`, `phs000007.v30.pht003099.v5.phv00177930.v5`, `phs000007.v30.pht004813.v1.phv00250287.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          # Initiate empty list
          data_lists <- list(original = NULL, omni_1 = NULL)
      
          # Rename weight variables
          data_lists$original <- rename(source_data$pht000009, wt = MF69)
          data_lists$omni_1 <- rename(source_data$pht004813, wt = e024)
          # Bind datasets rowwise
          dataset <- do.call(rbind, data_lists) %>%
              # Join weight datasets with age dataset
              inner_join(source_data$pht003099, by = "topmed_subject_id") %>%
              # Select and rename relevant variables
              transmute(topmed_subject_id,
                  # Convert weight to kilograms
                  weight_baseline = as.numeric(wt) * 0.45359,
                  # Convert age to integer
                  age = as.integer(age1)) %>%
              # Exclude incomplete records
              na.omit()
      
          return(dataset)
      }
      ```
<a id="weight_baseline_1-fhs_workthru"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **FHS_Workthru**:
    * 4 component_study_variables: `phs000007.v30.pht006026.v2.phv00277020.v2`, `phs000007.v30.pht006026.v2.phv00277055.v2`, `phs000007.v30.pht006027.v2.phv00277077.v2`, `phs000007.v30.pht006027.v2.phv00277227.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # Bind dataframes row-wise
          bind_rows(phen_list$source_data) %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              transmute(age = AGE1, weight_baseline = WGT1 * 0.45359,
                        topmed_subject_id) %>%
              # Exclude incomplete records
              na.omit() %>%
              return
      }
      ```
<a id="weight_baseline_1-genestar"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **GeneSTAR**:
    * 4 component_study_variables: `phs001218.v1.pht007766.v1.phv00369267.v1`, `phs001218.v1.pht007766.v1.phv00369268.v1`, `phs001218.v1.pht007766.v1.phv00369271.v1`, `phs001218.v1.pht007766.v1.phv00369272.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        int <- phen_list$source_data$pht007766
        #Order of levels
        int$VISIT <- int$VISIT %>%
                     as.factor() %>%
                     relevel('SSV')
        #Subset to baseline visits, SSV and PSV
        dataset <- int %>%
                   filter(VISIT %in% c('SSV', 'PSV')) %>%
                   mutate(VISIT = as.factor(VISIT)) %>%
                   group_by(topmed_subject_id) %>%
                   arrange(topmed_subject_id, VISIT) %>%
                   filter(row_number(topmed_subject_id) == 1) %>%
                   ungroup() %>%
                   data.frame()
        #Converting to numeric variable
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(HT = as.numeric(HT),
                          BMI = as.numeric(BMI),
                          age = as.numeric(AGE))
      
        #Calculating weight from height and BMI
        dataset$height_m <- (0.0254 * (dataset$HT))
        dataset$weight_baseline <- (dataset$BMI * (dataset$height_m) ^ 2)
      
        #Final variables and remove missing
        dataset <- dataset %>%
                   select(topmed_subject_id, weight_baseline, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="weight_baseline_1-genoa"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v2.pht006039.v1.phv00277507.v1`, `phs001238.v2.pht006039.v1.phv00277515.v1`, `phs001238.v2.pht006653.v1.phv00307788.v1`, `phs001238.v2.pht006653.v1.phv00307796.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Row-bind African-American and European-American cohort datasets.
        harmonized <- bind_rows(phen_list$source_data) %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename age and weight variables.
          rename(age = AGE, weight_baseline = WEIGHT) %>%
          # Exclude rows with missing values.
          na.omit()
        return(harmonized)
      }
      ```
<a id="weight_baseline_1-hchs_sol"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00253218.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht004715 %>%
              # Reneame age and weight variables
              rename(age = AGE, weight_baseline = ANTA4) %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="weight_baseline_1-hvh"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **HVH**:
    * 4 component_study_variables: `phs001013.v3.pht005311.v2.phv00259376.v2`, `phs001013.v3.pht005311.v2.phv00259377.v2`, `phs001013.v3.pht005311.v2.phv00259378.v2`, `phs001013.v3.pht005311.v2.phv00259393.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$pht005311 %>%
          # Convert character variables to numeric.
          mutate_if(is.character, as.numeric) %>%
          group_by(topmed_subject_id) %>%
          # Select only earliest observations for each participant.
          filter(indexy == min(indexy))
        # Create index of duplicated subject IDs.
        dup_index <- duplicated(select(dat, topmed_subject_id))
        # Create vector of duplicated subject IDs.
        dups <- select(dat, topmed_subject_id)[dup_index, ]
        # Filter out duplicated subject IDs.
        dat <- filter(dat, !(topmed_subject_id %in% unlist(dups))) %>%
          # Drop unnecessary variables.
          select(-ccs, -indexy) %>%
          # Exclude incomplete records.
          na.omit() %>%
          ungroup() %>%
          # Select relevent variables and convert weight to kg.
          transmute(topmed_subject_id, age, weight_baseline = as.numeric(weight) * 0.453592)
        return(dat)
      }
      ```
<a id="weight_baseline_1-jhs"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001940.v1.phv00125861.v1`, `phs000286.v5.pht001949.v1.phv00126009.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          # Join datasets by topmed_subject_id
          dataset <- inner_join(source_data$pht001940, source_data$pht001949,
                  by = "topmed_subject_id") %>%
                  # Select and rename relevant variables
              transmute(topmed_subject_id,
                  # Convert age to integer
                  age = as.integer(AGE01),
                  # Convert weight to numeric
                  weight_baseline = as.numeric(antv2)) %>%
              # Exclude incomplete records
              na.omit()
          return(dataset)
      }
      ```
<a id="weight_baseline_1-mayo_vte_geneva"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **Mayo_VTE_GENEVA**:
    * 2 component_study_variables: `phs000289.v2.pht001886.v2.phv00121846.v1`, `phs000289.v2.pht001886.v2.phv00121873.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht001886 %>%
              # Rename relevant variables
              rename(age = enrollage, weight_baseline = apptwt_kgs) %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="weight_baseline_1-mayo_vte_olmsted"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **Mayo_VTE_Olmsted**:
    * 2 component_study_variables: `phs001402.v1.pht008239.v1.phv00389902.v1`, `phs001402.v1.pht008239.v1.phv00389929.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht008239
      
        #Assigning age '>89' to 90
        dataset$enrollage[dataset$enrollage == '>89'] <- 90
      
        #Variable type, names and removing missing
        dataset <- dataset %>%
                   rename(age = enrollage, weight_baseline = apptwt_kgs) %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate_if(is.character, as.numeric) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="weight_baseline_1-mesa"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **MESA**:
    * 6 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082685.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084484.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087079.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          source_data <- phen_list$source_data
          # Rename age and weight to match other datasets
          source_data$pht001121 <- rename(source_data$pht001121,
                  age1c = agefc, wtlb1 = wtlbf)
          # Bind datasets rowwise
          dataset <- do.call(rbind, source_data) %>%
              # Select and rename relevant variables
              transmute(topmed_subject_id,
                  # Convert age to integer
                  age = as.integer(age1c),
                  # Convert weight to kilograms
                  weight_baseline = as.numeric(wtlb1) * 0.453592) %>%
          # Exclude incomplete records
          na.omit()
          return(dataset)
      }
      ```
<a id="weight_baseline_1-mgh_af"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **MGH_AF**:
    * 2 component_study_variables: `phs001001.v1.pht005655.v1.phv00354560.v1`, `phs001001.v1.pht005655.v1.phv00354565.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht005655
      
        #Converting weight to numeric variables
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(weight = as.numeric(weight), age = as.numeric(age))
      
        #Converting to kilograms
        dataset$weight_baseline <- (0.453592 * dataset$weight)
      
        #Selecting variables and removing NAs
        dataset <- dataset %>%
                   select(topmed_subject_id, weight_baseline, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="weight_baseline_1-partners"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **Partners**:
    * 2 component_study_variables: `phs001024.v3.pht005693.v1.phv00265978.v1`, `phs001024.v3.pht005693.v1.phv00265983.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005693 %>%
                   rename(age = age_diagnosis)
      
        #Assign 400+ value to 400
        dataset$weight[dataset$weight == '400+'] <- 400
      
        #Missing values and variable structure
        dataset <- replace(dataset, dataset == 'NA', NA) %>%
                   mutate(age = as.numeric(age),
                          weight = as.numeric(weight))
      
        #Converting from pounds to kilograms
        dataset$weight_baseline <- (0.4536 * dataset$weight)
      
        #Select final variables
        dataset <- select(dataset, topmed_subject_id, age, weight_baseline)
      
        return(dataset)
      }
      ```
<a id="weight_baseline_1-sas"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **SAS**:
    * 2 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258684.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          phen_list$source_data$pht005253 %>%
              # Select and rename relevant variables
              transmute(topmed_subject_id,
                  age = Dec_Age,
                  # Recode "NA" string as NA
                  weight_baseline = na_if(Weight, "NA")) %>%
              # Convert character variables to numeric
              mutate_if(is.character, as.numeric) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```
<a id="weight_baseline_1-vafar"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **VAFAR**:
    * 2 component_study_variables: `phs000997.v3.pht005688.v3.phv00265921.v3`, `phs000997.v3.pht005688.v3.phv00265927.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005688 %>%
                   rename(weight_baseline = weight)
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$weight_baseline[dataset$weight_baseline %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Convert weight unit from pound to kg.
        dataset <- mutate(dataset, weight_baseline = weight_baseline * 0.453592)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="weight_baseline_1-vu_af"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **VU_AF**:
    * 2 component_study_variables: `phs001032.v4.pht005675.v3.phv00265805.v2`, `phs001032.v4.pht005675.v3.phv00265811.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005675 %>%
                   rename(weight_baseline = weight)
      
        # Substitute the value of 'NA' to missing.
        dataset$weight_baseline[dataset$weight_baseline %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Convert weight unit from pound to kg.
        dataset <- mutate(dataset, weight_baseline = weight_baseline * 0.453592)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="weight_baseline_1-wghs"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **WGHS**:
    * 2 component_study_variables: `phs001040.v3.pht005682.v3.phv00265848.v3`, `phs001040.v3.pht005682.v3.phv00375261.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005682
        dataset <- dataset %>%
                   replace(dataset == 'NA', NA) %>%
                   mutate(WEIGHT = as.numeric(WEIGHT),
                          age = as.integer(age))
      
        #Height in cm
        dataset$weight_baseline <- (dataset$WEIGHT * 0.453592)
      
        #Final variables and remove missing
        dataset <- dataset %>%
                   select(topmed_subject_id, weight_baseline, age) %>%
                   na.omit() %>%
                   return()
      }
      ```
<a id="weight_baseline_1-whi"></a>
  * ### baseline_common_covariates/weight_baseline_1 -- **WHI**:
    * 5 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001019.v6.phv00079851.v6`, `phs000200.v11.pht001019.v6.phv00079852.v6`, `phs000200.v11.pht001019.v6.phv00079859.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          dataset <- phen_list$source_data[["pht001019"]] %>%
              # Subset to baseline visit
              filter(F80VY == "0") %>%
              # Join datasets by topmed_subject_id
              inner_join(phen_list$source_data[["pht000998"]],
                         by = "topmed_subject_id") %>%
              mutate_at(vars(F2DAYS), funs(as.numeric))
          # Values in F2DAYS above zero are likely errors. They are set to zero here
          ind <- dataset$F2DAYS > 0
          dataset$F2DAYS[ind] <- 0
          # Select and rename relevant variables
          transmute(dataset, topmed_subject_id,
                  # To calculate age at measurement, add baseline age, days since
                  # enrollment, and age since randomization
                  age = as.numeric(AGE) +
                      (as.numeric(F80DAYS) + abs(F2DAYS)) / 365.25,
                  # Convert weight to numeric
                  weight_baseline = as.numeric(WEIGHTX)) %>%
              # Exclude incomplete records
              na.omit() %>%
              return()
      }
      ```

# blood_cell_count

### Variables in this section:
* [basophil_ncnc_bld_1](#basophil_ncnc_bld_1)
* [eosinophil_ncnc_bld_1](#eosinophil_ncnc_bld_1)
* [hematocrit_vfr_bld_1](#hematocrit_vfr_bld_1)
* [hemoglobin_mcnc_bld_1](#hemoglobin_mcnc_bld_1)
* [lymphocyte_ncnc_bld_1](#lymphocyte_ncnc_bld_1)
* [mch_entmass_rbc_1](#mch_entmass_rbc_1)
* [mchc_mcnc_rbc_1](#mchc_mcnc_rbc_1)
* [mcv_entvol_rbc_1](#mcv_entvol_rbc_1)
* [monocyte_ncnc_bld_1](#monocyte_ncnc_bld_1)
* [neutrophil_ncnc_bld_1](#neutrophil_ncnc_bld_1)
* [platelet_ncnc_bld_1](#platelet_ncnc_bld_1)
* [pmv_entvol_bld_1](#pmv_entvol_bld_1)
* [rbc_ncnc_bld_1](#rbc_ncnc_bld_1)
* [rdw_ratio_rbc_1](#rdw_ratio_rbc_1)
* [wbc_ncnc_bld_1](#wbc_ncnc_bld_1)

<a id="basophil_ncnc_bld_1"></a>
## blood_cell_count: **basophil_ncnc_bld_1** (basophil_ncnc_bld)
  Count by volume, or number concentration (ncnc), of basophils in the blood (bld).
  * **Harmonization Units**:
    * [Amish](#basophil_ncnc_bld_1-amish)
    * [ARIC](#basophil_ncnc_bld_1-aric)
    * [CARDIA](#basophil_ncnc_bld_1-cardia)
    * [FHS_Gen3NOSOmni2](#basophil_ncnc_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#basophil_ncnc_bld_1-fhs_offspring)
    * [FHS_Omni1](#basophil_ncnc_bld_1-fhs_omni1)
    * [HCHS_SOL](#basophil_ncnc_bld_1-hchs_sol)
    * [JHS](#basophil_ncnc_bld_1-jhs)
    * [MESA](#basophil_ncnc_bld_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: thousands / microliter, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 14:54:41
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0942414
  * **DCC Harmonization Comments**:

    When possible, basophil count was derived from percentage (%) of basophils in the total white blood cell count (WBC) , using the formula
    ```
    white blood cell count * % basophils / 100.
    ```
    This choice minimizes discretizing round-off effects which can lead to multi-modal distributions. Otherwise, if percentage was not available, the value of basophil count as provided by the study was used directly.
    
    For studies or cohorts with measurements at more than one visit, in order to maximize sample 
    size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.  The counts were first derived as above using data from each visit and then a visit for a given subject was selected. 
    
    ### Study-specific comments
    
    #### Amish
    Because percentage data was not available, harmonization used given count values from a study component variable rescaled to appropriate harmonized.
    
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### MESA
    Because percentage data was not available, harmonization used given count values from a study component variable. 
    
    ### QC checks
    For each subject, the sum of the WBC subtype differential counts (percentages) was compared to the total white blood cell count (100%) . 
    
    For *_FHS_* Offspring, this QC led to the discovery of anomalies (unusual number of values recorded as 0) in the data at Exam 2 for the WBC subtype differentials. After communication with *_FHS_*, the decision was made to not use the Exam 2 data. 
    
    For other studies, there was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for WBC, basophils, and other WBC subtype differentials may not be from the same visit, so the harmonized subtype differential counts may not sum to the WBC count.
    
<a id="basophil_ncnc_bld_1-amish"></a>
  * ### blood_cell_count/basophil_ncnc_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253015.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
        source_data <- phen_list$source_data
         # basophil_ncnc_bld units in cells/microliter - we want thousands/microliter - 10^9 cells/liter
        dataset <- source_data[["pht005002"]]
        dataset$basophils_baseline <- as.numeric(dataset$basophils_baseline)
        names(dataset)[names(dataset) %in% "basophils_baseline"] <- "basophil_ncnc_bld"
        dataset$basophil_ncnc_bld <- dataset$basophil_ncnc_bld / 1000
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$basophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="basophil_ncnc_bld_1-aric"></a>
  * ### blood_cell_count/basophil_ncnc_bld_1 -- **ARIC**:
    * 6 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004107.v2.phv00207257.v1`, `phs000280.v4.pht004107.v2.phv00207264.v1`, `phs000280.v4.pht004108.v2.phv00207272.v1`, `phs000280.v4.pht004108.v2.phv00207279.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.integer(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.integer(V2AGE22))
      
          dem <- list(dem1, dem2) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # Basophils, converted from % of leukocytes to count of thousands/microliter
          # Obtain basophil data and eliminate subjects with missing codes
          blood1 <- phen_list$source_data[["pht004107"]] %>%
              filter(!(HMTA10 %in% c("A", "O")) & !(HMTA03 %in% c("A", "O"))) %>%
              mutate(visit = 1,
                  basophil_ncnc_bld = as.numeric(HMTA10),
                  wbc_ncnc_bld = as.numeric(HMTA03))
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB10 %in% c("A", "O")) & !(HMTB03 %in% c("A", "O"))) %>%
              mutate(visit = 2,
                  basophil_ncnc_bld = as.numeric(HMTB10),
                  wbc_ncnc_bld = as.numeric(HMTB03))
      
          blood <- list(blood1, blood2)
          for (i in seq_along(blood)){
              blood[[i]] %<>%
                  tbl_df() %>%
                  select(topmed_subject_id, visit, basophil_ncnc_bld, wbc_ncnc_bld) %>%
                  na.omit() %>%
                  mutate(basophil_ncnc_bld = basophil_ncnc_bld * wbc_ncnc_bld / 100) %>%
                  select(-wbc_ncnc_bld)
          }
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
         # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, basophil_ncnc_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="basophil_ncnc_bld_1-cardia"></a>
  * ### blood_cell_count/basophil_ncnc_bld_1 -- **CARDIA**:
    * 3 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112686.v2`, `phs000285.v3.pht001563.v2.phv00112696.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Basophil count at Exam 1 (thousands/microliter)
          # eliminate subjects with missing code "M"
          # derive count from total WBC (A05WBC) and % basophils (A05BASO)
      
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05BASO %in% "M") & !(A05WBC %in% "M")) %>%
              mutate(basophil_ncnc_bld = as.numeric(A05WBC) * as.numeric(A05BASO) / 100)
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, basophil_ncnc_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="basophil_ncnc_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/basophil_ncnc_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 3 component_study_variables: `phs000007.v29.pht002889.v2.phv00172178.v2`, `phs000007.v29.pht002889.v2.phv00172192.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # basophil: use percent measurement along with WBC
        dataset1 <- source_data[["pht002889"]]
        dataset1$BA_PER <- as.numeric(dataset1$BA_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$basophil_ncnc_bld <- dataset1$WBC * dataset1$BA_PER / 100
        dataset1$BA_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$basophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="basophil_ncnc_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/basophil_ncnc_bld_1 -- **FHS_Offspring**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227039.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # basophil
        dataset1 <- source_data[["pht004802"]]
          # subset to Offspring
        dataset1 <- dataset1[dataset1$IDTYPE %in% 1, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$BA_PER <- as.numeric(dataset1$BA_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$basophil_ncnc_bld <- dataset1$WBC * dataset1$BA_PER / 100
        dataset1$BA_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age9 <- as.numeric(dataset2$age9)
        names(dataset2)[names(dataset2) %in% "age9"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$basophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="basophil_ncnc_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/basophil_ncnc_bld_1 -- **FHS_Omni1**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227039.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # basophil
        dataset1 <- source_data[["pht004802"]]
          # subset to Omni1
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$BA_PER <- as.numeric(dataset1$BA_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$basophil_ncnc_bld <- dataset1$WBC * dataset1$BA_PER / 100
        dataset1$BA_PER <- NULL
        dataset1$WBC <- NULL
      
         # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$basophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="basophil_ncnc_bld_1-hchs_sol"></a>
  * ### blood_cell_count/basophil_ncnc_bld_1 -- **HCHS_SOL**:
    * 3 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226283.v1`, `phs000810.v1.pht004715.v1.phv00226288.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Basophils (thousands/microliter) and age at measurement
          # derive count from total WBC (LABA1) and % basophils (LABA14)
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(basophil_ncnc_bld = as.numeric(LABA1) * as.numeric(LABA14) / 100,
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, basophil_ncnc_bld) %>%
              filter(!is.na(age), !is.na(basophil_ncnc_bld))
      
          return(dataset)
      }
      ```
<a id="basophil_ncnc_bld_1-jhs"></a>
  * ### blood_cell_count/basophil_ncnc_bld_1 -- **JHS**:
    * 3 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127620.v1`, `phs000286.v5.pht001959.v1.phv00127631.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # basophil_count
        dataset1 <- source_data[["pht001959"]]
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$BASO <- as.numeric(dataset1$BASO)
        sel <- !is.na(dataset1$WBC) & !is.na(dataset1$BASO)
        dataset1 <- dataset1[sel, ]
        dataset1$basophil_ncnc_bld <- dataset1$WBC * dataset1$BASO / 100
        dataset1$WBC <- NULL
        dataset1$BASO <- NULL
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$basophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="basophil_ncnc_bld_1-mesa"></a>
  * ### blood_cell_count/basophil_ncnc_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00219002.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.integer(age5c))
      
          # Basophils (cells x 10^3/uL of blood)
          wbc <- phen_list$source_data[["pht004319"]] %>%
              tbl_df %>%
              mutate(basophil_ncnc_bld = as.numeric(basosa5)) %>%
              select(topmed_subject_id, basophil_ncnc_bld) %>%
              filter(complete.cases(.))
      
          dataset <- inner_join(dataset_dem, wbc, by = "topmed_subject_id") %>%
              na.omit()
      
          return(dataset)
      }
      ```
<a id="eosinophil_ncnc_bld_1"></a>
## blood_cell_count: **eosinophil_ncnc_bld_1** (eosinophil_ncnc_bld)
  Count by volume, or number concentration (ncnc), of eosinophils in the blood (bld).
  * **Harmonization Units**:
    * [Amish](#eosinophil_ncnc_bld_1-amish)
    * [ARIC](#eosinophil_ncnc_bld_1-aric)
    * [CARDIA](#eosinophil_ncnc_bld_1-cardia)
    * [FHS_Gen3NOSOmni2](#eosinophil_ncnc_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#eosinophil_ncnc_bld_1-fhs_offspring)
    * [FHS_Omni1](#eosinophil_ncnc_bld_1-fhs_omni1)
    * [HCHS_SOL](#eosinophil_ncnc_bld_1-hchs_sol)
    * [JHS](#eosinophil_ncnc_bld_1-jhs)
    * [MESA](#eosinophil_ncnc_bld_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: thousands / microliter, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 14:56:42
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0942419
  * **DCC Harmonization Comments**:

    When possible, eosinophil count was derived from percentage (%) of eosinophils in the total white blood cell count (WBC) , using the formula
    ```
    white blood cell count * % eosinophils / 100.
    ```
    This choice minimizes discretizing round-off effects which can lead to multi-modal distributions. Otherwise, if percentage was not available, the value of eosinophil count as provided by the study was used directly.
    
    For studies or cohorts with measurements at more than one visit, in order to maximize sample 
    size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.  The counts were first derived as above using data from each visit and then a visit for a given subject was selected. 
    
    ### Study-specific comments
    
    #### Amish
    Because percentage data was not available, harmonization used given count values from a study component variable rescaled to appropriate harmonized units.
    
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### MESA
    Because percentage data was not available, harmonization used given count values from a study component variable. 
    
    ### QC checks
    For each subject, the sum of the WBC subtype differential counts (percentages) was compared to the total white blood cell count (100%) . 
    
    For *_FHS_* Offspring, this QC led to the discovery of anomalies (unusual number of values recorded as 0) in the data at Exam 2 for the WBC subtype differentials. After communication with *_FHS_*, the decision was made to not use the Exam 2 data. 
    
    For other studies, there was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for WBC, eosinophils, and other WBC subtype differentials may not be from the same visit, so the harmonized subtype differential counts may not sum to the WBC count.
    
<a id="eosinophil_ncnc_bld_1-amish"></a>
  * ### blood_cell_count/eosinophil_ncnc_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253014.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
         source_data <- phen_list$source_data
         # eosinophil_ncnc_bld units in cells/microliter - we want thousands/microliter - 10^9 cells/liter
        dataset <- source_data[["pht005002"]]
        dataset$eosinophils_baseline <- as.numeric(dataset$eosinophils_baseline)
        names(dataset)[names(dataset) %in% "eosinophils_baseline"] <- "eosinophil_ncnc_bld"
        dataset$eosinophil_ncnc_bld <- dataset$eosinophil_ncnc_bld / 1000
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$eosinophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="eosinophil_ncnc_bld_1-aric"></a>
  * ### blood_cell_count/eosinophil_ncnc_bld_1 -- **ARIC**:
    * 6 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004107.v2.phv00207257.v1`, `phs000280.v4.pht004107.v2.phv00207263.v1`, `phs000280.v4.pht004108.v2.phv00207272.v1`, `phs000280.v4.pht004108.v2.phv00207278.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.integer(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.integer(V2AGE22))
      
          dem <- list(dem1, dem2) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # Eosinophils, converted from % of leukocytes to count of thousands/microliter
          # Obtain eosinophil data and eliminate subjects with missing codes
          blood1 <- phen_list$source_data[["pht004107"]] %>%
              filter(!(HMTA09 %in% c("A", "O")) & !(HMTA03 %in% c("A", "O"))) %>%
              mutate(visit = 1,
                  eosinophil_ncnc_bld = as.numeric(HMTA09),
                  wbc_ncnc_bld = as.numeric(HMTA03))
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB09 %in% c("A", "O")) & !(HMTB03 %in% c("A", "O"))) %>%
              mutate(visit = 2,
                  eosinophil_ncnc_bld = as.numeric(HMTB09),
                  wbc_ncnc_bld = as.numeric(HMTB03))
      
          blood <- list(blood1, blood2)
          for (i in seq_along(blood)){
              blood[[i]] %<>%
                  tbl_df() %>%
                  select(topmed_subject_id, visit, eosinophil_ncnc_bld, wbc_ncnc_bld) %>%
                  na.omit() %>%
                  mutate(eosinophil_ncnc_bld = eosinophil_ncnc_bld * wbc_ncnc_bld / 100) %>%
                  select(-wbc_ncnc_bld)
          }
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
         # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, eosinophil_ncnc_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="eosinophil_ncnc_bld_1-cardia"></a>
  * ### blood_cell_count/eosinophil_ncnc_bld_1 -- **CARDIA**:
    * 3 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112686.v2`, `phs000285.v3.pht001563.v2.phv00112693.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Eosinophil count at Exam 1 (thousands/microliter)
          # eliminate subjects with missing code "M"
          # derive count from total WBC (A05WBC) and % eosinophils (A05BASO)
      
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05EOSIN %in% "M") & !(A05WBC %in% "M")) %>%
              mutate(eosinophil_ncnc_bld = as.numeric(A05WBC) * as.numeric(A05EOSIN) / 100)
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, eosinophil_ncnc_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="eosinophil_ncnc_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/eosinophil_ncnc_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 3 component_study_variables: `phs000007.v29.pht002889.v2.phv00172178.v2`, `phs000007.v29.pht002889.v2.phv00172191.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # eosinophil
        dataset1 <- source_data[["pht002889"]]
        dataset1$EO_PER <- as.numeric(dataset1$EO_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$eosinophil_ncnc_bld <- dataset1$WBC * dataset1$EO_PER / 100
        dataset1$EO_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$eosinophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="eosinophil_ncnc_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/eosinophil_ncnc_bld_1 -- **FHS_Offspring**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227038.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # eosinophil
        dataset1 <- source_data[["pht004802"]]
          # subset to Offspring
        dataset1 <- dataset1[dataset1$IDTYPE %in% 1, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$EO_PER <- as.numeric(dataset1$EO_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$eosinophil_ncnc_bld <- dataset1$WBC * dataset1$EO_PER / 100
        dataset1$EO_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age9 <- as.numeric(dataset2$age9)
        names(dataset2)[names(dataset2) %in% "age9"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$eosinophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="eosinophil_ncnc_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/eosinophil_ncnc_bld_1 -- **FHS_Omni1**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227038.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # eosinophil
        dataset1 <- source_data[["pht004802"]]
          # subset to Omni1
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$EO_PER <- as.numeric(dataset1$EO_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$eosinophil_ncnc_bld <- dataset1$WBC * dataset1$EO_PER / 100
        dataset1$EO_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$eosinophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="eosinophil_ncnc_bld_1-hchs_sol"></a>
  * ### blood_cell_count/eosinophil_ncnc_bld_1 -- **HCHS_SOL**:
    * 3 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226283.v1`, `phs000810.v1.pht004715.v1.phv00226287.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Eosinophils (thousands/microliter) and age at measurement
          # derive count from total WBC (LABA1) and % eosinophils (LABA13)
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(eosinophil_ncnc_bld = as.numeric(LABA1) * as.numeric(LABA13) / 100,
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, eosinophil_ncnc_bld) %>%
              filter(!is.na(age), !is.na(eosinophil_ncnc_bld))
      
          return(dataset)
      }
      ```
<a id="eosinophil_ncnc_bld_1-jhs"></a>
  * ### blood_cell_count/eosinophil_ncnc_bld_1 -- **JHS**:
    * 3 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127621.v1`, `phs000286.v5.pht001959.v1.phv00127631.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # eosinophil_count
        dataset1 <- source_data[["pht001959"]]
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$EOSIN <- as.numeric(dataset1$EOSIN)
        sel <- !is.na(dataset1$WBC) & !is.na(dataset1$EOSIN)
        dataset1 <- dataset1[sel, ]
        dataset1$eosinophil_ncnc_bld <- dataset1$WBC * dataset1$EOSIN / 100
        dataset1$WBC <- NULL
        dataset1$EOSIN <- NULL
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$eosinophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="eosinophil_ncnc_bld_1-mesa"></a>
  * ### blood_cell_count/eosinophil_ncnc_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00219001.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              tbl_df %>%
              transmute(topmed_subject_id, age = as.integer(age5c))
      
          # Eosiniphils (cells x 10^3/uL of blood)
          wbc <- phen_list$source_data[["pht004319"]] %>%
              tbl_df %>%
              mutate(eosinophil_ncnc_bld = as.numeric(eosa5)) %>%
              select(topmed_subject_id, eosinophil_ncnc_bld) %>%
              filter(complete.cases(.))
      
          dataset <- inner_join(dataset_dem, wbc, by = "topmed_subject_id") %>%
              na.omit()
      
          return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1"></a>
## blood_cell_count: **hematocrit_vfr_bld_1** (hematocrit_vfr_bld)
  Measurement of hematocrit, the fraction of volume (vfr) of blood (bld) that is composed of red blood cells.
  * **Harmonization Units**:
    * [Amish](#hematocrit_vfr_bld_1-amish)
    * [ARIC](#hematocrit_vfr_bld_1-aric)
    * [CARDIA](#hematocrit_vfr_bld_1-cardia)
    * [CHS](#hematocrit_vfr_bld_1-chs)
    * [FHS_Gen3NOSOmni2](#hematocrit_vfr_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#hematocrit_vfr_bld_1-fhs_offspring)
    * [FHS_Omni1](#hematocrit_vfr_bld_1-fhs_omni1)
    * [HCHS_SOL](#hematocrit_vfr_bld_1-hchs_sol)
    * [JHS](#hematocrit_vfr_bld_1-jhs)
    * [MESA](#hematocrit_vfr_bld_1-mesa)
    * [WHI](#hematocrit_vfr_bld_1-whi)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: % = percentage, **`Version`**: 4, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 14:59:23
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0803379
  * **DCC Harmonization Comments**:

    For studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.
    
    ### Study-specific comments
    
    #### FHS
    Only the Offspring subcohort had measurements at multiple visits (exams). For this subcohort, the measurement at the most recent exam available was chosen (since more recent exams used more up-to-date procedures). 
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### Amish
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    
    ### QC checks
    
    Analysts should carefully examine distributions of the *_WHI_* hematocrit values and compare hematocrit and hemoglobin. There are clusters of outliers for which no specific batch effect could be identified but which analysts may wish to exclude from analyses.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject.
    
<a id="hematocrit_vfr_bld_1-amish"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253008.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
        source_data <- phen_list$source_data
         # hematocrit units already %
        dataset <- source_data[["pht005002"]]
        dataset$hematocrit_baseline <- as.numeric(dataset$hematocrit_baseline)
        names(dataset)[names(dataset) %in% "hematocrit_baseline"] <- "hematocrit_vfr_bld"
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$hematocrit_vfr_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1-aric"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **ARIC**:
    * 10 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004064.v2.phv00204871.v1`, `phs000280.v4.pht004065.v2.phv00204975.v1`, `phs000280.v4.pht004107.v2.phv00207255.v1`, `phs000280.v4.pht004108.v2.phv00207270.v1`, `phs000280.v4.pht004109.v2.phv00207289.v1`, `phs000280.v4.pht004110.v2.phv00207301.v1`, `phs000280.v4.pht006422.v1.phv00294957.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.numeric(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.numeric(V2AGE22))
          dem3 <- phen_list$source_data[["pht004064"]] %>%
              mutate(visit = 3, age = as.numeric(V3AGE31))
          dem4 <- phen_list$source_data[["pht004065"]] %>%
              mutate(visit = 4, age = as.numeric(V4AGE41))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
      
          dem <- list(dem1, dem2, dem3, dem4, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # Hematocrit (percentage)
          # get hematocrit data for each visit, eliminate subjects with missing codes
          blood1 <- phen_list$source_data[["pht004107"]] %>%
              filter(!(HMTA01 %in% c("A", "O")) ) %>%
              mutate(visit = 1, hematocrit_vfr_bld = as.numeric(HMTA01))
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB01 %in% c("A", "O")) ) %>%
              mutate(visit = 2, hematocrit_vfr_bld = as.numeric(HMTB01))
          blood3 <- phen_list$source_data[["pht004109"]] %>%
              filter(!(HMTC5 %in% c("A", "O")) ) %>%
              mutate(visit = 3, hematocrit_vfr_bld = as.numeric(HMTC5))
          blood4 <- phen_list$source_data[["pht004110"]] %>%
              filter(!(HMTC5 %in% c("A", "O")) ) %>%
              mutate(visit = 4, hematocrit_vfr_bld = as.numeric(HMTC5))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC6 %in% c("A", "O")) ) %>%
              mutate(visit = 5, hematocrit_vfr_bld = as.numeric(CBC6))
      
          blood <- list(blood1, blood2, blood3, blood4, blood5) %>%
              lapply(select, topmed_subject_id, visit, hematocrit_vfr_bld) %>%
              lapply(na.omit)
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, hematocrit_vfr_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="hematocrit_vfr_bld_1-cardia"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112689.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Hematocrit at Exam 1 (%)
          # eliminate subjects with missing code "M"
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05HCT %in% "M")) %>%
              transmute(topmed_subject_id, hematocrit_vfr_bld = as.numeric(A05HCT))
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, hematocrit_vfr_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1-chs"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100413.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Hematocrit (percentage) and age at baseline
          dataset <- phen_list$source_data[["pht001452"]] %>%
              tbl_df %>%
              mutate(hematocrit_vfr_bld = as.numeric(HEMATO23),
                  age = as.integer(AGEBL)) %>%
              select(topmed_subject_id, age, hematocrit_vfr_bld) %>%
              filter(!is.na(age), !is.na(hematocrit_vfr_bld))
      
          return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172181.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # hematocrit
        dataset1 <- source_data[["pht002889"]]
      
        dataset1$HCT <- as.numeric(dataset1$HCT)
        names(dataset1)[names(dataset1) %in% "HCT"] <- "hematocrit_vfr_bld"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$hematocrit_vfr_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **FHS_Offspring**:
    * 7 component_study_variables: `phs000007.v29.pht000030.v7.phv00007555.v5`, `phs000007.v29.pht000031.v7.phv00008111.v5`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177932.v4`, `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227028.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # hematocrit
        var <- "hematocrit_vfr_bld"
      
        # Offspring exam 9
        dataset9 <- source_data[["pht004802"]]
        # subset to Offspring
        dataset9 <- dataset9[dataset9$IDTYPE %in% 1, ]
        dataset9$IDTYPE <- NULL
      
        dataset9$HCT <- as.numeric(dataset9$HCT)
      
        # Offspring exam 2
        dataset2 <- source_data[["pht000031"]]
        dataset2$B764 <- as.numeric(dataset2$B764)
      
         # Offspring exam 1
        dataset1 <- source_data[["pht000030"]]
        dataset1$A28 <- as.numeric(dataset1$A28)
      
        # ages
        dataseta <- source_data[["pht003099"]]
        dataseta$age9 <- as.numeric(dataseta$age9)
        dataseta$age2 <- as.numeric(dataseta$age2)
        dataseta$age1 <- as.numeric(dataseta$age1)
      
        # add appropriate ages to datasets
        dataset9 <- inner_join(dataset9, dataseta)
        dataset9$age2 <- NULL
        dataset9$age1 <- NULL
      
        dataset2 <- inner_join(dataset2, dataseta)
        dataset2$age9 <- NULL
        dataset2$age1 <- NULL
      
        dataset1 <- inner_join(dataset1, dataseta)
        dataset1$age9 <- NULL
        dataset1$age2 <- NULL
      
        sel <- !is.na(dataset9$HCT) & !is.na(dataset9$age9)
        keep9 <- dataset9[sel, ]
        names(keep9)[names(keep9) == "HCT"] <- var
        names(keep9)[names(keep9) == "age9"] <- "age"
      
        dataset2 <- anti_join(dataset2, keep9)
        sel2 <- !is.na(dataset2$B764) & !is.na(dataset2$age2)
        keep2 <- dataset2[sel2, ]
        names(keep2)[names(keep2) == "B764"] <- var
        names(keep2)[names(keep2) == "age2"] <- "age"
      
        keep <- rbind(keep9, keep2)
      
        dataset1 <- anti_join(dataset1, keep)
        sel1 <-  !is.na(dataset1$A28) & !is.na(dataset1$age1)
        keep1 <- dataset1[sel1, ]
        names(keep1)[names(keep1) == "A28"] <- var
        names(keep1)[names(keep1) == "age1"] <- "age"
      
        # combine
        dataset <- rbind(keep, keep1)
      
        return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227028.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # hematocrit
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
        dataset1$HCT <- as.numeric(dataset1$HCT)
        names(dataset1)[names(dataset1) %in% "HCT"] <- "hematocrit_vfr_bld"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$hematocrit_vfr_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1-hchs_sol"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226303.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Hematocrit (percentage) and age at measurement
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(hematocrit_vfr_bld = as.numeric(LABA4),
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, hematocrit_vfr_bld) %>%
              filter(!is.na(age), !is.na(hematocrit_vfr_bld))
      
          return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1-jhs"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127614.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # hematocrit
        dataset1 <- source_data[["pht001959"]]
        dataset1$HEMATOCRIT <- as.numeric(dataset1$HEMATOCRIT)
        names(dataset1)[names(dataset1) %in% "HEMATOCRIT"] <- "hematocrit_vfr_bld"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$hematocrit_vfr_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1-mesa"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218992.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.integer(age5c))
      
          # Hematocrit at Exam 5 (percentage)
          dataset_hem <- phen_list$source_data[["pht004319"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, hematocrit_vfr_bld = as.numeric(hct5))
      
          dataset <- inner_join(dataset_dem, dataset_hem, by = "topmed_subject_id") %>%
              na.omit()
      
          return(dataset)
      }
      ```
<a id="hematocrit_vfr_bld_1-whi"></a>
  * ### blood_cell_count/hematocrit_vfr_bld_1 -- **WHI**:
    * 5 component_study_variables: `phs000200.v11.pht000986.v6.phv00077362.v6`, `phs000200.v11.pht000986.v6.phv00077363.v6`, `phs000200.v11.pht000986.v6.phv00077365.v6`, `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Hematocrit (percentage)
          dataset <- phen_list$source_data[["pht000986"]] %>%
              tbl_df() %>%
              # Age
              left_join(phen_list$source_data[["pht000998"]], by = "topmed_subject_id") %>%
      
              # AGE is measured at screening on form F2.
              # abs(F2DAYS) is days between screening and enrollment.
              # do not use F2DAYS when F2DAYS > 0
              # CBCDAYS is days from enrollment to trait measurement
              mutate(F2DAYS = ifelse(as.integer(F2DAYS) > 0, 0, F2DAYS)) %>%
              mutate(hematocrit_vfr_bld = as.numeric(HEMATOCR),
                  age = as.integer(AGE) +
                      (as.integer(CBCDAYS) + abs(as.integer(F2DAYS))) / 365.25) %>%
              select(topmed_subject_id,
                      age, CBCVY,
                      hematocrit_vfr_bld) %>%
              # Use year 0 measurement
              filter(CBCVY %in% 0 & !is.na(hematocrit_vfr_bld) & !is.na(age)) %>%
              select(topmed_subject_id, age, hematocrit_vfr_bld)
      
          return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1"></a>
## blood_cell_count: **hemoglobin_mcnc_bld_1** (hemoglobin_mcnc_bld)
  Measurement of mass per volume, or mass concentration (mcnc), of hemoglobin in the blood (bld).
  * **Harmonization Units**:
    * [Amish](#hemoglobin_mcnc_bld_1-amish)
    * [ARIC](#hemoglobin_mcnc_bld_1-aric)
    * [CARDIA](#hemoglobin_mcnc_bld_1-cardia)
    * [CHS](#hemoglobin_mcnc_bld_1-chs)
    * [FHS_Gen3NOSOmni2](#hemoglobin_mcnc_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#hemoglobin_mcnc_bld_1-fhs_offspring)
    * [FHS_Omni1](#hemoglobin_mcnc_bld_1-fhs_omni1)
    * [HCHS_SOL](#hemoglobin_mcnc_bld_1-hchs_sol)
    * [JHS](#hemoglobin_mcnc_bld_1-jhs)
    * [MESA](#hemoglobin_mcnc_bld_1-mesa)
    * [WHI](#hemoglobin_mcnc_bld_1-whi)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: g / dL = grams per deciliter, **`Version`**: 4, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 14:59:36
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0362923
  * **DCC Harmonization Comments**:

    For studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.
    
    ### Study-specific comments
    
    #### FHS
    Only the Offspring subcohort had measurements at multiple visits (exams). For this subcohort, the measurement at the most recent exam available was chosen (since more recent exams used more up-to-date procedures). 
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### Amish
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    ### QC checks
    
    Analysts should carefully examine distributions of the *_WHI_* hemoglobin values and compare hematocrit and hemoglobin. There are clusters of outliers for which no specific batch effect could be identified but which analysts may wish to exclude from analyses.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject.
    
<a id="hemoglobin_mcnc_bld_1-amish"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253007.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
        source_data <- phen_list$source_data
         # hemoglobin units already g/dL (grams per deciliter)
        dataset <- source_data[["pht005002"]]
        dataset$hemoglobin_baseline <- as.numeric(dataset$hemoglobin_baseline)
        names(dataset)[names(dataset) %in% "hemoglobin_baseline"] <- "hemoglobin_mcnc_bld"
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$hemoglobin_mcnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-aric"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **ARIC**:
    * 10 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004064.v2.phv00204871.v1`, `phs000280.v4.pht004065.v2.phv00204975.v1`, `phs000280.v4.pht004107.v2.phv00207256.v1`, `phs000280.v4.pht004108.v2.phv00207271.v1`, `phs000280.v4.pht004109.v2.phv00207288.v1`, `phs000280.v4.pht004110.v2.phv00207300.v1`, `phs000280.v4.pht006422.v1.phv00294956.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.numeric(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.numeric(V2AGE22))
          dem3 <- phen_list$source_data[["pht004064"]] %>%
              mutate(visit = 3, age = as.numeric(V3AGE31))
          dem4 <- phen_list$source_data[["pht004065"]] %>%
              mutate(visit = 4, age = as.numeric(V4AGE41))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
      
          dem <- list(dem1, dem2, dem3, dem4, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # Hemoglobin (g/dL)
          # get hemoglobin data for each visit, eliminate subjects with missing codes
          blood1 <- phen_list$source_data[["pht004107"]] %>%
              filter(!(HMTA02 %in% c("A", "O")) ) %>%
              mutate(visit = 1, hemoglobin_mcnc_bld = as.numeric(HMTA02))
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB02 %in% c("A", "O")) ) %>%
              mutate(visit = 2, hemoglobin_mcnc_bld = as.numeric(HMTB02))
          blood3 <- phen_list$source_data[["pht004109"]] %>%
              filter(!(HMTC4 %in% c("A", "O")) ) %>%
              mutate(visit = 3, hemoglobin_mcnc_bld = as.numeric(HMTC4))
          blood4 <- phen_list$source_data[["pht004110"]] %>%
              filter(!(HMTC4 %in% c("A", "O")) ) %>%
              mutate(visit = 4, hemoglobin_mcnc_bld = as.numeric(HMTC4))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC5 %in% c("A", "O")) ) %>%
              mutate(visit = 5, hemoglobin_mcnc_bld = as.numeric(CBC5))
      
          blood <- list(blood1, blood2, blood3, blood4, blood5) %>%
              lapply(select, topmed_subject_id, visit, hemoglobin_mcnc_bld) %>%
              lapply(na.omit)
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, hemoglobin_mcnc_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-cardia"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112688.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Hemoglobin at Exam 1 (g/dL)
          # eliminate subjects with missing code "M"
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05HGB %in% "M")) %>%
              transmute(topmed_subject_id, hemoglobin_mcnc_bld = as.numeric(A05HGB))
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, hemoglobin_mcnc_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-chs"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100412.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Hemoglobin (g/dL) and age calculated at baseline
          dataset <- phen_list$source_data[["pht001452"]] %>%
              mutate(hemoglobin_mcnc_bld = as.numeric(HEMOGL23),
                  age = as.integer(AGEBL)) %>%
              select(topmed_subject_id, age, hemoglobin_mcnc_bld) %>% na.omit
      
          return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172180.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # hemoglobin
        dataset1 <- source_data[["pht002889"]]
        dataset1$HGB <- as.numeric(dataset1$HGB)
        names(dataset1)[names(dataset1) %in% "HGB"] <- "hemoglobin_mcnc_bld"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$hemoglobin_mcnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **FHS_Offspring**:
    * 7 component_study_variables: `phs000007.v29.pht000030.v7.phv00007642.v5`, `phs000007.v29.pht000031.v7.phv00008110.v5`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177932.v4`, `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227027.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # hemoglobin
        var <- "hemoglobin_mcnc_bld"
      
        # Offspring exam 9
        dataset9 <- source_data[["pht004802"]]
        # subset to Offspring
        dataset9 <- dataset9[dataset9$IDTYPE %in% 1, ]
        dataset9$IDTYPE <- NULL
      
        dataset9$HGB <- as.numeric(dataset9$HGB)
      
        # Offspring exam 2
        dataset2 <- source_data[["pht000031"]]
        dataset2$B763 <- as.numeric(dataset2$B763)
      
      # Recode: B763 in g/L - need g/dL - so divide by 10
        dataset2$B763 <- dataset2$B763 / 10
      
         # Offspring exam 1
        dataset1 <- source_data[["pht000030"]]
        dataset1$A140 <- as.numeric(dataset1$A140)
      
        # Recode: A140 in g/L - need g/dL - so divide by 10
        dataset1$A140 <- dataset1$A140 / 10
      
        # ages
        dataseta <- source_data[["pht003099"]]
        dataseta$age9 <- as.numeric(dataseta$age9)
        dataseta$age2 <- as.numeric(dataseta$age2)
        dataseta$age1 <- as.numeric(dataseta$age1)
      
        # add appropriate ages to datasets
        dataset9 <- inner_join(dataset9, dataseta)
        dataset9$age2 <- NULL
        dataset9$age1 <- NULL
      
        dataset2 <- inner_join(dataset2, dataseta)
        dataset2$age9 <- NULL
        dataset2$age1 <- NULL
      
        dataset1 <- inner_join(dataset1, dataseta)
        dataset1$age9 <- NULL
        dataset1$age2 <- NULL
      
        sel <- !is.na(dataset9$HGB) & !is.na(dataset9$age9)
        keep9 <- dataset9[sel, ]
        names(keep9)[names(keep9) == "HGB"] <- var
        names(keep9)[names(keep9) == "age9"] <- "age"
      
        dataset2 <- anti_join(dataset2, keep9)
        sel2 <- !is.na(dataset2$B763) & !is.na(dataset2$age2)
        keep2 <- dataset2[sel2, ]
        names(keep2)[names(keep2) == "B763"] <- var
        names(keep2)[names(keep2) == "age2"] <- "age"
      
        keep <- rbind(keep9, keep2)
      
        dataset1 <- anti_join(dataset1, keep)
        sel1 <-  !is.na(dataset1$A140) & !is.na(dataset1$age1)
        keep1 <- dataset1[sel1, ]
        names(keep1)[names(keep1) == "A140"] <- var
        names(keep1)[names(keep1) == "age1"] <- "age"
      
        # combine
        dataset <- rbind(keep, keep1)
      
        return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227027.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # hemoglobin
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
        dataset1$HGB <- as.numeric(dataset1$HGB)
        names(dataset1)[names(dataset1) %in% "HGB"] <- "hemoglobin_mcnc_bld"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$hemoglobin_mcnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-hchs_sol"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226302.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Hemoglobin (g/dL) and age at measurement
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(hemoglobin_mcnc_bld = as.numeric(LABA3),
                  age = as.numeric(AGE)) %>%
              select(topmed_subject_id, age, hemoglobin_mcnc_bld) %>%
              filter(!is.na(age), !is.na(hemoglobin_mcnc_bld))
      
          return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-jhs"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127615.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # hemoglobin
        dataset1 <- source_data[["pht001959"]]
        dataset1$HEMOGLOBIN <- as.numeric(dataset1$HEMOGLOBIN)
        names(dataset1)[names(dataset1) %in% "HEMOGLOBIN"] <- "hemoglobin_mcnc_bld"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$hemoglobin_mcnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-mesa"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218993.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              transmute(topmed_subject_id, age = as.integer(age5c))
      
          # Hemoglobin at Exam 5 (g/dL)
          dataset_hem <- phen_list$source_data[["pht004319"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, hemoglobin_mcnc_bld = as.numeric(hgb5))
      
          dataset <- inner_join(dataset_dem, dataset_hem, by = "topmed_subject_id") %>%
              na.omit()
      
          return(dataset)
      }
      ```
<a id="hemoglobin_mcnc_bld_1-whi"></a>
  * ### blood_cell_count/hemoglobin_mcnc_bld_1 -- **WHI**:
    * 5 component_study_variables: `phs000200.v11.pht000986.v6.phv00077362.v6`, `phs000200.v11.pht000986.v6.phv00077363.v6`, `phs000200.v11.pht000986.v6.phv00077366.v6`, `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
         # Hemaglobin (g/dL)
      
          dataset <- phen_list$source_data[["pht000986"]] %>%
              # Age
              left_join(phen_list$source_data[["pht000998"]], by = "topmed_subject_id") %>%
      
              # AGE is measured at screening on form F2.
              # abs(F2DAYS) is days between screening and enrollment.
              # do not use F2DAYS when F2DAYS > 0
              mutate(F2DAYS = ifelse(as.integer(F2DAYS) > 0, 0, F2DAYS)) %>%
      
              # get hemoglobin
              mutate(hemoglobin_mcnc_bld = as.numeric(HEMOGLBN),
      
              # CBCDAYS is days from enrollment to trait measurement
              age = as.numeric(AGE) +
                      (as.numeric(CBCDAYS) + abs(as.numeric(F2DAYS))) / 365.25) %>%
              select(topmed_subject_id, age, CBCVY, hemoglobin_mcnc_bld) %>%
      
             # Use year 0 measurement.
              filter(CBCVY %in% 0 & !is.na(hemoglobin_mcnc_bld) & !is.na(age)) %>%
              select(topmed_subject_id, age, hemoglobin_mcnc_bld)
      
          return(dataset)
      }
      ```
<a id="lymphocyte_ncnc_bld_1"></a>
## blood_cell_count: **lymphocyte_ncnc_bld_1** (lymphocyte_ncnc_bld)
  Count by volume, or number concentration (ncnc), of lymphocytes in the blood (bld).
  * **Harmonization Units**:
    * [Amish](#lymphocyte_ncnc_bld_1-amish)
    * [ARIC](#lymphocyte_ncnc_bld_1-aric)
    * [CARDIA](#lymphocyte_ncnc_bld_1-cardia)
    * [FHS_Gen3NOSOmni2](#lymphocyte_ncnc_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#lymphocyte_ncnc_bld_1-fhs_offspring)
    * [FHS_Omni1](#lymphocyte_ncnc_bld_1-fhs_omni1)
    * [HCHS_SOL](#lymphocyte_ncnc_bld_1-hchs_sol)
    * [JHS](#lymphocyte_ncnc_bld_1-jhs)
    * [MESA](#lymphocyte_ncnc_bld_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: thousands / microliter, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 14:56:57
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0942437
  * **DCC Harmonization Comments**:

    When possible, lymphocyte count was derived from percentage (%) of lymphocytes in the total white blood cell count (WBC) , using the formula
    ```
    white blood cell count * % lymphocytes / 100.
    ```
    This choice minimizes discretizing round-off effects which can lead to multi-modal distributions. Otherwise, if percentage was not available, the value of lymphocyte count as provided by the study was used directly.
    
    For studies or cohorts with measurements at more than one visit, in order to maximize sample 
    size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.  The counts were first derived as above using data from each visit and then a visit for a given subject was selected. 
    
    ### Study-specific comments
    
    #### Amish
    Because percentage data was not available, harmonization used given count values from a study component variable rescaled to appropriate harmonized units.
    
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### MESA
    Because percentage data was not available, harmonization used given count values from a study component variable. 
    
    ### QC checks
    For each subject, the sum of the WBC subtype differential counts (percentages) was compared to the total white blood cell count (100%) . 
    
    For *_FHS_* Offspring, this QC led to the discovery of anomalies (unusual number of values recorded as 0) in the data at Exam 2 for the WBC subtype differentials. After communication with *_FHS_*, the decision was made to not use the Exam 2 data. 
    
    For other studies, there was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for WBC, lymphocytes, and other WBC subtype differentials may not be from the same visit, so the harmonized subtype differential counts may not sum to the WBC count.
    
<a id="lymphocyte_ncnc_bld_1-amish"></a>
  * ### blood_cell_count/lymphocyte_ncnc_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253013.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
        source_data <- phen_list$source_data
         # lymphocyte_ncnc_bld units in cells/microliter
         #   we want thousands/microliter
        dataset <- source_data[["pht005002"]]
        dataset$lymphocytes_baseline <- as.numeric(dataset$lymphocytes_baseline)
        names(dataset)[names(dataset) %in% "lymphocytes_baseline"] <- "lymphocyte_ncnc_bld"
        dataset$lymphocyte_ncnc_bld <- dataset$lymphocyte_ncnc_bld / 1000
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$lymphocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="lymphocyte_ncnc_bld_1-aric"></a>
  * ### blood_cell_count/lymphocyte_ncnc_bld_1 -- **ARIC**:
    * 9 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004107.v2.phv00207257.v1`, `phs000280.v4.pht004107.v2.phv00207261.v1`, `phs000280.v4.pht004108.v2.phv00207272.v1`, `phs000280.v4.pht004108.v2.phv00207276.v1`, `phs000280.v4.pht006422.v1.phv00294954.v1`, `phs000280.v4.pht006422.v1.phv00294964.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Lymphocyte, converted from % of leukocytes to count of thousands/microliter
          # Study component variables available only in visits 1, 2, and 5
      
          # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.integer(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.integer(V2AGE22))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
          dem <- list(dem1, dem2, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # obtain lymphocyte % and WBC data, eliminate subjects with missing codes
          blood1 <- phen_list$source_data[["pht004107"]] %>%
              filter(!(HMTA07 %in% c("A", "O")) & !(HMTA03 %in% c("A", "O"))) %>%
              mutate(visit = 1,
                  lymphocyte_ncnc_bld = as.numeric(HMTA07),
                  wbc_ncnc_bld = as.numeric(HMTA03))
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB07 %in% c("A", "O")) & !(HMTB03 %in% c("A", "O"))) %>%
              mutate(visit = 2,
                  lymphocyte_ncnc_bld = as.numeric(HMTB07),
                  wbc_ncnc_bld = as.numeric(HMTB03))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC13 %in% c("A", "O")) & !(CBC3 %in% c("A", "O"))) %>%
              mutate(visit = 5,
                  lymphocyte_ncnc_bld = as.numeric(CBC13),
                  wbc_ncnc_bld = as.numeric(CBC3))
      
          blood <- list(blood1, blood2, blood5)
          for (i in seq_along(blood)){
              blood[[i]] %<>%
                  tbl_df() %>%
                  select(topmed_subject_id, visit, lymphocyte_ncnc_bld, wbc_ncnc_bld) %>%
                  na.omit() %>%
                  mutate(lymphocyte_ncnc_bld = lymphocyte_ncnc_bld * wbc_ncnc_bld / 100) %>%
                  select(-wbc_ncnc_bld)
          }
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, lymphocyte_ncnc_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="lymphocyte_ncnc_bld_1-cardia"></a>
  * ### blood_cell_count/lymphocyte_ncnc_bld_1 -- **CARDIA**:
    * 3 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112686.v2`, `phs000285.v3.pht001563.v2.phv00112691.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Lymphocyte count at Exam 1 (thousands/microliter)
          # eliminate subjects with missing code "M"
          # derive count from total WBC (A05WBC) and % lymphocytes (A05LYMPH)
          #  description of A05LYMPH says lymphocyte count but the values are actually %s
      
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05LYMPH %in% "M") & !(A05WBC %in% "M")) %>%
              mutate(lymphocyte_ncnc_bld = as.numeric(A05WBC) * as.numeric(A05LYMPH) / 100)
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, lymphocyte_ncnc_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="lymphocyte_ncnc_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/lymphocyte_ncnc_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 3 component_study_variables: `phs000007.v29.pht002889.v2.phv00172178.v2`, `phs000007.v29.pht002889.v2.phv00172189.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # lymphocyte - derive count from percentage and total WBC
        dataset1 <- source_data[["pht002889"]]
        dataset1$LY_PER <- as.numeric(dataset1$LY_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$lymphocyte_ncnc_bld <- dataset1$WBC * dataset1$LY_PER / 100
        dataset1$LY_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$lymphocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="lymphocyte_ncnc_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/lymphocyte_ncnc_bld_1 -- **FHS_Offspring**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227036.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # lymphocyte - derive count from percentage and total WBC
        dataset1 <- source_data[["pht004802"]]
          # subset to Offspring
        dataset1 <- dataset1[dataset1$IDTYPE %in% 1, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$LY_PER <- as.numeric(dataset1$LY_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$lymphocyte_ncnc_bld <- dataset1$WBC * dataset1$LY_PER / 100
        dataset1$LY_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age9 <- as.numeric(dataset2$age9)
        names(dataset2)[names(dataset2) %in% "age9"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$lymphocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="lymphocyte_ncnc_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/lymphocyte_ncnc_bld_1 -- **FHS_Omni1**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227036.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # lymphocyte - derive from percentage and total WBC
        dataset1 <- source_data[["pht004802"]]
          # subset to Omni1
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$LY_PER <- as.numeric(dataset1$LY_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$lymphocyte_ncnc_bld <- dataset1$WBC * dataset1$LY_PER / 100
        dataset1$LY_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$lymphocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="lymphocyte_ncnc_bld_1-hchs_sol"></a>
  * ### blood_cell_count/lymphocyte_ncnc_bld_1 -- **HCHS_SOL**:
    * 3 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226283.v1`, `phs000810.v1.pht004715.v1.phv00226285.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Lymphocytes (thousands/microliter) and age at measurement
          # derive count from total WBC (LABA1) and % lymphocytes (LABA11)
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(lymphocyte_ncnc_bld = as.numeric(LABA1) * as.numeric(LABA11) / 100) %>%
              mutate(age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, lymphocyte_ncnc_bld) %>%
              filter(!is.na(age), !is.na(lymphocyte_ncnc_bld))
      
          return(dataset)
      }
      ```
<a id="lymphocyte_ncnc_bld_1-jhs"></a>
  * ### blood_cell_count/lymphocyte_ncnc_bld_1 -- **JHS**:
    * 3 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127622.v1`, `phs000286.v5.pht001959.v1.phv00127631.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # lymphocyte_count - derive from percentage and total WBC
        dataset1 <- source_data[["pht001959"]]
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$LYMPHS <- as.numeric(dataset1$LYMPHS)
        sel <- !is.na(dataset1$WBC) & !is.na(dataset1$LYMPHS)
        dataset1 <- dataset1[sel, ]
        dataset1$lymphocyte_ncnc_bld <- dataset1$WBC * dataset1$LYMPHS / 100
        dataset1$WBC <- NULL
        dataset1$LYMPHS <- NULL
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$lymphocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="lymphocyte_ncnc_bld_1-mesa"></a>
  * ### blood_cell_count/lymphocyte_ncnc_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218998.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              tbl_df %>%
              transmute(topmed_subject_id, age = as.integer(age5c))
      
          # Lymphocytes (cells x 10^3/uL of blood)
          wbc <- phen_list$source_data[["pht004319"]] %>%
              tbl_df %>%
              mutate(lymphocyte_ncnc_bld = as.numeric(lymphsa5)) %>%
              select(topmed_subject_id, lymphocyte_ncnc_bld)
      
          dataset <- inner_join(dataset_dem, wbc, by = "topmed_subject_id") %>%
                     na.omit()
      
          return(dataset)
      }
      ```
<a id="mch_entmass_rbc_1"></a>
## blood_cell_count: **mch_entmass_rbc_1** (mch_entmass_rbc)
  Measurement of the average mass (entmass) of hemoglobin per red blood cell(rbc), known as mean corpuscular hemoglobin (MCH).
  * **Harmonization Units**:
    * [Amish](#mch_entmass_rbc_1-amish)
    * [ARIC](#mch_entmass_rbc_1-aric)
    * [CARDIA](#mch_entmass_rbc_1-cardia)
    * [FHS_Gen3NOSOmni2](#mch_entmass_rbc_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#mch_entmass_rbc_1-fhs_offspring)
    * [FHS_Omni1](#mch_entmass_rbc_1-fhs_omni1)
    * [HCHS_SOL](#mch_entmass_rbc_1-hchs_sol)
    * [JHS](#mch_entmass_rbc_1-jhs)
    * [MESA](#mch_entmass_rbc_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg = picogram, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:25:19
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0945625
  * **DCC Harmonization Comments**:

    For most studies, the values of mean corpuscular hemoglobin (MCH) as provided by the study were used directly. When a study did not provide a variable for MCH, harmonized MCH values were derived from hemoglobin and red blood cell count study component variables, if available, using the formula:
    ```
    10 * hemoglobin / red blood cell count .
    ```
    For studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study. 
    
    ### Study-specific comments
    
    #### FHS
    Only the Offspring subcohort had measurements at multiple visits (exams). For this subcohort, the measurement at the most recent exam available was chosen because more recent exams used more up-to-date procedures. 
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### Amish
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    ### QC checks
    
    For studies with MCH, hemoglobin, and red blood cell count study component variables, the calculated values from hemoglobin and red blood cell count were compared with the given values in the MCH study component variable.
    
    For *_MESA_*, this QC detected apparent recording errors in some MCH values and led to the decision to use calculated values.
    
    For other studies, there was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for hemoglobin, red blood cell count, and MCH may not be from the same visit.
    
<a id="mch_entmass_rbc_1-amish"></a>
  * ### blood_cell_count/mch_entmass_rbc_1 -- **Amish**:
    * 3 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253007.v1`, `phs000956.v2.pht005002.v1.phv00253010.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
        source_data <- phen_list$source_data
      
         # MCH = hemoglobin/RBC * 10 units = pg (picograms) mean corpuscular hemoglobin
        dataset <- source_data[["pht005002"]]
        dataset$red_blood_cell_count_baseline <- as.numeric(dataset$red_blood_cell_count_baseline)
        dataset$hemoglobin_baseline <- as.numeric(dataset$hemoglobin_baseline)
        dataset <- dataset %>%
          mutate(mch_entmass_rbc = hemoglobin_baseline / red_blood_cell_count_baseline * 10)
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
         dataset <- dataset %>% filter(!is.na(age) & !is.na(mch_entmass_rbc)) %>%
             select(topmed_subject_id, mch_entmass_rbc, age)
      
        return(dataset)
      }
      ```
<a id="mch_entmass_rbc_1-aric"></a>
  * ### blood_cell_count/mch_entmass_rbc_1 -- **ARIC**:
    * 6 component_study_variables: `phs000280.v4.pht004064.v2.phv00204871.v1`, `phs000280.v4.pht004065.v2.phv00204975.v1`, `phs000280.v4.pht004109.v2.phv00207290.v1`, `phs000280.v4.pht004110.v2.phv00207302.v1`, `phs000280.v4.pht006422.v1.phv00294960.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Mean corpuscular hemoglobin MCH (pg) - only measured at visit 3, 4, and 5
          # Age at visit
          dem3 <- phen_list$source_data[["pht004064"]] %>%
              mutate(visit = 3, age = as.numeric(V3AGE31))
          dem4 <- phen_list$source_data[["pht004065"]] %>%
              mutate(visit = 4, age = as.numeric(V4AGE41))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
      
          dem <- list(dem3, dem4, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # get MCH data for each visit, eliminate subjects with missing codes
          blood3 <- phen_list$source_data[["pht004109"]] %>%
              filter(!(HMTC7 %in% c("A", "O")) ) %>%
              mutate(visit = 3, mch_entmass_rbc = as.numeric(HMTC7))
          blood4 <- phen_list$source_data[["pht004110"]] %>%
              filter(!(HMTC7 %in% c("A", "O")) ) %>%
              mutate(visit = 4, mch_entmass_rbc = as.numeric(HMTC7))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC9 %in% c("A", "O")) ) %>%
              mutate(visit = 5, mch_entmass_rbc = as.numeric(CBC9))
      
          blood <- list(blood3, blood4, blood5) %>%
              lapply(select, topmed_subject_id, visit, mch_entmass_rbc) %>%
              lapply(na.omit)
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, mch_entmass_rbc, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="mch_entmass_rbc_1-cardia"></a>
  * ### blood_cell_count/mch_entmass_rbc_1 -- **CARDIA**:
    * 3 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112687.v2`, `phs000285.v3.pht001563.v2.phv00112688.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Mean corpuscular hemoglobin MCH (pg)
          # not given but can derive from hemoglobin and red blood cell count (RBC)
          # MCH = hemoglobin/RBC * 10
          # get variables, eliminate subjects with missing code "M", derive
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05HGB %in% "M") & !(A05RBC %in% "M")) %>%
              mutate(mch_entmass_rbc = as.numeric(A05HGB) / as.numeric(A05RBC) * 10)
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, mch_entmass_rbc, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="mch_entmass_rbc_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/mch_entmass_rbc_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172183.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
        source_data <- phen_list$source_data
      
         # mch_entmass_rbc units = pg (picograms) mean corpuscular hemoglobin
        dataset1 <- source_data[["pht002889"]]
        dataset1$MCH <- as.numeric(dataset1$MCH)
        names(dataset1)[names(dataset1) %in% "MCH"] <- "mch_entmass_rbc"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mch_entmass_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="mch_entmass_rbc_1-fhs_offspring"></a>
  * ### blood_cell_count/mch_entmass_rbc_1 -- **FHS_Offspring**:
    * 7 component_study_variables: `phs000007.v29.pht000030.v7.phv00007645.v5`, `phs000007.v29.pht000031.v7.phv00008113.v5`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177932.v4`, `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227030.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
        source_data <- phen_list$source_data
         # MCH units = pg (picograms) mean corpuscular hemoglobin
        var <- "mch_entmass_rbc"
      
        # Offspring exam 9
        dataset9 <- source_data[["pht004802"]]
        # subset to Offspring
        dataset9 <- dataset9[dataset9$IDTYPE %in% 1, ]
        dataset9$IDTYPE <- NULL
      
        dataset9$MCH <- as.numeric(dataset9$MCH)
      
        # Offspring exam 2
        dataset2 <- source_data[["pht000031"]]
        dataset2$B766 <- as.numeric(dataset2$B766)
      
        # Recode: tens of pg - recode to pg (picogram)
        dataset2$B766 <- dataset2$B766 / 10
      
         # Offspring exam 1
        dataset1 <- source_data[["pht000030"]]
        dataset1$A143 <- as.numeric(dataset1$A143)
      
        # Recode: tens of pg - recode to pg (picogram)
        dataset1$A143 <- dataset1$A143 / 10
      
        # ages
        dataseta <- source_data[["pht003099"]]
        dataseta$age9 <- as.numeric(dataseta$age9)
        dataseta$age2 <- as.numeric(dataseta$age2)
        dataseta$age1 <- as.numeric(dataseta$age1)
      
        # add appropriate ages to datasets
        dataset9 <- inner_join(dataset9, dataseta)
        dataset9$age2 <- NULL
        dataset9$age1 <- NULL
      
        dataset2 <- inner_join(dataset2, dataseta)
        dataset2$age9 <- NULL
        dataset2$age1 <- NULL
      
        dataset1 <- inner_join(dataset1, dataseta)
        dataset1$age9 <- NULL
        dataset1$age2 <- NULL
      
        sel <- !is.na(dataset9$MCH) & !is.na(dataset9$age9)
        keep9 <- dataset9[sel, ]
        names(keep9)[names(keep9) == "MCH"] <- var
        names(keep9)[names(keep9) == "age9"] <- "age"
      
        dataset2 <- anti_join(dataset2, keep9)
        sel2 <- !is.na(dataset2$B766) & !is.na(dataset2$age2)
        keep2 <- dataset2[sel2, ]
        names(keep2)[names(keep2) == "B766"] <- var
        names(keep2)[names(keep2) == "age2"] <- "age"
      
        keep <- rbind(keep9, keep2)
      
        dataset1 <- anti_join(dataset1, keep)
        sel1 <-  !is.na(dataset1$A143) & !is.na(dataset1$age1)
        keep1 <- dataset1[sel1, ]
        names(keep1)[names(keep1) == "A143"] <- var
        names(keep1)[names(keep1) == "age1"] <- "age"
      
        # combine
        dataset <- rbind(keep, keep1)
      
        return(dataset)
      }
      ```
<a id="mch_entmass_rbc_1-fhs_omni1"></a>
  * ### blood_cell_count/mch_entmass_rbc_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227030.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
        source_data <- phen_list$source_data
      
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
         # mch_entmass_rbc units = pg (picograms) mean corpuscular hemoglobin
        dataset1$MCH <- as.numeric(dataset1$MCH)
        names(dataset1)[names(dataset1) %in% "MCH"] <- "mch_entmass_rbc"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mch_entmass_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="mch_entmass_rbc_1-hchs_sol"></a>
  * ### blood_cell_count/mch_entmass_rbc_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226305.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Mean corpuscular hemoglobin(MCH) (pg) and age at measurement
      
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(mch_entmass_rbc = as.numeric(LABA6),
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, mch_entmass_rbc) %>%
              filter(!is.na(age), !is.na(mch_entmass_rbc))
      
          return(dataset)
      }
      ```
<a id="mch_entmass_rbc_1-jhs"></a>
  * ### blood_cell_count/mch_entmass_rbc_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # mch_entmass_rbc  units = pg (picograms) mean corpuscular hemoglobin
        dataset1 <- source_data[["pht001959"]]
        dataset1$MCH <- as.numeric(dataset1$MCH)
        names(dataset1)[names(dataset1) %in% "MCH"] <- "mch_entmass_rbc"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mch_entmass_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="mch_entmass_rbc_1-mesa"></a>
  * ### blood_cell_count/mch_entmass_rbc_1 -- **MESA**:
    * 3 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218990.v1`, `phs000209.v13.pht004319.v1.phv00218993.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
        source_data <- phen_list$source_data
         # mch_entmass_rbc  units = pg (picograms) mean corpuscular hemoglobin
         # measured at exam 5
         # derive from hemoglobin and RBC since some given values are recording errors
        dataset1 <- source_data[["pht004319"]]
        dataset1$mch_entmass_rbc <- as.numeric(dataset1$hgb5) / as.numeric(dataset1$rbc5) * 10
      
        # age
        dataset2 <- source_data[["pht003091"]]
        dataset2$age5c <- as.numeric(dataset2$age5c)
        names(dataset2)[names(dataset2) %in% "age5c"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mch_entmass_rbc)
        dataset <- dataset[sel, ]
      
        # measurements are at Exam 5
        dataset <- dataset %>% select(c(topmed_subject_id, mch_entmass_rbc, age))
      
        return(dataset)
      }
      ```
<a id="mchc_mcnc_rbc_1"></a>
## blood_cell_count: **mchc_mcnc_rbc_1** (mchc_mcnc_rbc)
  Measurement of the mass concentration (mcnc) of hemoglobin in a given volume of packed red blood cells (rbc), known as mean corpuscular hemoglobin concentration (MCHC).
  * **Harmonization Units**:
    * [Amish](#mchc_mcnc_rbc_1-amish)
    * [ARIC](#mchc_mcnc_rbc_1-aric)
    * [CARDIA](#mchc_mcnc_rbc_1-cardia)
    * [CHS](#mchc_mcnc_rbc_1-chs)
    * [FHS_Gen3NOSOmni2](#mchc_mcnc_rbc_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#mchc_mcnc_rbc_1-fhs_offspring)
    * [FHS_Omni1](#mchc_mcnc_rbc_1-fhs_omni1)
    * [HCHS_SOL](#mchc_mcnc_rbc_1-hchs_sol)
    * [JHS](#mchc_mcnc_rbc_1-jhs)
    * [MESA](#mchc_mcnc_rbc_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: g /dL = grams per deciliter, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:25:04
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0944134
  * **DCC Harmonization Comments**:

    For studies which had no MCHC study component variable but hemoglobin and hematocrit study component variables were available, harmonized MCHC values were calculated using the formula:
    ```
    100 *  hemoglobin / hematocrit .
    ```
    If a study had MCHC, hemoglobin, and hematocrit component variables, the values of MCHC as provided by the study were used directly unless there were many missing values, in which case the harmonized MCHC values were calculated from hemoglobin and hematocrit using the above formula.  For most of the studies, MCHC values were calculated in this manner. The study-specific comments indicate for which studies the MCHC values as provided by the study were used directly. 
    
    For studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study. The values were first calculated as above using data from each visit and then a visit for a given subject was selected. 
    
    ### Study-specific comments
    
    #### FHS
    Only the Offspring subcohort had measurements at multiple visits (exams). For this subcohort, the measurement at the most recent exam available was chosen because more recent exams used more up-to-date procedures. 
    
    The values of MCHC as provided by the study were used directly for the harmonization.
    
    #### JHS
    The values of MCHC as provided by the study were used directly for the harmonization.
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    Because of missingness patterns across the visits, calculated values were used in order to maximize sample size.
    
    #### Amish
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    ### QC checks
    
    For studies with MCHC, hemoglobin, and hematocrit study component variables, the calculated values from hemoglobin and hematocrit were compared with the given values in the MCHC study component variable. There was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for hemoglobin, hematocrit, and MCHC may not be from the same visit.
    
<a id="mchc_mcnc_rbc_1-amish"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **Amish**:
    * 3 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253007.v1`, `phs000956.v2.pht005002.v1.phv00253008.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
         # MCHC = hemoglobin/hematocrit * 100
         #   units = g/dL  mean corpuscular hemoglobin concentration
         # no data given so derive trait
        source_data <- phen_list$source_data
        dataset <- source_data[["pht005002"]]
        dataset$hematocrit_baseline <- as.numeric(dataset$hematocrit_baseline)
        dataset$hemoglobin_baseline <- as.numeric(dataset$hemoglobin_baseline)
        dataset$mchc_mcnc_rbc <- dataset$hemoglobin_baseline / dataset$hematocrit_baseline * 100
        dataset$hematocrit_baseline <- NULL
        dataset$hemoglobin_baseline <- NULL
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)
        dataset <- dataset[sel, ]
      
       return(dataset)
      }
      ```
<a id="mchc_mcnc_rbc_1-aric"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **ARIC**:
    * 15 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004064.v2.phv00204871.v1`, `phs000280.v4.pht004065.v2.phv00204975.v1`, `phs000280.v4.pht004107.v2.phv00207255.v1`, `phs000280.v4.pht004107.v2.phv00207256.v1`, `phs000280.v4.pht004108.v2.phv00207270.v1`, `phs000280.v4.pht004108.v2.phv00207271.v1`, `phs000280.v4.pht004109.v2.phv00207288.v1`, `phs000280.v4.pht004109.v2.phv00207289.v1`, `phs000280.v4.pht004110.v2.phv00207300.v1`, `phs000280.v4.pht004110.v2.phv00207301.v1`, `phs000280.v4.pht006422.v1.phv00294956.v1`, `phs000280.v4.pht006422.v1.phv00294957.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # MCHC mean corpuscular hemoglobin concentration g/dL
          # to maximize sample size, will derive MCHC from hemoglogin and hematocrit
          # all visits have hemoglobin and hematocrit
      
          source_data <- phen_list$source_data
      
          # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.numeric(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.numeric(V2AGE22))
          dem3 <- phen_list$source_data[["pht004064"]] %>%
              mutate(visit = 3, age = as.numeric(V3AGE31))
          dem4 <- phen_list$source_data[["pht004065"]] %>%
              mutate(visit = 4, age = as.numeric(V4AGE41))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
      
          dem <- list(dem1, dem2, dem3, dem4, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
         # get data for hemoglobin and hematocrit, eliminate subjects with missing codes
         # derive MCHC = hemoglobin/hematocrit * 100
          blood1 <- source_data[["pht004107"]] %>%
              filter(!(HMTA02 %in% c("A", "O")) & !(HMTA01 %in% c("A", "O"))) %>%
              mutate(visit = 1, mchc_mcnc_rbc = as.numeric(HMTA02) / as.numeric(HMTA01) * 100)
          blood2 <- source_data[["pht004108"]] %>%
              filter(!(HMTB02 %in% c("A", "O")) & !(HMTB01 %in% c("A", "O"))) %>%
              mutate(visit = 2, mchc_mcnc_rbc = as.numeric(HMTB02) / as.numeric(HMTB01) * 100)
          blood3 <- source_data[["pht004109"]] %>%
              filter(!(HMTC4 %in% c("A", "O")) & !(HMTC5 %in% c("A", "O"))) %>%
              mutate(visit = 3, mchc_mcnc_rbc = as.numeric(HMTC4) / as.numeric(HMTC5) * 100)
          blood4 <- source_data[["pht004110"]] %>%
              filter(!(HMTC4 %in% c("A", "O")) & !(HMTC5 %in% c("A", "O"))) %>%
              mutate(visit = 4, mchc_mcnc_rbc = as.numeric(HMTC4) / as.numeric(HMTC5) * 100)
          blood5 <- source_data[["pht006422"]] %>%
              filter(!(CBC5 %in% c("A", "O")) & !(CBC6 %in% c("A", "O"))) %>%
              mutate(visit = 5, mchc_mcnc_rbc = as.numeric(CBC5) / as.numeric(CBC6) * 100)
      
          blood <- list(blood1, blood2, blood3, blood4, blood5)
          for (i in seq_along(blood)){
              blood[[i]] %<>%
                  tbl_df %>%
                  select(topmed_subject_id, visit, mchc_mcnc_rbc) %>%
                  na.omit()
          }
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, mchc_mcnc_rbc, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="mchc_mcnc_rbc_1-cardia"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **CARDIA**:
    * 3 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112688.v2`, `phs000285.v3.pht001563.v2.phv00112689.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Mean corpuscular hemoglobin concentration MCHC (g/dL)
          # not given but can derive from hemoglobin and hematocrit
          # MCHC = hemoglogin/hematocrit * 100
          # get variables, eliminate subjects with missing code "M", derive
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05HGB %in% "M") & !(A05HCT %in% "M")) %>%
              mutate(mchc_mcnc_rbc = as.numeric(A05HGB) / as.numeric(A05HCT) * 100)
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, mchc_mcnc_rbc, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="mchc_mcnc_rbc_1-chs"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **CHS**:
    * 3 component_study_variables: `phs000287.v6.pht001452.v1.phv00100412.v1`, `phs000287.v6.pht001452.v1.phv00100413.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Mean corpuscular hemoglobin concentration MCHC (g/dL)
          # not given but can be derived from hemoglobin and hematocrit
          # MCHC = hemoglobin/hematocrit * 100
          # get variables and derive
      
          dataset <- phen_list$source_data[["pht001452"]] %>%
               mutate(mchc_mcnc_rbc = as.numeric(HEMOGL23) / as.numeric(HEMATO23) * 100,
               age = as.integer(AGEBL)) %>%
               select(topmed_subject_id, age, mchc_mcnc_rbc) %>% na.omit
      
          return(dataset)
      }
      ```
<a id="mchc_mcnc_rbc_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172184.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
       # mchc_mcnc_rbc units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration
        dataset1 <- source_data[["pht002889"]]
        dataset1$MCHC <- as.numeric(dataset1$MCHC)
        names(dataset1)[names(dataset1) %in% "MCHC"] <- "mchc_mcnc_rbc"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="mchc_mcnc_rbc_1-fhs_offspring"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **FHS_Offspring**:
    * 7 component_study_variables: `phs000007.v29.pht000030.v7.phv00007646.v5`, `phs000007.v29.pht000031.v7.phv00008114.v5`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177932.v4`, `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227031.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # MCHC units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration
        var <- "mchc_mcnc_rbc"
      
        # Offspring exam 9
        dataset9 <- source_data[["pht004802"]]
        # subset to Offspring
        dataset9 <- dataset9[dataset9$IDTYPE %in% 1, ]
        dataset9$IDTYPE <- NULL
      
        dataset9$MCHC <- as.numeric(dataset9$MCHC)
      
        # Offspring exam 2
        dataset2 <- source_data[["pht000031"]]
        dataset2$B767 <- as.numeric(dataset2$B767)
      
        # Recode: g/L - recode to g/dL
        dataset2$B767 <- dataset2$B767 / 10
      
         # Offspring exam 1
        dataset1 <- source_data[["pht000030"]]
        dataset1$A144 <- as.numeric(dataset1$A144)
      
        # Recode: g/L - recode to g/dL
        dataset1$A144 <- dataset1$A144 / 10
      
        # ages
        dataseta <- source_data[["pht003099"]]
        dataseta$age9 <- as.numeric(dataseta$age9)
        dataseta$age2 <- as.numeric(dataseta$age2)
        dataseta$age1 <- as.numeric(dataseta$age1)
      
        # add appropriate ages to datasets
        dataset9 <- inner_join(dataset9, dataseta)
        dataset9$age2 <- NULL
        dataset9$age1 <- NULL
      
        dataset2 <- inner_join(dataset2, dataseta)
        dataset2$age9 <- NULL
        dataset2$age1 <- NULL
      
        dataset1 <- inner_join(dataset1, dataseta)
        dataset1$age9 <- NULL
        dataset1$age2 <- NULL
      
        sel <- !is.na(dataset9$MCHC) & !is.na(dataset9$age9)
        keep9 <- dataset9[sel, ]
        names(keep9)[names(keep9) == "MCHC"] <- var
        names(keep9)[names(keep9) == "age9"] <- "age"
      
        dataset2 <- anti_join(dataset2, keep9)
        sel2 <- !is.na(dataset2$B767) & !is.na(dataset2$age2)
        keep2 <- dataset2[sel2, ]
        names(keep2)[names(keep2) == "B767"] <- var
        names(keep2)[names(keep2) == "age2"] <- "age"
      
        keep <- rbind(keep9, keep2)
      
        dataset1 <- anti_join(dataset1, keep)
        sel1 <-  !is.na(dataset1$A144) & !is.na(dataset1$age1)
        keep1 <- dataset1[sel1, ]
        names(keep1)[names(keep1) == "A144"] <- var
        names(keep1)[names(keep1) == "age1"] <- "age"
      
        # combine
        dataset <- rbind(keep, keep1)
      
        return(dataset)
      }
      ```
<a id="mchc_mcnc_rbc_1-fhs_omni1"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227031.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
         # mchc_mcnc_rbc units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration
        dataset1$MCHC <- as.numeric(dataset1$MCHC)
        names(dataset1)[names(dataset1) %in% "MCHC"] <- "mchc_mcnc_rbc"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="mchc_mcnc_rbc_1-hchs_sol"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226306.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Mean corpuscular hemoglobin concentration (MCHC) (pg) and age at measurement
      
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(mchc_mcnc_rbc = as.numeric(LABA7),
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, mchc_mcnc_rbc) %>%
              filter(!is.na(age), !is.na(mchc_mcnc_rbc))
      
          return(dataset)
      }
      ```
<a id="mchc_mcnc_rbc_1-jhs"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127624.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # mchc_mcnc_rbc units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration
        dataset1 <- source_data[["pht001959"]]
        dataset1$MCHC <- as.numeric(dataset1$MCHC)
        names(dataset1)[names(dataset1) %in% "MCHC"] <- "mchc_mcnc_rbc"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="mchc_mcnc_rbc_1-mesa"></a>
  * ### blood_cell_count/mchc_mcnc_rbc_1 -- **MESA**:
    * 3 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218992.v1`, `phs000209.v13.pht004319.v1.phv00218993.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # mchc_mcnc_rbc  units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration
        # measured at exam 5
         # derive from hemoglobin and hematocrit
      
         dataset1 <- source_data[["pht004319"]]
        dataset1$mchc_mcnc_rbc <- as.numeric(dataset1$hgb5) / as.numeric(dataset1$hct5) * 100
      
        # age
        dataset2 <- source_data[["pht003091"]]
        dataset2$age5c <- as.numeric(dataset2$age5c)
        names(dataset2)[names(dataset2) %in% "age5c"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)
        dataset <- dataset[sel, ]
      
        dataset <- dataset %>% select(c(topmed_subject_id, mchc_mcnc_rbc, age))
      
        return(dataset)
      }
      ```
<a id="mcv_entvol_rbc_1"></a>
## blood_cell_count: **mcv_entvol_rbc_1** (mcv_entvol_rbc)
  Measurement of the average volume (entvol) of red blood cells (rbc), known as mean corpuscular volume (MCV).
  * **Harmonization Units**:
    * [Amish](#mcv_entvol_rbc_1-amish)
    * [ARIC](#mcv_entvol_rbc_1-aric)
    * [CARDIA](#mcv_entvol_rbc_1-cardia)
    * [FHS_Gen3NOSOmni2](#mcv_entvol_rbc_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#mcv_entvol_rbc_1-fhs_offspring)
    * [FHS_Omni1](#mcv_entvol_rbc_1-fhs_omni1)
    * [HCHS_SOL](#mcv_entvol_rbc_1-hchs_sol)
    * [JHS](#mcv_entvol_rbc_1-jhs)
    * [MESA](#mcv_entvol_rbc_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: fL = femtoliter, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:24:45
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C1114281
  * **DCC Harmonization Comments**:

    For most studies, the values of mean corpuscular volume (MCV) as provided by the study were used directly. When a study did not provide a variable for MCV, harmonized MCV values were derived from hematocrit and red blood cell count study component variables, if available, using the formula:
    ```
    10 * hematocrit / red blood cell count .
    ```
    For studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study. 
    
    ### Study-specific comments
    
    #### FHS
    Only the Offspring subcohort had measurements at multiple visits (exams). For this subcohort, the measurement at the most recent exam available was chosen because more recent exams used more up-to-date procedures. 
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### Amish
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    ### QC checks
    
    For studies with MCV, hematocrit, and red blood cell count study component variables, the calculated values from hematocrit and red blood cell count were compared with the given values in the MCV study component variable.
    
    For *_MESA_*, this QC detected apparent recording errors in some MCV values and led to the decision to use calculated values.
    
    For other studies, there was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for hematocrit, red blood cell count, and MCV may not be from the same visit.
    
<a id="mcv_entvol_rbc_1-amish"></a>
  * ### blood_cell_count/mcv_entvol_rbc_1 -- **Amish**:
    * 3 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253008.v1`, `phs000956.v2.pht005002.v1.phv00253010.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
         library(dplyr)
        source_data <- phen_list$source_data
         # MCV = hematocrit/RBC * 10 units=fL femtoliter mean corpuscular volume
         # data not given so derive
        dataset <- source_data[["pht005002"]]
        dataset$red_blood_cell_count_baseline <- as.numeric(dataset$red_blood_cell_count_baseline)
        dataset$hematocrit_baseline <- as.numeric(dataset$hematocrit_baseline)
        dataset <- dataset %>%
          mutate(mcv_entvol_rbc = hematocrit_baseline / red_blood_cell_count_baseline * 10)
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        dataset <- dataset %>% filter(!is.na(age) & !is.na(mcv_entvol_rbc)) %>%
          select(topmed_subject_id, mcv_entvol_rbc, age)
      
        return(dataset)
      }
      ```
<a id="mcv_entvol_rbc_1-aric"></a>
  * ### blood_cell_count/mcv_entvol_rbc_1 -- **ARIC**:
    * 8 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004064.v2.phv00204871.v1`, `phs000280.v4.pht004065.v2.phv00204975.v1`, `phs000280.v4.pht004108.v2.phv00207282.v1`, `phs000280.v4.pht004109.v2.phv00207293.v1`, `phs000280.v4.pht004110.v2.phv00207305.v1`, `phs000280.v4.pht006422.v1.phv00294959.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Mean corpuscular volume MCV (fl) - measured at visits 2, 3, 4, and 5
          # Age at visit
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.numeric(V2AGE22))
          dem3 <- phen_list$source_data[["pht004064"]] %>%
              mutate(visit = 3, age = as.numeric(V3AGE31))
          dem4 <- phen_list$source_data[["pht004065"]] %>%
              mutate(visit = 4, age = as.numeric(V4AGE41))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
      
          dem <- list(dem2, dem3, dem4, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # get MCV data for each visit, eliminate subjects with missing codes
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB13 %in% c("A", "O")) ) %>%
              mutate(visit = 2, mcv_entvol_rbc = as.numeric(HMTB13))
          blood3 <- phen_list$source_data[["pht004109"]] %>%
              filter(!(HMTC6 %in% c("A", "O")) ) %>%
              mutate(visit = 3, mcv_entvol_rbc = as.numeric(HMTC6))
          blood4 <- phen_list$source_data[["pht004110"]] %>%
              filter(!(HMTC6 %in% c("A", "O")) ) %>%
              mutate(visit = 4, mcv_entvol_rbc = as.numeric(HMTC6))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC8 %in% c("A", "O")) ) %>%
              mutate(visit = 5, mcv_entvol_rbc = as.numeric(CBC8))
      
          blood <- list(blood2, blood3, blood4, blood5) %>%
              lapply(select, topmed_subject_id, visit, mcv_entvol_rbc) %>%
              lapply(na.omit)
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, mcv_entvol_rbc, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="mcv_entvol_rbc_1-cardia"></a>
  * ### blood_cell_count/mcv_entvol_rbc_1 -- **CARDIA**:
    * 3 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112687.v2`, `phs000285.v3.pht001563.v2.phv00112689.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Mean corpuscular volume MCH (fL)
          # not given but can derive from hematocrit and red blood cell count (RBC)
          # MCV = hematocrit/RBC * 10
          # get variables, eliminate subjects with missing code "M", derive
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05HCT %in% "M") & !(A05RBC %in% "M")) %>%
              mutate(mcv_entvol_rbc = as.numeric(A05HCT) / as.numeric(A05RBC) * 10)
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, mcv_entvol_rbc, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="mcv_entvol_rbc_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/mcv_entvol_rbc_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172182.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # mcv_entvol_rbc  units=fL femtoliter mean corpuscular volume
        dataset1 <- source_data[["pht002889"]]
        dataset1$MCV <- as.numeric(dataset1$MCV)
        names(dataset1)[names(dataset1) %in% "MCV"] <- "mcv_entvol_rbc"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mcv_entvol_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="mcv_entvol_rbc_1-fhs_offspring"></a>
  * ### blood_cell_count/mcv_entvol_rbc_1 -- **FHS_Offspring**:
    * 7 component_study_variables: `phs000007.v29.pht000030.v7.phv00007644.v5`, `phs000007.v29.pht000031.v7.phv00008112.v5`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177932.v4`, `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227029.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
        source_data <- phen_list$source_data
      
         # MCV units=fL femtoliter mean corpuscular volume
        var <- "mcv_entvol_rbc"
      
        # Offspring exam 9
        dataset9 <- source_data[["pht004802"]]
        # subset to Offspring
        dataset9 <- dataset9[dataset9$IDTYPE %in% 1, ]
        dataset9$IDTYPE <- NULL
      
        dataset9$MCV <- as.numeric(dataset9$MCV)
      
        # Offspring exam 2
        dataset2 <- source_data[["pht000031"]]
        dataset2$B765 <- as.numeric(dataset2$B765)
      
         # Offspring exam 1
        dataset1 <- source_data[["pht000030"]]
        dataset1$A142 <- as.numeric(dataset1$A142)
      
        # ages
        dataseta <- source_data[["pht003099"]]
        dataseta$age9 <- as.numeric(dataseta$age9)
        dataseta$age2 <- as.numeric(dataseta$age2)
        dataseta$age1 <- as.numeric(dataseta$age1)
      
        # add appropriate ages to datasets
        dataset9 <- inner_join(dataset9, dataseta)
        dataset9$age2 <- NULL
        dataset9$age1 <- NULL
      
        dataset2 <- inner_join(dataset2, dataseta)
        dataset2$age9 <- NULL
        dataset2$age1 <- NULL
      
        dataset1 <- inner_join(dataset1, dataseta)
        dataset1$age9 <- NULL
        dataset1$age2 <- NULL
      
        sel <- !is.na(dataset9$MCV) & !is.na(dataset9$age9)
        keep9 <- dataset9[sel, ]
        names(keep9)[names(keep9) == "MCV"] <- var
        names(keep9)[names(keep9) == "age9"] <- "age"
      
        dataset2 <- anti_join(dataset2, keep9)
        sel2 <- !is.na(dataset2$B765) & !is.na(dataset2$age2)
        keep2 <- dataset2[sel2, ]
        names(keep2)[names(keep2) == "B765"] <- var
        names(keep2)[names(keep2) == "age2"] <- "age"
      
        keep <- rbind(keep9, keep2)
      
        dataset1 <- anti_join(dataset1, keep)
        sel1 <-  !is.na(dataset1$A142) & !is.na(dataset1$age1)
        keep1 <- dataset1[sel1, ]
        names(keep1)[names(keep1) == "A142"] <- var
        names(keep1)[names(keep1) == "age1"] <- "age"
      
        # combine
        dataset <- rbind(keep, keep1)
      
        return(dataset)
      }
      ```
<a id="mcv_entvol_rbc_1-fhs_omni1"></a>
  * ### blood_cell_count/mcv_entvol_rbc_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227029.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
         # mcv_entvol_rbc units=fL femtoliter mean corpuscular volume
        dataset1$MCV <- as.numeric(dataset1$MCV)
        names(dataset1)[names(dataset1) %in% "MCV"] <- "mcv_entvol_rbc"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mcv_entvol_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="mcv_entvol_rbc_1-hchs_sol"></a>
  * ### blood_cell_count/mcv_entvol_rbc_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226304.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Mean corpuscular volume (MCV) (fl) and age at measurement
      
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(mcv_entvol_rbc = as.numeric(LABA5),
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, mcv_entvol_rbc) %>%
              filter(!is.na(age), !is.na(mcv_entvol_rbc))
      
          return(dataset)
      }
      ```
<a id="mcv_entvol_rbc_1-jhs"></a>
  * ### blood_cell_count/mcv_entvol_rbc_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127625.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
         source_data <- phen_list$source_data
         # mcv_entvol_rbc units=fL femtoliter mean corpuscular volume
        dataset1 <- source_data[["pht001959"]]
        dataset1$MCV <- as.numeric(dataset1$MCV)
        names(dataset1)[names(dataset1) %in% "MCV"] <- "mcv_entvol_rbc"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mcv_entvol_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="mcv_entvol_rbc_1-mesa"></a>
  * ### blood_cell_count/mcv_entvol_rbc_1 -- **MESA**:
    * 3 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218990.v1`, `phs000209.v13.pht004319.v1.phv00218992.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
      
         # mcv_entvol_rbc  units = fL (femtoliter) mean corpuscular volume
         # measured at exam 5
         # derive from hemoglobin and RBC since some given values are recording errors
      
        dataset1 <- source_data[["pht004319"]]
        dataset1$mcv_entvol_rbc <- as.numeric(dataset1$hct5) / as.numeric(dataset1$rbc5) * 10
      
        # age
        dataset2 <- source_data[["pht003091"]]
        dataset2$age5c <- as.numeric(dataset2$age5c)
        names(dataset2)[names(dataset2) %in% "age5c"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$mcv_entvol_rbc)
        dataset <- dataset[sel, ]
      
        dataset <- dataset %>% select(c(topmed_subject_id, mcv_entvol_rbc, age))
      
        return(dataset)
      }
      ```
<a id="monocyte_ncnc_bld_1"></a>
## blood_cell_count: **monocyte_ncnc_bld_1** (monocyte_ncnc_bld)
  Count by volume, or number concentration (ncnc), of monocytes in the blood (bld).
  * **Harmonization Units**:
    * [Amish](#monocyte_ncnc_bld_1-amish)
    * [ARIC](#monocyte_ncnc_bld_1-aric)
    * [CARDIA](#monocyte_ncnc_bld_1-cardia)
    * [FHS_Gen3NOSOmni2](#monocyte_ncnc_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#monocyte_ncnc_bld_1-fhs_offspring)
    * [FHS_Omni1](#monocyte_ncnc_bld_1-fhs_omni1)
    * [HCHS_SOL](#monocyte_ncnc_bld_1-hchs_sol)
    * [JHS](#monocyte_ncnc_bld_1-jhs)
    * [MESA](#monocyte_ncnc_bld_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: thousands / microliter, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:23:28
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0942446
  * **DCC Harmonization Comments**:

    When possible, monocyte count was derived from percentage (%) of monocytes in the total white blood cell count (WBC) , using the formula
    ```
    white blood cell count * % monocytes / 100.
    ```
    This choice minimizes discretizing round-off effects which can lead to multi-modal distributions. Otherwise, if percentage was not available, the value of monocyte count as provided by the study was used directly.
    
    For studies or cohorts with measurements at more than one visit, in order to maximize sample 
    size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.  The counts were first derived as above using data from each visit and then a visit for a given subject was selected. 
    
    ### Study-specific comments
    
    #### Amish
    Because percentage data was not available, harmonization used given count values from a study component variable rescaled to appropriate harmonized units.
    
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### MESA
    Because percentage data was not available, harmonization used given count values from a study component variable. 
    
    ### QC checks
    For each subject, the sum of the WBC subtype differential counts (percentages) was compared to the total white blood cell count (100%) . 
    
    For *_FHS_* Offspring, this QC led to the discovery of anomalies (unusual number of values recorded as 0) in the data at Exam 2 for the WBC subtype differentials. After communication with *_FHS_*, the decision was made to not use the Exam 2 data. 
    
    For other studies, there was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for WBC, monocytes, and other WBC subtype differentials may not be from the same visit, so the harmonized subtype differential counts may not sum to the WBC count.
    
<a id="monocyte_ncnc_bld_1-amish"></a>
  * ### blood_cell_count/monocyte_ncnc_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253012.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
        source_data <- phen_list$source_data
         # monocyte_ncnc_bld units in cells/microliter - we want thousands/microliter - 10^9 cells/liter
        dataset <- source_data[["pht005002"]]
        dataset$monocytes_baseline <- as.numeric(dataset$monocytes_baseline)
        names(dataset)[names(dataset) %in% "monocytes_baseline"] <- "monocyte_ncnc_bld"
        dataset$monocyte_ncnc_bld <- dataset$monocyte_ncnc_bld / 1000
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$monocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="monocyte_ncnc_bld_1-aric"></a>
  * ### blood_cell_count/monocyte_ncnc_bld_1 -- **ARIC**:
    * 9 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004107.v2.phv00207257.v1`, `phs000280.v4.pht004107.v2.phv00207262.v1`, `phs000280.v4.pht004108.v2.phv00207272.v1`, `phs000280.v4.pht004108.v2.phv00207277.v1`, `phs000280.v4.pht006422.v1.phv00294954.v1`, `phs000280.v4.pht006422.v1.phv00294965.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Monocyte, converted from % leukocytes to count of thousands/microliter
          # Study component variables available only in visits 1, 2, and 5
      
          # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.integer(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.integer(V2AGE22))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
          dem <- list(dem1, dem2, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # obtain monocyte % and WBC data, eliminate subjects with missing codes
          blood1 <- phen_list$source_data[["pht004107"]] %>%
              filter(!(HMTA08 %in% c("A", "O")) & !(HMTA03 %in% c("A", "O"))) %>%
              mutate(visit = 1,
                  monocyte_ncnc_bld = as.numeric(HMTA08),
                  wbc_ncnc_bld = as.numeric(HMTA03))
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB08 %in% c("A", "O")) & !(HMTB03 %in% c("A", "O"))) %>%
              mutate(visit = 2,
                  monocyte_ncnc_bld = as.numeric(HMTB08),
                  wbc_ncnc_bld = as.numeric(HMTB03))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC14 %in% c("A", "O")) & !(CBC3 %in% c("A", "O"))) %>%
              mutate(visit = 5,
                  monocyte_ncnc_bld = as.numeric(CBC14),
                  wbc_ncnc_bld = as.numeric(CBC3))
      
          blood <- list(blood1, blood2, blood5)
          for (i in seq_along(blood)){
              blood[[i]] %<>%
                  tbl_df() %>%
                  select(topmed_subject_id, visit, monocyte_ncnc_bld, wbc_ncnc_bld) %>%
                  na.omit() %>%
                  mutate(monocyte_ncnc_bld = monocyte_ncnc_bld * wbc_ncnc_bld / 100) %>%
                  select(-wbc_ncnc_bld)
          }
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, monocyte_ncnc_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="monocyte_ncnc_bld_1-cardia"></a>
  * ### blood_cell_count/monocyte_ncnc_bld_1 -- **CARDIA**:
    * 3 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112686.v2`, `phs000285.v3.pht001563.v2.phv00112692.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Monocyte count at Exam 1 (thousands/microliter)
          # eliminate subjects with missing code "M"
          # derive count from total WBC (A05WBC) and % monocytes (A05MONO)
      
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05MONO %in% "M") & !(A05WBC %in% "M")) %>%
              mutate(monocyte_ncnc_bld = as.numeric(A05WBC) * as.numeric(A05MONO) / 100)
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, monocyte_ncnc_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="monocyte_ncnc_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/monocyte_ncnc_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 3 component_study_variables: `phs000007.v29.pht002889.v2.phv00172178.v2`, `phs000007.v29.pht002889.v2.phv00172190.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # monocyte
        dataset1 <- source_data[["pht002889"]]
        dataset1$MO_PER <- as.numeric(dataset1$MO_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$monocyte_ncnc_bld <- dataset1$WBC * dataset1$MO_PER / 100
        dataset1$MO_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$monocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="monocyte_ncnc_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/monocyte_ncnc_bld_1 -- **FHS_Offspring**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227037.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
         source_data <- phen_list$source_data
         # monocyte
        dataset1 <- source_data[["pht004802"]]
          # subset to Offspring
        dataset1 <- dataset1[dataset1$IDTYPE %in% 1, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$MO_PER <- as.numeric(dataset1$MO_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$monocyte_ncnc_bld <- dataset1$WBC * dataset1$MO_PER / 100
        dataset1$MO_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age9 <- as.numeric(dataset2$age9)
        names(dataset2)[names(dataset2) %in% "age9"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$monocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="monocyte_ncnc_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/monocyte_ncnc_bld_1 -- **FHS_Omni1**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227037.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # monocyte
        dataset1 <- source_data[["pht004802"]]
          # subset to Omni1
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$MO_PER <- as.numeric(dataset1$MO_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$monocyte_ncnc_bld <- dataset1$WBC * dataset1$MO_PER / 100
        dataset1$MO_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$monocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="monocyte_ncnc_bld_1-hchs_sol"></a>
  * ### blood_cell_count/monocyte_ncnc_bld_1 -- **HCHS_SOL**:
    * 3 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226283.v1`, `phs000810.v1.pht004715.v1.phv00226286.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Monocytes (thousands/microliter) and age at measurement
          # derive count from total WBC (LABA1) and % monocytes (LABA12)
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(monocyte_ncnc_bld = as.numeric(LABA1) * as.numeric(LABA12) / 100,
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, monocyte_ncnc_bld) %>%
              filter(!is.na(age), !is.na(monocyte_ncnc_bld))
      
          return(dataset)
      }
      ```
<a id="monocyte_ncnc_bld_1-jhs"></a>
  * ### blood_cell_count/monocyte_ncnc_bld_1 -- **JHS**:
    * 3 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127626.v1`, `phs000286.v5.pht001959.v1.phv00127631.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # monocyte_count
        dataset1 <- source_data[["pht001959"]]
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$MONOS <- as.numeric(dataset1$MONOS)
        sel <- !is.na(dataset1$WBC) & !is.na(dataset1$MONOS)
        dataset1 <- dataset1[sel, ]
        dataset1$monocyte_ncnc_bld <- dataset1$WBC * dataset1$MONOS / 100
        dataset1$WBC <- NULL
        dataset1$MONOS <- NULL
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$monocyte_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="monocyte_ncnc_bld_1-mesa"></a>
  * ### blood_cell_count/monocyte_ncnc_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00219000.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              tbl_df %>%
              transmute(topmed_subject_id, age = as.integer(age5c))
      
          # Monocytes (cells x 10^3/uL of blood)
          wbc <- phen_list$source_data[["pht004319"]] %>%
              tbl_df %>%
              mutate(monocyte_ncnc_bld = as.numeric(monosa5)) %>%
              select(topmed_subject_id, monocyte_ncnc_bld)
      
          dataset <- inner_join(dataset_dem, wbc, by = "topmed_subject_id") %>%
              na.omit()
      
          return(dataset)
      }
      ```
<a id="neutrophil_ncnc_bld_1"></a>
## blood_cell_count: **neutrophil_ncnc_bld_1** (neutrophil_ncnc_bld)
  Count by volume, or number concentration (ncnc), of neutrophils in the blood (bld).
  * **Harmonization Units**:
    * [Amish](#neutrophil_ncnc_bld_1-amish)
    * [ARIC](#neutrophil_ncnc_bld_1-aric)
    * [CARDIA](#neutrophil_ncnc_bld_1-cardia)
    * [FHS_Gen3NOSOmni2](#neutrophil_ncnc_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#neutrophil_ncnc_bld_1-fhs_offspring)
    * [FHS_Omni1](#neutrophil_ncnc_bld_1-fhs_omni1)
    * [HCHS_SOL](#neutrophil_ncnc_bld_1-hchs_sol)
    * [JHS](#neutrophil_ncnc_bld_1-jhs)
    * [MESA](#neutrophil_ncnc_bld_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: thousands / microliter, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:23:48
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0942461
  * **DCC Harmonization Comments**:

    When possible, neutrophil count was derived from percentage (%) of neutrophils in the total white blood cell count (WBC), using the formula
    ```
    white blood cell count * % neutrophils / 100.
    ```
    This choice minimizes discretizing round-off effects, which can lead to multi-modal distributions. Otherwise, if percentage was not available, the value of neutrophil count as provided by the study was used directly. For some studies (as indicated below), the total neutrophil percentage was first calculated by adding multiple study component variables representing different types of neutrophils, treating missing values as 0 when at least one of the study component variables was non-missing.
    
    For studies or cohorts with measurements at more than one visit, in order to maximize sample 
    size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.  The counts were first derived as above using data from each visit and then a visit for a given subject was selected. 
    
    ### Study-specific comments
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession.  Total neutrophil percentage was first calculated from the sum of component study variables representing different types of neutrophils for each visit before visit selection occurred.
    
    #### Amish
    Because percentage data were not available, harmonization used given count values from a study component variable rescaled to the appropriate harmonized units.
    
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    #### CARDIA
    Total neutrophil percentage was first calculated from the sum of component study variables representing different types of neutrophils. 
    
    #### JHS
    Total neutrophil percentage was first calculated from the sum of component study variables representing different types of neutrophils.
    
    #### MESA
    Because percentage data were not available, harmonization used given count values from a study component variable.
    
    ### QC checks
    For each subject, the sum of the WBC subtype differential counts (percentages) was compared to the total white blood cell count (100%) . 
    
    For *_FHS_* Offspring, this QC led to the discovery of anomalies (unusual number of values recorded as 0) in the data at Exam 2 for the WBC subtype differentials. After communication with *_FHS_*, the decision was made to not use the Exam 2 data. 
    
    For other studies, there was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for WBC, neutrophils, and other WBC subtype differentials may not be from the same visit, so the harmonized subtype differential counts may not sum to the WBC count.
    
<a id="neutrophil_ncnc_bld_1-amish"></a>
  * ### blood_cell_count/neutrophil_ncnc_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253011.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
        source_data <- phen_list$source_data
         # neutrophil_ncnc_bld units in cells/microliter - we want thousands/microliter - 10^9 cells/liter
        dataset <- source_data[["pht005002"]]
        dataset$neutrophils_baseline <- as.numeric(dataset$neutrophils_baseline)
        names(dataset)[names(dataset) %in% "neutrophils_baseline"] <- "neutrophil_ncnc_bld"
        dataset$neutrophil_ncnc_bld <- dataset$neutrophil_ncnc_bld / 1000
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$neutrophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="neutrophil_ncnc_bld_1-aric"></a>
  * ### blood_cell_count/neutrophil_ncnc_bld_1 -- **ARIC**:
    * 8 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004107.v2.phv00207257.v1`, `phs000280.v4.pht004107.v2.phv00207259.v1`, `phs000280.v4.pht004107.v2.phv00207260.v1`, `phs000280.v4.pht004108.v2.phv00207272.v1`, `phs000280.v4.pht004108.v2.phv00207274.v1`, `phs000280.v4.pht004108.v2.phv00207275.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
        # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.integer(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.integer(V2AGE22))
      
          dem <- list(dem1, dem2) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
        # Combine Neutrophils and bands, convert from % of leukocytes to count of thousands/microliter
        # Obtain neutrophil data and eliminate subjects with missing codes
          blood1 <- phen_list$source_data[["pht004107"]] %>%
              filter(!(HMTA05 %in% c("A", "O")) &  !(HMTA06 %in% c("A", "O"))) %>%
              filter(!(HMTA03 %in% c("A", "O"))) %>%
              mutate(visit = 1,
                  neutrophil_ncnc_bld = as.numeric(HMTA05),
                  bands = as.numeric(HMTA06),
                  wbc_ncnc_bld = as.numeric(HMTA03))
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB05 %in% c("A", "O")) &  !(HMTB06 %in% c("A", "O"))) %>%
              filter(!(HMTB03 %in% c("A", "O"))) %>%
              mutate(visit = 2,
                  neutrophil_ncnc_bld = as.numeric(HMTB05),
                  bands = as.numeric(HMTB06),
                  wbc_ncnc_bld = as.numeric(HMTB03))
      
          blood <- list(blood1, blood2)
          for (i in seq_along(blood)){
              # Add neutrophil and neutrophil bands for harmonized count of neutrophil cells.
              # Treat NAs as zero for summing.
              blood[[i]]$bands[is.na(blood[[i]]$bands)] <- 0
              blood[[i]] %<>%
                  tbl_df() %>%
                  mutate(neutrophil_ncnc_bld = (neutrophil_ncnc_bld + bands) * wbc_ncnc_bld / 100) %>%
                  select(topmed_subject_id, visit, neutrophil_ncnc_bld) %>%
                  na.omit()
          }
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
         # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, neutrophil_ncnc_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="neutrophil_ncnc_bld_1-cardia"></a>
  * ### blood_cell_count/neutrophil_ncnc_bld_1 -- **CARDIA**:
    * 6 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112686.v2`, `phs000285.v3.pht001563.v2.phv00112694.v2`, `phs000285.v3.pht001563.v2.phv00112695.v2`, `phs000285.v3.pht001563.v2.phv00112697.v2`, `phs000285.v3.pht001563.v2.phv00112698.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Neutrophil count at Exam 1 (thousands/microliter)
          # Naming of neutrophils varied across recordings - neutrophil, bands, segs, granulocyte
          #   first replace missing "M" with NA and make variables numeric
          dat2 <- phen_list$source_data[["pht001563"]]
          vars <- c("A05NEUTR", "A05BANDS", "A05SEGS", "A05GRAN")
          for (v in vars){
            sel <- dat2[, v] %in% "M"
            dat2[sel, v] <- NA
            dat2[, v] <- as.numeric(dat2[, v])
          }
      
          # exclude subjects if have missing values for all types
          dat2 <- dat2 %>% filter(!(is.na(A05NEUTR) & is.na(A05BANDS) & is.na(A05SEGS) & is.na(A05GRAN)))
      
          # Find total % of neutrophils (add up excluding NA)
          dat2$NEUTR <- rowSums(dat2[, vars], na.rm = TRUE)
      
          # derive count from total WBC (A05WBC) and % neutrophils (NEUTR)
      
          dat2 <- dat2 %>%
              mutate(neutrophil_ncnc_bld = as.numeric(A05WBC) * as.numeric(NEUTR) / 100)
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, neutrophil_ncnc_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="neutrophil_ncnc_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/neutrophil_ncnc_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 3 component_study_variables: `phs000007.v29.pht002889.v2.phv00172178.v2`, `phs000007.v29.pht002889.v2.phv00172188.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # neutrophil
        dataset1 <- source_data[["pht002889"]]
        dataset1$NE_PER <- as.numeric(dataset1$NE_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$neutrophil_ncnc_bld <- dataset1$WBC * dataset1$NE_PER / 100
        dataset1$NE_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$neutrophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="neutrophil_ncnc_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/neutrophil_ncnc_bld_1 -- **FHS_Offspring**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227035.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # neutrophil
        dataset1 <- source_data[["pht004802"]]
          # subset to Offspring
        dataset1 <- dataset1[dataset1$IDTYPE %in% 1, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$NE_PER <- as.numeric(dataset1$NE_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$neutrophil_ncnc_bld <- dataset1$WBC * dataset1$NE_PER / 100
        dataset1$NE_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age9 <- as.numeric(dataset2$age9)
        names(dataset2)[names(dataset2) %in% "age9"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$neutrophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="neutrophil_ncnc_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/neutrophil_ncnc_bld_1 -- **FHS_Omni1**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`, `phs000007.v29.pht004802.v1.phv00227035.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # neutrophil
        dataset1 <- source_data[["pht004802"]]
          # subset to Omni1
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$NE_PER <- as.numeric(dataset1$NE_PER)
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$neutrophil_ncnc_bld <- dataset1$WBC * dataset1$NE_PER / 100
        dataset1$NE_PER <- NULL
        dataset1$WBC <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$neutrophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="neutrophil_ncnc_bld_1-hchs_sol"></a>
  * ### blood_cell_count/neutrophil_ncnc_bld_1 -- **HCHS_SOL**:
    * 3 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226283.v1`, `phs000810.v1.pht004715.v1.phv00226284.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Neutrophils (thousands/microliter) and age at measurement
          # derive count from total WBC (LABA1) and % neutrophils (LABA10)
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(neutrophil_ncnc_bld = as.numeric(LABA1) * as.numeric(LABA10) / 100,
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, neutrophil_ncnc_bld) %>%
              filter(!is.na(age), !is.na(neutrophil_ncnc_bld))
      
          return(dataset)
      }
      ```
<a id="neutrophil_ncnc_bld_1-jhs"></a>
  * ### blood_cell_count/neutrophil_ncnc_bld_1 -- **JHS**:
    * 4 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127630.v1`, `phs000286.v5.pht001959.v1.phv00127631.v1`, `phs000286.v5.pht001959.v1.phv00127632.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
         library("dplyr")
      
         source_data <- phen_list$source_data
        # neutrophil_count
        dataset1 <- source_data[["pht001959"]]
        dataset1$WBC <- as.numeric(dataset1$WBC)
        dataset1$BANDS <- as.numeric(dataset1$BANDS)
        dataset1$SEGS <- as.numeric(dataset1$SEGS)
      
        sel <- !is.na(dataset1$WBC) &  !is.na(dataset1$SEGS)
        dataset1 <- dataset1[sel, ]
        # treat missing BANDS as 0 for adding to SEGS
        dataset1$BANDS[is.na(dataset1$BANDS)] <- 0
        dataset1$neutrophil_ncnc_bld <- dataset1$WBC * (dataset1$SEGS + dataset1$BANDS) / 100
        dataset1$WBC <- NULL
        dataset1$BANDS <- NULL
        dataset1$SEGS <- NULL
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$neutrophil_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="neutrophil_ncnc_bld_1-mesa"></a>
  * ### blood_cell_count/neutrophil_ncnc_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218999.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              tbl_df %>%
              transmute(topmed_subject_id, age = as.integer(age5c))
      
          # Neutrophils (cells x 10^3/uL of blood)
          wbc <- phen_list$source_data[["pht004319"]] %>%
              tbl_df %>%
              mutate(neutrophil_ncnc_bld = as.numeric(polysa5)) %>%
              select(topmed_subject_id, neutrophil_ncnc_bld) %>%
              filter(complete.cases(.))
      
          dataset <- inner_join(dataset_dem, wbc, by = "topmed_subject_id") %>%
              na.omit()
      
          return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1"></a>
## blood_cell_count: **platelet_ncnc_bld_1** (platelet_ncnc_bld)
  Count by volume, or number concentration (ncnc), of platelets in the blood (bld).
  * **Harmonization Units**:
    * [Amish](#platelet_ncnc_bld_1-amish)
    * [ARIC](#platelet_ncnc_bld_1-aric)
    * [CARDIA](#platelet_ncnc_bld_1-cardia)
    * [CHS](#platelet_ncnc_bld_1-chs)
    * [FHS_Gen3NOSOmni2](#platelet_ncnc_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#platelet_ncnc_bld_1-fhs_offspring)
    * [FHS_Omni1](#platelet_ncnc_bld_1-fhs_omni1)
    * [HCHS_SOL](#platelet_ncnc_bld_1-hchs_sol)
    * [JHS](#platelet_ncnc_bld_1-jhs)
    * [MESA](#platelet_ncnc_bld_1-mesa)
    * [WHI](#platelet_ncnc_bld_1-whi)
  * **Metadata**:
    **`Data Type`**: integer, **`Measurement Units`**: thousands / microliter, **`Version`**: 4, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:28:37
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0942474
  * **DCC Harmonization Comments**:

    For studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.
    
    ### Study-specific comments
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### Amish
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    ### QC checks
    
    Analysts should carefully examine distributions of the *_WHI_* platelet values. There is at least one extreme outlier.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. 
    
<a id="platelet_ncnc_bld_1-amish"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253009.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
         source_data <- phen_list$source_data
         # platelet_ncnc_bld units already thousands/microliter
        dataset <- source_data[["pht005002"]]
        dataset$platelet_count_baseline <- as.integer(dataset$platelet_count_baseline)
        names(dataset)[names(dataset) %in% "platelet_count_baseline"] <- "platelet_ncnc_bld"
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$platelet_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1-aric"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **ARIC**:
    * 10 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004064.v2.phv00204871.v1`, `phs000280.v4.pht004065.v2.phv00204975.v1`, `phs000280.v4.pht004107.v2.phv00207258.v1`, `phs000280.v4.pht004108.v2.phv00207273.v1`, `phs000280.v4.pht004109.v2.phv00207294.v1`, `phs000280.v4.pht004110.v2.phv00207306.v1`, `phs000280.v4.pht006422.v1.phv00294958.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.numeric(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.numeric(V2AGE22))
          dem3 <- phen_list$source_data[["pht004064"]] %>%
              mutate(visit = 3, age = as.numeric(V3AGE31))
          dem4 <- phen_list$source_data[["pht004065"]] %>%
              mutate(visit = 4, age = as.numeric(V4AGE41))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
      
          dem <- list(dem1, dem2, dem3, dem4, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # Platelet count (thousands/microliter)
          # get platelet data for each visit, eliminate subjects with missing codes
          blood1 <- phen_list$source_data[["pht004107"]] %>%
              filter(!(HMTA04 %in% c("A", "O")) ) %>%
              mutate(visit = 1, platelet_ncnc_bld = as.numeric(HMTA04))
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB04 %in% c("A", "O")) ) %>%
              mutate(visit = 2, platelet_ncnc_bld = as.numeric(HMTB04))
          blood3 <- phen_list$source_data[["pht004109"]] %>%
              filter(!(HMTC10 %in% c("A", "O")) ) %>%
              mutate(visit = 3, platelet_ncnc_bld = as.numeric(HMTC10))
          blood4 <- phen_list$source_data[["pht004110"]] %>%
              filter(!(HMTC10 %in% c("A", "O")) ) %>%
              mutate(visit = 4, platelet_ncnc_bld = as.numeric(HMTC10))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC7 %in% c("A", "O")) ) %>%
              mutate(visit = 5, platelet_ncnc_bld = as.numeric(CBC7))
      
          blood <- list(blood1, blood2, blood3, blood4, blood5) %>%
              lapply(select, topmed_subject_id, visit, platelet_ncnc_bld) %>%
              lapply(na.omit)
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, platelet_ncnc_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="platelet_ncnc_bld_1-cardia"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112690.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Platelet count at Exam 1
          # eliminate subjects with missing code "M"
          # need to convert to units of thousands/microliter
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05PLATL %in% "M")) %>%
              transmute(topmed_subject_id, platelet_ncnc_bld = as.numeric(A05PLATL) * 100)
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, platelet_ncnc_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1-chs"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100414.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at baseline and platelet count (cells X 10^3 / uL)
          dataset <- phen_list$source_data[["pht001452"]] %>%
              tbl_df %>%
              mutate(platelet_ncnc_bld = as.integer(PLATE23),
                  age = as.integer(AGEBL)) %>%
              select(topmed_subject_id, age, platelet_ncnc_bld) %>% na.omit
      
          return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172186.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
         source_data <- phen_list$source_data
         # platelet
        dataset1 <- source_data[["pht002889"]]
        dataset1$PLT <- as.integer(dataset1$PLT)
        names(dataset1)[names(dataset1) %in% "PLT"] <- "platelet_ncnc_bld"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$platelet_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **FHS_Offspring**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227033.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # platelet
        dataset1 <- source_data[["pht004802"]]
          # subset to Offspring
        dataset1 <- dataset1[dataset1$IDTYPE %in% 1, ]
        dataset1$IDTYPE <- NULL
      
        dataset1$PLT <- as.integer(dataset1$PLT)
        names(dataset1)[names(dataset1) %in% "PLT"] <- "platelet_ncnc_bld"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age9 <- as.numeric(dataset2$age9)
        names(dataset2)[names(dataset2) %in% "age9"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$platelet_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227033.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # platelet
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
        dataset1$PLT <- as.integer(dataset1$PLT)
        names(dataset1)[names(dataset1) %in% "PLT"] <- "platelet_ncnc_bld"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$platelet_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1-hchs_sol"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226310.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Platelet count(thousands/microliter) and age at measurement
      
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(platelet_ncnc_bld = as.numeric(LABA9),
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, platelet_ncnc_bld) %>%
              filter(!is.na(age), !is.na(platelet_ncnc_bld))
      
          return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1-jhs"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127616.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # platelet_ncnc_bld
        dataset1 <- source_data[["pht001959"]]
        dataset1$PLATELET <- as.integer(dataset1$PLATELET)
        names(dataset1)[names(dataset1) %in% "PLATELET"] <- "platelet_ncnc_bld"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$platelet_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1-mesa"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218991.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          library(magrittr)
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              tbl_df %>%
              transmute(topmed_subject_id, age = as.integer(age5c))
      
          # Platelets at Exam 5 (cells x 10^3 / uL)
          dataset_blood <- phen_list$source_data[["pht004319"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, platelet_ncnc_bld = as.integer(plt5))
      
          dataset <- inner_join(dataset_dem, dataset_blood, by = "topmed_subject_id") %>%
              na.omit()
      
          return(dataset)
      }
      ```
<a id="platelet_ncnc_bld_1-whi"></a>
  * ### blood_cell_count/platelet_ncnc_bld_1 -- **WHI**:
    * 5 component_study_variables: `phs000200.v11.pht000986.v6.phv00077362.v6`, `phs000200.v11.pht000986.v6.phv00077363.v6`, `phs000200.v11.pht000986.v6.phv00077367.v6`, `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Platelets (thousands/microliter) and age at measurement
          dataset <- phen_list$source_data[["pht000986"]] %>%
              # Age
              left_join(phen_list$source_data[["pht000998"]], by = "topmed_subject_id") %>%
      
              # AGE is measured at screening on form F2.
              # abs(F2DAYS) is days between screening and enrollment.
              # do not use F2DAYS when F2DAYS > 0
              # CBCDAYS is days from enrollment to trait measurement
              mutate(F2DAYS = ifelse(as.integer(F2DAYS) > 0, 0, F2DAYS)) %>%
              mutate(platelet_ncnc_bld = as.integer(PLATELET),
                  age = as.integer(AGE) +
                      (as.integer(CBCDAYS) + abs(as.integer(F2DAYS))) / 365.25) %>%
              select(topmed_subject_id,
                     age, CBCVY,
                    platelet_ncnc_bld) %>%
                      # Use year 0 measurement.
              filter(CBCVY %in% 0 & !is.na(platelet_ncnc_bld) & !is.na(age)) %>%
              select(topmed_subject_id, age, platelet_ncnc_bld)
      
          return(dataset)
      }
      ```
<a id="pmv_entvol_bld_1"></a>
## blood_cell_count: **pmv_entvol_bld_1** (pmv_entvol_bld)
  Measurement of the mean volume (entvol) of platelets in the blood (bld), known as mean platelet volume (MPV or PMV).
  * **Harmonization Units**:
    * [ARIC](#pmv_entvol_bld_1-aric)
    * [FHS_Gen3NOSOmni2](#pmv_entvol_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#pmv_entvol_bld_1-fhs_offspring)
    * [FHS_Omni1](#pmv_entvol_bld_1-fhs_omni1)
    * [JHS](#pmv_entvol_bld_1-jhs)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: fL = femtoliter, **`Version`**: 2, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:33:16
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0944136
  * **DCC Harmonization Comments**:

    Measurements for each harmonization unit were from a single exam/visit.
    
    ### QC checks
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for mean platelet volume and platelet count may not be from the same visit.
    
<a id="pmv_entvol_bld_1-aric"></a>
  * ### blood_cell_count/pmv_entvol_bld_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht006422.v1.phv00294963.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Mean platelet volume MPV (fL) - measured at visit 5
          # Age at visit
      
          dem <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1)) %>%
              filter(!is.na(visit) & !is.na(age))
      
          # get MPV data for visit 5, eliminate subjects with missing codes
          # select desired variables
          blood <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC12 %in% c("A", "O")) ) %>%
              mutate(visit = 5, pmv_entvol_bld = as.numeric(CBC12))
          datafnl <- left_join(blood, dem, c("topmed_subject_id", "visit")) %>%
              select(topmed_subject_id, pmv_entvol_bld, age) %>%
              na.omit
      
         return(datafnl)
      }
      ```
<a id="pmv_entvol_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/pmv_entvol_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172187.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
        source_data <- phen_list$source_data
      
         # pmv_entvol_bld units = fL (femtoliter) mean platelet volume
        dataset1 <- source_data[["pht002889"]]
        dataset1$MPV <- as.numeric(dataset1$MPV)
        names(dataset1)[names(dataset1) %in% "MPV"] <- "pmv_entvol_bld"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$pmv_entvol_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="pmv_entvol_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/pmv_entvol_bld_1 -- **FHS_Offspring**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227034.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        dataset1 <- source_data[["pht004802"]]
        # choose Offspring cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 1, ]
      
         # pmv_entvol_bld units = fL (femtoliter) mean platelet volume
        dataset1$MPV <- as.numeric(dataset1$MPV)
        names(dataset1)[names(dataset1) %in% "MPV"] <- "pmv_entvol_bld"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age9 <- as.numeric(dataset2$age9)
        names(dataset2)[names(dataset2) %in% "age9"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$pmv_entvol_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="pmv_entvol_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/pmv_entvol_bld_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227034.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
         # pmv_entvol_bld units = fL (femtoliter) mean platelet volume
        dataset1$MPV <- as.numeric(dataset1$MPV)
        names(dataset1)[names(dataset1) %in% "MPV"] <- "pmv_entvol_bld"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$pmv_entvol_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="pmv_entvol_bld_1-jhs"></a>
  * ### blood_cell_count/pmv_entvol_bld_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127627.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # pmv_entvol_bld  units = fL (femtoliter) mean platelet volume
        dataset1 <- source_data[["pht001959"]]
        dataset1$MPV <- as.numeric(dataset1$MPV)
        names(dataset1)[names(dataset1) %in% "MPV"] <- "pmv_entvol_bld"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$pmv_entvol_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="rbc_ncnc_bld_1"></a>
## blood_cell_count: **rbc_ncnc_bld_1** (rbc_ncnc_bld)
  Count by volume, or number concentration (ncnc), of red blood cells in the blood (bld).
  * **Harmonization Units**:
    * [Amish](#rbc_ncnc_bld_1-amish)
    * [ARIC](#rbc_ncnc_bld_1-aric)
    * [CARDIA](#rbc_ncnc_bld_1-cardia)
    * [FHS_Gen3NOSOmni2](#rbc_ncnc_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#rbc_ncnc_bld_1-fhs_offspring)
    * [FHS_Omni1](#rbc_ncnc_bld_1-fhs_omni1)
    * [HCHS_SOL](#rbc_ncnc_bld_1-hchs_sol)
    * [JHS](#rbc_ncnc_bld_1-jhs)
    * [MESA](#rbc_ncnc_bld_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: millions / microliter, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:33:27
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0942422
  * **DCC Harmonization Comments**:

    For studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.
    
    ### Study-specific comments
    
    #### FHS
    Only the Offspring subcohort had measurements at multiple visits (exams). For this subcohort, the measurement at the most recent exam available was chosen (since more recent exams used more up-to-date procedures). 
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### Amish
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    ### QC checks
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values of red blood cell count (RBC) and other red blood cell phenotypes may not be from the same visit.
    
<a id="rbc_ncnc_bld_1-amish"></a>
  * ### blood_cell_count/rbc_ncnc_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253010.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
        source_data <- phen_list$source_data
         # RBC_count units already millions/microliter
        dataset <- source_data[["pht005002"]]
        dataset$red_blood_cell_count_baseline <- as.numeric(dataset$red_blood_cell_count_baseline)
        names(dataset)[names(dataset) %in% "red_blood_cell_count_baseline"] <- "rbc_ncnc_bld"
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$rbc_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="rbc_ncnc_bld_1-aric"></a>
  * ### blood_cell_count/rbc_ncnc_bld_1 -- **ARIC**:
    * 6 component_study_variables: `phs000280.v4.pht004064.v2.phv00204871.v1`, `phs000280.v4.pht004065.v2.phv00204975.v1`, `phs000280.v4.pht004109.v2.phv00207287.v1`, `phs000280.v4.pht004110.v2.phv00207299.v1`, `phs000280.v4.pht006422.v1.phv00294955.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Red blood cell count RBC (millions/microliter) - measured at visit 3, 4, and 5
          # Age at visit
          dem3 <- phen_list$source_data[["pht004064"]] %>%
              mutate(visit = 3, age = as.numeric(V3AGE31))
          dem4 <- phen_list$source_data[["pht004065"]] %>%
              mutate(visit = 4, age = as.numeric(V4AGE41))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
      
          dem <- list(dem3, dem4, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # get RBC data for each visit, eliminate subjects with missing codes
          blood3 <- phen_list$source_data[["pht004109"]] %>%
              filter(!(HMTC3 %in% c("A", "O")) ) %>%
              mutate(visit = 3, rbc_ncnc_bld = as.numeric(HMTC3))
          blood4 <- phen_list$source_data[["pht004110"]] %>%
              filter(!(HMTC3 %in% c("A", "O")) ) %>%
              mutate(visit = 4, rbc_ncnc_bld = as.numeric(HMTC3))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC4 %in% c("A", "O")) ) %>%
              mutate(visit = 5, rbc_ncnc_bld = as.numeric(CBC4))
      
          blood <- list(blood3, blood4, blood5) %>%
              lapply(select, topmed_subject_id, visit, rbc_ncnc_bld) %>%
              lapply(na.omit)
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, rbc_ncnc_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="rbc_ncnc_bld_1-cardia"></a>
  * ### blood_cell_count/rbc_ncnc_bld_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112687.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # Red blood cell count (RBC) at Exam 1 (millions/microliter)
          # eliminate subjects with missing code "M"
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05RBC %in% "M")) %>%
              transmute(topmed_subject_id, rbc_ncnc_bld = as.numeric(A05RBC))
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, rbc_ncnc_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="rbc_ncnc_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/rbc_ncnc_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172179.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # RBC
        dataset1 <- source_data[["pht002889"]]
        dataset1$RBC <- as.numeric(dataset1$RBC)
        names(dataset1)[names(dataset1) %in% "RBC"] <- "rbc_ncnc_bld"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$rbc_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="rbc_ncnc_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/rbc_ncnc_bld_1 -- **FHS_Offspring**:
    * 7 component_study_variables: `phs000007.v29.pht000030.v7.phv00007641.v5`, `phs000007.v29.pht000031.v7.phv00008109.v5`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177932.v4`, `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227026.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # RBC
        var <- "rbc_ncnc_bld"
      
        # Offspring exam 9
        dataset9 <- source_data[["pht004802"]]
        # subset to Offspring
        dataset9 <- dataset9[dataset9$IDTYPE %in% 1, ]
        dataset9$IDTYPE <- NULL
      
        dataset9$RBC <- as.numeric(dataset9$RBC)
      
        # Offspring exam 2
        dataset2 <- source_data[["pht000031"]]
        dataset2$B762 <- as.numeric(dataset2$B762)
      
        # Recode: hundred millions/microliter - need millions/microliter - so divide by 100
        dataset2$B762 <- dataset2$B762 / 100
      
         # Offspring exam 1
        dataset1 <- source_data[["pht000030"]]
        dataset1$A139 <- as.numeric(dataset1$A139)
      
        # Recode: hundred millions/microliter - need millions/microliter - so divide by 100
        dataset1$A139 <- dataset1$A139 / 100
      
        # ages
        dataseta <- source_data[["pht003099"]]
        dataseta$age9 <- as.numeric(dataseta$age9)
        dataseta$age2 <- as.numeric(dataseta$age2)
        dataseta$age1 <- as.numeric(dataseta$age1)
      
        # add appropriate ages to datasets
        dataset9 <- inner_join(dataset9, dataseta)
        dataset9$age2 <- NULL
        dataset9$age1 <- NULL
      
        dataset2 <- inner_join(dataset2, dataseta)
        dataset2$age9 <- NULL
        dataset2$age1 <- NULL
      
        dataset1 <- inner_join(dataset1, dataseta)
        dataset1$age9 <- NULL
        dataset1$age2 <- NULL
      
        sel <- !is.na(dataset9$RBC) & !is.na(dataset9$age9)
        keep9 <- dataset9[sel, ]
        names(keep9)[names(keep9) == "RBC"] <- var
        names(keep9)[names(keep9) == "age9"] <- "age"
      
        dataset2 <- anti_join(dataset2, keep9)
        sel2 <- !is.na(dataset2$B762) & !is.na(dataset2$age2)
        keep2 <- dataset2[sel2, ]
        names(keep2)[names(keep2) == "B762"] <- var
        names(keep2)[names(keep2) == "age2"] <- "age"
      
        keep <- rbind(keep9, keep2)
      
        dataset1 <- anti_join(dataset1, keep)
        sel1 <-  !is.na(dataset1$A139) & !is.na(dataset1$age1)
        keep1 <- dataset1[sel1, ]
        names(keep1)[names(keep1) == "A139"] <- var
        names(keep1)[names(keep1) == "age1"] <- "age"
      
        # combine
        dataset <- rbind(keep, keep1)
      
        return(dataset)
      }
      ```
<a id="rbc_ncnc_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/rbc_ncnc_bld_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227026.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # RBC
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
        dataset1$RBC <- as.numeric(dataset1$RBC)
        names(dataset1)[names(dataset1) %in% "RBC"] <- "rbc_ncnc_bld"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$rbc_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="rbc_ncnc_bld_1-hchs_sol"></a>
  * ### blood_cell_count/rbc_ncnc_bld_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226294.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Red blood cell count (RBC) (millions/microliter) and age at measurement
      
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(rbc_ncnc_bld = as.numeric(LABA2),
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, rbc_ncnc_bld) %>%
              filter(!is.na(age), !is.na(rbc_ncnc_bld))
      
          return(dataset)
      }
      ```
<a id="rbc_ncnc_bld_1-jhs"></a>
  * ### blood_cell_count/rbc_ncnc_bld_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127629.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # RBC_ncnc_bld
        dataset1 <- source_data[["pht001959"]]
        dataset1$RED_CELL_COUNT <- as.numeric(dataset1$RED_CELL_COUNT)
        names(dataset1)[names(dataset1) %in% "RED_CELL_COUNT"] <- "rbc_ncnc_bld"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$rbc_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="rbc_ncnc_bld_1-mesa"></a>
  * ### blood_cell_count/rbc_ncnc_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218990.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          # RBC count at Exam 5 (M/uL)
          dataset_rbc <- phen_list$source_data[["pht004319"]] %>%
              mutate(rbc_ncnc_bld = as.numeric(rbc5)) %>%
              select(topmed_subject_id, rbc_ncnc_bld)
      
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              mutate(age = as.integer(age5c)) %>%
              select(topmed_subject_id, age)
      
          # Join and remove incomplete cases
          dataset <- inner_join(dataset_dem, dataset_rbc, by = "topmed_subject_id") %>%
              filter(complete.cases(.))
          return(dataset)
      }
      ```
<a id="rdw_ratio_rbc_1"></a>
## blood_cell_count: **rdw_ratio_rbc_1** (rdw_ratio_rbc)
  Measurement of the ratio of variation in width to the mean width of the red blood cell (rbc) volume distribution curve taken at +/- 1 CV, known as red cell distribution width (RDW).
  * **Harmonization Units**:
    * [ARIC](#rdw_ratio_rbc_1-aric)
    * [FHS_Gen3NOSOmni2](#rdw_ratio_rbc_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#rdw_ratio_rbc_1-fhs_offspring)
    * [FHS_Omni1](#rdw_ratio_rbc_1-fhs_omni1)
    * [HCHS_SOL](#rdw_ratio_rbc_1-hchs_sol)
    * [JHS](#rdw_ratio_rbc_1-jhs)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: % = percentage, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:33:56
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0362909
  * **DCC Harmonization Comments**:

    For studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.
    
    ### Study-specific comments
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    ### QC checks
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values of red cell distribution width and other red blood cell phenotypes may not be from the same visit.
    
<a id="rdw_ratio_rbc_1-aric"></a>
  * ### blood_cell_count/rdw_ratio_rbc_1 -- **ARIC**:
    * 6 component_study_variables: `phs000280.v4.pht004064.v2.phv00204871.v1`, `phs000280.v4.pht004065.v2.phv00204975.v1`, `phs000280.v4.pht004109.v2.phv00207292.v1`, `phs000280.v4.pht004110.v2.phv00207304.v1`, `phs000280.v4.pht006422.v1.phv00294962.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Red blood cell distribution width RDW (%) - visits 3, 4, and 5
          # Age at visit
          dem3 <- phen_list$source_data[["pht004064"]] %>%
              mutate(visit = 3, age = as.numeric(V3AGE31))
          dem4 <- phen_list$source_data[["pht004065"]] %>%
              mutate(visit = 4, age = as.numeric(V4AGE41))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
      
          dem <- list(dem3, dem4, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # get RDW data for each visit, eliminate subjects with missing codes
          blood3 <- phen_list$source_data[["pht004109"]] %>%
              filter(!(HMTC9 %in% c("A", "O")) ) %>%
              mutate(visit = 3, rdw_ratio_rbc = as.numeric(HMTC9))
          blood4 <- phen_list$source_data[["pht004110"]] %>%
              filter(!(HMTC9 %in% c("A", "O")) ) %>%
              mutate(visit = 4, rdw_ratio_rbc = as.numeric(HMTC9))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC11 %in% c("A", "O")) ) %>%
              mutate(visit = 5, rdw_ratio_rbc = as.numeric(CBC11))
      
          blood <- list(blood3, blood4, blood5) %>%
              lapply(select, topmed_subject_id, visit, rdw_ratio_rbc) %>%
              lapply(na.omit)
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, rdw_ratio_rbc, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="rdw_ratio_rbc_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/rdw_ratio_rbc_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172185.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
      
         #rdw_ratio_rbc  units = %  red blood cell distribution width
        dataset1 <- source_data[["pht002889"]]
        dataset1$RDW <- as.numeric(dataset1$RDW)
        names(dataset1)[names(dataset1) %in% "RDW"] <- "rdw_ratio_rbc"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$rdw_ratio_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="rdw_ratio_rbc_1-fhs_offspring"></a>
  * ### blood_cell_count/rdw_ratio_rbc_1 -- **FHS_Offspring**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227032.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
        source_data <- phen_list$source_data
      
        dataset1 <- source_data[["pht004802"]]
        # choose Offspring cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 1, ]
      
         # rdw_ratio_rbc units = %  red blood cell distribution width
        dataset1$RDW <- as.numeric(dataset1$RDW)
        names(dataset1)[names(dataset1) %in% "RDW"] <- "rdw_ratio_rbc"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age9 <- as.numeric(dataset2$age9)
        names(dataset2)[names(dataset2) %in% "age9"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$rdw_ratio_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="rdw_ratio_rbc_1-fhs_omni1"></a>
  * ### blood_cell_count/rdw_ratio_rbc_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227032.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
      
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
         # rdw_ratio_rbc  units = %  red blood cell distribution width
        dataset1$RDW <- as.numeric(dataset1$RDW)
        names(dataset1)[names(dataset1) %in% "RDW"] <- "rdw_ratio_rbc"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$rdw_ratio_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="rdw_ratio_rbc_1-hchs_sol"></a>
  * ### blood_cell_count/rdw_ratio_rbc_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226308.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Red blood cell distribution width (RDW) (%) and age at measurement
      
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(rdw_ratio_rbc = as.numeric(LABA8),
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, rdw_ratio_rbc) %>%
              filter(!is.na(age), !is.na(rdw_ratio_rbc))
      
          return(dataset)
      }
      ```
<a id="rdw_ratio_rbc_1-jhs"></a>
  * ### blood_cell_count/rdw_ratio_rbc_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127628.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
      
         #rdw_ratio_rbc units = %  red blood cell distribution width
        dataset1 <- source_data[["pht001959"]]
        dataset1$RDW <- as.numeric(dataset1$RDW)
        names(dataset1)[names(dataset1) %in% "RDW"] <- "rdw_ratio_rbc"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$rdw_ratio_rbc)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1"></a>
## blood_cell_count: **wbc_ncnc_bld_1** (wbc_ncnc_bld)
  Count by volume, or number concentration (ncnc), of white blood cells in the blood (bld).
  * **Harmonization Units**:
    * [Amish](#wbc_ncnc_bld_1-amish)
    * [ARIC](#wbc_ncnc_bld_1-aric)
    * [CARDIA](#wbc_ncnc_bld_1-cardia)
    * [CHS](#wbc_ncnc_bld_1-chs)
    * [FHS_Gen3NOSOmni2](#wbc_ncnc_bld_1-fhs_gen3nosomni2)
    * [FHS_Offspring](#wbc_ncnc_bld_1-fhs_offspring)
    * [FHS_Omni1](#wbc_ncnc_bld_1-fhs_omni1)
    * [HCHS_SOL](#wbc_ncnc_bld_1-hchs_sol)
    * [JHS](#wbc_ncnc_bld_1-jhs)
    * [MESA](#wbc_ncnc_bld_1-mesa)
    * [WHI](#wbc_ncnc_bld_1-whi)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: thousands / microliter, **`Version`**: 4, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-09-28 15:36:33
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0945357
  * **DCC Harmonization Comments**:

    For studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study.
    
    ### Study-specific comments
    
    #### FHS
    Only the Offspring subcohort had measurements at multiple visits (exams). For this subcohort, the measurement at the most recent exam available was chosen (since more recent exams used more up-to-date procedures). 
    
    #### ARIC
    The visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. 
    
    #### Amish
    Subjects with age recorded as 90+ were assigned a harmonized age of 90.
    
    ### QC checks
    
    Analysts should carefully examine distributions of the *_WHI_* white blood cell (WBC) values.
    There is a cluster of high-value outliers for which no specific batch effect could be identified but which analysts may wish to exclude from analyses.
    
    Please note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for WBC and WBC subtype differentials may not be from the same visit, so the harmonized subtype differential counts may not sum to the WBC count.
    
    
    
<a id="wbc_ncnc_bld_1-amish"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253006.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
        source_data <- phen_list$source_data
         # WBC_count units already thousands/microliter
        dataset <- source_data[["pht005002"]]
        dataset$white_blood_cell_count_baseline <- as.numeric(dataset$white_blood_cell_count_baseline)
        names(dataset)[names(dataset) %in% "white_blood_cell_count_baseline"] <- "wbc_ncnc_bld"
      
         # age - winsorize at 90
         dataset$age_baseline[dataset$age_baseline %in% "90+"] <- 90
         dataset$age_baseline <- as.numeric(dataset$age_baseline)
         names(dataset)[names(dataset) %in% "age_baseline"] <- "age"
      
         # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$wbc_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1-aric"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **ARIC**:
    * 10 component_study_variables: `phs000280.v4.pht004062.v2.phv00204623.v1`, `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004064.v2.phv00204871.v1`, `phs000280.v4.pht004065.v2.phv00204975.v1`, `phs000280.v4.pht004107.v2.phv00207257.v1`, `phs000280.v4.pht004108.v2.phv00207272.v1`, `phs000280.v4.pht004109.v2.phv00207286.v1`, `phs000280.v4.pht004110.v2.phv00207298.v1`, `phs000280.v4.pht006422.v1.phv00294954.v1`, `phs000280.v4.pht006431.v1.phv00295623.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # Age at visit
          dem1 <- phen_list$source_data[["pht004063"]] %>%
              mutate(visit = 1, age = as.numeric(V1AGE01))
          dem2 <- phen_list$source_data[["pht004062"]] %>%
              mutate(visit = 2, age = as.numeric(V2AGE22))
          dem3 <- phen_list$source_data[["pht004064"]] %>%
              mutate(visit = 3, age = as.numeric(V3AGE31))
          dem4 <- phen_list$source_data[["pht004065"]] %>%
              mutate(visit = 4, age = as.numeric(V4AGE41))
          dem5 <- phen_list$source_data[["pht006431"]] %>%
              mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))
      
          dem <- list(dem1, dem2, dem3, dem4, dem5) %>%
              lapply(select, topmed_subject_id, visit, age) %>%
              do.call(rbind, .) %>%
              tbl_df %>%
              filter(!is.na(visit) & !is.na(age))
      
          # White blood cell count (WBC) (thousands/microliter)
          # get WBC data for each visit, eliminate subjects with missing codes
          blood1 <- phen_list$source_data[["pht004107"]] %>%
              filter(!(HMTA03 %in% c("A", "O")) ) %>%
              mutate(visit = 1, wbc_ncnc_bld = as.numeric(HMTA03))
          blood2 <- phen_list$source_data[["pht004108"]] %>%
              filter(!(HMTB03 %in% c("A", "O")) ) %>%
              mutate(visit = 2, wbc_ncnc_bld = as.numeric(HMTB03))
          blood3 <- phen_list$source_data[["pht004109"]] %>%
              filter(!(HMTC2 %in% c("A", "O")) ) %>%
              mutate(visit = 3, wbc_ncnc_bld = as.numeric(HMTC2))
          blood4 <- phen_list$source_data[["pht004110"]] %>%
              filter(!(HMTC2 %in% c("A", "O")) ) %>%
              mutate(visit = 4, wbc_ncnc_bld = as.numeric(HMTC2))
          blood5 <- phen_list$source_data[["pht006422"]] %>%
              filter(!(CBC3 %in% c("A", "O")) ) %>%
              mutate(visit = 5, wbc_ncnc_bld = as.numeric(CBC3))
      
          blood <- list(blood1, blood2, blood3, blood4, blood5) %>%
              lapply(select, topmed_subject_id, visit, wbc_ncnc_bld) %>%
              lapply(na.omit)
      
          blood %<>% do.call(rbind, .)
      
          dataset <- left_join(blood, dem, c("topmed_subject_id", "visit"))
      
          # Successively select from visit with most observations for additional subjects
          datafnl <- NULL
          while (nrow(dataset) > 0){
           # create table of number of subjects per visit
            tb <- dataset %>% group_by(visit) %>%
                  summarise(count = n())
           # order the table in decreasing order, choose the top visit (most subjects)
            tb <- tb[order(tb$count, decreasing = TRUE), ]
            v <- tb %>% slice(1) %>% select(visit)
            v <- as.numeric(v)
           # select subjects with that visit
            tmp <- dataset %>% filter(visit == v)
            datafnl <- rbind(datafnl, tmp)
           # remove chosen set of subjects and repeat the process with remaining subjects
            dataset <- anti_join(dataset, tmp, by = "topmed_subject_id")
          }
         datafnl <- datafnl %>% select(topmed_subject_id, wbc_ncnc_bld, age) %>% na.omit
         return(datafnl)
      }
      ```
<a id="wbc_ncnc_bld_1-cardia"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112686.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at measurement (Exam 1)
          dat1 <- phen_list$source_data[["pht001559"]] %>%
              tbl_df() %>%
              transmute(topmed_subject_id, age = as.numeric(A01AGE2))
      
          # White blood cell count (WBC) at Exam 1 (thousands/microliter)
          # eliminate subjects with missing code "M"
          dat2 <- phen_list$source_data[["pht001563"]] %>%
              tbl_df() %>% filter(!(A05WBC %in% "M")) %>%
              transmute(topmed_subject_id, wbc_ncnc_bld = as.numeric(A05WBC))
      
          dataset <- left_join(dat2, dat1, by = "topmed_subject_id") %>%
              select(topmed_subject_id, wbc_ncnc_bld, age) %>% na.omit()
      
          return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1-chs"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100411.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # White blood cells * 1,000 / uL of blood and age at baseline
          dataset <- phen_list$source_data[["pht001452"]] %>%
              tbl_df %>%
              mutate(wbc_ncnc_bld = as.numeric(WBLD23),
                  age = as.integer(AGEBL)) %>%
              select(topmed_subject_id, age, wbc_ncnc_bld) %>% na.omit
      
          return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1-fhs_gen3nosomni2"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **FHS_Gen3NOSOmni2**:
    * 2 component_study_variables: `phs000007.v29.pht002889.v2.phv00172178.v2`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # WBC
        dataset1 <- source_data[["pht002889"]]
        dataset1$WBC <- as.numeric(dataset1$WBC)
        names(dataset1)[names(dataset1) %in% "WBC"] <- "wbc_ncnc_bld"
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age2 <- as.numeric(dataset2$age2)
        names(dataset2)[names(dataset2) %in% "age2"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$wbc_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1-fhs_offspring"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **FHS_Offspring**:
    * 7 component_study_variables: `phs000007.v29.pht000030.v7.phv00007640.v5`, `phs000007.v29.pht000031.v7.phv00008108.v5`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177932.v4`, `phs000007.v29.pht003099.v4.phv00177946.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # WBC
        var <- "wbc_ncnc_bld"
      
        # Offspring exam 9
        dataset9 <- source_data[["pht004802"]]
        # subset to Offspring
        dataset9 <- dataset9[dataset9$IDTYPE %in% 1, ]
        dataset9$IDTYPE <- NULL
      
        dataset9$WBC <- as.numeric(dataset9$WBC)
      
        # Offspring exam 2
        dataset2 <- source_data[["pht000031"]]
        dataset2$B761 <- as.numeric(dataset2$B761)
      
        # Recode: ten thousands/microliter - need thousands/microliter - so divide by 10
        dataset2$B761 <- dataset2$B761 / 10
      
         # Offspring exam 1
        dataset1 <- source_data[["pht000030"]]
        dataset1$A138 <- as.numeric(dataset1$A138)
      
        # Recode: ten thousands/microliter - need thousands/microliter - so divide by 10
        dataset1$A138 <- dataset1$A138 / 10
      
        # ages
        dataseta <- source_data[["pht003099"]]
        dataseta$age9 <- as.numeric(dataseta$age9)
        dataseta$age2 <- as.numeric(dataseta$age2)
        dataseta$age1 <- as.numeric(dataseta$age1)
      
        # add appropriate ages to datasets
        dataset9 <- inner_join(dataset9, dataseta)
        dataset9$age2 <- NULL
        dataset9$age1 <- NULL
      
        dataset2 <- inner_join(dataset2, dataseta)
        dataset2$age9 <- NULL
        dataset2$age1 <- NULL
      
        dataset1 <- inner_join(dataset1, dataseta)
        dataset1$age9 <- NULL
        dataset1$age2 <- NULL
      
        sel <- !is.na(dataset9$WBC) & !is.na(dataset9$age9)
        keep9 <- dataset9[sel, ]
        names(keep9)[names(keep9) == "WBC"] <- var
        names(keep9)[names(keep9) == "age9"] <- "age"
      
        dataset2 <- anti_join(dataset2, keep9)
        sel2 <- !is.na(dataset2$B761) & !is.na(dataset2$age2)
        keep2 <- dataset2[sel2, ]
        names(keep2)[names(keep2) == "B761"] <- var
        names(keep2)[names(keep2) == "age2"] <- "age"
      
        keep <- rbind(keep9, keep2)
      
        dataset1 <- anti_join(dataset1, keep)
        sel1 <-  !is.na(dataset1$A138) & !is.na(dataset1$age1)
        keep1 <- dataset1[sel1, ]
        names(keep1)[names(keep1) == "A138"] <- var
        names(keep1)[names(keep1) == "age1"] <- "age"
      
        # combine
        dataset <- rbind(keep, keep1)
      
        return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1-fhs_omni1"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177936.v4`, `phs000007.v29.pht004802.v1.phv00227024.v1`, `phs000007.v29.pht004802.v1.phv00227025.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
         # WBC
        dataset1 <- source_data[["pht004802"]]
        # choose Omni1 cohort
        dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]
      
        dataset1$WBC <- as.numeric(dataset1$WBC)
        names(dataset1)[names(dataset1) %in% "WBC"] <- "wbc_ncnc_bld"
        dataset1$IDTYPE <- NULL
      
        # age
        dataset2 <- source_data[["pht003099"]]
        dataset2$age4 <- as.numeric(dataset2$age4)
        names(dataset2)[names(dataset2) %in% "age4"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$wbc_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1-hchs_sol"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226283.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # White blood cell count (WBC) (thousands/microliter) and age at measurement
      
          dataset <- phen_list$source_data[["pht004715"]] %>%
              tbl_df %>%
              mutate(wbc_ncnc_bld = as.numeric(LABA1),
                  age = as.integer(AGE)) %>%
              select(topmed_subject_id, age, wbc_ncnc_bld) %>%
              filter(!is.na(age), !is.na(wbc_ncnc_bld))
      
          return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1-jhs"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001959.v1.phv00127631.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library("dplyr")
      
        source_data <- phen_list$source_data
        # WBC_ncnc_bld
        dataset1 <- source_data[["pht001959"]]
        dataset1$WBC <- as.numeric(dataset1$WBC)
        names(dataset1)[names(dataset1) %in% "WBC"] <- "wbc_ncnc_bld"
      
        # age
        dataset2 <- source_data[["pht001949"]]
        dataset2$AGE01 <- as.numeric(dataset2$AGE01)
        names(dataset2)[names(dataset2) %in% "AGE01"] <- "age"
      
        # combine
        dataset <- inner_join(dataset1, dataset2)
      
        # subset to non-missing values
        sel <- !is.na(dataset$age) & !is.na(dataset$wbc_ncnc_bld)
        dataset <- dataset[sel, ]
      
        return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1-mesa"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht003091.v3.phv00176011.v1`, `phs000209.v13.pht004319.v1.phv00218997.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
          # Age at Exam 5
          dataset_dem <- phen_list$source_data[["pht003091"]] %>%
              tbl_df %>%
              transmute(topmed_subject_id, age = as.integer(age5c))
      
          # WBC (cells x 10^3/uL of blood)
          wbc <- phen_list$source_data[["pht004319"]] %>%
              tbl_df %>%
              transmute(topmed_subject_id, wbc_ncnc_bld = as.numeric(wbc5))
      
          dataset <- inner_join(dataset_dem, wbc, by = "topmed_subject_id") %>%
              na.omit()
      
          return(dataset)
      }
      ```
<a id="wbc_ncnc_bld_1-whi"></a>
  * ### blood_cell_count/wbc_ncnc_bld_1 -- **WHI**:
    * 5 component_study_variables: `phs000200.v11.pht000986.v6.phv00077362.v6`, `phs000200.v11.pht000986.v6.phv00077363.v6`, `phs000200.v11.pht000986.v6.phv00077368.v6`, `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          # White blood cells * 1,000 / uL of blood and age at measurement
          dataset <- phen_list$source_data[["pht000986"]] %>%
              tbl_df %>%
              # Age
              left_join(phen_list$source_data[["pht000998"]], by = "topmed_subject_id") %>%
      
              # AGE is measured at screening on form F2.
              # abs(F2DAYS) is days between screening and enrollment.
              # do not use F2DAYS when F2DAYS > 0
              # CBCDAYS is days from enrollment to trait measurement
              mutate(F2DAYS = ifelse(as.integer(F2DAYS) > 0, 0, F2DAYS)) %>%
              mutate(wbc_ncnc_bld = as.numeric(WBC),
                  age = as.integer(AGE) +
                      (as.integer(CBCDAYS) + abs(as.integer(F2DAYS))) / 365.25) %>%
              select(topmed_subject_id,
                      age, CBCVY,
                      wbc_ncnc_bld) %>%
              # Use year 0 measurement.
              filter(CBCVY %in% 0 & !is.na(wbc_ncnc_bld) & !is.na(age)) %>%
              select(topmed_subject_id, age, wbc_ncnc_bld)
      
          return(dataset)
      }
      ```

# blood_pressure

### Variables in this section:
* [antihypertensive_meds_1](#antihypertensive_meds_1)
* [bp_diastolic_1](#bp_diastolic_1)
* [bp_systolic_1](#bp_systolic_1)

<a id="antihypertensive_meds_1"></a>
## blood_pressure: **antihypertensive_meds_1** (antihypertensive_meds)
  Indicator for use of antihypertensive medication at the time of blood pressure measurement.
  * **Harmonization Units**:
    * [Amish](#antihypertensive_meds_1-amish)
    * [ARIC](#antihypertensive_meds_1-aric)
    * [CARDIA](#antihypertensive_meds_1-cardia)
    * [CFS](#antihypertensive_meds_1-cfs)
    * [CHS](#antihypertensive_meds_1-chs)
    * [FHS_Gen3_NOS_Omni2](#antihypertensive_meds_1-fhs_gen3_nos_omni2)
    * [FHS_Offspring](#antihypertensive_meds_1-fhs_offspring)
    * [FHS_Omni1](#antihypertensive_meds_1-fhs_omni1)
    * [FHS_Original](#antihypertensive_meds_1-fhs_original)
    * [GENOA](#antihypertensive_meds_1-genoa)
    * [HCHS_SOL](#antihypertensive_meds_1-hchs_sol)
    * [JHS](#antihypertensive_meds_1-jhs)
    * [MESA](#antihypertensive_meds_1-mesa)
    * [SAS](#antihypertensive_meds_1-sas)
    * [WHI](#antihypertensive_meds_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-07-31 12:39:37
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C2054151
  * **DCC Harmonization Comments**:

    This variable was defined as a binary indicator for use of antihypertensive medication at the time of blood pressure measurement. When available, binary variables provided by the study were used for harmonization. Otherwise, usage of specific medication classes was used to define the harmonized variable.
    
    #### COPDGene
    
    There was no study variable to indicate whether a subject was taking antihypertensive medication at the time of blood pressure measurement. Therefore, all *_COPDGene_* subjects have missing values for this harmonized variable. 
    
    #### FHS
    
    Because antihypertensive medication was not recorded before Exam 4 for the Original cohort, antihypertensive medication status from Exam 4 were used for harmonization.
    
    #### GOLDN
    
    There was no study variable to indicate whether a subject was taking antihypertensive medication at the time of blood pressure measurement. Therefore, all *_GOLDN_* subjects have missing values for this harmonized variable. 
    
<a id="antihypertensive_meds_1-amish"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00252997.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005002 %>%
                   rename(age = age_baseline, antihypertensive_meds = htn_med_baseline)
      
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        dataset$age[dataset$age %in% '90+'] <- 90
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$antihypertensive_meds[dataset$antihypertensive_meds %in% 'NA'] <- NA
      
        # Convert character values to numeric and remove NAs.
        dataset <- mutate(dataset, age = as.numeric(age)) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-aric"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004063.v2.phv00204754.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- phen_list$source_data$pht004063
      
        # Change missing encoded values to NA.
        dataset$HYPTMD01[dataset$HYPTMD01 %in% 'NA'] <- NA
        dataset$HYPTMD01[dataset$HYPTMD01 %in% 'T'] <- NA
      
        # Rename variables.
        dataset <- rename(dataset, age = V1AGE01, antihypertensive_meds = HYPTMD01)
      
        # Convert age variable from character to numeric.
        dataset <- mutate(dataset, age = as.numeric(age))
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-cardia"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **CARDIA**:
    * 4 component_study_variables: `phs000285.v3.pht001569.v2.phv00113012.v2`, `phs000285.v3.pht001571.v2.phv00113154.v2`, `phs000285.v3.pht001571.v2.phv00113155.v2`, `phs000285.v3.pht001645.v2.phv00115119.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset of whether a participant has ever taken antihypertensive meds.
        med_ever <- phen_list$source_data$pht001569
      
        # Subset participants who have never taken antihypertensive meds
        # and assign the encoded value "0".
        med_no <- filter(med_ever, A08BPMED == "1") %>%
                  mutate(antihypertensive_meds = 0) %>%
                  select(topmed_subject_id, antihypertensive_meds)
      
        # Subset participants who have ever taken antihypertensive meds.
        med_yes <- filter(med_ever, A08BPMED == "2")
      
        # Get dataset of antihypertensive meds status at clinical visit.
        med_visit <- filter(distinct(phen_list$source_data$pht001571),
                              A09MDTYP == "HBP")
      
        # Join datasets to determine the meds status of participants who have ever
        # taken antihypertensive meds at time of clinical visit.
        med_now <- left_join(med_yes, med_visit, by = "topmed_subject_id")
      
        # Assign encoded values to multiple records of a participant.
        # Records of taking antihypertensive meds at visit are encoded as "1".
        # Records of a missing value are encoded as "0.5".
        # Records of not taking antihypertensive meds at visit are encoded as "0".
        med_now <- mutate(med_now, med = case_when(A09MDNOW == "2" ~ 1,
                                                   A09MDNOW == "M" | is.na(A09MDNOW) ~ 0.5,
                                                   A09MDNOW == "1" ~ 0))
      
        # If a participant has any records of "1", he/she is identified as taking antihypertensive meds
        # at visit and get the encoded value "1". If a participant has records of both "0.5" and "0",
        # he/she is identified as missing meds status at visit and get the encoded value "0.5". If a
        # participant only has records of "0", he/she is identified as not taking antihypertensive meds
        # at visit and get the encoded value "0".
        med_now <- group_by(med_now, topmed_subject_id) %>%
                   mutate(antihypertensive_meds = max(med)) %>%
                   ungroup()
      
        # Convert the encoded value "0.5" to "NA" to represent missing meds status.
        med_now$antihypertensive_meds[med_now$antihypertensive_meds == 0.5] <- NA
      
        # Filter out unique values.
        med_now <- distinct(select(med_now, topmed_subject_id, antihypertensive_meds))
      
        # Combine datasets.
        dataset <- bind_rows(med_no, med_now)
      
        # Join with age dataset and rename variable.
        dataset <- inner_join(dataset,
                              phen_list$source_data$pht001645,
                              by = "topmed_subject_id") %>%
                   rename(age = EXAMAGE)
      
        # Convert variable types and remove records with NAs from dataset.
        dataset <- mutate(dataset,
                          age = as.numeric(age),
                          antihypertensive_meds = as.character(antihypertensive_meds)) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-cfs"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **CFS**:
    * 3 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00123029.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dataset <- phen_list$source_data$pht001902 %>%
      
        # Rename variables.
                   rename(antihypertensive_meds = xbpmeds) %>%
      
        # Filter for baseline visit only.
                   filter(visit == 5) %>%
      
        # Select diastolic blood pressure.
                   select(topmed_subject_id, age, antihypertensive_meds) %>%
      
        # Remove NAs.
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-chs"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001452.v1.phv00100595.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- phen_list$source_data$pht001452
      
        # Rename age and medication variable.
        dataset <- rename(dataset, age = AGEBL, antihypertensive_meds = HTNMED06)
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        # Return harmonized dataset
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-fhs_gen3_nos_omni2"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **FHS_Gen3_NOS_Omni2**:
    * 2 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht006026.v1.phv00277059.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- inner_join(phen_list$source_data$pht006026,
                              phen_list$source_data$pht003099,
                              by = "topmed_subject_id") %>%
      
          # Rename variables.
          rename(antihypertensive_meds = HRX1, age = age1) %>%
      
          # Remove NAs.
          na.omit()
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-fhs_offspring"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **FHS_Offspring**:
    * 2 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht006027.v1.phv00277245.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- inner_join(phen_list$source_data$pht006027,
                              phen_list$source_data$pht003099,
                              by = "topmed_subject_id") %>%
      
          # Rename variables.
          rename(antihypertensive_meds = HRX1, age = age1) %>%
      
          # Remove NAs.
          na.omit()
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-fhs_omni1"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **FHS_Omni1**:
    * 2 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht004813.v1.phv00250358.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dataset <- plyr::join_all(phen_list$source_data) %>%
      
          # Rename variables.
          rename(antihypertensive_meds = e221, age = age1) %>%
      
          # Remove NAs.
          na.omit()
      
        # Return dataset.
        return(dataset)
      
      }
      ```
<a id="antihypertensive_meds_1-fhs_original"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **FHS_Original**:
    * 2 component_study_variables: `phs000007.v29.pht000009.v2.phv00000705.v1`, `phs000007.v29.pht003099.v4.phv00177936.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dataset <- plyr::join_all(phen_list$source_data) %>%
      
          # Rename variables.
          rename(antihypertensive_meds = MF250, age = age4)
      
        # Recode encoded values to 0 (no) and 1 (yes).
        dataset[dataset$antihypertensive_meds %in% "2", ]$antihypertensive_meds <- "0"
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        # Return dataset.
        return(dataset)
      
      }
      ```
<a id="antihypertensive_meds_1-genoa"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v1.pht006039.v1.phv00277507.v1`, `phs001238.v1.pht006042.v1.phv00277585.v1`, `phs001238.v1.pht006653.v1.phv00307788.v1`, `phs001238.v1.pht006656.v1.phv00307866.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        source_data <- phen_list$source_data
        data_aa <- inner_join(source_data$pht006039,
                              source_data$pht006042,
                              by = "topmed_subject_id")
        data_ea <- inner_join(source_data$pht006653,
                              source_data$pht006656,
                              by = "topmed_subject_id")
        dataset <- union(data_aa, data_ea)
      
        # Rename variables.
        dataset <- rename(dataset, age = AGE, antihypertensive_meds = meds_HYT)
      
        # Encode the two-level factor values to binary values.
        dataset <- mutate_if(dataset, is.factor, as.character)
        dataset$antihypertensive_meds[dataset$antihypertensive_meds %in% 'NO'] <- 0
        dataset$antihypertensive_meds[dataset$antihypertensive_meds %in% 'YES'] <- 1
      
        # Convert variable types and remove records with NAs from dataset.
        dataset <- mutate(dataset,
                          age = as.numeric(age),
                          antihypertensive_meds = as.character(antihypertensive_meds)) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-hchs_sol"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226324.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Select phenotype dataset.
        dataset <- phen_list$source_data$pht004715 %>%
        # Rename variables and convert to appropriate data type.
                   transmute(topmed_subject_id,
                             antihypertensive_meds = as.character(MED_ANTIHYPERT),
                             age = as.numeric(AGE)) %>%
        # Exclude rows with NAs.
                   na.omit()
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-jhs"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001949.v1.phv00126038.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht001949 %>%
                   rename(age = AGE01, antihypertensive_meds = BPM01)
      
        # Substitute the value of 'X' to missing.
        dataset$antihypertensive_meds[dataset$antihypertensive_meds %in% 'X'] <- NA
      
        # Convert variable types and remove records with NAs from dataset.
        dataset <- mutate(dataset,
                          age = as.numeric(age),
                          antihypertensive_meds = as.character(antihypertensive_meds)) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-mesa"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **MESA**:
    * 6 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00083163.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085324.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087093.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        # Merge pht001111 and pht001116.
        dataset <- rbind(phen_list$source_data$pht001111, phen_list$source_data$pht001116)
      
        # Rename variables in pht001121.
        dataset_21 <- phen_list$source_data$pht001121 %>%
                      rename(age1c = agefc, htnmed1c = htnmedfc)
      
        # Merge pht001121 with previously merged dataset.
        dataset <- rbind(dataset, dataset_21)
      
        # Rename age and medication variable.
        dataset <- rename(dataset, age = age1c, antihypertensive_meds = htnmed1c)
      
        # Remove NAs.
        dataset <- na.omit(dataset)
      
        # Return harmonized dataset
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-sas"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **SAS**:
    * 2 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258749.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- phen_list$source_data$pht005253 %>%
        # Rename variables.
                   transmute(topmed_subject_id,
                             age = Dec_Age,
                             antihypertensive_meds = na_if(Hyp_meds, "NA")) %>%
                   mutate_at(vars(age), funs(as.numeric)) %>%
        # Remove NAs.
                   na.omit()
        return(dataset)
      }
      ```
<a id="antihypertensive_meds_1-whi"></a>
  * ### blood_pressure/antihypertensive_meds_1 -- **WHI**:
    * 8 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001019.v6.phv00079850.v6`, `phs000200.v11.pht001019.v6.phv00079852.v6`, `phs000200.v11.pht002754.v4.phv00169603.v4`, `phs000200.v11.pht002754.v4.phv00169605.v4`, `phs000200.v11.pht002754.v4.phv00169608.v4`, `phs000200.v11.pht002754.v4.phv00169611.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get medication dataset.
        dataset_med <- phen_list$source_data$pht002754
      
        # Subset to baseline visit.
        dataset_med <- filter(dataset_med, F44VTYP == 1)
      
        # Select variables needed.
        dataset_med <- select(dataset_med, topmed_subject_id, ADULTDY, F44DAYS, TCCODE)
      
        # Substitute the value of 'NA' to missing.
        dataset_med$ADULTDY[dataset_med$ADULTDY %in% 'NA'] <- NA
        dataset_med$TCCODE[dataset_med$TCCODE %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset_med <- mutate_if(dataset_med, is.character, as.numeric)
      
        # Get blood pressure dataset.
        dataset_bp <- phen_list$source_data$pht001019
      
        # Subset to baseline visit.
        dataset_bp <- filter(dataset_bp, F80VTYP == 1)
      
        # Convert character values to numeric.
        dataset_bp <- mutate_if(dataset_bp, is.character, as.numeric)
      
        # Select variables needed and join with medication dataset to get medication taken during
        # blood pressure measurement.
        dataset_bp <- select(dataset_bp, topmed_subject_id, F80DAYS)
        dataset_med <- left_join(dataset_med, dataset_bp, by = "topmed_subject_id")
      
        # Subset participants who had taken blood pressure measurements.
        dataset_med <- filter(dataset_med, !is.na(F80DAYS))
      
        # Create the antihypertensive medication status variable and assign the value "-1" to all records.
        dataset_med$meds <- -1
      
        # Subset participants taking antihypertensive meds at time of medication questionnaire visit.
        whi_med_y <- filter(dataset_med,
                            (TCCODE >= 330000 & TCCODE <= 349999) |
                            (TCCODE >= 360000 & TCCODE <= 369999) |
                            (TCCODE == 372000) | (TCCODE == 375000) |
                            (TCCODE == 376000) | (TCCODE == 379900))
      
        # For each visit defined by one "F44DAYS", calculate the new variable
        # "MEDSTART" (Medication start days since randomization/enrollment).
        whi_med_yes <- mutate(whi_med_y, MEDSTART = F44DAYS - ADULTDY)
      
        # If the time of taking blood pressure measurements was between MEDSTART and the
        # time of medication questionnaire visit, it means the participant was taking
        # antihypertensive meds at blood pressure measurements.
        whi_med_yes <- mutate(whi_med_yes,
                              meds = ifelse(MEDSTART <= F80DAYS & F80DAYS <= F44DAYS, 1, meds))
      
        # If the time of taking blood pressure measurements was before MEDSTART,
        # it means the participant was not taking antihypertensive meds at blood pressure measurements.
        whi_med_yes <- mutate(whi_med_yes, meds = ifelse(F80DAYS < MEDSTART, 0, meds))
      
        # For participants with multiple medication questionnaire visits, if she was ever assigned the
        # value 1 at the previous steps, her antihypertensive meds status should be 1. If she was
        # assigned both 0 and -1, her antihypertensive meds status should be 0.
        whi_med_yes <- group_by(whi_med_yes, topmed_subject_id) %>%
                       mutate(antihypertensive_meds = max(meds)) %>%
                       ungroup()
      
        # Filter out unique values.
        whi_med_yes <- distinct(select(whi_med_yes, topmed_subject_id, antihypertensive_meds, F80DAYS))
      
        # Subset participants not taking antihypertensive meds at time of medication questionnaire visit.
        whi_med_n <- anti_join(dataset_med, whi_med_y, by = "topmed_subject_id")
      
        # If the time of taking blood pressure measurements was before or the same as the
        # time of medication questionnaire visit, it means the participant was not taking
        # antihypertensive meds at blood pressure measurements.
        whi_med_no <- mutate(whi_med_n, meds = ifelse(F80DAYS <= F44DAYS, 0, meds))
      
        # If a participant had multiple medication questionnaire visits, as long as she was assigned the
        # value 0 at the previous step, her antihypertensive meds status should be 0.
        whi_med_no <- group_by(whi_med_no, topmed_subject_id) %>%
                      mutate(antihypertensive_meds = max(meds)) %>%
                      ungroup()
      
        # Filter out unique values.
        whi_med_no <- distinct(select(whi_med_no, topmed_subject_id, antihypertensive_meds, F80DAYS))
      
        # Combine datasets.
        whi_med_all <- bind_rows(whi_med_yes, whi_med_no)
      
        # Convert the encoded value "-1" to "NA" to represent missing meds status.
        whi_med_all$antihypertensive_meds[whi_med_all$antihypertensive_meds == -1] <- NA
      
        # Select the medication variable and time of blood pressure measurement.
        whi_med_all <- select(whi_med_all, topmed_subject_id, antihypertensive_meds, F80DAYS)
      
        # Get age dataset.
        dataset_age <- phen_list$source_data$pht000998
      
        # Substitute the value of 'NA' to missing.
        dataset_age$F2DAYS[dataset_age$F2DAYS %in% 'NA'] <- NA
        dataset_age$AGE[dataset_age$AGE %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset_age <- mutate_if(dataset_age, is.character, as.numeric)
      
        # Join blood pressure dataset and age dataset.
        dataset <- inner_join(whi_med_all, dataset_age, by = "topmed_subject_id")
      
        # Calculate age at blood pressure measurement.
        dataset <- mutate(dataset,
                          age = ifelse(F2DAYS > 0,
                                       AGE + F80DAYS / 365.25,
                                       AGE + (abs(F2DAYS) + F80DAYS) / 365.25))
      
        # Select the output variables.
        dataset <- select(dataset, topmed_subject_id, antihypertensive_meds, age)
      
        # Convert variable types.
        dataset <- mutate(dataset, antihypertensive_meds = as.character(antihypertensive_meds))
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_diastolic_1"></a>
## blood_pressure: **bp_diastolic_1** (bp_diastolic)
  Resting diastolic blood pressure from the upper arm in a clinical setting.
  * **Harmonization Units**:
    * [Amish](#bp_diastolic_1-amish)
    * [ARIC](#bp_diastolic_1-aric)
    * [CARDIA](#bp_diastolic_1-cardia)
    * [CFS](#bp_diastolic_1-cfs)
    * [CHS](#bp_diastolic_1-chs)
    * [COPDGene](#bp_diastolic_1-copdgene)
    * [FHS_Gen3_NOS_Omni2](#bp_diastolic_1-fhs_gen3_nos_omni2)
    * [FHS_Offspring](#bp_diastolic_1-fhs_offspring)
    * [FHS_Omni1](#bp_diastolic_1-fhs_omni1)
    * [FHS_Original](#bp_diastolic_1-fhs_original)
    * [GENOA](#bp_diastolic_1-genoa)
    * [GOLDN](#bp_diastolic_1-goldn)
    * [HCHS_SOL](#bp_diastolic_1-hchs_sol)
    * [JHS](#bp_diastolic_1-jhs)
    * [MESA](#bp_diastolic_1-mesa)
    * [SAS](#bp_diastolic_1-sas)
    * [WHI](#bp_diastolic_1-whi)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: mmHg, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-07-31 12:33:29
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C2183311
  * **DCC Harmonization Comments**:

    This variable was harmonized by taking the average of two diastolic blood pressure (BP) measurements collected at a single clinic visit. When more than two measurements were collected, the average was calculated using the second and third measurements. In cases where either of the measurements was missing, the average was calculated discarding the missing value. If a study used a random-zero sphygmomanometer and the variables representing the zero readings were available in dbGaP, the zero reading adjustments were applied in the harmonization. In cases where the individual BP measurements were not available in dbGaP, a mean diastolic BP variable derived by the study was used for harmonization. For paired systolic and diastolic BP measurements, if one of the paired measurements was missing or the systolic BP was less than the diastolic BP, the values for both systolic BP and diastolic BP for that pair were set to missing. This harmonized variable was not adjusted for antihypertensive medication status.
    
    #### ARIC
    
    Two subjects had a mean diastolic BP value of zero after adjusting for random zero correction. These values were kept in the harmonized diastolic BP dataset.  
    
    #### COPDGene
    
    Only one blood pressure measurement was available for each subject at baseline, so an average diastolic BP value could not be calculated. The single measurement was used for harmonization of diastolic BP.
    
    #### FHS
    
    Because antihypertensive medication was not recorded before Exam 4 for the Original cohort, diastolic BP values from Exam 4 were used for harmonization.
    
    #### GOLDN
    
    Only one blood pressure measurement was available for each subject at baseline, so an average diastolic BP value could not be calculated. The single measurement was used for harmonization of diastolic BP.
    
    #### Instrumentation
    
    The instruments used for BP measurements were different among studies, including standard manual sphygmomanometers, random-zero sphygmomanometers, and automated digital blood pressure monitors.
    
<a id="bp_diastolic_1-amish"></a>
  * ### blood_pressure/bp_diastolic_1 -- **Amish**:
    * 3 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00252995.v1`, `phs000956.v2.pht005002.v1.phv00252996.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- phen_list$source_data$pht005002
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        ind <- dataset$age_baseline == "90+"
        dataset$age_baseline[ind] <- "90"
        # Rename variables.
        dataset <- transmute(dataset,
                             topmed_subject_id,
                             bp_systolic = as.numeric(sbp_baseline),
                             bp_diastolic = as.numeric(dbp_baseline),
                             age = as.numeric(age_baseline)) %>%
        # Subset to observations where systolic BP is greater than or equal to diastolic BP.
                   filter(bp_systolic >= bp_diastolic) %>%
        # Select the output variables and remove NAs.
                   select(-bp_systolic) %>%
                   na.omit()
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-aric"></a>
  * ### blood_pressure/bp_diastolic_1 -- **ARIC**:
    * 7 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004192.v2.phv00210284.v1`, `phs000280.v4.pht004192.v2.phv00210285.v1`, `phs000280.v4.pht004192.v2.phv00210286.v1`, `phs000280.v4.pht004192.v2.phv00210287.v1`, `phs000280.v4.pht004192.v2.phv00210288.v1`, `phs000280.v4.pht004192.v2.phv00210289.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Select phenotype dataset.
        dataset <- plyr::join_all(phen_list$source_data)
      
        # Change "NA" to NA.
        dataset$SBPA15[dataset$SBPA15 %in% 'NA'] <- NA
        dataset$SBPA18[dataset$SBPA18 %in% 'NA'] <- NA
        dataset$SBPA16[dataset$SBPA16 %in% 'NA'] <- NA
        dataset$SBPA19[dataset$SBPA19 %in% 'NA'] <- NA
        dataset$SBPA17[dataset$SBPA17 %in% 'NA'] <- NA
        dataset$SBPA20[dataset$SBPA20 %in% 'NA'] <- NA
        dataset$V1AGE01[dataset$V1AGE01 %in% 'NA'] <- NA
      
        dataset$SBPA15[dataset$SBPA15 %in% 'A'] <- NA
        dataset$SBPA18[dataset$SBPA18 %in% 'A'] <- NA
        dataset$SBPA16[dataset$SBPA16 %in% 'A'] <- NA
        dataset$SBPA19[dataset$SBPA19 %in% 'A'] <- NA
        dataset$SBPA17[dataset$SBPA17 %in% 'A'] <- NA
        dataset$SBPA20[dataset$SBPA20 %in% 'A'] <- NA
        dataset$V1AGE01[dataset$V1AGE01 %in% 'A'] <- NA
      
        # Rename variables and convert to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric) %>%
                   rename(sbp_2 = SBPA15,
                          sbp_3 = SBPA18,
                          dbp_2 = SBPA16,
                          dbp_3 = SBPA19,
                          zero_2 = SBPA17,
                          zero_3 = SBPA20,
                          age = V1AGE01)
      
        # Use Random zero correction for BP values.
        dataset$dbp_2_RZ <- dataset$dbp_2 - dataset$zero_2
        dataset$dbp_3_RZ <- dataset$dbp_3 - dataset$zero_3
      
        dataset$sbp_2_RZ <- dataset$sbp_2 - dataset$zero_2
        dataset$sbp_3_RZ <- dataset$sbp_3 - dataset$zero_3
      
        # Check SBP is greater than or equal to DBP.
        dataset <- mutate(dataset, sbp_2_RZ = ifelse(sbp_2_RZ >= dbp_2_RZ, sbp_2_RZ, NA))
        dataset <- mutate(dataset, sbp_3_RZ = ifelse(sbp_3_RZ >= dbp_3_RZ, sbp_3_RZ, NA))
        dataset <- mutate(dataset, dbp_2_RZ = ifelse(sbp_2_RZ >= dbp_2_RZ, dbp_2_RZ, NA))
        dataset <- mutate(dataset, dbp_3_RZ = ifelse(sbp_3_RZ >= dbp_3_RZ, dbp_3_RZ, NA))
      
        # Subset R-Z corrected DBP.
        dataset_RZ <- dataset %>%
                      select(topmed_subject_id, dbp_2_RZ, dbp_3_RZ)
      
        # Take the mean of DBP
        vars <- c("dbp_2_RZ", "dbp_3_RZ")
        dataset$bp_diastolic <- rowMeans(dataset_RZ[, vars], na.rm = TRUE)
      
        # Exclude rows with NAs.
        dataset <- dataset %>%
                   select(topmed_subject_id, age, bp_diastolic) %>%
                   na.omit()
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-cardia"></a>
  * ### blood_pressure/bp_diastolic_1 -- **CARDIA**:
    * 9 component_study_variables: `phs000285.v3.pht001560.v2.phv00112481.v2`, `phs000285.v3.pht001560.v2.phv00112482.v2`, `phs000285.v3.pht001560.v2.phv00112483.v2`, `phs000285.v3.pht001560.v2.phv00112484.v2`, `phs000285.v3.pht001560.v2.phv00112487.v2`, `phs000285.v3.pht001560.v2.phv00112488.v2`, `phs000285.v3.pht001560.v2.phv00112489.v2`, `phs000285.v3.pht001560.v2.phv00112490.v2`, `phs000285.v3.pht001645.v2.phv00115119.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- inner_join(phen_list$source_data$pht001560,
                              phen_list$source_data$pht001645,
                              by = "topmed_subject_id")
      
        # Substitute the value of 'M' to missing.
        dataset$A02R2S[dataset$A02R2S %in% 'M'] <- NA
        dataset$A02RZ2S[dataset$A02RZ2S %in% 'M'] <- NA
        dataset$A02R2D[dataset$A02R2D %in% 'M'] <- NA
        dataset$A02RZ2D[dataset$A02RZ2D %in% 'M'] <- NA
        dataset$A02R3S[dataset$A02R3S %in% 'M'] <- NA
        dataset$A02RZ3S[dataset$A02RZ3S %in% 'M'] <- NA
        dataset$A02R3D[dataset$A02R3D %in% 'M'] <- NA
        dataset$A02RZ3D[dataset$A02RZ3D %in% 'M'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Calculate random-zero corrected BP readings.
        dataset <- mutate(dataset,
                          sbp2 = A02R2S - A02RZ2S,
                          dbp2 = A02R2D - A02RZ2D,
                          sbp3 = A02R3S - A02RZ3S,
                          dbp3 = A02R3D - A02RZ3D)
      
        # Set diastolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when systolic BP from the same reading is NA.
        dataset <- mutate(dataset,
                          dbp2 = ifelse(sbp2 >= dbp2, dbp2, NA),
                          dbp3 = ifelse(sbp3 >= dbp3, dbp3, NA))
      
        # Calculate the average diastolic BP.
        dataset$bp_diastolic <- rowMeans(dataset[, c("dbp2", "dbp3")], na.rm = TRUE)
      
        # Rename and select the output variables.
        dataset <- rename(dataset, age = EXAMAGE) %>%
                   select(topmed_subject_id, bp_diastolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-cfs"></a>
  * ### blood_pressure/bp_diastolic_1 -- **CFS**:
    * 4 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00123001.v1`, `phs000284.v1.pht001902.v1.phv00123002.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dataset_tmp <- phen_list$source_data$pht001902 %>%
      
        # Convert from character to numeric.
                       mutate_if(is.character, as.numeric) %>%
      
        # Filter for baseline visit only.
                       filter(visit == 5) %>%
      
        # Check for inconsistencies between systolic and diastolic values.
                       filter(sbp >= dbp)
      
        # Create dataset.
        dataset <- dataset_tmp %>%
                   select(topmed_subject_id, age, bp_diastolic = dbp) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-chs"></a>
  * ### blood_pressure/bp_diastolic_1 -- **CHS**:
    * 3 component_study_variables: `phs000287.v6.pht001452.v1.phv00100435.v1`, `phs000287.v6.pht001452.v1.phv00100436.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- phen_list$source_data$pht001452 %>%
      
        # Convert from character to numeric
                   mutate_if(is.character, as.numeric) %>%
      
        # Check for inconsistencies between systolic and diastolic values
                   filter(AVZMSYS >= AVZMDIA) %>%
      
        # Select diastolic blood pressure
                   select(topmed_subject_id, AGEBL, AVZMDIA) %>%
      
        # Rename variables
                   rename(age = AGEBL, bp_diastolic = AVZMDIA) %>%
      
        # Remove NAs
                   na.omit()
      
        return(dataset)
      
      }
      ```
<a id="bp_diastolic_1-copdgene"></a>
  * ### blood_pressure/bp_diastolic_1 -- **COPDGene**:
    * 3 component_study_variables: `phs000179.v5.pht002239.v4.phv00159583.v4`, `phs000179.v5.pht002239.v4.phv00159590.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- phen_list$source_data$pht002239
      
        # Substitute the value of 'NA' to missing.
        dataset$sysBP[dataset$sysBP %in% 'NA'] <- NA
        dataset$diasBP[dataset$diasBP %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Set diastolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when systolic BP from the same reading is NA.
        dataset <- mutate(dataset, bp_diastolic = ifelse(sysBP >= diasBP, diasBP, NA))
      
        # Rename and select the output variables.
        dataset <- rename(dataset, age = Age_Enroll) %>%
                   select(topmed_subject_id, bp_diastolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-fhs_gen3_nos_omni2"></a>
  * ### blood_pressure/bp_diastolic_1 -- **FHS_Gen3_NOS_Omni2**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht006026.v1.phv00277034.v1`, `phs000007.v29.pht006026.v1.phv00277045.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- inner_join(phen_list$source_data$pht006026,
                              phen_list$source_data$pht003099,
                              by = "topmed_subject_id") %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric) %>%
      
          # Check SBP >= DBP.
          filter(SBP1 >= DBP1) %>%
      
          # Rename variables.
          rename(bp_diastolic = DBP1, age = age1) %>%
      
          # Select relevant columns for harmonized dataset.
          select(topmed_subject_id, age, bp_diastolic) %>%
      
          # Remove NAs.
          na.omit()
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-fhs_offspring"></a>
  * ### blood_pressure/bp_diastolic_1 -- **FHS_Offspring**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht006027.v1.phv00277137.v1`, `phs000007.v29.pht006027.v1.phv00277185.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- inner_join(phen_list$source_data$pht006027,
                              phen_list$source_data$pht003099,
                              by = "topmed_subject_id") %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric) %>%
      
          # Check SBP >= DBP.
          filter(SBP1 >= DBP1) %>%
      
          # Rename variables.
          rename(bp_diastolic = DBP1, age = age1) %>%
      
          # Select relevant columns for harmonized dataset.
          select(topmed_subject_id, age, bp_diastolic) %>%
      
          # Remove NAs.
          na.omit()
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-fhs_omni1"></a>
  * ### blood_pressure/bp_diastolic_1 -- **FHS_Omni1**:
    * 5 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht004813.v1.phv00250561.v1`, `phs000007.v29.pht004813.v1.phv00250562.v1`, `phs000007.v29.pht004813.v1.phv00250652.v1`, `phs000007.v29.pht004813.v1.phv00250653.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- plyr::join_all(phen_list$source_data) %>%
      
          # Rename variables.
          rename(sbp_1 = e485, dbp_1 = e486, sbp_2 = e581, dbp_2 = e582, age = age1) %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric)
      
        # Filter for values in which sbp is greater than or equal to dbp.
        dataset <- mutate(dataset, sbp_1 = ifelse(sbp_1 >= dbp_1, sbp_1, NA))
        dataset <- mutate(dataset, sbp_2 = ifelse(sbp_2 >= dbp_2, sbp_2, NA))
        dataset <- mutate(dataset, dbp_1 = ifelse(sbp_1 >= dbp_1, dbp_1, NA))
        dataset <- mutate(dataset, dbp_2 = ifelse(sbp_2 >= dbp_2, dbp_2, NA))
      
        # Subset DBP values.
        dataset_2 <- dataset %>%
          select(topmed_subject_id, dbp_1, dbp_2)
      
        # Take the mean of DBP
        vars <- c("dbp_1", "dbp_2")
        dataset$bp_diastolic <- rowMeans(dataset_2[, vars], na.rm = TRUE)
      
        # Select columns for harmonization dataset.
        dataset <- select(dataset, topmed_subject_id, age, bp_diastolic)
      
        # Remove NAs
        dataset <- na.omit(dataset)
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-fhs_original"></a>
  * ### blood_pressure/bp_diastolic_1 -- **FHS_Original**:
    * 5 component_study_variables: `phs000007.v29.pht000009.v2.phv00000719.v1`, `phs000007.v29.pht000009.v2.phv00000720.v1`, `phs000007.v29.pht000009.v2.phv00000721.v1`, `phs000007.v29.pht000009.v2.phv00000722.v1`, `phs000007.v29.pht003099.v4.phv00177936.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- plyr::join_all(phen_list$source_data) %>%
      
          # Rename variables.
          rename(sbp_1 = MF264, dbp_1 = MF265, sbp_2 = MF266, dbp_2 = MF267, age = age4) %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric)
      
        # Filter for values in which sbp is greater than or equal to dbp.
        dataset <- mutate(dataset, sbp_1 = ifelse(sbp_1 >= dbp_1, sbp_1, NA))
        dataset <- mutate(dataset, sbp_2 = ifelse(sbp_2 >= dbp_2, sbp_2, NA))
        dataset <- mutate(dataset, dbp_1 = ifelse(sbp_1 >= dbp_1, dbp_1, NA))
        dataset <- mutate(dataset, dbp_2 = ifelse(sbp_2 >= dbp_2, dbp_2, NA))
      
        # Subset DBP values.
        dataset_2 <- dataset %>%
          select(topmed_subject_id, dbp_1, dbp_2)
      
        # Take the mean of DBP
        vars <- c("dbp_1", "dbp_2")
        dataset$bp_diastolic <- rowMeans(dataset_2[, vars], na.rm = TRUE)
      
        # Select columns for harmonization dataset.
        dataset <- select(dataset, topmed_subject_id, age, bp_diastolic)
      
        # Remove NAs
        dataset <- na.omit(dataset)
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-genoa"></a>
  * ### blood_pressure/bp_diastolic_1 -- **GENOA**:
    * 10 component_study_variables: `phs001238.v1.pht006039.v1.phv00277507.v1`, `phs001238.v1.pht006039.v1.phv00277520.v1`, `phs001238.v1.pht006039.v1.phv00277521.v1`, `phs001238.v1.pht006039.v1.phv00277522.v1`, `phs001238.v1.pht006039.v1.phv00277523.v1`, `phs001238.v1.pht006653.v1.phv00307788.v1`, `phs001238.v1.pht006653.v1.phv00307801.v1`, `phs001238.v1.pht006653.v1.phv00307802.v1`, `phs001238.v1.pht006653.v1.phv00307803.v1`, `phs001238.v1.pht006653.v1.phv00307804.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- union(phen_list$source_data$pht006039, phen_list$source_data$pht006653)
      
        # Substitute the value of 'NA' to missing.
        dataset$RAND_SYS2[dataset$RAND_SYS2 %in% 'NA'] <- NA
        dataset$RAND_DIA2[dataset$RAND_DIA2 %in% 'NA'] <- NA
        dataset$RAND_SYS3[dataset$RAND_SYS3 %in% 'NA'] <- NA
        dataset$RAND_DIA3[dataset$RAND_DIA3 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Set diastolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when systolic BP from the same reading is NA.
        dataset <- mutate(dataset,
                          dbp2 = ifelse(RAND_SYS2 >= RAND_DIA2, RAND_DIA2, NA),
                          dbp3 = ifelse(RAND_SYS3 >= RAND_DIA3, RAND_DIA3, NA))
      
        # Calculate the average systolic BP.
        dataset$bp_diastolic <- rowMeans(dataset[, c("dbp2", "dbp3")], na.rm = TRUE)
      
        # Rename and select the output variables.
        dataset <- rename(dataset, age = AGE) %>%
                   select(topmed_subject_id, bp_diastolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-goldn"></a>
  * ### blood_pressure/bp_diastolic_1 -- **GOLDN**:
    * 3 component_study_variables: `phs000741.v2.pht003918.v2.phv00202104.v2`, `phs000741.v2.pht003918.v2.phv00259052.v1`, `phs000741.v2.pht003918.v2.phv00259053.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- phen_list$source_data$pht003918
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Set diastolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when systolic BP from the same reading is NA.
        dataset <- mutate(dataset, bp_diastolic = ifelse(SBP >= DBP, DBP, NA))
      
        # Select the output variables.
        dataset <- select(dataset, topmed_subject_id, bp_diastolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-hchs_sol"></a>
  * ### blood_pressure/bp_diastolic_1 -- **HCHS_SOL**:
    * 3 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226390.v1`, `phs000810.v1.pht004715.v1.phv00226391.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Select phenotype dataset.
        dataset <- phen_list$source_data$pht004715 %>%
        # Convert character variables to numeric.
                   mutate_if(is.character, as.numeric) %>%
        # Subset to observations where SBP is greater than or equal to DBP.
                   filter(SBPA5 >= SBPA6) %>%
        # Rename variables.
                   select(topmed_subject_id, bp_diastolic = SBPA6, age = AGE) %>%
        # Exclude rows with NAs.
                   na.omit()
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-jhs"></a>
  * ### blood_pressure/bp_diastolic_1 -- **JHS**:
    * 7 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001974.v1.phv00128370.v1`, `phs000286.v5.pht001974.v1.phv00128371.v1`, `phs000286.v5.pht001974.v1.phv00128372.v1`, `phs000286.v5.pht001974.v1.phv00128373.v1`, `phs000286.v5.pht001974.v1.phv00128374.v1`, `phs000286.v5.pht001974.v1.phv00128375.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- inner_join(phen_list$source_data$pht001949,
                              phen_list$source_data$pht001974,
                              by = "topmed_subject_id")
      
        # Substitute the value of 'NA' to missing.
        dataset$SBPA13[dataset$SBPA13 %in% 'NA'] <- NA
        dataset$SBPA14[dataset$SBPA14 %in% 'NA'] <- NA
        dataset$SBPA15[dataset$SBPA15 %in% 'NA'] <- NA
        dataset$SBPA16[dataset$SBPA16 %in% 'NA'] <- NA
        dataset$SBPA17[dataset$SBPA17 %in% 'NA'] <- NA
        dataset$SBPA18[dataset$SBPA18 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Calculate random-zero corrected BP readings.
        dataset <- mutate(dataset,
                          sbp1 = SBPA13 - SBPA15,
                          dbp1 = SBPA14 - SBPA15,
                          sbp2 = SBPA16 - SBPA18,
                          dbp2 = SBPA17 - SBPA18)
      
        # Set diastolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when systolic BP from the same reading is NA.
        dataset <- mutate(dataset,
                          dbp1 = ifelse(sbp1 >= dbp1, dbp1, NA),
                          dbp2 = ifelse(sbp2 >= dbp2, dbp2, NA))
      
        # Calculate the average diastolic BP.
        dataset$bp_diastolic <- rowMeans(dataset[, c("dbp1", "dbp2")], na.rm = TRUE)
      
        # Rename and select the output variables.
        dataset <- rename(dataset, age = AGE01) %>%
                   select(topmed_subject_id, bp_diastolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-mesa"></a>
  * ### blood_pressure/bp_diastolic_1 -- **MESA**:
    * 15 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00083403.v1`, `phs000209.v13.pht001111.v4.phv00083404.v1`, `phs000209.v13.pht001111.v4.phv00083406.v1`, `phs000209.v13.pht001111.v4.phv00083407.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085735.v2`, `phs000209.v13.pht001116.v10.phv00085736.v2`, `phs000209.v13.pht001116.v10.phv00085737.v2`, `phs000209.v13.pht001116.v10.phv00085738.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087509.v1`, `phs000209.v13.pht001121.v3.phv00087510.v1`, `phs000209.v13.pht001121.v3.phv00087512.v1`, `phs000209.v13.pht001121.v3.phv00087513.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        # Merge pht001111 and pht001116.
        dataset <- rbind(phen_list$source_data$pht001111, phen_list$source_data$pht001116)
      
        # Rename variable names for pht001121.
        dataset_21 <- phen_list$source_data$pht001121 %>%
                      rename(s2bp1 = s2bpf,
                             d2bp1 = d2bpf,
                             s3bp1 = s3bpf,
                             d3bp1 = d3bpf,
                             age1c = agefc)
      
        # Merge pht001121 with previously merged dataset.
        dataset <- rbind(dataset, dataset_21) %>%
      
          # Rename variables.
          rename(sbp_2 = s2bp1, dbp_2 = d2bp1, sbp_3 = s3bp1, dbp_3 = d3bp1, age = age1c) %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric)
      
        # Filter for values in which sbp is greater than or equal to dbp.
        dataset <- mutate(dataset, sbp_2 = ifelse(sbp_2 > dbp_2, sbp_2, NA))
        dataset <- mutate(dataset, sbp_3 = ifelse(sbp_3 > dbp_3, sbp_3, NA))
        dataset <- mutate(dataset, dbp_2 = ifelse(sbp_2 > dbp_2, dbp_2, NA))
        dataset <- mutate(dataset, dbp_3 = ifelse(sbp_3 > dbp_3, dbp_3, NA))
      
        # Subset DBP values.
        dataset_2 <- dataset %>%
          select(topmed_subject_id, dbp_2, dbp_3)
      
        # Take the mean of DBP
        vars <- c("dbp_2", "dbp_3")
        dataset$bp_diastolic <- rowMeans(dataset_2[, vars], na.rm = TRUE)
      
        # Select columns for harmonization dataset.
        dataset <- select(dataset, topmed_subject_id, age, bp_diastolic)
      
        # Remove NAs
        dataset <- na.omit(dataset)
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-sas"></a>
  * ### blood_pressure/bp_diastolic_1 -- **SAS**:
    * 3 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258701.v1`, `phs000914.v1.pht005253.v1.phv00258703.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- phen_list$source_data$pht005253 %>%
        # Rename variables.
                   transmute(topmed_subject_id,
                             age = Dec_Age,
                             bp_diastolic = na_if(Diastolic_BP, "NA"),
                             bp_systolic = na_if(Systolic_BP, "NA")) %>%
                   mutate_at(vars(age, bp_diastolic, bp_systolic), funs(as.numeric)) %>%
        # Subset to observations where systolic BP is greater than or equal to diastolic BP.
                   filter(bp_systolic >= bp_diastolic) %>%
        # Select the output variables and remove NAs.
                   select(-bp_systolic) %>%
                   na.omit()
        return(dataset)
      }
      ```
<a id="bp_diastolic_1-whi"></a>
  * ### blood_pressure/bp_diastolic_1 -- **WHI**:
    * 8 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001019.v6.phv00079850.v6`, `phs000200.v11.pht001019.v6.phv00079852.v6`, `phs000200.v11.pht001019.v6.phv00079854.v6`, `phs000200.v11.pht001019.v6.phv00079855.v6`, `phs000200.v11.pht001019.v6.phv00079856.v6`, `phs000200.v11.pht001019.v6.phv00079857.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get blood pressure dataset.
        dataset <- phen_list$source_data$pht001019
      
        # Subset to baseline visit.
        dataset <- filter(dataset, F80VTYP == 1)
      
        # Substitute the value of 'NA' to missing.
        dataset$SYSTBP1[dataset$SYSTBP1 %in% 'NA'] <- NA
        dataset$DIASBP1[dataset$DIASBP1 %in% 'NA'] <- NA
        dataset$SYSTBP2[dataset$SYSTBP2 %in% 'NA'] <- NA
        dataset$DIASBP2[dataset$DIASBP2 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Set diastolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when systolic BP from the same reading is NA.
        dataset <- mutate(dataset,
                          dbp1 = ifelse(SYSTBP1 >= DIASBP1, DIASBP1, NA),
                          dbp2 = ifelse(SYSTBP2 >= DIASBP2, DIASBP2, NA))
      
        # Calculate the average diastolic BP.
        dataset$bp_diastolic <- rowMeans(dataset[, c("dbp1", "dbp2")], na.rm = TRUE)
      
        # Select the blood pressure variables.
        dataset <- select(dataset, topmed_subject_id, bp_diastolic, F80DAYS)
      
        # Get age dataset.
        dataset_age <- phen_list$source_data$pht000998
      
        # Substitute the value of 'NA' to missing.
        dataset_age$F2DAYS[dataset_age$F2DAYS %in% 'NA'] <- NA
        dataset_age$AGE[dataset_age$AGE %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset_age <- mutate_if(dataset_age, is.character, as.numeric)
      
        # Join blood pressure dataset and age dataset.
        dataset <- inner_join(dataset, dataset_age, by = "topmed_subject_id")
      
        # Calculate age at blood pressure measurement.
        dataset <- mutate(dataset,
                          age = ifelse(F2DAYS > 0,
                                       AGE + F80DAYS / 365.25,
                                       AGE + (abs(F2DAYS) + F80DAYS) / 365.25))
      
        # Select the output variables.
        dataset <- select(dataset, topmed_subject_id, bp_diastolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_systolic_1"></a>
## blood_pressure: **bp_systolic_1** (bp_systolic)
  Resting systolic blood pressure from the upper arm in a clinical setting.
  * **Harmonization Units**:
    * [Amish](#bp_systolic_1-amish)
    * [ARIC](#bp_systolic_1-aric)
    * [CARDIA](#bp_systolic_1-cardia)
    * [CFS](#bp_systolic_1-cfs)
    * [CHS](#bp_systolic_1-chs)
    * [COPDGene](#bp_systolic_1-copdgene)
    * [FHS_Gen3_NOS_Omni2](#bp_systolic_1-fhs_gen3_nos_omni2)
    * [FHS_Offspring](#bp_systolic_1-fhs_offspring)
    * [FHS_Omni1](#bp_systolic_1-fhs_omni1)
    * [FHS_Original](#bp_systolic_1-fhs_original)
    * [GENOA](#bp_systolic_1-genoa)
    * [GOLDN](#bp_systolic_1-goldn)
    * [HCHS_SOL](#bp_systolic_1-hchs_sol)
    * [JHS](#bp_systolic_1-jhs)
    * [MESA](#bp_systolic_1-mesa)
    * [SAS](#bp_systolic_1-sas)
    * [WHI](#bp_systolic_1-whi)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: mmHg, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-07-31 12:02:39
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C2039694
  * **DCC Harmonization Comments**:

    This variable was harmonized by taking the average of two systolic blood pressure (BP) measurements collected at a single clinic visit. When more than two measurements were collected, the average was calculated using the second and third measurements. In cases where either of the measurements was missing, the average was calculated discarding the missing value. If a study used a random-zero sphygmomanometer and the variables representing the zero readings were available in dbGaP, the zero reading adjustments were applied in the harmonization. In cases where the individual BP measurements were not available in dbGaP, a mean systolic BP variable derived by the study was used for harmonization. For paired systolic and diastolic BP measurements, if one of the paired measurements was missing or the systolic BP was less than the diastolic BP, the values for both systolic BP and diastolic BP for that pair were set to missing. This harmonized variable was not adjusted for antihypertensive medication status.
    
    #### COPDGene
    
    Only one blood pressure measurement was available for each subject at baseline, so an average systolic BP value could not be calculated. The single measurement was used for harmonization of systolic BP.
    
    #### FHS
    
    Because antihypertensive medication was not recorded before Exam 4 for the Original cohort, systolic BP values from Exam 4 were used for harmonization.
    
    #### GOLDN
    
    Only one blood pressure measurement was available for each subject at baseline, so an average systolic BP value could not be calculated. The single measurement was used for harmonization of systolic BP.
    
    #### Instrumentation
    
    The instruments used for BP measurements were different among studies, including standard manual sphygmomanometers, random-zero sphygmomanometers, and automated digital blood pressure monitors.
    
<a id="bp_systolic_1-amish"></a>
  * ### blood_pressure/bp_systolic_1 -- **Amish**:
    * 3 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00252995.v1`, `phs000956.v2.pht005002.v1.phv00252996.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- phen_list$source_data$pht005002
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        ind <- dataset$age_baseline == "90+"
        dataset$age_baseline[ind] <- "90"
        # Rename variables.
        dataset <- transmute(dataset,
                             topmed_subject_id,
                             bp_systolic = as.numeric(sbp_baseline),
                             bp_diastolic = as.numeric(dbp_baseline),
                             age = as.numeric(age_baseline)) %>%
        # Subset to observations where systolic BP is greater than or equal to diastolic BP.
                   filter(bp_systolic >= bp_diastolic) %>%
        # Select the output variables and remove NAs.
                   select(-bp_diastolic) %>%
                   na.omit()
        return(dataset)
      }
      ```
<a id="bp_systolic_1-aric"></a>
  * ### blood_pressure/bp_systolic_1 -- **ARIC**:
    * 7 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004192.v2.phv00210284.v1`, `phs000280.v4.pht004192.v2.phv00210285.v1`, `phs000280.v4.pht004192.v2.phv00210286.v1`, `phs000280.v4.pht004192.v2.phv00210287.v1`, `phs000280.v4.pht004192.v2.phv00210288.v1`, `phs000280.v4.pht004192.v2.phv00210289.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Select phenotype dataset.
        dataset <- plyr::join_all(phen_list$source_data)
      
        # Change "NA" to NA.
        dataset$SBPA15[dataset$SBPA15 %in% 'NA'] <- NA
        dataset$SBPA18[dataset$SBPA18 %in% 'NA'] <- NA
        dataset$SBPA16[dataset$SBPA16 %in% 'NA'] <- NA
        dataset$SBPA19[dataset$SBPA19 %in% 'NA'] <- NA
        dataset$SBPA17[dataset$SBPA17 %in% 'NA'] <- NA
        dataset$SBPA20[dataset$SBPA20 %in% 'NA'] <- NA
        dataset$V1AGE01[dataset$V1AGE01 %in% 'NA'] <- NA
      
        dataset$SBPA15[dataset$SBPA15 %in% 'A'] <- NA
        dataset$SBPA18[dataset$SBPA18 %in% 'A'] <- NA
        dataset$SBPA16[dataset$SBPA16 %in% 'A'] <- NA
        dataset$SBPA19[dataset$SBPA19 %in% 'A'] <- NA
        dataset$SBPA17[dataset$SBPA17 %in% 'A'] <- NA
        dataset$SBPA20[dataset$SBPA20 %in% 'A'] <- NA
        dataset$V1AGE01[dataset$V1AGE01 %in% 'A'] <- NA
      
        # Rename variables and convert to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric) %>%
                   rename(sbp_2 = SBPA15,
                          sbp_3 = SBPA18,
                          dbp_2 = SBPA16,
                          dbp_3 = SBPA19,
                          zero_2 = SBPA17,
                          zero_3 = SBPA20,
                          age = V1AGE01)
      
        # Use Random zero correction for SBP and DBP values.
        dataset$sbp_2_RZ <- dataset$sbp_2 - dataset$zero_2
        dataset$sbp_3_RZ <- dataset$sbp_3 - dataset$zero_3
      
        dataset$dbp_2_RZ <- dataset$dbp_2 - dataset$zero_2
        dataset$dbp_3_RZ <- dataset$dbp_3 - dataset$zero_3
      
        # Check SBP value is greater than or equal to DBP value.
        dataset <- mutate(dataset, sbp_2_RZ = ifelse(sbp_2_RZ >= dbp_2_RZ, sbp_2_RZ, NA))
        dataset <- mutate(dataset, sbp_3_RZ = ifelse(sbp_3_RZ >= dbp_3_RZ, sbp_3_RZ, NA))
        dataset <- mutate(dataset, dbp_2_RZ = ifelse(sbp_2_RZ >= dbp_2_RZ, dbp_2_RZ, NA))
        dataset <- mutate(dataset, dbp_3_RZ = ifelse(sbp_3_RZ >= dbp_3_RZ, dbp_3_RZ, NA))
      
        # Subset R-Z corrected SBP.
        dataset_RZ <- dataset %>%
                      select(topmed_subject_id, sbp_2_RZ, sbp_3_RZ)
      
        # Take the mean of SBP
        vars <- c("sbp_2_RZ", "sbp_3_RZ")
        dataset$bp_systolic <- rowMeans(dataset_RZ[, vars], na.rm = TRUE)
      
        # Exclude rows with NAs.
        dataset <- dataset %>%
                   select(topmed_subject_id, age, bp_systolic) %>%
                   na.omit()
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_systolic_1-cardia"></a>
  * ### blood_pressure/bp_systolic_1 -- **CARDIA**:
    * 9 component_study_variables: `phs000285.v3.pht001560.v2.phv00112481.v2`, `phs000285.v3.pht001560.v2.phv00112482.v2`, `phs000285.v3.pht001560.v2.phv00112483.v2`, `phs000285.v3.pht001560.v2.phv00112484.v2`, `phs000285.v3.pht001560.v2.phv00112487.v2`, `phs000285.v3.pht001560.v2.phv00112488.v2`, `phs000285.v3.pht001560.v2.phv00112489.v2`, `phs000285.v3.pht001560.v2.phv00112490.v2`, `phs000285.v3.pht001645.v2.phv00115119.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- inner_join(phen_list$source_data$pht001560,
                              phen_list$source_data$pht001645,
                              by = "topmed_subject_id")
      
        # Substitute the value of 'M' to missing.
        dataset$A02R2S[dataset$A02R2S %in% 'M'] <- NA
        dataset$A02RZ2S[dataset$A02RZ2S %in% 'M'] <- NA
        dataset$A02R2D[dataset$A02R2D %in% 'M'] <- NA
        dataset$A02RZ2D[dataset$A02RZ2D %in% 'M'] <- NA
        dataset$A02R3S[dataset$A02R3S %in% 'M'] <- NA
        dataset$A02RZ3S[dataset$A02RZ3S %in% 'M'] <- NA
        dataset$A02R3D[dataset$A02R3D %in% 'M'] <- NA
        dataset$A02RZ3D[dataset$A02RZ3D %in% 'M'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Calculate random-zero corrected BP readings.
        dataset <- mutate(dataset,
                          sbp2 = A02R2S - A02RZ2S,
                          dbp2 = A02R2D - A02RZ2D,
                          sbp3 = A02R3S - A02RZ3S,
                          dbp3 = A02R3D - A02RZ3D)
      
        # Set systolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when diastolic BP from the same reading is NA.
        dataset <- mutate(dataset,
                          sbp2 = ifelse(sbp2 >= dbp2, sbp2, NA),
                          sbp3 = ifelse(sbp3 >= dbp3, sbp3, NA))
      
        # Calculate the average systolic BP.
        dataset$bp_systolic <- rowMeans(dataset[, c("sbp2", "sbp3")], na.rm = TRUE)
      
        # Rename and select the output variables.
        dataset <- rename(dataset, age = EXAMAGE) %>%
                   select(topmed_subject_id, bp_systolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_systolic_1-cfs"></a>
  * ### blood_pressure/bp_systolic_1 -- **CFS**:
    * 4 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00123001.v1`, `phs000284.v1.pht001902.v1.phv00123002.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dataset_tmp <- phen_list$source_data$pht001902 %>%
      
        # Convert from character to numeric.
                       mutate_if(is.character, as.numeric) %>%
      
        # Filter for baseline visit only
                       filter(visit == 5) %>%
      
        # Check for inconsistencies between systolic and diastolic values.
                       filter(sbp >= dbp)
      
        # Create dataset.
        dataset <- dataset_tmp %>%
                   select(topmed_subject_id, age, bp_systolic = sbp) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="bp_systolic_1-chs"></a>
  * ### blood_pressure/bp_systolic_1 -- **CHS**:
    * 3 component_study_variables: `phs000287.v6.pht001452.v1.phv00100435.v1`, `phs000287.v6.pht001452.v1.phv00100436.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- phen_list$source_data$pht001452 %>%
      
        # Convert from character to numeric
                   mutate_if(is.character, as.numeric) %>%
      
        # Check for inconsistencies between systolic and diastolic values
                   filter(AVZMSYS >= AVZMDIA) %>%
      
        # Select systolic blood pressure
                   select(topmed_subject_id, AGEBL, AVZMSYS) %>%
      
        # Rename variables
                   rename(age = AGEBL, bp_systolic = AVZMSYS) %>%
      
        # Remove NAs
                   na.omit()
      
        return(dataset)
      
      }
      ```
<a id="bp_systolic_1-copdgene"></a>
  * ### blood_pressure/bp_systolic_1 -- **COPDGene**:
    * 3 component_study_variables: `phs000179.v5.pht002239.v4.phv00159583.v4`, `phs000179.v5.pht002239.v4.phv00159590.v4`, `phs000179.v5.pht002239.v4.phv00159836.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- phen_list$source_data$pht002239
      
        # Substitute the value of 'NA' to missing.
        dataset$sysBP[dataset$sysBP %in% 'NA'] <- NA
        dataset$diasBP[dataset$diasBP %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Set systolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when diastolic BP from the same reading is NA.
        dataset <- mutate(dataset, bp_systolic = ifelse(sysBP >= diasBP, sysBP, NA))
      
        # Rename and select the output variables.
        dataset <- rename(dataset, age = Age_Enroll) %>%
                   select(topmed_subject_id, bp_systolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_systolic_1-fhs_gen3_nos_omni2"></a>
  * ### blood_pressure/bp_systolic_1 -- **FHS_Gen3_NOS_Omni2**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht006026.v1.phv00277034.v1`, `phs000007.v29.pht006026.v1.phv00277045.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- inner_join(phen_list$source_data$pht006026,
                              phen_list$source_data$pht003099,
                              by = "topmed_subject_id") %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric) %>%
      
          # Check SBP >= DBP.
          filter(SBP1 >= DBP1) %>%
      
          # Rename variables.
          rename(bp_systolic = SBP1, age = age1) %>%
      
          # Select relevant columns for harmonized dataset.
          select(topmed_subject_id, age, bp_systolic) %>%
      
          # Remove NAs.
          na.omit()
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_systolic_1-fhs_offspring"></a>
  * ### blood_pressure/bp_systolic_1 -- **FHS_Offspring**:
    * 3 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht006027.v1.phv00277137.v1`, `phs000007.v29.pht006027.v1.phv00277185.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- inner_join(phen_list$source_data$pht006027,
                              phen_list$source_data$pht003099,
                              by = "topmed_subject_id") %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric) %>%
      
          # Check SBP >= DBP.
          filter(SBP1 >= DBP1) %>%
      
          # Rename variables.
          rename(bp_systolic = SBP1, age = age1) %>%
      
          # Select relevant columns for harmonized dataset.
          select(topmed_subject_id, age, bp_systolic) %>%
      
          # Remove NAs.
          na.omit()
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_systolic_1-fhs_omni1"></a>
  * ### blood_pressure/bp_systolic_1 -- **FHS_Omni1**:
    * 5 component_study_variables: `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht004813.v1.phv00250561.v1`, `phs000007.v29.pht004813.v1.phv00250562.v1`, `phs000007.v29.pht004813.v1.phv00250652.v1`, `phs000007.v29.pht004813.v1.phv00250653.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- plyr::join_all(phen_list$source_data) %>%
      
          # Rename variables.
          rename(sbp_1 = e485, dbp_1 = e486, sbp_2 = e581, dbp_2 = e582, age = age1) %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric)
      
        # Filter for values in which sbp is greater than or equal to dbp.
        dataset <- mutate(dataset, sbp_1 = ifelse(sbp_1 >= dbp_1, sbp_1, NA))
        dataset <- mutate(dataset, sbp_2 = ifelse(sbp_2 >= dbp_2, sbp_2, NA))
        dataset <- mutate(dataset, dbp_1 = ifelse(sbp_1 >= dbp_1, dbp_1, NA))
        dataset <- mutate(dataset, dbp_2 = ifelse(sbp_2 >= dbp_2, dbp_2, NA))
      
        # Subset SBP values.
        dataset_2 <- dataset %>%
          select(topmed_subject_id, sbp_1, sbp_2)
      
        # Take the mean of SBP
        vars <- c("sbp_1", "sbp_2")
        dataset$bp_systolic <- rowMeans(dataset_2[, vars], na.rm = TRUE)
      
        # Select columns for harmonization dataset.
        dataset <- select(dataset, topmed_subject_id, age, bp_systolic)
      
        # Remove NAs
        dataset <- na.omit(dataset)
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_systolic_1-fhs_original"></a>
  * ### blood_pressure/bp_systolic_1 -- **FHS_Original**:
    * 5 component_study_variables: `phs000007.v29.pht000009.v2.phv00000719.v1`, `phs000007.v29.pht000009.v2.phv00000720.v1`, `phs000007.v29.pht000009.v2.phv00000721.v1`, `phs000007.v29.pht000009.v2.phv00000722.v1`, `phs000007.v29.pht003099.v4.phv00177936.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        dataset <- plyr::join_all(phen_list$source_data) %>%
      
          # Rename variables.
          rename(sbp_1 = MF264, dbp_1 = MF265, sbp_2 = MF266, dbp_2 = MF267, age = age4) %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric)
      
        # Filter for values in which sbp is greater than or equal to dbp.
        dataset <- mutate(dataset, sbp_1 = ifelse(sbp_1 >= dbp_1, sbp_1, NA))
        dataset <- mutate(dataset, sbp_2 = ifelse(sbp_2 >= dbp_2, sbp_2, NA))
        dataset <- mutate(dataset, dbp_1 = ifelse(sbp_1 >= dbp_1, dbp_1, NA))
        dataset <- mutate(dataset, dbp_2 = ifelse(sbp_2 >= dbp_2, dbp_2, NA))
      
        # Subset SBP values.
        dataset_2 <- dataset %>%
          select(topmed_subject_id, sbp_1, sbp_2)
      
        # Take the mean of SBP
        vars <- c("sbp_1", "sbp_2")
        dataset$bp_systolic <- rowMeans(dataset_2[, vars], na.rm = TRUE)
      
        # Select columns for harmonization dataset.
        dataset <- select(dataset, topmed_subject_id, age, bp_systolic)
      
        # Remove NAs
        dataset <- na.omit(dataset)
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_systolic_1-genoa"></a>
  * ### blood_pressure/bp_systolic_1 -- **GENOA**:
    * 10 component_study_variables: `phs001238.v1.pht006039.v1.phv00277507.v1`, `phs001238.v1.pht006039.v1.phv00277520.v1`, `phs001238.v1.pht006039.v1.phv00277521.v1`, `phs001238.v1.pht006039.v1.phv00277522.v1`, `phs001238.v1.pht006039.v1.phv00277523.v1`, `phs001238.v1.pht006653.v1.phv00307788.v1`, `phs001238.v1.pht006653.v1.phv00307801.v1`, `phs001238.v1.pht006653.v1.phv00307802.v1`, `phs001238.v1.pht006653.v1.phv00307803.v1`, `phs001238.v1.pht006653.v1.phv00307804.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- union(phen_list$source_data$pht006039, phen_list$source_data$pht006653)
      
        # Substitute the value of 'NA' to missing.
        dataset$RAND_SYS2[dataset$RAND_SYS2 %in% 'NA'] <- NA
        dataset$RAND_DIA2[dataset$RAND_DIA2 %in% 'NA'] <- NA
        dataset$RAND_SYS3[dataset$RAND_SYS3 %in% 'NA'] <- NA
        dataset$RAND_DIA3[dataset$RAND_DIA3 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Set systolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when diastolic BP from the same reading is NA.
        dataset <- mutate(dataset,
                          sbp2 = ifelse(RAND_SYS2 >= RAND_DIA2, RAND_SYS2, NA),
                          sbp3 = ifelse(RAND_SYS3 >= RAND_DIA3, RAND_SYS3, NA))
      
        # Calculate the average systolic BP.
        dataset$bp_systolic <- rowMeans(dataset[, c("sbp2", "sbp3")], na.rm = TRUE)
      
        # Rename and select the output variables.
        dataset <- rename(dataset, age = AGE) %>%
                   select(topmed_subject_id, bp_systolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_systolic_1-goldn"></a>
  * ### blood_pressure/bp_systolic_1 -- **GOLDN**:
    * 3 component_study_variables: `phs000741.v2.pht003918.v2.phv00202104.v2`, `phs000741.v2.pht003918.v2.phv00259052.v1`, `phs000741.v2.pht003918.v2.phv00259053.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- phen_list$source_data$pht003918
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Set systolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when diastolic BP from the same reading is NA.
        dataset <- mutate(dataset, bp_systolic = ifelse(SBP >= DBP, SBP, NA))
      
        # Select the output variables.
        dataset <- select(dataset, topmed_subject_id, bp_systolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_systolic_1-hchs_sol"></a>
  * ### blood_pressure/bp_systolic_1 -- **HCHS_SOL**:
    * 3 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226390.v1`, `phs000810.v1.pht004715.v1.phv00226391.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Select phenotype dataset.
        dataset <- phen_list$source_data$pht004715 %>%
        # Convert character variables to numeric.
                   mutate_if(is.character, as.numeric) %>%
        # Subset to observations where SBP is greater than or equal to DBP.
                   filter(SBPA5 >= SBPA6) %>%
        # Rename variables.
                   select(topmed_subject_id, bp_systolic = SBPA5, age = AGE) %>%
        # Exclude rows with NAs.
                   na.omit()
        return(dataset)
      }
      ```
<a id="bp_systolic_1-jhs"></a>
  * ### blood_pressure/bp_systolic_1 -- **JHS**:
    * 7 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001974.v1.phv00128370.v1`, `phs000286.v5.pht001974.v1.phv00128371.v1`, `phs000286.v5.pht001974.v1.phv00128372.v1`, `phs000286.v5.pht001974.v1.phv00128373.v1`, `phs000286.v5.pht001974.v1.phv00128374.v1`, `phs000286.v5.pht001974.v1.phv00128375.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- inner_join(phen_list$source_data$pht001949,
                              phen_list$source_data$pht001974,
                              by = "topmed_subject_id")
      
        # Substitute the value of 'NA' to missing.
        dataset$SBPA13[dataset$SBPA13 %in% 'NA'] <- NA
        dataset$SBPA14[dataset$SBPA14 %in% 'NA'] <- NA
        dataset$SBPA15[dataset$SBPA15 %in% 'NA'] <- NA
        dataset$SBPA16[dataset$SBPA16 %in% 'NA'] <- NA
        dataset$SBPA17[dataset$SBPA17 %in% 'NA'] <- NA
        dataset$SBPA18[dataset$SBPA18 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Calculate random-zero corrected BP readings.
        dataset <- mutate(dataset,
                          sbp1 = SBPA13 - SBPA15,
                          dbp1 = SBPA14 - SBPA15,
                          sbp2 = SBPA16 - SBPA18,
                          dbp2 = SBPA17 - SBPA18)
      
        # Set systolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when diastolic BP from the same reading is NA.
        dataset <- mutate(dataset,
                          sbp1 = ifelse(sbp1 >= dbp1, sbp1, NA),
                          sbp2 = ifelse(sbp2 >= dbp2, sbp2, NA))
      
        # Calculate the average systolic BP.
        dataset$bp_systolic <- rowMeans(dataset[, c("sbp1", "sbp2")], na.rm = TRUE)
      
        # Rename and select the output variables.
        dataset <- rename(dataset, age = AGE01) %>%
                   select(topmed_subject_id, bp_systolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="bp_systolic_1-mesa"></a>
  * ### blood_pressure/bp_systolic_1 -- **MESA**:
    * 15 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00083403.v1`, `phs000209.v13.pht001111.v4.phv00083404.v1`, `phs000209.v13.pht001111.v4.phv00083406.v1`, `phs000209.v13.pht001111.v4.phv00083407.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085735.v2`, `phs000209.v13.pht001116.v10.phv00085736.v2`, `phs000209.v13.pht001116.v10.phv00085737.v2`, `phs000209.v13.pht001116.v10.phv00085738.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087509.v1`, `phs000209.v13.pht001121.v3.phv00087510.v1`, `phs000209.v13.pht001121.v3.phv00087512.v1`, `phs000209.v13.pht001121.v3.phv00087513.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        # Merge pht001111 and pht001116.
        dataset <- rbind(phen_list$source_data$pht001111, phen_list$source_data$pht001116)
      
        # Rename variable names for pht001121.
        dataset_21 <- phen_list$source_data$pht001121 %>%
                      rename(s2bp1 = s2bpf,
                             d2bp1 = d2bpf,
                             s3bp1 = s3bpf,
                             d3bp1 = d3bpf,
                             age1c = agefc)
      
        # Merge pht001121 with previously merged dataset.
        dataset <- rbind(dataset, dataset_21) %>%
      
          # Rename variables.
          rename(sbp_2 = s2bp1, dbp_2 = d2bp1, sbp_3 = s3bp1, dbp_3 = d3bp1, age = age1c) %>%
      
          # Convert from character to numeric.
          mutate_if(is.character, as.numeric)
      
        # Filter for values in which sbp is greater than or equal to dbp.
        dataset <- mutate(dataset, sbp_2 = ifelse(sbp_2 > dbp_2, sbp_2, NA))
        dataset <- mutate(dataset, sbp_3 = ifelse(sbp_3 > dbp_3, sbp_3, NA))
        dataset <- mutate(dataset, dbp_2 = ifelse(sbp_2 > dbp_2, dbp_2, NA))
        dataset <- mutate(dataset, dbp_3 = ifelse(sbp_3 > dbp_3, dbp_3, NA))
      
        # Subset SBP values.
        dataset_2 <- dataset %>%
          select(topmed_subject_id, sbp_2, sbp_3)
      
        # Take the mean of SBP
        vars <- c("sbp_2", "sbp_3")
        dataset$bp_systolic <- rowMeans(dataset_2[, vars], na.rm = TRUE)
      
        # Select columns for harmonization dataset.
        dataset <- select(dataset, topmed_subject_id, age, bp_systolic)
      
        # Remove NAs
        dataset <- na.omit(dataset)
      
        # Return harmonized dataset.
        return(dataset)
      }
      ```
<a id="bp_systolic_1-sas"></a>
  * ### blood_pressure/bp_systolic_1 -- **SAS**:
    * 3 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258701.v1`, `phs000914.v1.pht005253.v1.phv00258703.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get dataset.
        dataset <- phen_list$source_data$pht005253 %>%
        # Rename variables.
               transmute(topmed_subject_id,
                         age = Dec_Age,
                         bp_systolic = na_if(Systolic_BP, "NA"),
                         bp_diastolic = na_if(Diastolic_BP, "NA")) %>%
               mutate_at(vars(age, bp_systolic, bp_diastolic), funs(as.numeric)) %>%
        # Subset to observations where systolic BP is greater than or equal to diastolic BP.
               filter(bp_systolic >= bp_diastolic) %>%
        # Select the output variables and remove NAs.
               select(-bp_diastolic) %>%
               na.omit()
        return(dataset)
      }
      ```
<a id="bp_systolic_1-whi"></a>
  * ### blood_pressure/bp_systolic_1 -- **WHI**:
    * 8 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001019.v6.phv00079850.v6`, `phs000200.v11.pht001019.v6.phv00079852.v6`, `phs000200.v11.pht001019.v6.phv00079854.v6`, `phs000200.v11.pht001019.v6.phv00079855.v6`, `phs000200.v11.pht001019.v6.phv00079856.v6`, `phs000200.v11.pht001019.v6.phv00079857.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Get blood pressure dataset.
        dataset <- phen_list$source_data$pht001019
      
        # Subset to baseline visit.
        dataset <- filter(dataset, F80VTYP == 1)
      
        # Substitute the value of 'NA' to missing.
        dataset$SYSTBP1[dataset$SYSTBP1 %in% 'NA'] <- NA
        dataset$DIASBP1[dataset$DIASBP1 %in% 'NA'] <- NA
        dataset$SYSTBP2[dataset$SYSTBP2 %in% 'NA'] <- NA
        dataset$DIASBP2[dataset$DIASBP2 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Set systolic BP to NA when systolic BP is less than diastolic BP from the same reading
        # or when diastolic BP from the same reading is NA.
        dataset <- mutate(dataset,
                          sbp1 = ifelse(SYSTBP1 >= DIASBP1, SYSTBP1, NA),
                          sbp2 = ifelse(SYSTBP2 >= DIASBP2, SYSTBP2, NA))
      
        # Calculate the average systolic BP.
        dataset$bp_systolic <- rowMeans(dataset[, c("sbp1", "sbp2")], na.rm = TRUE)
      
        # Select the blood pressure variables.
        dataset <- select(dataset, topmed_subject_id, bp_systolic, F80DAYS)
      
        # Get age dataset.
        dataset_age <- phen_list$source_data$pht000998
      
        # Substitute the value of 'NA' to missing.
        dataset_age$F2DAYS[dataset_age$F2DAYS %in% 'NA'] <- NA
        dataset_age$AGE[dataset_age$AGE %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset_age <- mutate_if(dataset_age, is.character, as.numeric)
      
        # Join blood pressure dataset and age dataset.
        dataset <- inner_join(dataset, dataset_age, by = "topmed_subject_id")
      
        # Calculate age at blood pressure measurement.
        dataset <- mutate(dataset,
                          age = ifelse(F2DAYS > 0,
                                       AGE + F80DAYS / 365.25,
                                       AGE + (abs(F2DAYS) + F80DAYS) / 365.25))
      
        # Select the output variables.
        dataset <- select(dataset, topmed_subject_id, bp_systolic, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```

# demographic

### Variables in this section:
* [annotated_sex_1](#annotated_sex_1)
* [geographic_site_1](#geographic_site_1)
* [hispanic_or_latino_1](#hispanic_or_latino_1)
* [hispanic_subgroup_1](#hispanic_subgroup_1)
* [race_us_1](#race_us_1)
* [subcohort_1](#subcohort_1)

<a id="annotated_sex_1"></a>
## demographic: **annotated_sex_1** (annotated_sex)
  Subject sex, as recorded by the study.
  * **Harmonization Units**:
    * [Amish](#annotated_sex_1-amish)
    * [ARIC](#annotated_sex_1-aric)
    * [BAGS](#annotated_sex_1-bags)
    * [CARDIA](#annotated_sex_1-cardia)
    * [CCAF](#annotated_sex_1-ccaf)
    * [CFS](#annotated_sex_1-cfs)
    * [CHS](#annotated_sex_1-chs)
    * [COPDGene](#annotated_sex_1-copdgene)
    * [CRA](#annotated_sex_1-cra)
    * [DHS](#annotated_sex_1-dhs)
    * [FHS](#annotated_sex_1-fhs)
    * [GALAII](#annotated_sex_1-galaii)
    * [GeneSTAR](#annotated_sex_1-genestar)
    * [GENOA](#annotated_sex_1-genoa)
    * [GOLDN](#annotated_sex_1-goldn)
    * [HCHS_SOL](#annotated_sex_1-hchs_sol)
    * [HVH](#annotated_sex_1-hvh)
    * [JHS](#annotated_sex_1-jhs)
    * [Mayo_VTE_GENEVA](#annotated_sex_1-mayo_vte_geneva)
    * [Mayo_VTE_Olmsted](#annotated_sex_1-mayo_vte_olmsted)
    * [MESA_AirNR](#annotated_sex_1-mesa_airnr)
    * [MESA_Classic](#annotated_sex_1-mesa_classic)
    * [MESA_Family](#annotated_sex_1-mesa_family)
    * [MGH_AF](#annotated_sex_1-mgh_af)
    * [Partners](#annotated_sex_1-partners)
    * [SAGE](#annotated_sex_1-sage)
    * [SAS](#annotated_sex_1-sas)
    * [VAFAR](#annotated_sex_1-vafar)
    * [VU_AF](#annotated_sex_1-vu_af)
    * [WGHS](#annotated_sex_1-wghs)
    * [WHI](#annotated_sex_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 5, **`Has Age Variable`**: No, **`Date Harmonized`**: 2019-10-29 09:41:00
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0017249
  * **DCC Harmonization Comments**:

    This variable was harmonized by renaming and recoding component study variables. Note that it is possible for annotated sex to differ from genetic sex.
    
    ### Study-specific comments
    
    #### WGHS
    
    All subjects are female due to recruitment criteria. 
    
    #### WHI
    
    *WHI* is an all female study, so all consented subjects were assigned the value "`female`" for this harmonized variable.
    
<a id="annotated_sex_1-amish"></a>
  * ### demographic/annotated_sex_1 -- **Amish**:
    * 1 component_study_variables: `phs000956.v3.pht005002.v1.phv00252975.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
        # harmonize sex for Amish
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht005002"]]
      
         dat <- dat %>% filter(!is.na(SEX)) %>%
              mutate(annotated_sex = ifelse(SEX %in% "M", "male", "female")) %>%
              select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-aric"></a>
  * ### demographic/annotated_sex_1 -- **ARIC**:
    * 1 component_study_variables: `phs000280.v5.pht004063.v2.phv00204711.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize gender for ARIC; use first visit
      
         source_data <- phen_list$source_data
      
         # visit 1 data
      
          dat <- source_data[["pht004063"]]
      
          dat <- dat %>% filter(!is.na(GENDER)) %>%
                mutate(annotated_sex = ifelse(GENDER %in% "M", "male", "female"))
      
         dat <- dat %>% select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-bags"></a>
  * ### demographic/annotated_sex_1 -- **BAGS**:
    * 1 component_study_variables: `phs001143.v2.pht005905.v2.phv00273212.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht005905
      
        #Sex levels
        dataset$annotated_sex <- ifelse(dataset$SEX == 1, 'male',
          ifelse(dataset$SEX == 2, 'female', NA))
      
        #Select variables and remove missing
        dataset <- select(dataset, topmed_subject_id, annotated_sex) %>%
        na.omit() %>%
        return()
      }
      ```
<a id="annotated_sex_1-cardia"></a>
  * ### demographic/annotated_sex_1 -- **CARDIA**:
    * 1 component_study_variables: `phs000285.v3.pht001645.v2.phv00115114.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize gender for CARDIA
          source_data <- phen_list$source_data
      
         dat <- source_data[["pht001645"]]
      
         dat <- dat %>% filter(!is.na(SEX)) %>%
                mutate(annotated_sex = ifelse(SEX == 2, "female", "male")) %>%
                select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-ccaf"></a>
  * ### demographic/annotated_sex_1 -- **CCAF**:
    * 1 component_study_variables: `phs001189.v2.pht005979.v2.phv00273548.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005979 %>%
                   rename(annotated_sex = sex)
      
        # Substitute the value of 'NA' to missing.
        dataset$annotated_sex[dataset$annotated_sex %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-cfs"></a>
  * ### demographic/annotated_sex_1 -- **CFS**:
    * 2 component_study_variables: `phs000284.v2.pht001902.v1.phv00122012.v1`, `phs000284.v2.pht001902.v1.phv00122989.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001902"]]
      
        # harmonize sex for CFS; first available visit
       # 1=Male;0=Female
       # male if variable = 1; female if variable = 0
      
         dat <- dat %>% filter(!is.na(male))
         dat$visit <- as.integer(dat$visit)
         dat <- dat[order(dat$visit), ]
      
         dat2 <- dat %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id) %>% slice(1)
      
         datt <- dat2 %>% mutate(annotated_sex = ifelse(male == 1, "male", "female"))
      
         datt <- datt %>% select(topmed_subject_id, annotated_sex)
      
         return(datt)
      }
      ```
<a id="annotated_sex_1-chs"></a>
  * ### demographic/annotated_sex_1 -- **CHS**:
    * 1 component_study_variables: `phs000287.v6.pht001452.v1.phv00100302.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001452"]]
      
       # CHS BASEBOTH file
       # GEND01: 0/1 = female/male
      
          dat <- dat %>% filter(!is.na(GEND01))
      
         datt <- dat %>%
                mutate(annotated_sex = ifelse(dat$GEND01 %in% 1, "male", "female")) %>%
                select(topmed_subject_id, annotated_sex)
      
         return(datt)
      }
      ```
<a id="annotated_sex_1-copdgene"></a>
  * ### demographic/annotated_sex_1 -- **COPDGene**:
    * 1 component_study_variables: `phs000179.v5.pht002239.v4.phv00159571.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht002239"]]
      
       # COPDGene 1= male 2 = female
      
         dat <- dat %>% filter(!is.na(gender)) %>%
              mutate(annotated_sex = ifelse(gender %in% 1, "male", "female")) %>%
              select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-cra"></a>
  * ### demographic/annotated_sex_1 -- **CRA**:
    * 1 component_study_variables: `phs000988.v2.pht005248.v2.phv00258649.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize gender for CRA
      
          source_data <- phen_list$source_data
      
          dat <- source_data[["pht005248"]]
      
         dat <- dat %>% filter(!is.na(gender)) %>%
                mutate(annotated_sex = ifelse(gender %in% "M", "male", "female")) %>%
                select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-dhs"></a>
  * ### demographic/annotated_sex_1 -- **DHS**:
    * 1 component_study_variables: `phs001412.v1.pht006746.v1.phv00310017.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Dataset
        dataset <- phen_list$source_data$pht006746
        # Recoding male and female values
        dataset$annotated_sex <- ifelse(dataset$SEX == 'M',
                                        'male',
                                        'female')
        #Selecting final harmonized variables
        dataset <- select(dataset, topmed_subject_id, annotated_sex)
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-fhs"></a>
  * ### demographic/annotated_sex_1 -- **FHS**:
    * 1 component_study_variables: `phs000007.v30.pht003099.v5.phv00177929.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize gender FHS
      
         source_data <- phen_list$source_data
      
          dat <- source_data[["pht003099"]]
          w <- which(is.element(dat, "."))
          dat[w] <- NA
      
          dat <- dat %>% filter(!is.na(sex)) %>%
              mutate(annotated_sex = ifelse(sex %in% 1, "male", "female"))
      
          datt <- dat %>% select(topmed_subject_id, annotated_sex)
      
         return(datt)
      }
      ```
<a id="annotated_sex_1-galaii"></a>
  * ### demographic/annotated_sex_1 -- **GALAII**:
    * 1 component_study_variables: `phs001180.v1.pht006991.v1.phv00320631.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht006991 %>%
        rename(annotated_sex = SEX)
      
        #Rename levels
        dataset$annotated_sex <- ifelse(dataset$annotated_sex == 'Male',
                                        'male', 'female')
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-genestar"></a>
  * ### demographic/annotated_sex_1 -- **GeneSTAR**:
    * 2 component_study_variables: `phs001218.v1.pht007766.v1.phv00369267.v1`, `phs001218.v1.pht007766.v1.phv00369269.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        int <- phen_list$source_data$pht007766
        #Order of levels
        int$VISIT <- int$VISIT %>%
                     as.factor() %>%
                     relevel('SSV')
        #Subset to baseline visits, SSV and PSV
        dataset <- int %>%
                   filter(VISIT %in% c('SSV', 'PSV')) %>%
                   mutate(VISIT = as.factor(VISIT)) %>%
                   group_by(topmed_subject_id) %>%
                   arrange(topmed_subject_id, VISIT) %>%
                   filter(row_number(topmed_subject_id) == 1) %>%
                   ungroup() %>%
                   data.frame()
      
        #Reassigning values
        dataset$SEX <- ifelse(dataset$SEX == '0', 'male', 'female')
      
        #Rename harmonized variable
        dataset <- select(dataset, topmed_subject_id, annotated_sex = SEX)
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-genoa"></a>
  * ### demographic/annotated_sex_1 -- **GENOA**:
    * 2 component_study_variables: `phs001238.v2.pht006039.v1.phv00277506.v1`, `phs001238.v2.pht006653.v1.phv00307787.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize annotated sex for GENOA
          source_data <- phen_list$source_data
      
      # GENDER coded as "Female" or "Male"
      
         dat1 <- source_data[["pht006039"]]   # AA sub-study
         dat2 <- source_data[["pht006653"]]   # EA sub_study
         dat <- rbind(dat1, dat2)
      
      # filter for non-missing values
      # assign harmonized names "male" and "female"
      # select subject id and ethnicity
         dat <- dat %>% filter(!is.na(GENDER)) %>%
                 mutate(annotated_sex = ifelse(GENDER %in% "Male", "male", "female")) %>%
                 select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-goldn"></a>
  * ### demographic/annotated_sex_1 -- **GOLDN**:
    * 1 component_study_variables: `phs000741.v2.pht003918.v2.phv00202103.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
        # harmonize sex for GOLDN
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht003918"]]
      
       # 1= male 2 = female
      
         dat <- dat %>% filter(!is.na(sex)) %>%
              mutate(annotated_sex = ifelse(sex %in% 1, "male", "female")) %>%
              select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-hchs_sol"></a>
  * ### demographic/annotated_sex_1 -- **HCHS_SOL**:
    * 1 component_study_variables: `phs000810.v1.pht004715.v1.phv00226279.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht004715"]]
      
         dat <- dat %>% filter(!is.na(dat$GENDER)) %>%
              mutate(annotated_sex = ifelse(GENDER %in% "M", "male", "female")) %>%
              select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-hvh"></a>
  * ### demographic/annotated_sex_1 -- **HVH**:
    * 1 component_study_variables: `phs001013.v3.pht005311.v2.phv00259379.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$pht005311 %>%
          # Remove rows that are missing sex variable.
          filter(!is.na(sex)) %>%
          group_by(topmed_subject_id) %>%
          # Collapse sex variable by topmed_subject_id.
          summarize(as_1 = unique(sex)) %>%
          # Recode sex codes.
          mutate(annotated_sex = ifelse(as_1 %in% 1, "male", "female")) %>%
          # Select only ID and harmonized variables.
          select(topmed_subject_id, annotated_sex)
        return(dat)
      }
      ```
<a id="annotated_sex_1-jhs"></a>
  * ### demographic/annotated_sex_1 -- **JHS**:
    * 1 component_study_variables: `phs000286.v5.pht001949.v1.phv00126012.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
        # harmonize sex for JHS
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001949"]]
      
       # 1= male 0 = female
      
         dat <- dat %>% filter(!is.na(GENDER)) %>%
              mutate(annotated_sex = ifelse(GENDER %in% 1, "male", "female")) %>%
              select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-mayo_vte_geneva"></a>
  * ### demographic/annotated_sex_1 -- **Mayo_VTE_GENEVA**:
    * 1 component_study_variables: `phs000289.v2.pht001886.v2.phv00121845.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
      # harmonize annotated sex for Mayo_VTE (parent Mayo)
      
        datt <- phen_list$source_data[["pht001886"]]
      
        datt <- datt %>% filter(!is.na(gender)) %>%
                   mutate(annotated_sex = ifelse(gender %in% "M", "male", "female")) %>%
                   select(topmed_subject_id, annotated_sex) %>% na.omit
      
         return(datt)
      }
      ```
<a id="annotated_sex_1-mayo_vte_olmsted"></a>
  * ### demographic/annotated_sex_1 -- **Mayo_VTE_Olmsted**:
    * 1 component_study_variables: `phs001402.v1.pht008239.v1.phv00389901.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht008239 %>%
                   mutate(annotated_sex = ifelse(gender == 'M',
                                             'male',
                                             'female')) %>%
                   select(topmed_subject_id, annotated_sex)
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-mesa_airnr"></a>
  * ### demographic/annotated_sex_1 -- **MESA_AirNR**:
    * 1 component_study_variables: `phs000209.v13.pht001111.v4.phv00082643.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize gender for MESA AirNR; all subjects in visit 1
      
          source_data <- phen_list$source_data
      
         # visit 1 data
          dat <- source_data[["pht001111"]]
      
         datt <- dat %>% filter(!is.na(gender1))
      
         datt <- datt %>%
                mutate(annotated_sex = ifelse(gender1 %in% 1, "male", "female")) %>%
                select(topmed_subject_id, annotated_sex)
      
         return(datt)
      }
      ```
<a id="annotated_sex_1-mesa_classic"></a>
  * ### demographic/annotated_sex_1 -- **MESA_Classic**:
    * 1 component_study_variables: `phs000209.v13.pht001116.v10.phv00084446.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize gender for MESA Classic - all subjects in visit 1
      
          source_data <- phen_list$source_data
      
         # visit 1 data
          dat <- source_data[["pht001116"]]
      
         datt <- dat %>% filter(!is.na(gender1))
      
         datt <- datt %>%
               mutate(annotated_sex = ifelse(gender1 %in% 1, "male", "female")) %>%
                select(topmed_subject_id, annotated_sex)
      
         return(datt)
      }
      ```
<a id="annotated_sex_1-mesa_family"></a>
  * ### demographic/annotated_sex_1 -- **MESA_Family**:
    * 1 component_study_variables: `phs000209.v13.pht001121.v3.phv00087073.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize gender for MESA Family
      
          source_data <- phen_list$source_data
      
         # visit 1 data
          dat <- source_data[["pht001121"]]
      
          datt <- dat %>% filter(!is.na(genderf)) %>%
                mutate(annotated_sex = ifelse(genderf %in% 1, "male", "female")) %>%
                select(topmed_subject_id, annotated_sex)
      
         return(datt)
      }
      ```
<a id="annotated_sex_1-mgh_af"></a>
  * ### demographic/annotated_sex_1 -- **MGH_AF**:
    * 1 component_study_variables: `phs001001.v1.pht005655.v1.phv00354562.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht005655 %>%
                   select(topmed_subject_id, annotated_sex = sex)
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-partners"></a>
  * ### demographic/annotated_sex_1 -- **Partners**:
    * 1 component_study_variables: `phs001024.v3.pht005693.v1.phv00265979.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        #Dataset
        dataset <- phen_list$source_data$pht005693 %>%
                   rename(annotated_sex = sex)
      
        return(dataset)
      
      }
      ```
<a id="annotated_sex_1-sage"></a>
  * ### demographic/annotated_sex_1 -- **SAGE**:
    * 1 component_study_variables: `phs000921.v3.pht004883.v3.phv00252284.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        #Dataset
        dataset <- phen_list$source_data$pht004883 %>%
                   rename(annotated_sex = SEX)
      
        #Assigning missing and converting to factor variable
        dataset <- replace(dataset, dataset == 'NA', NA) %>%
                   mutate(annotated_sex = as.factor(annotated_sex))
      
        #Assigning correct levels
        levels(dataset$annotated_sex) <- c('female', 'male')
      
        #Remove missing
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-sas"></a>
  * ### demographic/annotated_sex_1 -- **SAS**:
    * 1 component_study_variables: `phs000914.v1.pht005253.v1.phv00258679.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
        # harmonize sex for Samoan
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht005253"]]
      
         dat <- dat %>% filter(!is.na(Gender)) %>%
              mutate(annotated_sex = ifelse(Gender %in% 1, "male", "female")) %>%
              select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="annotated_sex_1-vafar"></a>
  * ### demographic/annotated_sex_1 -- **VAFAR**:
    * 1 component_study_variables: `phs000997.v3.pht005688.v3.phv00265923.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005688 %>%
                   rename(annotated_sex = sex)
      
        # Substitute the value of 'NA' to missing.
        dataset$annotated_sex[dataset$annotated_sex %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-vu_af"></a>
  * ### demographic/annotated_sex_1 -- **VU_AF**:
    * 1 component_study_variables: `phs001032.v4.pht005675.v3.phv00265807.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005675 %>%
                   rename(annotated_sex = sex)
      
        # Substitute the value of 'NA' to missing.
        dataset$annotated_sex[dataset$annotated_sex %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-wghs"></a>
  * ### demographic/annotated_sex_1 -- **WGHS**:
    * 1 component_study_variables: `phs001040.v3.pht005682.v3.phv00265850.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005682 %>%
                   rename(annotated_sex = sex)
      
        return(dataset)
      }
      ```
<a id="annotated_sex_1-whi"></a>
  * ### demographic/annotated_sex_1 -- **WHI**:
    * 1 component_study_variables: `phs000200.v11.pht000982.v8.phv00077315.v8`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize sex for WHI - an all female study
       # pull in subject file and eliminate consent=0 subjects
      
          source_data <- phen_list$source_data
      
         dat <- source_data[["pht000982"]]
      
         dat <- dat %>% filter(CONSENT != 0)
         dat$annotated_sex <- "female"
      
         dat <- dat %>% select(topmed_subject_id, annotated_sex)
      
         return(dat)
      }
      ```
<a id="geographic_site_1"></a>
## demographic: **geographic_site_1** (geographic_site)
  Recruitment/field center, baseline clinic, or geographic region.
  * **Harmonization Units**:
    * [ARIC](#geographic_site_1-aric)
    * [CARDIA](#geographic_site_1-cardia)
    * [CHS](#geographic_site_1-chs)
    * [COPDGene](#geographic_site_1-copdgene)
    * [GENOA](#geographic_site_1-genoa)
    * [GOLDN](#geographic_site_1-goldn)
    * [HCHS_SOL](#geographic_site_1-hchs_sol)
    * [JHS](#geographic_site_1-jhs)
    * [MESA_AirNR](#geographic_site_1-mesa_airnr)
    * [MESA_Classic](#geographic_site_1-mesa_classic)
    * [MESA_Family](#geographic_site_1-mesa_family)
    * [SAS](#geographic_site_1-sas)
    * [WHI](#geographic_site_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 5, **`Has Age Variable`**: No, **`Date Harmonized`**: 2019-10-29 09:51:05
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C2828208
  * **DCC Harmonization Comments**:

    For studies with multiple exams or visits, baseline (visit 1) clinic was recorded for this variable. All harmonized values are prepended with the study name abbreviation to ensure that values are unique across studies.
    
    ### Study-specific comments
    
    #### GENOA
    
    This study does not provide a specific variable containing this information. However, the dbGaP study page (phs001238) contains the information that the African-American cohort participants were recruited from Jackson, MS, and that the European-American cohort participants were recruited from Rochester, MN. To determine cohort membership, and thus geographic site, for each subject, the study variable `GENDER` from cohort-specific datasets was used as a component variable for this harmonized trait even though the values in the `GENDER` variable are not used.
    
    #### Mayo_VTE_GENEVA 
    
    This study was removed from this harmonized variable version to maintain consistency with the other harmonized studies and variable definition. All subjects were recruited and had baseline measurements at Mayo Clinic Rochester although their home residence may have been located in a different state or country.
    
<a id="geographic_site_1-aric"></a>
  * ### demographic/geographic_site_1 -- **ARIC**:
    * 1 component_study_variables: `phs000280.v5.pht004063.v2.phv00204813.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for ARIC
       # 4 anonymized centers where exams were conducted; values A, B, C, D
       # The ARIC dbGaP study site acknowledges four communities:
       # Forsyth County, NC; Jackson, MS; the northwest suburbs of Minneapolis, MN;
       # and Washington County, MD.
       # The correspondence of the four communities with the values A, B, C, D is not given.
      
       # CENTERID variable given for each exam
       # we use Exam 1 center as the recruitment site
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht004063"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = CENTERID) %>%
          # omit incomplete records
          na.omit()
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("ARIC", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-cardia"></a>
  * ### demographic/geographic_site_1 -- **CARDIA**:
    * 1 component_study_variables: `phs000285.v3.pht001700.v2.phv00116398.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for CARDIA
       # "CENTER_CARE" = center for CARE project
       # anonymized 1 - 4 for 4 field centers
       # The CARDIA dbGaP study site acknowledges four field centers:
       # University of Alabama, Birmingham; Northwester University; University of Minnesota;
       #  Kaiser Foundation Research Institute, Oakland CA.
       # The correspondence of the values 1 - 4 with the four field centers is not given.
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht001700"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = CENTER_CARE) %>%
          # omit incomplete records
          na.omit()
      
       # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("CARDIA", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-chs"></a>
  * ### demographic/geographic_site_1 -- **CHS**:
    * 1 component_study_variables: `phs000287.v6.pht001452.v1.phv00100291.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for CHS
       # "CLINIC" = CHS clinic
       # 3 = BOWMAN GRAY
       # 4 = DAVIS
       # 5 = HOPKINS
       # 6 = PITT
       # abbreviations for Universities
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht001452"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = CLINIC) %>%
          # omit incomplete records
          na.omit()
      
       # change site variable to integer and shift to number 1 - 4 instead of 3 - 6
       dat$geographic_site <- as.integer(dat$geographic_site) - 2
      
       # establish desired values and assign accordingly
       vals <- c("BOWMAN.GRAY", "DAVIS", "HOPKINS", "PITT")
       dat$geographic_site <- vals[dat$geographic_site]
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("CHS", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-copdgene"></a>
  * ### demographic/geographic_site_1 -- **COPDGene**:
    * 1 component_study_variables: `phs000179.v5.pht002239.v4.phv00159569.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for COPDGene
       # 21 clinical centers with "deid_center" = de-identified site codes with values C1 - C21
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht002239"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = deid_center) %>%
          # omit incomplete records
          na.omit()
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("COPDGene", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-genoa"></a>
  * ### demographic/geographic_site_1 -- **GENOA**:
    * 2 component_study_variables: `phs001238.v2.pht006039.v1.phv00277506.v1`, `phs001238.v2.pht006653.v1.phv00307787.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize geographic_site (recruitment site)for GENOA
          source_data <- phen_list$source_data
      
      # from study dbgap page: AA study from Jackson, MS and EA study from Rochester, MN
      # concatenate values with study abbrev to insure unique values across studies
      
         dat1 <- source_data[["pht006039"]]   # AA sub-study
         dat1 <- dat1 %>% mutate(geographic_site = "GENOA_MS")
      
         dat2 <- source_data[["pht006653"]]   # EA sub_study
         dat2 <- dat2 %>% mutate(geographic_site = "GENOA_MN")
      
         dat <- rbind(dat1, dat2)
      
         dat <- dat %>% select(topmed_subject_id, geographic_site)
      
         return(dat)
      }
      ```
<a id="geographic_site_1-goldn"></a>
  * ### demographic/geographic_site_1 -- **GOLDN**:
    * 1 component_study_variables: `phs000741.v2.pht003918.v2.phv00202105.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for GOLDN
       # "center" = recruitment center
       # M = Minneapolis, MN
       # U = Salt Lake City, Utah
       # use state abbreviation MN, UT
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht003918"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = center) %>%
          # omit incomplete records
          na.omit()
      
        # establish desired values and assign accordingly
       dat$geographic_site[dat$geographic_site == "M"] <- "MN"
       dat$geographic_site[dat$geographic_site == "U"] <- "UT"
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("GOLDN", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-hchs_sol"></a>
  * ### demographic/geographic_site_1 -- **HCHS_SOL**:
    * 1 component_study_variables: `phs000810.v1.pht004715.v1.phv00226256.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for HCHS/SOL
       # "CENTER" = recruitment center
       # B = Bronx
       # C = Chicago
       # M = Miami
       # S = San Diego
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht004715"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = CENTER) %>%
          # omit incomplete records
          na.omit()
      
        # establish desired values and assign accordingly
       dat$geographic_site[dat$geographic_site == "B"] <- "Bronx"
       dat$geographic_site[dat$geographic_site == "C"] <- "Chicago"
       dat$geographic_site[dat$geographic_site == "M"] <- "Miami"
       dat$geographic_site[dat$geographic_site == "S"] <- "SanDiego"
      
       # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("HCHS_SOL", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-jhs"></a>
  * ### demographic/geographic_site_1 -- **JHS**:
    * 1 component_study_variables: `phs000286.v5.pht001949.v1.phv00126005.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for JHS
       # given as counties in Missisippi
       # COUNTY has values "Hinds", "Madison", "Rankin", "Unkn" (Unknown)
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht001949"]]
      
       # select subjects with COUNTY = "Unkn"  or missing and change value to "Unknown"
       sel <- dat$COUNTY %in% "Unkn" | is.na(dat$COUNTY)
       dat$COUNTY[sel] <- "Unknown"
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = COUNTY)
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("JHS", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-mesa_airnr"></a>
  * ### demographic/geographic_site_1 -- **MESA_AirNR**:
    * 1 component_study_variables: `phs000209.v13.pht001111.v4.phv00082644.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for MESA AirNR
       # 6 field centers (same for Classic, AirNR, Family)
       # 3 = WFU = Wake Forest University
       # 4 = COL = Columbia University
       # 5 = JHU = John Hopkins University
       # 6 = UMN = University of Minnesota
       # 7 = NWU = Northwestern University
       # 8 = UCLA = University of California, Los Angeles
       # assign the university abbreviations for values
       # site variable is associated with each exam
       # we use Exam 1 "site1c" as the recruitment site
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht001111"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = site1c) %>%
          # omit incomplete records
          na.omit()
      
       # change site variable to integer and shift to become 1 - 6 instead of 3 - 8
       dat$geographic_site <- as.integer(dat$geographic_site) - 2
      
       # establish desired values and assign accordingly
       vals <- c("WFU", "COL", "JHU", "UMN", "NWU", "UCLA")
       dat$geographic_site <- vals[dat$geographic_site]
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("MESA", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-mesa_classic"></a>
  * ### demographic/geographic_site_1 -- **MESA_Classic**:
    * 1 component_study_variables: `phs000209.v13.pht001116.v10.phv00084447.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for MESA Classic
       # 6 field centers (same for Classic, AirNR, Family)
       # 3 = WFU = Wake Forest University
       # 4 = COL = Columbia University
       # 5 = JHU = Johns Hopkins University
       # 6 = UMN = University of Minnesota
       # 7 = NWU = Northwestern University
       # 8 = UCLA = University of California, Los Angeles
       # assign the university abbreviations for values
       # site variable is associated with each exam
       # we use Exam 1 "site1c" as the recruitment site
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht001116"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = site1c) %>%
          # omit incomplete records
          na.omit()
      
       # change site variable to integer and shift to become 1 - 6 instead of 3 - 8
       dat$geographic_site <- as.integer(dat$geographic_site) - 2
      
       # establish desired values and assign accordingly
       vals <- c("WFU", "COL", "JHU", "UMN", "NWU", "UCLA")
       dat$geographic_site <- vals[dat$geographic_site]
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("MESA", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-mesa_family"></a>
  * ### demographic/geographic_site_1 -- **MESA_Family**:
    * 1 component_study_variables: `phs000209.v13.pht001121.v3.phv00087075.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for MESA Family
       # 6 field centers (same for Classic, AirNR, Family)
       # 3 = WFU = Wake Forest University
       # 4 = COL = Columbia University
       # 5 = JHU = John Hopkins University
       # 6 = UMN = University of Minnesota
       # 7 = NWU = Northwestern University
       # 8 = UCLA = University of California, Los Angeles
       # assign the university abbreviations for values
       # variable is "sitefc"
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht001121"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = sitefc) %>%
          # omit incomplete records
          na.omit()
      
       # change site variable to integer and shift to become 1 - 6 instead of 3 - 8
       dat$geographic_site <- as.integer(dat$geographic_site) - 2
      
       # establish desired values and assign accordingly
       vals <- c("WFU", "COL", "JHU", "UMN", "NWU", "UCLA")
       dat$geographic_site <- vals[dat$geographic_site]
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("MESA", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-sas"></a>
  * ### demographic/geographic_site_1 -- **SAS**:
    * 1 component_study_variables: `phs000914.v1.pht005253.v1.phv00258677.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for SAS (Samoan)
       # "Census_Region" = census region of Samoa
       # 1 = Apia Urban Area assign "Apia.urban"
       # 2 = Northwest Upola assign "NW.Upola"
       # 3 = Rest of Upola  assign "rest.Upola"
       # 4 = Savaii         assign "Savaii"
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht005253"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = Census_Region) %>%
          # omit incomplete records
          na.omit()
      
       # convert values to integer; assign new values
       dat$geographic_site <- as.integer(dat$geographic_site)
       vals <- c("Apia.urban", "NW.Upola", "rest.Upola", "Savaii")
       dat$geographic_site <- vals[dat$geographic_site]
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("SAS", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="geographic_site_1-whi"></a>
  * ### demographic/geographic_site_1 -- **WHI**:
    * 1 component_study_variables: `phs000200.v11.pht001031.v6.phv00080435.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
      
       # harmonize recruitment site for WHI
       # study documents mention 40 clinical centers but there is no variable for these
       # we will use "REGION" which gives 4 regions of the US(suggested by study investigator)
       # 1 = Northeast
       # 2 = South
       # 3 = Midwest
       # 4 = West
      
       source_data <- phen_list$source_data
       dat <- source_data[["pht001031"]]
      
       # Select and rename relevant traits
       dat <- dat %>% transmute(topmed_subject_id, geographic_site = REGION) %>%
          # omit incomplete records
          na.omit()
      
       # change site variable to integer
       dat$geographic_site <- as.integer(dat$geographic_site)
      
       # establish desired values and assign accordingly
       vals <- c("Northeast", "South", "Midwest", "West")
       dat$geographic_site <- vals[dat$geographic_site]
      
        # concatenate values with study abbrev to insure unique values across studies
       dat <- dat %>% mutate(geographic_site = paste("WHI", geographic_site, sep = "_"))
      
       return(dat)
      }
      ```
<a id="hispanic_or_latino_1"></a>
## demographic: **hispanic_or_latino_1** (hispanic_or_latino)
  Indicator of reported Hispanic or Latino ethnicity.
  * **Harmonization Units**:
    * [BAGS](#hispanic_or_latino_1-bags)
    * [CCAF](#hispanic_or_latino_1-ccaf)
    * [CFS](#hispanic_or_latino_1-cfs)
    * [CHS_AfricanAmerican](#hispanic_or_latino_1-chs_africanamerican)
    * [CHS_Original](#hispanic_or_latino_1-chs_original)
    * [COPDGene](#hispanic_or_latino_1-copdgene)
    * [CRA](#hispanic_or_latino_1-cra)
    * [FHS_Gen3](#hispanic_or_latino_1-fhs_gen3)
    * [FHS_NewOffspringSpouse](#hispanic_or_latino_1-fhs_newoffspringspouse)
    * [FHS_Offspring](#hispanic_or_latino_1-fhs_offspring)
    * [FHS_Omni1](#hispanic_or_latino_1-fhs_omni1)
    * [FHS_Omni2](#hispanic_or_latino_1-fhs_omni2)
    * [GALAII](#hispanic_or_latino_1-galaii)
    * [GENOA](#hispanic_or_latino_1-genoa)
    * [HCHS_SOL](#hispanic_or_latino_1-hchs_sol)
    * [HVH](#hispanic_or_latino_1-hvh)
    * [Mayo_VTE_GENEVA](#hispanic_or_latino_1-mayo_vte_geneva)
    * [Mayo_VTE_Olmsted](#hispanic_or_latino_1-mayo_vte_olmsted)
    * [MESA_AirNR](#hispanic_or_latino_1-mesa_airnr)
    * [MESA_Classic](#hispanic_or_latino_1-mesa_classic)
    * [MESA_Family](#hispanic_or_latino_1-mesa_family)
    * [MGH_AF](#hispanic_or_latino_1-mgh_af)
    * [Partners](#hispanic_or_latino_1-partners)
    * [VAFAR](#hispanic_or_latino_1-vafar)
    * [VU_AF](#hispanic_or_latino_1-vu_af)
    * [WHI](#hispanic_or_latino_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: No, **`Date Harmonized`**: 2019-10-29 10:00:18
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C2741637
  * **DCC Harmonization Comments**:

    This variable was harmonized by consistently recoding component study variables for Hispanic/Latino ethnicity or a Hispanic/Latino option from component race variables. Subjects who indicated Hispanic or Latino ethnicity were assigned "`HL`". If subjects were asked about their Hispanic or Latino ethnicity at multiple time points, we used information from all time points to construct this variable. Subjects who had discordant responses at different time points were assigned the value "`both`".
    
    Please note that the "`both`" encoded value is not intended to be used directly in analysis. If this variable is used in analysis, analysts should either exclude subjects who were assigned this value or decide how to appropriately group the subjects with this value.
    
    It is expected that most values for this harmonized variable are from self-report of study subjects. For some studies it is known that Hispanic/Latino ethnicity is not directly from self-report but rather was inferred from the study recruitment and/or confirmed by study investigators.
    
    ### Study-specific comments
    
    #### BAGS
    
    All consented subjects were assigned the value "`notHL`" for this harmonized variable, which was confirmed by study investigators. 
    
    #### CFS
    
    Component variables for *CFS* include study variables from multiple visits.
    
    #### CRA
    
    All subjects are Hispanic due to recruitment criteria. 
    
    #### FHS
    
    Component variables for *FHS* Generation 3, New Offspring Spouse, and Omni 2 subcohorts include study variables from multiple visits.
    
    *FHS* Offspring, and Omni 1 subcohorts only used component variables from one visit.
    
    #### GALAII
    
    All consented subjects were assigned the value "`HL`" for this harmonized variable, which was confirmed by study investigators.
    
    #### HCHS_SOL
    
    All consented subjects were assigned the value "`HL`" for this harmonized variable, which was confirmed by study investigators.
    
    #### MESA
    
    Component variables for *MESA* AirNR and Classic subcohorts include study variables from multiple visits.
    
    *MESA* Family subcohort only used component variables from one visit.
    
    
    
<a id="hispanic_or_latino_1-bags"></a>
  * ### demographic/hispanic_or_latino_1 -- **BAGS**:
    * 1 component_study_variables: `phs001143.v2.pht005902.v1.phv00273200.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht005902 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create hispanic_or_latino variable.
          transmute(topmed_subject_id, hispanic_or_latino = "notHL")
      
        return(dataset)
      }
      ```
<a id="hispanic_or_latino_1-ccaf"></a>
  * ### demographic/hispanic_or_latino_1 -- **CCAF**:
    * 1 component_study_variables: `phs001189.v2.pht005979.v2.phv00273550.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005979 %>%
                   rename(hispanic_or_latino = ethnicity)
      
        # Substitute encoded hispanic_or_latino values.
        dataset$hispanic_or_latino[dataset$hispanic_or_latino %in% 'yes'] <- 'HL'
        dataset$hispanic_or_latino[dataset$hispanic_or_latino %in% 'no'] <- 'notHL'
      
        # Substitute the value of 'NA' to missing.
        dataset$hispanic_or_latino[dataset$hispanic_or_latino %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="hispanic_or_latino_1-cfs"></a>
  * ### demographic/hispanic_or_latino_1 -- **CFS**:
    * 2 component_study_variables: `phs000284.v2.pht001902.v1.phv00122991.v1`, `phs000284.v2.pht001902.v1.phv00122992.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001902"]]
      
       # 1=Hispanic or Latino; 0=Not Hispanic or Latino; 2=Unknown
       # 1=White or Caucasian; 2=Black or African American; 3=Asian; 4=Hispanic;
       # 5=Native American or Alaska Native;  6=More than one race
      
         dat$ethnicity[dat$ethnicity %in% 0] <- "notHL"
         dat$ethnicity[dat$ethnicity %in% 1] <- "HL"
         dat$ethnicity[dat$ethnicity %in% 2] <- NA
      
         se2 <- dat$race %in% 4  # Hispanic race will count as ethnicity HL
         dat$ethnicity[se2] <- "HL"
      
         dat2 <- dat %>% filter(!is.na(ethnicity)) %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
        # determine number of unique ethnicity categories chosen across visits for each subject
         sdat <- dat2 %>% summarise(ncate = length(unique(ethnicity)))
      
         dat3 <- inner_join(dat2, sdat)
         sele <- dat3$ncate > 1
         dat3$ethnicity[sele] <- "both"  # inconsistent responses across visits
      
        # slice(1) chooses the first entry for each subject (all entries per subject are now the same)
         datt <- dat3 %>% slice(1) %>%
                select(topmed_subject_id, ethnicity) %>%
                rename(hispanic_or_latino = ethnicity)
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-chs_africanamerican"></a>
  * ### demographic/hispanic_or_latino_1 -- **CHS_AfricanAmerican**:
    * 1 component_study_variables: `phs000287.v6.pht001490.v1.phv00105652.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001490"]]
      
       # YR5 NEW file (NEW cohort)
       # HISP01: 0/1 = no/yes for Hispanic origin
      
          dat <- dat %>% filter(!is.na(HISP01))
      
         datt <- dat %>% mutate(hispanic_or_latino = ifelse(dat$HISP01 %in% 1, "HL", "notHL")) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-chs_original"></a>
  * ### demographic/hispanic_or_latino_1 -- **CHS_Original**:
    * 1 component_study_variables: `phs000287.v6.pht001450.v1.phv00099434.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001450"]]
      
       # BASE1 file (Original or OLD cohort)
       # HISP01: 0/1 = no/yes for Hispanic origin
      
          dat <- dat %>% filter(!is.na(HISP01))
      
         datt <- dat %>% mutate(hispanic_or_latino = ifelse(dat$HISP01 %in% 1, "HL", "notHL")) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-copdgene"></a>
  * ### demographic/hispanic_or_latino_1 -- **COPDGene**:
    * 1 component_study_variables: `phs000179.v5.pht002239.v4.phv00159573.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht002239"]]
      
       # 1= Hispanic or Latino 2 = not Hispanic or Latino
      
          dat <- dat %>% filter(!is.na(ethnic)) %>%
              mutate(hispanic_or_latino = ifelse(ethnic %in% 1, "HL", "notHL"))
      
         dat <- dat %>% select(topmed_subject_id, hispanic_or_latino)
      
         return(dat)
      }
      ```
<a id="hispanic_or_latino_1-cra"></a>
  * ### demographic/hispanic_or_latino_1 -- **CRA**:
    * 1 component_study_variables: `phs000988.v2.pht005248.v2.phv00258651.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize ethnicity for CRA
       # phenotype file has "race", all values "Hispanic"
          source_data <- phen_list$source_data
      
          dat <- source_data[["pht005248"]]
      
         dat <- dat %>% filter(race %in% "Hispanic") %>%
            mutate(hispanic_or_latino = "HL") %>% select(topmed_subject_id, hispanic_or_latino)
      
         return(dat)
      }
      ```
<a id="hispanic_or_latino_1-fhs_gen3"></a>
  * ### demographic/hispanic_or_latino_1 -- **FHS_Gen3**:
    * 4 component_study_variables: `phs000007.v30.pht000074.v11.phv00021245.v5`, `phs000007.v30.pht000074.v11.phv00021398.v5`, `phs000007.v30.pht003094.v5.phv00177238.v3`, `phs000007.v30.pht003094.v5.phv00177597.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize hispanic_or_latino for FHS Generation 3
       # variables are 0/1 (no/yes) for given categories
       # Have race category of Hispanic (Spanish/Hispanic/Latino)
       # 1 if checked, 0 if no or not checked
      
         source_data <- phen_list$source_data
      
         # visit 1 data
      
          dat1 <- source_data[["pht000074"]]
          dat1 <- dat1[dat1$IDTYPE %in% 3, ]
          vars <- "G3A484"
      
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
         dat1$hispanic_or_latino <- NA
      
         se <- dat1$G3A484 %in% 1
         dat1$hispanic_or_latino[se] <- "HL"
      
         dat1 <- dat1 %>% filter(!is.na(hispanic_or_latino)) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         # visit 2 data - contains Gen3, NOS, Omni2
         # Hispanic is not race choice
         #   but there is question re Hispanic hispanic_or_latino: 1 = yes; 2 = no
      
          dat2 <- source_data[["pht003094"]]
          dat2 <- dat2[dat2$idtype %in% 3, ] # choose Gen3
          vars <- "g3b0624"
      
         w <- which(is.element(dat2, "."))
         dat2[w] <- NA
      
         dat2 <- dat2 %>% filter(!is.na(g3b0624)) %>%
              mutate(hispanic_or_latino = ifelse(g3b0624 == 1, "HL", "notHL")) %>%
              select(topmed_subject_id, hispanic_or_latino)
      
         dat <- rbind(dat1, dat2)
      
         dat <- dat %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
        # determine number of unique hispanic_or_latino categories chosen across visits
        #    for each subject
         sdat <- dat %>% summarise(ncatr = length(unique(hispanic_or_latino)))
      
         datt <- inner_join(dat, sdat)
         selr <- datt$ncatr > 1
         datt$hispanic_or_latino[selr] <- "both"  # inconsistency in choices across visits
      
        # slice(1) chooses the first entry for each subject (all entries per subject are now the same)
         datt <- datt %>% filter(!is.na(hispanic_or_latino)) %>% slice(1) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-fhs_newoffspringspouse"></a>
  * ### demographic/hispanic_or_latino_1 -- **FHS_NewOffspringSpouse**:
    * 4 component_study_variables: `phs000007.v30.pht003094.v5.phv00177238.v3`, `phs000007.v30.pht003094.v5.phv00177597.v3`, `phs000007.v30.pht006005.v1.phv00273701.v1`, `phs000007.v30.pht006005.v1.phv00274067.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize hispanic_or_latino for FHS New Offspring Spouse
       # variables are 0/1 (no/yes) for given categories
       # Have race category of Hispanic (Spanish/Hispanic/Latino)
      
         source_data <- phen_list$source_data
      
         # visit 1 data
      
          dat1 <- source_data[["pht006005"]]
          dat1 <- dat1[dat1$idtype %in% 2, ]
          vars <- "g3a484"
      
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
      
         dat1$hispanic_or_latino <- NA
         se <- dat1$g3a484 %in% 1 # chose Hispanic as race
         dat1$hispanic_or_latino[se] <- "HL"
      
         dat1 <- dat1 %>% filter(!is.na(hispanic_or_latino)) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         # visit 2 data - contains Gen3, NOS, Omni2
         # Hispanic is not race choice but there is question
         #   re Hispanic hispanic_or_latino: 1 = yes; 2 = no
      
          dat2 <- source_data[["pht003094"]]
          dat2 <- dat2[dat2$idtype %in% 2, ] # choose NOS
          vars <- "g3b0624"
      
         w <- which(is.element(dat2, "."))
         dat2[w] <- NA
      
         dat2 <- dat2 %>% filter(!is.na(g3b0624)) %>%
              mutate(hispanic_or_latino = ifelse(g3b0624 == 1, "HL", "notHL")) %>%
              select(topmed_subject_id, hispanic_or_latino)
      
         dat <- rbind(dat1, dat2)
      
         dat <- dat %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
         # determine number of unique hispanic_or_latino categories chosen across visits for each subject
         sdat <- dat %>% summarise(ncatr = length(unique(hispanic_or_latino)))
      
         datt <- inner_join(dat, sdat)
         selr <- datt$ncatr > 1
         datt$hispanic_or_latino[selr] <- "both" # inconsistent responses across visits
      
        # slice(1) chooses the first entry for each subject (all entries per subject are now the same)
         datt <- datt %>% filter(!is.na(hispanic_or_latino)) %>% slice(1) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-fhs_offspring"></a>
  * ### demographic/hispanic_or_latino_1 -- **FHS_Offspring**:
    * 3 component_study_variables: `phs000007.v30.pht000747.v6.phv00072044.v5`, `phs000007.v30.pht000747.v6.phv00072538.v5`, `phs000007.v30.pht000747.v6.phv00072539.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize hispanic_or_latino for FHS Offspring
       # variables are 0/1 (no/yes) for given categories
       # H700 is Hispanic/Latino and H701 is not Hispanic/Latino
      
         source_data <- phen_list$source_data
      
         # visit 8 data
      
          dat1 <- source_data[["pht000747"]]
          dat1 <- dat1[dat1$IDTYPE %in% 1, ]
          vars <- paste0("H", 700:701)
      
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
      
         dat1$hispanic_or_latino <- dat1$H700  # 0 not hispanic, 1 hispanic
         s <- (dat1$H700 %in% 1 & dat1$H701 %in% 1) | (dat1$H700 %in% 0 & dat1$H701 %in% 0)
       # chose yes and no
         dat1$hispanic_or_latino[s] <- NA
      
         datt <- dat1 %>%
                 filter(!is.na(hispanic_or_latino)) %>%
                 select(topmed_subject_id, hispanic_or_latino)
         datt$hispanic_or_latino[datt$hispanic_or_latino %in% 1] <- "HL"
         datt$hispanic_or_latino[datt$hispanic_or_latino %in% 0] <- "notHL"
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-fhs_omni1"></a>
  * ### demographic/hispanic_or_latino_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v30.pht004815.v1.phv00251263.v1`, `phs000007.v30.pht004815.v1.phv00251746.v1`, `phs000007.v30.pht004815.v1.phv00251747.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize hispanic_or_latino for FHS Omni1
       # variables are 0/1 (no/yes) for given categories
       # h700 is Hispanic/Latino and h701 is not Hispanic/Latino
      
         source_data <- phen_list$source_data
      
         # visit 3 data
      
          dat1 <- source_data[["pht004815"]]
          dat1 <- dat1[dat1$idtype %in% 7, ]
          vars <- paste0("h", 700:701)
      
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
      
         dat1$hispanic_or_latino <- dat1$h700  # 0 not hispanic, 1 hispanic
         s <- (dat1$h700 %in% 1 & dat1$h701 %in% 1) | (dat1$h700 %in% 0 & dat1$h701 %in% 0)
       # chose yes and no
         dat1$hispanic_or_latino[s] <- NA
      
         datt <- dat1 %>%
                 filter(!is.na(hispanic_or_latino)) %>%
                 select(topmed_subject_id, hispanic_or_latino)
         datt$hispanic_or_latino[datt$hispanic_or_latino %in% 1] <- "HL"
         datt$hispanic_or_latino[datt$hispanic_or_latino %in% 0] <- "notHL"
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-fhs_omni2"></a>
  * ### demographic/hispanic_or_latino_1 -- **FHS_Omni2**:
    * 4 component_study_variables: `phs000007.v30.pht003094.v5.phv00177238.v3`, `phs000007.v30.pht003094.v5.phv00177597.v3`, `phs000007.v30.pht006006.v2.phv00274194.v2`, `phs000007.v30.pht006006.v2.phv00274558.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize hispanic_or_latino for FHS Omni2
       # variables are 0/1 (no/yes) for given categories
       # Have race category of Hispanic (Spanish/Hispanic/Latino)
      
         source_data <- phen_list$source_data
      
         # visit 1 data
      
          dat1 <- source_data[["pht006006"]]
          dat1 <- dat1[dat1$idtype %in% 72, ]
          vars <- "g3a484"
      
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
      
         dat1$hispanic_or_latino <- NA
         se <- dat1$g3a484 %in% 1 # chose Hispanic as race
         dat1$hispanic_or_latino[se] <- "HL"
      
         dat1 <- dat1 %>% filter(!is.na(hispanic_or_latino)) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         # visit 2 data - contains Gen3, NOS, Omni2
         # Hispanic is not race choice but there is question re Hispanic hispanic_or_latino:
         # 1 = yes; 2 = no
      
          dat2 <- source_data[["pht003094"]]
          dat2 <- dat2[dat2$idtype %in% 72, ] # choose Omni2
          vars <- "g3b0624"
      
         w <- which(is.element(dat2, "."))
         dat2[w] <- NA
      
         dat2 <- dat2 %>% filter(!is.na(g3b0624)) %>%
              mutate(hispanic_or_latino = ifelse(g3b0624 == 1, "HL", "notHL")) %>%
              select(topmed_subject_id, hispanic_or_latino)
      
         dat <- rbind(dat1, dat2)
      
         dat <- dat %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
        # determine number of unique hispanic_or_latino categories chosen across visits for each subject
         sdat <- dat %>% summarise(ncatr = length(unique(hispanic_or_latino)))
      
         datt <- inner_join(dat, sdat)
         selr <- datt$ncatr > 1
         datt$hispanic_or_latino[selr] <- "both"  # inconsistent responses across visits
      
        # slice(1) chooses the first entry for each subject (all entries per subject are now the same)
         datt <- datt %>% filter(!is.na(hispanic_or_latino)) %>% slice(1) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-galaii"></a>
  * ### demographic/hispanic_or_latino_1 -- **GALAII**:
    * 1 component_study_variables: `phs001180.v1.pht006988.v1.phv00320615.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht006988 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create hispanic_or_latino variable.
          # Confirmed with study, hispanic_or_latino = 'HL'
          transmute(topmed_subject_id, hispanic_or_latino = "HL")
      
        return(dataset)
      }
      ```
<a id="hispanic_or_latino_1-genoa"></a>
  * ### demographic/hispanic_or_latino_1 -- **GENOA**:
    * 2 component_study_variables: `phs001238.v2.pht006039.v1.phv00277509.v1`, `phs001238.v2.pht006653.v1.phv00307790.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize ethnicity for GENOA
          source_data <- phen_list$source_data
      
      #  information is in the RACE variable
      # values are "African-American", "Hispanic White", "Non-Hispanic White"
      
         dat1 <- source_data[["pht006039"]]   # AA sub-study
         dat2 <- source_data[["pht006653"]]   # EA sub_study
         dat <- rbind(dat1, dat2)
      
      # filter RACE to values with ethnicity information
      # assign HL = if RACE is Hispanic White and notHL otherwise, i.e. for Non-Hispanic White
      # select subject id and ethnicity
         dat <- dat %>% filter(RACE %in% c("Hispanic White", "Non-Hispanic White")) %>%
                 mutate(hispanic_or_latino = ifelse(RACE %in% "Hispanic White", "HL", "notHL")) %>%
                 select(topmed_subject_id, hispanic_or_latino)
      
         return(dat)
      }
      ```
<a id="hispanic_or_latino_1-hchs_sol"></a>
  * ### demographic/hispanic_or_latino_1 -- **HCHS_SOL**:
    * 1 component_study_variables: `phs000810.v1.pht004713.v1.phv00226241.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht004713"]]
      
        # All subjects are Hispanic/Latino
        # set race to Other and ethnicity to HL
        # will define ethnic_subgroup variable
        # pull in Subject file and delete subjects with consent 0
      
         dat <- dat %>% filter(!is.element(CONSENT, 0)) %>%
              mutate(hispanic_or_latino = "HL") %>%
              select(topmed_subject_id, hispanic_or_latino)
      
         return(dat)
      }
      ```
<a id="hispanic_or_latino_1-hvh"></a>
  * ### demographic/hispanic_or_latino_1 -- **HVH**:
    * 1 component_study_variables: `phs001013.v3.pht005311.v2.phv00259381.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$pht005311 %>%
          group_by(topmed_subject_id) %>%
          # Collapse ethnicity variable by topmed_subject_id.
          summarize(eth_1 = unique(ethnicity)) %>%
          # Remove rows where the value is missing or unknown.
          filter(!is.na(eth_1) & !(eth_1 %in% 9)) %>%
          mutate(hispanic_or_latino = ifelse(eth_1 %in% 1, "HL", "notHL")) %>%
          select(topmed_subject_id, hispanic_or_latino)
        return(dat)
      }
      ```
<a id="hispanic_or_latino_1-mayo_vte_geneva"></a>
  * ### demographic/hispanic_or_latino_1 -- **Mayo_VTE_GENEVA**:
    * 1 component_study_variables: `phs000289.v2.pht001886.v2.phv00121875.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
      # harmonize ethnicity for GWAS_VTE (parent Mayo)
      # variable Hispanic = 1 if of Hispanic or Latino ethnicity, = 0 is not Hispanic or Latino
      
        datt <- phen_list$source_data[["pht001886"]]
      
        datt <- datt %>% filter(!is.na(Hispanic)) %>%
                  mutate(hispanic_or_latino = ifelse(Hispanic %in% 1, "HL", "notHL")) %>%
                       select(topmed_subject_id, hispanic_or_latino) %>% na.omit
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-mayo_vte_olmsted"></a>
  * ### demographic/hispanic_or_latino_1 -- **Mayo_VTE_Olmsted**:
    * 1 component_study_variables: `phs001402.v1.pht008239.v1.phv00389931.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht008239
      
        dataset$ethnicity <- ifelse(dataset$hispanic == '0', 'notHL',
                                    ifelse(dataset$hispanic == '1', 'HL', NA))
      
        dataset <- dataset %>%
                   select(topmed_subject_id, hispanic_or_latino = ethnicity) %>%
                   na.omit() %>%
                   return()
      }
      ```
<a id="hispanic_or_latino_1-mesa_airnr"></a>
  * ### demographic/hispanic_or_latino_1 -- **MESA_AirNR**:
    * 2 component_study_variables: `phs000209.v13.pht001111.v4.phv00082641.v1`, `phs000209.v13.pht003086.v3.phv00174585.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize hispanic_or_latino for MESA AirNR
       # 1=white; 2=chinese american; 3=black;4=hispanic
       # assign Hispanic for hispanic_or_latino if indicated Hispanic race at any time
      
          source_data <- phen_list$source_data
      
          # visit 1 data
          dat1 <- source_data[["pht001111"]]
      
         # visit 5 data
         dat5 <- source_data[["pht003086"]]
      
         dat <- rbind(dat1, dat5)
      
         dat$hispanic_or_latino <- NA
         dat$hispanic_or_latino[dat$race1c %in% 4] <- "HL"
         # set hispanic_or_latino = HL if race choice is Hispanic
         # cannot identify "not Hispanic" directly
      
         dat <- dat %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
        # slice(1) chooses the first entry for each subject
         datt <- dat %>% filter(!is.na(hispanic_or_latino)) %>% slice(1) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-mesa_classic"></a>
  * ### demographic/hispanic_or_latino_1 -- **MESA_Classic**:
    * 5 component_study_variables: `phs000209.v13.pht001116.v10.phv00084444.v2`, `phs000209.v13.pht001118.v8.phv00085775.v2`, `phs000209.v13.pht001119.v8.phv00086261.v2`, `phs000209.v13.pht001120.v10.phv00086729.v2`, `phs000209.v13.pht003091.v3.phv00176008.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize hispanic_or_latino for MESA Classic
       # 1=white; 2=chinese american; 3=black;4=hispanic
        # assign Hispanic for hispanic_or_latino if indicated Hispanic race at any time
      
          source_data <- phen_list$source_data
      
         # visit 1 data
          dat1 <- source_data[["pht001116"]]
      
         # visit 2 data
          dat2 <- source_data[["pht001118"]]
      
         # visit 3 data
          dat3 <- source_data[["pht001119"]]
      
         # visit 4 data
          dat4 <- source_data[["pht001120"]]
      
         # visit 5 data
          dat5 <- source_data[["pht003091"]]
      
         dat <- rbind(dat1, dat2, dat3, dat4, dat5)
      
         dat$hispanic_or_latino <- NA
         dat$hispanic_or_latino[dat$race1c %in% 4] <- "HL"
        # set hispanic_or_latino = HL if race choice is Hispanic
            # we cannot identify not Hispanic directly
      
          dat <- dat %>% tbl_df() %>%
               arrange(topmed_subject_id) %>%
               group_by(topmed_subject_id)
      
        # slice(1) chooses the first entry for each subject
         datt <- dat %>% filter(!is.na(hispanic_or_latino)) %>% slice(1) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-mesa_family"></a>
  * ### demographic/hispanic_or_latino_1 -- **MESA_Family**:
    * 2 component_study_variables: `phs000209.v13.pht001121.v3.phv00087074.v1`, `phs000209.v13.pht001121.v3.phv00087659.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize hispanic_or_latino for MESA Family
       # racefc: 1=white; 2=chinese american; 3=black;4=hispanic
       # scrhispf: 0 = not Hispanic, 1 = Hispanic
      
          source_data <- phen_list$source_data
      
         # visit 1 data
          dat <- source_data[["pht001121"]]
      
         dat$hispanic_or_latino <- NA
      
         sel1 <- dat$scrhispf %in% 0 & !(dat$racefc %in% 4)
         sel2 <- dat$scrhispf %in% 0 & dat$racefc %in% 4 # inconsistent
         sel3 <- dat$scrhispf %in% 1 | (is.na(dat$scrhispf) & dat$racefc %in% 4)
      
         dat$hispanic_or_latino[sel3] <- "HL"
         dat$hispanic_or_latino[sel1] <- "notHL"
         dat$hispanic_or_latino[sel2] <- "both"
      
         datt <- dat %>% filter(!is.na(hispanic_or_latino)) %>%
                select(topmed_subject_id, hispanic_or_latino)
      
         return(datt)
      }
      ```
<a id="hispanic_or_latino_1-mgh_af"></a>
  * ### demographic/hispanic_or_latino_1 -- **MGH_AF**:
    * 1 component_study_variables: `phs001001.v1.pht005655.v1.phv00354563.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        library(dplyr)
      
        dataset <- phen_list$source_data$pht005655
      
        dataset$ethnicity_cat <- ifelse(dataset$ethnicity == 'yes', 'HL',
                                      ifelse(dataset$ethnicity == 'no', 'notHL', NA))
        dataset <- dataset %>%
                   select(topmed_subject_id, hispanic_or_latino = ethnicity_cat) %>%
                   na.omit()
      }
      ```
<a id="hispanic_or_latino_1-partners"></a>
  * ### demographic/hispanic_or_latino_1 -- **Partners**:
    * 1 component_study_variables: `phs001024.v3.pht005693.v1.phv00265981.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005693
      
        #Ethnicity categories
        dataset$ethnicity_cat <- ifelse(dataset$ethnicity == 'yes', 'HL',
                                        ifelse(dataset$ethnicity == 'no', 'notHL', NA))
      
        #Variable selection and remove missing
        dataset <- select(dataset, topmed_subject_id, hispanic_or_latino = ethnicity_cat) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="hispanic_or_latino_1-vafar"></a>
  * ### demographic/hispanic_or_latino_1 -- **VAFAR**:
    * 1 component_study_variables: `phs000997.v3.pht005688.v3.phv00265925.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005688
      
        # Substitute encoded ethnicity values.
        dataset$ethnicity[dataset$ethnicity %in% 'yes'] <- 'HL'
        dataset$ethnicity[dataset$ethnicity %in% 'no'] <- 'notHL'
      
        # Substitute the value of 'NA' to missing.
        dataset$ethnicity[dataset$ethnicity %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- rename(dataset, hispanic_or_latino = ethnicity) %>%
                   na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="hispanic_or_latino_1-vu_af"></a>
  * ### demographic/hispanic_or_latino_1 -- **VU_AF**:
    * 1 component_study_variables: `phs001032.v4.pht005675.v3.phv00265809.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005675
      
        # Substitute encoded ethnicity values.
        dataset$ethnicity[dataset$ethnicity %in% 'yes'] <- 'HL'
        dataset$ethnicity[dataset$ethnicity %in% 'no'] <- 'notHL'
      
        # Substitute the value of 'NA' to missing.
        dataset$ethnicity[dataset$ethnicity %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- rename(dataset, hispanic_or_latino = ethnicity) %>%
                   na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="hispanic_or_latino_1-whi"></a>
  * ### demographic/hispanic_or_latino_1 -- **WHI**:
    * 1 component_study_variables: `phs000200.v11.pht000998.v6.phv00078450.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize ethnicity for WHI
       # From WHI study investigator: Form 2 takes precedence, Form 41 can be used for more specificity
       # If Form 2 says "hispanic", and F41 has one of the main hispanic subcategories
       #   (puerto rican, mexican, cuban), that can be used.
       # The other combinations (F2 = hispanic and F41 = missing, F41 = "not hispanic",
       #   or F41 = "other hispanic") can be lumped together or used separate.
       # However, if F41 is Hispanic and F2 is not hispanic, F2 wins.
      
          source_data <- phen_list$source_data
      
       ## baseline
       # 1=American Indian or Alaskan Native; 2=Asian or Pacific Islander;
       #    3=Black or African American; 4=Hispanic/Latino; 5=White (not of Hispanic origin); 8 = Other
      
         dat <- source_data[["pht000998"]]
         dat <- dat %>% filter(!is.na(RACE)) %>%
             mutate(hispanic_or_latino = ifelse(RACE %in% 4, "HL", "notHL")) %>%
             select(topmed_subject_id, hispanic_or_latino)
      
       return(dat)
      }
      ```
<a id="hispanic_subgroup_1"></a>
## demographic: **hispanic_subgroup_1** (hispanic_subgroup)
  classification of Hispanic/Latino background for Hispanic/Latino subjects where country or region of origin information is available
  * **Harmonization Units**:
    * [CRA](#hispanic_subgroup_1-cra)
    * [HCHS_SOL](#hispanic_subgroup_1-hchs_sol)
    * [MESA_AirNR](#hispanic_subgroup_1-mesa_airnr)
    * [MESA_Classic](#hispanic_subgroup_1-mesa_classic)
    * [MESA_Family](#hispanic_subgroup_1-mesa_family)
    * [WHI](#hispanic_subgroup_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: No, **`Date Harmonized`**: 2017-08-02 13:25:16
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0804625
  * **DCC Harmonization Comments**:

    No additional summary information for this trait.
    
<a id="hispanic_subgroup_1-cra"></a>
  * ### demographic/hispanic_subgroup_1 -- **CRA**:
    * 1 component_study_variables: `phs000988.v2.pht005248.v2.phv00258651.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize hispanic subgroup CRA
       # phenotype file has "race", all values "Hispanic"
          source_data <- phen_list$source_data
      
          dat <- source_data[["pht005248"]]
      
         dat <- dat %>% filter(race %in% "Hispanic") %>%
                mutate(hispanic_subgroup = "CostaRican") %>% select(topmed_subject_id, hispanic_subgroup)
      
         return(dat)
      }
      ```
<a id="hispanic_subgroup_1-hchs_sol"></a>
  * ### demographic/hispanic_subgroup_1 -- **HCHS_SOL**:
    * 1 component_study_variables: `phs000810.v1.pht004715.v1.phv00226254.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht004715"]]
      
        # All subjects are Hispanic/Latino
      
         # 0=Dominican; 1=Central American; 2=Cuban; 3= Mexican; 4=Puerto-Rican; 5=South American; 6=More than one heritage/Other; Q = DK/Refused
      
         dat <- dat %>% filter(BKGRD1_C7 %in% 0:5)
      
         rc <- c("Dominican", "CentralAmerican", "Cuban", "Mexican", "PuertoRican", "SouthAmerican")
         dat$hispanic_subgroup <- as.integer(dat$BKGRD1_C7) + 1
         dat$hispanic_subgroup <- rc[dat$hispanic_subgroup]
      
         dat <- dat %>%
              select(topmed_subject_id, hispanic_subgroup)
      
            return(dat)
      }
      ```
<a id="hispanic_subgroup_1-mesa_airnr"></a>
  * ### demographic/hispanic_subgroup_1 -- **MESA_AirNR**:
    * 1 component_study_variables: `phs000209.v13.pht001111.v4.phv00083215.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # hispanic subgroup MESA AirNR
      
       #hctryo1c: CENTRAL AMERICA NOS, DOMINICAN REPUBLIC, MEXICO, OTHER NOS,
       #           PUERTO RICO, SOUTH AMERICA NOS
      
        source_data <- phen_list$source_data
      
         # visit 1 data
          dat <- source_data[["pht001111"]]
      
        vro <- c("CENTRAL AMERICA NOS", "DOMINICAN REPUBLIC", "MEXICO", "PUERTO RICO", "SOUTH AMERICA NOS")
        vrn <- c("CentralAmerican", "Dominican", "Mexican", "PuertoRican", "SouthAmerican")
      
        dat$hispanic_subgroup <- NA
        for (i in 1:length(vro)){
           sel <- dat$hctryo1c %in% vro[i]
           dat$hispanic_subgroup[sel] <- vrn[i]
        }
      
        dat <- dat %>% filter(!is.na(hispanic_subgroup)) %>% select(topmed_subject_id, hispanic_subgroup)
      
        return(dat)
      }
      ```
<a id="hispanic_subgroup_1-mesa_classic"></a>
  * ### demographic/hispanic_subgroup_1 -- **MESA_Classic**:
    * 1 component_study_variables: `phs000209.v13.pht001116.v10.phv00085543.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # hispanic subgroup MESA Classic
      
       #hctryo1c: CENTRAL AMERICA NOS, DOMINICAN REPUBLIC, MEXICO, OTHER NOS,
       #           PUERTO RICO, SOUTH AMERICA NOS, CARIBBEAN NOS, CUBA, NOT SPECIFIED
      
        source_data <- phen_list$source_data
      
         # visit 1 data
          dat <- source_data[["pht001116"]]
      
        vro <- c("CENTRAL AMERICA NOS", "DOMINICAN REPUBLIC", "MEXICO", "PUERTO RICO", "SOUTH AMERICA NOS", "CUBA")
        vrn <- c("CentralAmerican", "Dominican", "Mexican", "PuertoRican", "SouthAmerican", "Cuban")
      
        dat$hispanic_subgroup <- NA
        for (i in 1:length(vro)){
           sel <- dat$hctryo1c %in% vro[i]
           dat$hispanic_subgroup[sel] <- vrn[i]
        }
      
        dat <- dat %>% filter(!is.na(hispanic_subgroup)) %>% select(topmed_subject_id, hispanic_subgroup)
      
        return(dat)
      }
      ```
<a id="hispanic_subgroup_1-mesa_family"></a>
  * ### demographic/hispanic_subgroup_1 -- **MESA_Family**:
    * 1 component_study_variables: `phs000209.v13.pht001121.v3.phv00087228.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # hispanic subgroup MESA Family
      
       #hctryofc: CENTRAL AMERICA NOS, DOMINICAN REPUBLIC, MEXICO, OTHER NOS,
       #           PUERTO RICO, SOUTH AMERICA NOS, CUBA
      
        source_data <- phen_list$source_data
      
         # visit 1 data
          dat <- source_data[["pht001121"]]
      
        vro <- c("CENTRAL AMERICA NOS", "DOMINICAN REPUBLIC", "MEXICO", "PUERTO RICO", "SOUTH AMERICA NOS", "CUBA")
        vrn <- c("CentralAmerican", "Dominican", "Mexican", "PuertoRican", "SouthAmerican", "Cuban")
      
        dat$hispanic_subgroup <- NA
        for (i in 1:length(vro)){
           sel <- dat$hctryofc %in% vro[i]
           dat$hispanic_subgroup[sel] <- vrn[i]
        }
      
        dat <- dat %>% filter(!is.na(hispanic_subgroup)) %>% select(topmed_subject_id, hispanic_subgroup)
      
        return(dat)
      }
      ```
<a id="hispanic_subgroup_1-whi"></a>
  * ### demographic/hispanic_subgroup_1 -- **WHI**:
    * 2 component_study_variables: `phs000200.v11.pht000998.v6.phv00078450.v6`, `phs000200.v11.pht001009.v6.phv00079316.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      # If Form 2 says "hispanic", and F41 has one of the main hispanic subcategories (puerto rican, mexican, cuban), that can be used.
      # Form 41 used for specificity - otherwise Form 2 takes precedence
      
       # harmonize hispanic subgroup for WHI
          source_data <- phen_list$source_data
      
        # Form 2 Hispanic is RACE = 4
          dat1 <- source_data[["pht000998"]]
      
       # variable SPANISH Form 41: 0 = not Hispanic, 1 = Puerto Rican, 2 = Mexican/MexicanAmerican, Chicano, 3 = Cuban, 4 = Other Hispanic
         dat2 <- source_data[["pht001009"]]
      
         dat <- inner_join(dat1, dat2)
      
      # choose Hispanics
         dat <- dat %>% filter(RACE %in% 4 & SPANISH %in% 1:3)
      
         dat$hispanic_subgroup[dat$SPANISH %in% 1] <- "PuertoRican"
         dat$hispanic_subgroup[dat$SPANISH %in% 2] <- "Mexican"
         dat$hispanic_subgroup[dat$SPANISH %in% 3] <- "Cuban"
      
         dat <- dat %>% select(topmed_subject_id, hispanic_subgroup)
      
        return(dat)
      }
      ```
<a id="race_us_1"></a>
## demographic: **race_us_1** (race_us)
  Reported race of participant according to the United States administrative definition of race.
  * **Harmonization Units**:
    * [Amish](#race_us_1-amish)
    * [ARIC](#race_us_1-aric)
    * [CARDIA](#race_us_1-cardia)
    * [CCAF](#race_us_1-ccaf)
    * [CFS](#race_us_1-cfs)
    * [CHS_AfricanAmerican](#race_us_1-chs_africanamerican)
    * [CHS_Original](#race_us_1-chs_original)
    * [COPDGene](#race_us_1-copdgene)
    * [DHS](#race_us_1-dhs)
    * [FHS_Gen3](#race_us_1-fhs_gen3)
    * [FHS_NewOffspringSpouse](#race_us_1-fhs_newoffspringspouse)
    * [FHS_Offspring](#race_us_1-fhs_offspring)
    * [FHS_Omni1](#race_us_1-fhs_omni1)
    * [FHS_Omni2](#race_us_1-fhs_omni2)
    * [FHS_Original](#race_us_1-fhs_original)
    * [GALAII](#race_us_1-galaii)
    * [GeneSTAR](#race_us_1-genestar)
    * [GENOA](#race_us_1-genoa)
    * [GOLDN](#race_us_1-goldn)
    * [HCHS_SOL](#race_us_1-hchs_sol)
    * [HVH](#race_us_1-hvh)
    * [JHS](#race_us_1-jhs)
    * [Mayo_VTE_GENEVA](#race_us_1-mayo_vte_geneva)
    * [Mayo_VTE_Olmsted](#race_us_1-mayo_vte_olmsted)
    * [MESA_AirNR](#race_us_1-mesa_airnr)
    * [MESA_Classic](#race_us_1-mesa_classic)
    * [MESA_Family](#race_us_1-mesa_family)
    * [MGH_AF](#race_us_1-mgh_af)
    * [Partners](#race_us_1-partners)
    * [SAGE](#race_us_1-sage)
    * [VAFAR](#race_us_1-vafar)
    * [VU_AF](#race_us_1-vu_af)
    * [WGHS](#race_us_1-wghs)
    * [WHI](#race_us_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: No, **`Date Harmonized`**: 2019-10-29 10:12:49
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0034510
  * **DCC Harmonization Comments**:

    The values for this harmonized variable are largely concordant with the Office of Management and Budget (OMB) race categories[^1], but ultimately rely on if and how each study asked subjects about their race and ethnicity. This harmonized variable only includes studies where all or most subjects were recruited in the U.S. Subjects in studies that recruited all subjects outside the U.S. were not included in this harmonized variable.
    
    Some studies included the option "`Asian or Pacific Islander`" (in contrast to separate options of "`Native Hawaiian/Pacific Islander`" and "`Asian`"). In these cases, the value assigned for this variable was "`Asian`". If a component study variable included the option of Hispanic/Latino, "`Other`" was assigned for this variable unless there was additional information to allow for a specific race value to be assigned. Information about Hispanic/Latino origin is provided in the harmonized variable `hispanic_or_latino_1.` In addition to "`Other`" being assigned in this way, some studies had questionnaires where "`Other`" was an option to select for race. In these cases, the value "`Other`" was used for these subjects in this harmonized variable.
    
    For studies with multiple component variables asking for "`Yes`" or "`No`" for various race options, if a subject indicated "`Yes`" for more than one race option, the value "`Multiple`" was assigned for this variable. For studies/subcohorts with multiple visits and comparable race/ethnicity questions, if race values were inconsistent across visits, the value "`Multiple`" was assigned for this variable.
    
    Please note that the "`Other`" and "`Multiple`" encoded values are very heterogeneous and are not intended to be used directly in analysis. If this variable is used in analysis, analysts should either exclude subjects who were assigned to either of these encoded values or decide how to appropriately group the subjects with these values.
    
    It is expected that most values for this harmonized variable are from self-report of study subjects; however, this cannot be guaranteed in all cases. For some subjects, it is possible that a race value was assigned by a member of the research team. Indeed, for several studies it is known that race is not directly from self-report but rather was inferred from the study recruitment criteria and/or confirmed by study investigators. 
    
    ### Study-specific comments
    
    #### Amish
    
    All consented subjects were assigned the value  "`White`" for this harmonized variable, which was confirmed by study investigators.
    
    #### ARIC
    
    Component variables for *ARIC* include study variables from multiple visits.
    
    #### CFS
    
    Component variables for *CFS* include study variables from multiple visits.
    
    #### FHS
    
    All consented subjects from the *FHS* Original subcohort were assigned the value "`White`" for this harmonized variable, which was confirmed by study investigators.
    
    Component variables for *FHS* Generation 3, New Offspring Spouse, and Omni 2 subcohorts include study variables from multiple visits.
    
    *FHS* Offspring and Omni 1 subcohorts only used component variables from one visit.
    
    #### GALAII
    
    All consented subjects were assigned the value "`Other`" for this harmonized variable, which was confirmed by study investigators.
    
    #### GOLDN
    
    All consented subjects were assigned the value "`White`" for this harmonized variable based on recruitment criteria.
    
    #### HCHS_SOL
    
    All consented subjects were assigned the value "`Other`" for this harmonized variable, which was confirmed by study investigators.
    
    #### JHS
    
    All consented subjects were assigned the value "`Black`" for this harmonized variable, which was confirmed by study investigators.
    
    #### MESA
    
    Component variables for *MESA* AirNR and Classic subcohorts include study variables from multiple visits.
    
    *MESA* Family subcohort only used component variables from one visit.
    
    #### WHI 
    
    *WHI* ascertained race using two forms, one with broader race options and the second with more specific options, but the broader form took precedence according to study investigators. In this harmonization the second form was used to determine the assignment of "`Native Hawaiian/Pacific Islander`" over "`Asian`". Subjects who selected more than one option on the second form were not assigned to "`Multiple`".  See harmonization algorithm for more details.
    
    
    [^1]: Revisions to the Standards for the Classification of Federal Data on Race and Ethnicity, 62 Fed. Reg. 210 (October 30, 1997). *Federal Register: The Daily Journal of the United States*. 
    
    
<a id="race_us_1-amish"></a>
  * ### demographic/race_us_1 -- **Amish**:
    * 1 component_study_variables: `phs000956.v3.pht005000.v1.phv00252969.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht005000"]]
      
        # confirmed with PI that all subjects are Amish; set race_us = White
        # pull in subject file and eliminate consent=0 subjects
      
         dat <- dat %>% filter(!is.element(CONSENT, 0)) %>%
              mutate(race_us = "White") %>%
              select(topmed_subject_id, race_us)
      
         return(dat)
      }
      ```
<a id="race_us_1-aric"></a>
  * ### demographic/race_us_1 -- **ARIC**:
    * 3 component_study_variables: `phs000280.v5.pht004062.v2.phv00204633.v1`, `phs000280.v5.pht004063.v2.phv00204710.v1`, `phs000280.v5.pht004065.v2.phv00204962.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us and hispanic_or_latino for ARIC
       # A=Asian/Pacific Islander;B=Black;I=American Indian or Alaskan Indian;W=White
      
         source_data <- phen_list$source_data
      
         # visit 1 data
      
          dat1 <- source_data[["pht004063"]]
      
         # visit 2 data
          dat2 <- source_data[["pht004062"]]
      
         # visit 4 data
          dat4 <- source_data[["pht004065"]]
      
         dat <- rbind(dat1, dat2, dat4)
      
         dat$race_us <- dat$RACEGRP
         dat$race_us[dat$race_us %in% "A"] <- "Asian"
         dat$race_us[dat$race_us %in% "B"] <- "Black"
         dat$race_us[dat$race_us %in% "I"] <- "AI_AN"
         dat$race_us[dat$race_us %in% "W"] <- "White"
      
         dat <- dat %>% filter(!is.na(race_us)) %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
        # determine number of unique race categories chosen across visits for each subject
         sdat <- dat %>% summarise(ncatr = length(unique(race_us)))
      
         datt <- inner_join(dat, sdat)
      
        # if subject chose more than one race category across visits, assign race_us = Multiple
         selr <- datt$ncatr > 1
         datt$race_us[selr] <- "Multiple"
      
        # slice(1) chooses the first entry for each subject (all entries per subject are now the same)
         datt <- datt %>% filter(!is.na(race_us)) %>% slice(1) %>%
                select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-cardia"></a>
  * ### demographic/race_us_1 -- **CARDIA**:
    * 1 component_study_variables: `phs000285.v3.pht001645.v2.phv00115113.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us for CARDIA
          source_data <- phen_list$source_data
      
       ## study document for B2REF (pht001645) says:
       #  This file contains the demographic variables (age, sex, race, education)
       # and should be used in any analysis of the CARDIA cohort requiring stratification
       # by the demographic variables.
       #  The variables SEX and RACE are based on the original demographic variables collected in Exam 1
       # and verified in Exam 2.
       #  This reference file is the only file in this version of the CARDIA data that contains
       # information on all original participants.
       #  Document for A4REF from Exam1 states:
       # THE FOLLOWING CODE IMPLEMENTS ONLY TWO CODES FOR THE RACE VARIABLE
       #  5 - WHITE AND 4 - BLACK
       # Only 2 codes were carried forward
      
         dat <- source_data[["pht001645"]]
      
         dat$race_us <- NA
         dat$race_us[dat$RACE %in% 4] <- "Black"
         dat$race_us[dat$RACE %in% 5] <- "White"
      
         dat <- dat %>% filter(!is.na(race_us)) %>% select(topmed_subject_id, race_us)
      
         return(dat)
      }
      ```
<a id="race_us_1-ccaf"></a>
  * ### demographic/race_us_1 -- **CCAF**:
    * 1 component_study_variables: `phs001189.v2.pht005979.v2.phv00273549.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005979 %>%
                   rename(race_us = race)
      
        # Substitute encoded race values.
        dataset$race_us[dataset$race_us %in% 'white'] <- 'White'
      
        # Substitute the value of 'NA' to missing.
        dataset$race_us[dataset$race_us %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="race_us_1-cfs"></a>
  * ### demographic/race_us_1 -- **CFS**:
    * 1 component_study_variables: `phs000284.v2.pht001902.v1.phv00122991.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001902"]]
      
       # 1=White or Caucasian; 2=Black or African American; 3=Asian; 4=Hispanic;
      #  5=Native American or Alaska Native;  6=More than one race
       # White if variable=1; Black if variable=2; Asian if variable=3; Other if variable=4;
       # AI_AN if variable = 5; Multiple if variable=6
       # dat has multiple entries per subject for different visits
      
         rc <- c("White", "Black", "Asian", "Hispanic", "AI_AN", "Multiple")
         dat$race <- as.integer(dat$race)
         dat$race <- rc[dat$race]
      
         dat2 <- dat %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
         seh <- dat2$race %in% "Hispanic"
         dat2$race[seh] <- "Other"
         dat3 <- dat2[!is.na(dat2$race), ]
      
        # determine number of unique race categories chosen across visits for each subject
         sdat <- dat3 %>% summarise(ncatr = length(unique(race)), ot = is.element("Other", race))
      
         # if more than one race category (not including "Other") per subject across visits,
         #   assign race = Multiple
         datt <- inner_join(dat3, sdat)
         selr <- datt$ncatr > 2
         datt$race[selr] <- "Multiple"
      
         so <- datt$ncatr == 2 & datt$ot == FALSE
         datt$race[so] <- "Multiple"
      
        # if race chosen as Other and one other race also chosen, assign the more specific race
         se <- datt$ncatr == 2 & datt$ot == TRUE
         sse <- se & datt$race %in% "Other"
         datt <- datt[!sse, ]
        # take out the "Other" entry so slice(1) (taking first entry per subject)
        #  will capture the more specific race
      
         datt <- datt %>% filter(!is.na(race)) %>% slice(1) %>%
                select(topmed_subject_id, race_us = race)
      
         return(datt)
      }
      ```
<a id="race_us_1-chs_africanamerican"></a>
  * ### demographic/race_us_1 -- **CHS_AfricanAmerican**:
    * 1 component_study_variables: `phs000287.v6.pht001490.v1.phv00105645.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001490"]]
      
       # YR5 NEW file (NEW cohort)
       # 1=white;2=black; 3=American Indian or Alaska Native; 4= Asian/Pacific Islander; 5 = Other
      
          dat <- dat %>% filter(!is.na(RACE01))
      
         rc <- c("White", "Black", "AI_AN", "Asian", "Other")
         dat$race_us <- as.integer(dat$RACE01)
         dat$race_us <- rc[dat$race_us]
      
         datt <- dat %>% filter(!is.na(race_us)) %>%
                select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-chs_original"></a>
  * ### demographic/race_us_1 -- **CHS_Original**:
    * 1 component_study_variables: `phs000287.v6.pht001450.v1.phv00099569.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001450"]]
      
       # BASE1 file (Original, ie. OLD cohort)
       # 1=white;2=black; 3=American Indian or Alaska Native; 4= Asian/Pacific Islander; 5 = Other
      
         dat <- dat %>% filter(!is.na(RACE01))
      
         rc <- c("White", "Black", "AI_AN", "Asian", "Other")
         dat$race_us <- as.integer(dat$RACE01)
         dat$race_us <- rc[dat$race_us]
      
         datt <- dat %>% filter(!is.na(race_us)) %>%
                select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-copdgene"></a>
  * ### demographic/race_us_1 -- **COPDGene**:
    * 1 component_study_variables: `phs000179.v5.pht002239.v4.phv00159572.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht002239"]] %>%
                 rename(race_us = race)
      
       # harmonize race_us for COPDGene
       # 1=Caucasian; 2=African American; 3=Asian; 4=Pacific Islander;
       # 5= American Indian/Alaska; 6 = More than one race; 7 = Other
      
         rc <- c("White", "Black", "Asian", "HI_PI", "AI_AN", "Multiple", "Other")
         dat <- dat[!is.na(dat$race_us), ]
         dat$race_us <- as.integer(dat$race_us)
         dat$race_us <- rc[dat$race_us]
      
         return(dat)
      }
      ```
<a id="race_us_1-dhs"></a>
  * ### demographic/race_us_1 -- **DHS**:
    * 1 component_study_variables: `phs001412.v1.pht006746.v1.phv00310019.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Dataset
        dataset <- phen_list$source_data$pht006746 %>%
                   rename(race_us = RACE)
        #Encoding race values
        dataset$race_us[dataset$race_us %in% "AA"] <- "Black"
      
        return(dataset)
      }
      ```
<a id="race_us_1-fhs_gen3"></a>
  * ### demographic/race_us_1 -- **FHS_Gen3**:
    * 17 component_study_variables: `phs000007.v30.pht000074.v11.phv00021244.v5`, `phs000007.v30.pht000074.v11.phv00021245.v5`, `phs000007.v30.pht000074.v11.phv00021246.v5`, `phs000007.v30.pht000074.v11.phv00021247.v5`, `phs000007.v30.pht000074.v11.phv00021248.v5`, `phs000007.v30.pht000074.v11.phv00021249.v5`, `phs000007.v30.pht000074.v11.phv00021250.v5`, `phs000007.v30.pht000074.v11.phv00021251.v5`, `phs000007.v30.pht000074.v11.phv00021398.v5`, `phs000007.v30.pht003094.v5.phv00177238.v3`, `phs000007.v30.pht003094.v5.phv00177597.v3`, `phs000007.v30.pht003094.v5.phv00177598.v3`, `phs000007.v30.pht003094.v5.phv00177599.v3`, `phs000007.v30.pht003094.v5.phv00177600.v3`, `phs000007.v30.pht003094.v5.phv00177601.v3`, `phs000007.v30.pht003094.v5.phv00177602.v3`, `phs000007.v30.pht003094.v5.phv00177603.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us and hispanic_or_latino for FHS Generation 3
       # variables are 0/1 (no/yes) for given categories
       # White (Caucasian or White), Hispanic (Spanish/Hispanic/Latino)
       # Black (African-American or Black), Asian, HI_PI (Native Hawaiian or Pacific Islander
       # AI_AN (American Indian or Alaskan Native), Other, No (Prefer not to answer)
       # can choose more than one
      
         source_data <- phen_list$source_data
      
         # visit 1 data
      
          dat1 <- source_data[["pht000074"]]
          dat1 <- dat1[dat1$IDTYPE %in% 3, ]
          vars <- paste0("G3A", 483:490)
      
        #  rename variables; change 0/1 categorical to integer
          nm <- c("White", "Hispanic", "Black", "Asian", "HI_PI", "AI_AN", "Other", "No")
          for (i in 1:length(vars)){
            dat1[, vars[i]] <- as.integer(dat1[, vars[i]])
            names(dat1)[names(dat1) %in% vars[i]] <- nm[i]
          }
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
         dat1$race_us <- NA
      
        # treat "Hispanic" differently
         cnm <- c("White", "Black", "Asian", "HI_PI", "AI_AN", "Other")
      
        # add up 0's and 1's across variables for each subject
        # if sum =1 only chose one race category, if sum > 1 chose multiple race categories,
        #   if sum = 0, did not choose any of the indicated categories
         dat1$rs <- rowSums(dat1[, cnm], na.rm = TRUE)
      
        # if only one category chosen, assign that category as the race
         s1 <- dat1$rs %in% 1 & !(dat1$No %in% 1)
         ws1 <- which(s1)
         t2 <- dat1[s1, cnm]
         wa <- which(t2 == 1, arr.ind = T)
         dat1$race_us[ws1[wa[, 1]]] <- cnm[wa[, 2]]
      
       # if more than one race category chosen, assign race_us as "Multiple"
         s3 <- dat1$rs > 1 & !(dat1$No %in% 1)
         dat1$race_us[s3] <- "Multiple"
      
       # if Hispanic category chosen with no other race category, assign "Other"
       # person did choose to identify a race
       # ethnicity will be set to HL (i.e. is Hispanic)
      
         s <- dat1$Hispanic %in% 1 & dat1$rs %in% 0
         dat1$race_us[s] <- "Other"
      
         dat1$race_us[dat1$No %in% 1] <- NA
      
         dat1 <- dat1 %>% filter(!is.na(dat1$race_us)) %>% select(topmed_subject_id, race_us)
      
         # visit 2 data - contains Gen3, NOS, Omni2
         # Hispanic is not race choice but there is question re Hispanic ethnicity
         # race is not affected by ethnicity
         # here if chose ethnicity as Hispanic but no race - set race_us to Other if no other race choice
      
          dat2 <- source_data[["pht003094"]]
          dat2 <- dat2[dat2$idtype %in% 3, ] # choose Gen3
          vars <- paste0("g3b0", 625:630)
          nm <- c("White", "Black", "Asian", "HI_PI", "AI_AN", "No")
          for (i in 1:length(vars)){
            dat2[, vars[i]] <- as.integer(dat2[, vars[i]])
            names(dat2)[names(dat2) %in% vars[i]] <- nm[i]
          }
         w <- which(is.element(dat2, "."))
         dat2[w] <- NA
         dat2$race_us <- NA
      
         cnm <- c("White", "Black", "Asian", "HI_PI", "AI_AN")
         dat2$rs <- rowSums(dat2[, cnm], na.rm = TRUE)
      
        # if only one category chosen, assign that category as the race
         s1 <- dat2$rs %in% 1 & !(dat2$No %in% 1)
         ws1 <- which(s1)
         t2 <- dat2[s1, cnm]
         wa <- which(t2 == 1, arr.ind = T)
         dat2$race_us[ws1[wa[, 1]]] <- cnm[wa[, 2]]
      
       # if more than one race category chosen, assign race_us as "Multiple"
         s3 <- dat2$rs > 1 & !(dat2$No %in% 1)
         dat2$race_us[s3] <- "Multiple"
      
       # no other race chosen but indicated Hispanic ethnicity, set race_us to Other
         s <- dat2$g3b0624 %in% 1 & dat2$rs %in% 0
         dat2$race_us[s] <- "Other"
      
         dat2$race_us[dat2$No %in% 1] <- NA
      
         dat2 <- dat2 %>% filter(!is.na(dat2$race_us)) %>% select(topmed_subject_id, race_us)
      
       # check for consistency across visits - if differ, assign race_us as "Multiple"
         dat <- rbind(dat1, dat2)
      
         dat <- dat %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
          # determine number of unique race categories chosen across visits for each subject
         sdat <- dat %>% summarise(ncatr = length(unique(race_us)), ot = is.element("Other", race_us))
      
         # if more than one race category (not including "Other") per subject across visits,
         #   assign race_us = Multiple
         datt <- inner_join(dat, sdat)
         selr <- datt$ncatr > 2
         datt$race_us[selr] <- "Multiple"
      
         so <- datt$ncatr == 2 & datt$ot == FALSE
         datt$race_us[so] <- "Multiple"
      
        # if race chosen as Other and one other race also chosen, assign the more specific race
         se <- datt$ncatr == 2 & datt$ot == TRUE
         sse <- se & datt$race_us %in% "Other"
         datt <- datt[!sse, ]
         # take out the "Other" entry so slice(1) (taking first entry per subject)
      #     will capture the more specific race
      
         datt <- datt %>% filter(!is.na(race_us)) %>% slice(1) %>%
                select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-fhs_newoffspringspouse"></a>
  * ### demographic/race_us_1 -- **FHS_NewOffspringSpouse**:
    * 17 component_study_variables: `phs000007.v30.pht003094.v5.phv00177238.v3`, `phs000007.v30.pht003094.v5.phv00177597.v3`, `phs000007.v30.pht003094.v5.phv00177598.v3`, `phs000007.v30.pht003094.v5.phv00177599.v3`, `phs000007.v30.pht003094.v5.phv00177600.v3`, `phs000007.v30.pht003094.v5.phv00177601.v3`, `phs000007.v30.pht003094.v5.phv00177602.v3`, `phs000007.v30.pht003094.v5.phv00177603.v3`, `phs000007.v30.pht006005.v1.phv00273701.v1`, `phs000007.v30.pht006005.v1.phv00274066.v1`, `phs000007.v30.pht006005.v1.phv00274067.v1`, `phs000007.v30.pht006005.v1.phv00274068.v1`, `phs000007.v30.pht006005.v1.phv00274069.v1`, `phs000007.v30.pht006005.v1.phv00274070.v1`, `phs000007.v30.pht006005.v1.phv00274071.v1`, `phs000007.v30.pht006005.v1.phv00274072.v1`, `phs000007.v30.pht006005.v1.phv00274073.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us and hispanic_or_latino for FHS New Offspring Spouse
       # variables are 0/1 (no/yes) for given categories
       # White (Caucasian or White), Hispanic (Spanish/Hispanic/Latino)
       # Black (African-American or Black), Asian, HI_PI (Native Hawaiian or Pacific Islander
       # AI_AN (American Indian or Alaskan Native), Other, No (Prefer not to answer)
       # can choose more than one
      
         source_data <- phen_list$source_data
      
         # visit 1 data
      
          dat1 <- source_data[["pht006005"]]
          dat1 <- dat1[dat1$idtype %in% 2, ]
          vars <- paste0("g3a", 483:490)
          nm <- c("White", "Hispanic", "Black", "Asian", "HI_PI", "AI_AN", "Other", "No")
      
        #  rename variables; change 0/1 categorical to integer
         for (i in 1:length(vars)){
            dat1[, vars[i]] <- as.integer(dat1[, vars[i]])
            names(dat1)[names(dat1) %in% vars[i]] <- nm[i]
          }
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
         dat1$race_us <- NA
      
        # treat "Hispanic" differently
         cnm <- c("White", "Black", "Asian", "HI_PI", "AI_AN", "Other")
      
        # add up 0's and 1's across variables for each subject
        # if sum =1 only chose one race category, if sum > 1 chose multiple race categories,
        #   if sum = 0, did not choose any of the indicated categories
         dat1$rs <- rowSums(dat1[, cnm], na.rm = TRUE)
      
        # if only one category chosen, assign that category as the race
         s1 <- dat1$rs %in% 1 & !(dat1$No %in% 1)
         ws1 <- which(s1)
         t2 <- dat1[s1, cnm]
         wa <- which(t2 == 1, arr.ind = T)
         dat1$race_us[ws1[wa[, 1]]] <- cnm[wa[, 2]]
      
       # if more than one race category chosen, assign race_us as "Multiple"
         s3 <- dat1$rs > 1 & !(dat1$No %in% 1)
         dat1$race_us[s3] <- "Multiple"
      
       # if Hispanic category chosen with no other race category, assign "Other"
       # ethnicity will be set to HL (i.e. is Hispanic)
      
         s <- dat1$Hispanic %in% 1 & dat1$rs %in% 0
         dat1$race_us[s] <- "Other"
      
         dat1$race_us[dat1$No %in% 1] <- NA
      
         dat1 <- dat1 %>% filter(!is.na(dat1$race_us)) %>% select(topmed_subject_id, race_us)
      
         # visit 2 data - contains Gen3, NOS, Omni2
         # Hispanic is not race choice but there is question re Hispanic ethnicity
         # set race_us to Other if no other race choice
      
          dat2 <- source_data[["pht003094"]]
          dat2 <- dat2[dat2$idtype %in% 2, ] # choose NOS
          vars <- paste0("g3b0", 625:630)
          nm <- c("White", "Black", "Asian", "HI_PI", "AI_AN", "No")
          for (i in 1:length(vars)){
            dat2[, vars[i]] <- as.integer(dat2[, vars[i]])
            names(dat2)[names(dat2) %in% vars[i]] <- nm[i]
          }
         w <- which(is.element(dat2, "."))
         dat2[w] <- NA
         dat2$race_us <- NA
      
         cnm <- c("White", "Black", "Asian", "HI_PI", "AI_AN")
         dat2$rs <- rowSums(dat2[, cnm], na.rm = TRUE)
      
        # if only one category chosen, assign that category as the race
         s1 <- dat2$rs %in% 1 & !(dat2$No %in% 1)
         ws1 <- which(s1)
         t2 <- dat2[s1, cnm]
         wa <- which(t2 == 1, arr.ind = T)
         dat2$race_us[ws1[wa[, 1]]] <- cnm[wa[, 2]]
      
       # if more than one race category chosen, assign race_us as "Multiple"
         s3 <- dat2$rs > 1 & !(dat2$No %in% 1)
         dat2$race_us[s3] <- "Multiple"
      
        # no other race chosen but indicated Hispanic ethnicity, set race_us to Other
         s <- dat2$g3b0624 %in% 1 & dat2$rs %in% 0
         dat2$race_us[s] <- "Other"
      
         dat2$race_us[dat2$No %in% 1] <- NA
      
         dat2 <- dat2 %>% filter(!is.na(dat2$race_us)) %>% select(topmed_subject_id, race_us)
      
       # check for consistency across visits - if differ, assign race_us as "Multiple"
         dat <- rbind(dat1, dat2)
      
         dat <- dat %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
          # determine number of unique race categories chosen across visits for each subject
       sdat <- dat %>% summarise(ncatr = length(unique(race_us)), ot = is.element("Other", race_us))
      
         # if more than one race category (not including "Other") per subject across visits,
         #   assign race_us = Multiple
      
         datt <- inner_join(dat, sdat)
         selr <- datt$ncatr > 2
         datt$race_us[selr] <- "Multiple"
      
         so <- datt$ncatr == 2 & datt$ot == FALSE
         datt$race_us[so] <- "Multiple"
      
        # if race chosen as Other and one other race also chosen, assign the more specific race
         se <- datt$ncatr == 2 & datt$ot == TRUE
         sse <- se & datt$race_us %in% "Other"
         datt <- datt[!sse, ]
         ## take out the "Other" entry so slice(1) (taking first entry per subject)
         #   will capture the more specific race
      
         datt <- datt %>% filter(!is.na(race_us)) %>% slice(1) %>%
                 select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-fhs_offspring"></a>
  * ### demographic/race_us_1 -- **FHS_Offspring**:
    * 7 component_study_variables: `phs000007.v30.pht000747.v6.phv00072044.v5`, `phs000007.v30.pht000747.v6.phv00072530.v5`, `phs000007.v30.pht000747.v6.phv00072531.v5`, `phs000007.v30.pht000747.v6.phv00072532.v5`, `phs000007.v30.pht000747.v6.phv00072533.v5`, `phs000007.v30.pht000747.v6.phv00072534.v5`, `phs000007.v30.pht000747.v6.phv00072537.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us and hispanic_or_latino for FHS Offspring
       # variables are 0/1 (no/yes) for given categories
       # White (Caucasian or White)
       # Black (African-American or Black), Asian, HI_PI (Native Hawaiian or Pacific Islander
       # AI_AN (American Indian or Alaskan Native),  No (Prefer not to answer)
       # can choose more than one
       # ethnicity questions are separate
      
         source_data <- phen_list$source_data
      
         # visit 8 data
      
          dat1 <- source_data[["pht000747"]]
          dat1 <- dat1[dat1$IDTYPE %in% 1, ]
          vars <- paste0("H", 702:707)
          nm <- c("White", "Black", "Asian", "HI_PI", "AI_AN", "No")
      
          #  rename variables; change 0/1 categorical to integer
          for (i in 1:length(vars)){
            dat1[, vars[i]] <- as.integer(dat1[, vars[i]])
            names(dat1)[names(dat1) %in% vars[i]] <- nm[i]
          }
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
         dat1$race_us <- NA
      
         cnm <- c("White", "Black", "Asian", "HI_PI", "AI_AN")
      
        # add up 0's and 1's across variables for each subject
        # if sum =1 only chose one race category, if sum > 1 chose multiple race categories,
        #  if sum = 0, did not choose any of the indicated categories
         dat1$rs <- rowSums(dat1[, cnm], na.rm = TRUE)
      
        # if only one category chosen, assign that category as the race
         s1 <- dat1$rs %in% 1 & !(dat1$No %in% 1)
         ws1 <- which(s1)
         t2 <- dat1[s1, cnm]
         wa <- which(t2 == 1, arr.ind = T)
         dat1$race_us[ws1[wa[, 1]]] <- cnm[wa[, 2]]
      
       # if more than one race category chosen, assign race_us as "Multiple"
         s3 <- dat1$rs > 1 & !(dat1$No %in% 1)
         dat1$race_us[s3] <- "Multiple"
         dat1$race_us[dat1$No %in% 1] <- NA
      
         datt <- dat1 %>% filter(!is.na(dat1$race_us)) %>% select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-fhs_omni1"></a>
  * ### demographic/race_us_1 -- **FHS_Omni1**:
    * 7 component_study_variables: `phs000007.v30.pht004815.v1.phv00251263.v1`, `phs000007.v30.pht004815.v1.phv00251748.v1`, `phs000007.v30.pht004815.v1.phv00251749.v1`, `phs000007.v30.pht004815.v1.phv00251750.v1`, `phs000007.v30.pht004815.v1.phv00251751.v1`, `phs000007.v30.pht004815.v1.phv00251752.v1`, `phs000007.v30.pht004815.v1.phv00251753.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us and hispanic_or_latino for FHS Omni1
       # variables are 0/1 (no/yes) for given categories
       # White (Caucasian or White)
       # Black (African-American or Black), Asian, HI_PI (Native Hawaiian or Pacific Islander
       # AI_AN (American Indian or Alaskan Native),  No (Prefer not to answer)
       # can choose more than one
       # ethnicity questions are separate
      
         source_data <- phen_list$source_data
      
         # visit 3 data
      
          dat1 <- source_data[["pht004815"]]
          dat1 <- dat1[dat1$idtype %in% 7, ]
          vars <- paste0("h", 702:707)
          nm <- c("White", "Black", "Asian", "HI_PI", "AI_AN", "No")
      
        #  rename variables; change 0/1 categorical to integer
          for (i in 1:length(vars)){
            dat1[, vars[i]] <- as.integer(dat1[, vars[i]])
            names(dat1)[names(dat1) %in% vars[i]] <- nm[i]
          }
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
         dat1$race_us <- NA
      
         cnm <- c("White", "Black", "Asian", "HI_PI", "AI_AN")
      
        # add up 0's and 1's across variables for each subject
        # if sum =1 only chose one race category, if sum > 1 chose multiple race categories,
        #  if sum = 0, did not choose any of the indicated categories
         dat1$rs <- rowSums(dat1[, cnm], na.rm = TRUE)
      
        # if only one category chosen, assign that category as the race
         s1 <- dat1$rs %in% 1 & !(dat1$No %in% 1)
         ws1 <- which(s1)
         t2 <- dat1[s1, cnm]
         wa <- which(t2 == 1, arr.ind = T)
         dat1$race_us[ws1[wa[, 1]]] <- cnm[wa[, 2]]
      
       # if more than one race category chosen, assign race_us as "Multiple"
         s3 <- dat1$rs > 1 & !(dat1$No %in% 1)
         dat1$race_us[s3] <- "Multiple"
      
         dat1$race_us[dat1$No %in% 1] <- NA
      
         datt <- dat1 %>% filter(!is.na(dat1$race_us)) %>% select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-fhs_omni2"></a>
  * ### demographic/race_us_1 -- **FHS_Omni2**:
    * 17 component_study_variables: `phs000007.v30.pht003094.v5.phv00177238.v3`, `phs000007.v30.pht003094.v5.phv00177597.v3`, `phs000007.v30.pht003094.v5.phv00177598.v3`, `phs000007.v30.pht003094.v5.phv00177599.v3`, `phs000007.v30.pht003094.v5.phv00177600.v3`, `phs000007.v30.pht003094.v5.phv00177601.v3`, `phs000007.v30.pht003094.v5.phv00177602.v3`, `phs000007.v30.pht003094.v5.phv00177603.v3`, `phs000007.v30.pht006006.v2.phv00274194.v2`, `phs000007.v30.pht006006.v2.phv00274557.v2`, `phs000007.v30.pht006006.v2.phv00274558.v2`, `phs000007.v30.pht006006.v2.phv00274559.v2`, `phs000007.v30.pht006006.v2.phv00274560.v2`, `phs000007.v30.pht006006.v2.phv00274561.v2`, `phs000007.v30.pht006006.v2.phv00274562.v2`, `phs000007.v30.pht006006.v2.phv00274563.v2`, `phs000007.v30.pht006006.v2.phv00274564.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us and hispanic_or_latino for FHS Omni2
       # variables are 0/1 (no/yes) for given categories
       # White (Caucasian or White), Hispanic (Spanish/Hispanic/Latino)
       # Black (African-American or Black), Asian, HI_PI (Native Hawaiian or Pacific Islander
       # AI_AN (American Indian or Alaskan Native), Other, No (Prefer not to answer)
       # can choose more than one
      
         source_data <- phen_list$source_data
      
         # visit 1 data
      
          dat1 <- source_data[["pht006006"]]
          dat1 <- dat1[dat1$idtype %in% 72, ]
          vars <- paste0("g3a", 483:490)
      
        #  rename variables; change 0/1 categorical to integer
          nm <- c("White", "Hispanic", "Black", "Asian", "HI_PI", "AI_AN", "Other", "No")
          for (i in 1:length(vars)){
            dat1[, vars[i]] <- as.integer(dat1[, vars[i]])
            names(dat1)[names(dat1) %in% vars[i]] <- nm[i]
          }
         w <- which(is.element(dat1, "."))
         dat1[w] <- NA
         dat1$race_us <- NA
      
        # treat "Hispanic" differently
         cnm <- c("White", "Black", "Asian", "HI_PI", "AI_AN", "Other")
      
        # add up 0's and 1's across variables for each subject
        # if sum =1 only chose one race category, if sum > 1 chose multiple race categories,
        #   if sum = 0, did not choose any of the indicated categories
         dat1$rs <- rowSums(dat1[, cnm], na.rm = TRUE)
      
        # if only one category chosen, assign that category as the race
         s1 <- dat1$rs %in% 1 & !(dat1$No %in% 1)
         ws1 <- which(s1)
         t2 <- dat1[s1, cnm]
         wa <- which(t2 == 1, arr.ind = T)
         dat1$race_us[ws1[wa[, 1]]] <- cnm[wa[, 2]]
      
       # if more than one race category chosen, assign race_us as "Multiple"
         s3 <- dat1$rs > 1 & !(dat1$No %in% 1)
         dat1$race_us[s3] <- "Multiple"
      
       # if Hispanic category chosen with no other race category, assign "Other"
       # person did choose to identify a race
       # ethnicity will be set to 1 (i.e. is Hispanic)
      
         s <- dat1$Hispanic %in% 1 & dat1$rs %in% 0
         dat1$race_us[s] <- "Other"
      
         dat1$race_us[dat1$No %in% 1] <- NA
      
         dat1 <- dat1 %>% filter(!is.na(dat1$race_us)) %>% select(topmed_subject_id, race_us)
      
         # visit 2 data - contains Gen3, NOS, Omni2
         # Hispanic is not race choice but there is question re Hispanic ethnicity;
      #     set race_us to Other if no other race choice
      
          dat2 <- source_data[["pht003094"]]
          dat2 <- dat2[dat2$idtype %in% 72, ] # choose Omni2
          vars <- paste0("g3b0", 625:630)
          nm <- c("White", "Black", "Asian", "HI_PI", "AI_AN", "No")
          for (i in 1:length(vars)){
            dat2[, vars[i]] <- as.integer(dat2[, vars[i]])
            names(dat2)[names(dat2) %in% vars[i]] <- nm[i]
          }
         w <- which(is.element(dat2, "."))
         dat2[w] <- NA
         dat2$race_us <- NA
      
         cnm <- c("White", "Black", "Asian", "HI_PI", "AI_AN")
         dat2$rs <- rowSums(dat2[, cnm], na.rm = TRUE)
      
        # if only one category chosen, assign that category as the race
         s1 <- dat2$rs %in% 1 & !(dat2$No %in% 1)
         ws1 <- which(s1)
         t2 <- dat2[s1, cnm]
         wa <- which(t2 == 1, arr.ind = T)
         dat2$race_us[ws1[wa[, 1]]] <- cnm[wa[, 2]]
      
       # if more than one race category chosen, assign race_us as "Multiple"
         s3 <- dat2$rs > 1 & !(dat2$No %in% 1)
         dat2$race_us[s3] <- "Multiple"
      
        # no other race chosen but indicated Hispanic ethnicity, set race_us to Other
         s <- dat2$g3b0624 %in% 1 & dat2$rs %in% 0
         dat2$race_us[s] <- "Other"
      
         dat2$race_us[dat2$No %in% 1] <- NA
      
         dat2 <- dat2 %>% filter(!is.na(dat2$race_us)) %>% select(topmed_subject_id, race_us)
      
       # check for consistency across visits - if differ, assign race_us as "Multiple"
         dat <- rbind(dat1, dat2)
      
         dat <- dat %>% tbl_df() %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
          # determine number of unique race categories chosen across visits for each subject
         sdat <- dat %>% summarise(ncatr = length(unique(race_us)), ot = is.element("Other", race_us))
      
         # if more than one race category (not including "Other") per subject across visits,
      #     assign race_us = Multiple
         datt <- inner_join(dat, sdat)
         selr <- datt$ncatr > 2
         datt$race_us[selr] <- "Multiple"
      
         so <- datt$ncatr == 2 & datt$ot == FALSE
         datt$race_us[so] <- "Multiple"
      
        # if race chosen as Other and one other race also chosen, assign the more specific race
         se <- datt$ncatr == 2 & datt$ot == TRUE
         sse <- se & datt$race_us %in% "Other"
         datt <- datt[!sse, ]
        # take out the "Other" entry so slice(1) (taking first entry per subject)
        #   will capture the more specific race
      
         datt <- datt %>% filter(!is.na(race_us)) %>% slice(1) %>%
                select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-fhs_original"></a>
  * ### demographic/race_us_1 -- **FHS_Original**:
    * 1 component_study_variables: `phs000007.v30.pht003099.v5.phv00177928.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us for Original cohort
       # Nancy Heard-Costa confirmed can assume White
       # use global information file to get subjects
      
         source_data <- phen_list$source_data
      
          dat <- source_data[["pht003099"]]
          w <- which(is.element(dat, "."))
          dat[w] <- NA
      
          dat <- dat[dat$idtype %in% 0, ]
          dat$race_us <- "White"
      
          datt <- dat %>% select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-galaii"></a>
  * ### demographic/race_us_1 -- **GALAII**:
    * 1 component_study_variables: `phs001180.v1.pht006988.v1.phv00320615.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht006988 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create race_us variable
          # Confirmed with study, race_us = Other
          transmute(topmed_subject_id, race_us = "Other")
      
        return(dataset)
      }
      ```
<a id="race_us_1-genestar"></a>
  * ### demographic/race_us_1 -- **GeneSTAR**:
    * 2 component_study_variables: `phs001218.v1.pht007766.v1.phv00369267.v1`, `phs001218.v1.pht007766.v1.phv00369270.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        int <- phen_list$source_data$pht007766
        #Order of levels
        int$VISIT <- int$VISIT %>%
                     as.factor() %>%
                     relevel('SSV')
        #Subset to baseline visits, SSV and PSV
        dataset <- int %>%
                   filter(VISIT %in% c('SSV', 'PSV')) %>%
                   mutate(VISIT = as.factor(VISIT)) %>%
                   group_by(topmed_subject_id) %>%
                   arrange(topmed_subject_id, VISIT) %>%
                   filter(row_number(topmed_subject_id) == 1) %>%
                   ungroup() %>%
                   data.frame()
      
        #Assigning race_us categories
        dataset$RACE <- ifelse(dataset$RACE == '1', 'White', 'Black')
      
        #Rename harmonized variable
        dataset <- select(dataset, topmed_subject_id, race_us = RACE)
      
        return(dataset)
      }
      ```
<a id="race_us_1-genoa"></a>
  * ### demographic/race_us_1 -- **GENOA**:
    * 2 component_study_variables: `phs001238.v2.pht006039.v1.phv00277509.v1`, `phs001238.v2.pht006653.v1.phv00307790.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us for GENOA
          source_data <- phen_list$source_data
      
      # values are "African-American", "Hispanic White", "Non-Hispanic White"
      
         dat1 <- source_data[["pht006039"]]   # AA sub-study
         dat2 <- source_data[["pht006653"]]   # EA sub_study
         dat <- rbind(dat1, dat2)
      
      # filter to non-missing values
      # assign Black = African-American, White = either of the other two values
      # select subject id and race_us
         dat <- dat %>% filter(!is.na(RACE)) %>%
                 mutate(race_us = ifelse(RACE %in% "African-American", "Black", "White")) %>%
                 select(topmed_subject_id, race_us)
      
         return(dat)
      }
      ```
<a id="race_us_1-goldn"></a>
  * ### demographic/race_us_1 -- **GOLDN**:
    * 1 component_study_variables: `phs000741.v2.pht003915.v2.phv00202090.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht003915"]]
      
        # GOLDN dbGaP study page says "recruited Caucasian" so set race_us = "White"
        # pull in subject file and eliminate consent=0 subjects
      
         dat <- dat %>% filter(!is.element(consent, 0)) %>%
              mutate(race_us = "White") %>%
              select(topmed_subject_id, race_us)
      
         return(dat)
      }
      ```
<a id="race_us_1-hchs_sol"></a>
  * ### demographic/race_us_1 -- **HCHS_SOL**:
    * 1 component_study_variables: `phs000810.v1.pht004713.v1.phv00226241.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht004713"]]
      
        # All subjects are Hispanic/Latino
        # set race_us to Other and ethnicity to HL
        # will define ethnic_subgroup variable
        # pull in subject file and eliminate consent=0 subjects
      
         dat <- dat %>% filter(!is.element(CONSENT, 0)) %>%
              mutate(race_us = "Other") %>%
              select(topmed_subject_id, race_us)
      
            return(dat)
      }
      ```
<a id="race_us_1-hvh"></a>
  * ### demographic/race_us_1 -- **HVH**:
    * 1 component_study_variables: `phs001013.v3.pht005311.v2.phv00259380.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$pht005311 %>%
          # Remove rows where race is missing or unknown.
          filter(!is.na(race) & !(race %in% 9)) %>%
          group_by(topmed_subject_id) %>%
          # Collapse race by topmed_subject_id.
          summarize(race = unique(race))
      
        rc <- c("Black", "White", "Asian", "AI_AN", "HI_PI", "Other")
        dat$race <- as.integer(dat$race) + 1
        dat$race <- rc[dat$race]
      
        dat <- select(dat, topmed_subject_id, race_us = race)
        return(dat)
      }
      ```
<a id="race_us_1-jhs"></a>
  * ### demographic/race_us_1 -- **JHS**:
    * 1 component_study_variables: `phs000286.v5.pht001920.v4.phv00124546.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
          source_data <- phen_list$source_data
          dat <- source_data[["pht001920"]]
      
        # confirmed with PI that all subjects are African American so set race_us="Black"
        # pull in subject file and eliminate consent=0 subjects
      
         dat <- dat %>% filter(!is.element(CONSENT, 0)) %>%
              mutate(race_us = "Black") %>%
              select(topmed_subject_id, race_us)
      
         return(dat)
      
      }
      ```
<a id="race_us_1-mayo_vte_geneva"></a>
  * ### demographic/race_us_1 -- **Mayo_VTE_GENEVA**:
    * 6 component_study_variables: `phs000289.v2.pht001886.v2.phv00121876.v2`, `phs000289.v2.pht001886.v2.phv00121877.v2`, `phs000289.v2.pht001886.v2.phv00121878.v2`, `phs000289.v2.pht001886.v2.phv00121879.v2`, `phs000289.v2.pht001886.v2.phv00121880.v2`, `phs000289.v2.pht001886.v2.phv00121881.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
      # harmonize race_us for Mayo_VTE
        datt <- phen_list$source_data[["pht001886"]]
      
        rc <- c("race_other", "race_afram", "race_amind", "race_asian", "race_pacisl", "race_white")
       # variables are 1 if category chosen, otherwise 0
      
       # convert to integer
       # change category names to harmonized names
       hnm <- c("Other", "Black", "AI_AN", "Asian", "HI_PI", "White")
        for (i in 1:6){
          datt[, rc[i]] <- as.integer(datt[, rc[i]])
          names(datt)[names(datt) %in% rc[i]] <- hnm[i]
        }
      
       # rowSums in effect counts the number of categories chosen
        datt$rs <- rowSums(datt[, hnm], na.rm = T)
      
        datt$race_us <- NA
       # if rs=0, no categories were chosen; keep race_us as NA
       # if rs=1 then only one category chosen so assign race_us = that category
         s1 <- datt$rs %in% 1
         ws1 <- which(s1)
         t2 <- datt[s1, hnm]
         wa <- which(t2 == 1, arr.ind = TRUE)
       # wa[,1] gives row (subject index), wa[,2] gives column index of column/category chosen
         datt$race_us[ws1[wa[, 1]]] <- hnm[wa[, 2]]
      
       # if rs > 1 multiple categories chosen so assign race_us = "Multiple"
         datt$race_us[datt$rs > 1] <- "Multiple"
      
         datt <- datt %>% filter(!is.na(datt$race_us)) %>% select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-mayo_vte_olmsted"></a>
  * ### demographic/race_us_1 -- **Mayo_VTE_Olmsted**:
    * 6 component_study_variables: `phs001402.v1.pht008239.v1.phv00389932.v1`, `phs001402.v1.pht008239.v1.phv00389933.v1`, `phs001402.v1.pht008239.v1.phv00389934.v1`, `phs001402.v1.pht008239.v1.phv00389935.v1`, `phs001402.v1.pht008239.v1.phv00389936.v1`, `phs001402.v1.pht008239.v1.phv00389937.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht008239
      
        #Assiging race
        dataset$race_us[dataset$race_white == 1] <- 'White'
        dataset$race_us[dataset$race_other == 1] <- 'Other'
        dataset$race_us[dataset$race_afram == 1] <- 'Black'
        dataset$race_us[dataset$race_amind == 1] <- 'AI_AN'
        dataset$race_us[dataset$race_asian == 1] <- 'Asian'
      
        dataset <- dataset %>%
                   select(topmed_subject_id, race_us) %>%
                   return()
      }
      ```
<a id="race_us_1-mesa_airnr"></a>
  * ### demographic/race_us_1 -- **MESA_AirNR**:
    * 2 component_study_variables: `phs000209.v13.pht001111.v4.phv00082641.v1`, `phs000209.v13.pht003086.v3.phv00174585.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us and hispanic_or_latino for MESA AirNR
       # 1=white; 2=chinese american; 3=black;4=hispanic
      
          source_data <- phen_list$source_data
      
         # visit 1 data
         dat1 <- source_data[["pht001111"]]
      
         # visit 5 data
          dat5 <- source_data[["pht003086"]]
      
         dat <- rbind(dat1, dat5)
      
         dat$race_us <- dat$race1c
         dat$race_us[dat$race_us %in% 1] <- "White"
         dat$race_us[dat$race_us %in% 2] <- "Asian"
         dat$race_us[dat$race_us %in% 3] <- "Black"
         dat$race_us[dat$race_us %in% 4] <- "Other"  # will set ethnicity = HL
      
         dat <- dat %>% filter(!is.na(race_us)) %>% tbl_df() %>%
           arrange(topmed_subject_id) %>%
             group_by(topmed_subject_id)
      
          # determine number of unique race categories chosen across visits for each subject
         sdat <- dat %>% summarise(ncatr = length(unique(race_us)), ot = is.element("Other", race_us))
      
         # if more than one race category (not including "Other") per subject across visits,
         #   assign race_us = Multiple
         datt <- inner_join(dat, sdat)
         selr <- datt$ncatr > 2
         datt$race_us[selr] <- "Multiple"
      
         so <- datt$ncatr == 2 & datt$ot == FALSE
         datt$race_us[so] <- "Multiple"
      
        # if race chosen as Hispanic/Other and one other race also chosen, assign that one other race
         se <- datt$ncatr == 2 & datt$ot == TRUE
         sse <- se & datt$race_us %in% "Other"
         datt <- datt[!sse, ]
        #  take out the "Other" entry so slice(1) (taking first entry per subject)
      #     will capture the more specific race
         datt <- datt %>% filter(!is.na(race_us)) %>% slice(1) %>%
            select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-mesa_classic"></a>
  * ### demographic/race_us_1 -- **MESA_Classic**:
    * 5 component_study_variables: `phs000209.v13.pht001116.v10.phv00084444.v2`, `phs000209.v13.pht001118.v8.phv00085775.v2`, `phs000209.v13.pht001119.v8.phv00086261.v2`, `phs000209.v13.pht001120.v10.phv00086729.v2`, `phs000209.v13.pht003091.v3.phv00176008.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us and hispanic_or_latino for MESA Classic
       # 1=white; 2=chinese american; 3=black;4=hispanic
      
         source_data <- phen_list$source_data
      
         # visit 1 data
          dat1 <- source_data[["pht001116"]]
      
         # visit 2 data
          dat2 <- source_data[["pht001118"]]
      
         # visit 3 data
          dat3 <- source_data[["pht001119"]]
      
         # visit 4 data
         dat4 <- source_data[["pht001120"]]
      
         # visit 5 data
          dat5 <- source_data[["pht003091"]]
      
         dat0 <- rbind(dat1, dat2, dat3, dat4, dat5)
      
         dat0$race_us <- dat0$race1c
         dat0$race_us[dat0$race_us %in% 1] <- "White"
         dat0$race_us[dat0$race_us %in% 2] <- "Asian"
         dat0$race_us[dat0$race_us %in% 3] <- "Black"
         dat0$race_us[dat0$race_us %in% 4] <- "Other"   # will set ethnicity = "HL"
      
         dat0 <- dat0 %>% tbl_df()  %>%
             arrange(topmed_subject_id) %>%
              group_by(topmed_subject_id)
      
         dat <- dat0 %>% filter(!is.na(race_us))
      
          # determine number of unique race categories chosen across visits for each subject
         sdat <- dat %>% summarise(ncatr = length(unique(race_us)), ot = is.element("Other", race_us))
      
         # if more than one race category (not including "Other") per subject across visits,
      #      assign race = Multiple
         datt <- inner_join(dat, sdat)
         selr <- datt$ncatr > 2
         datt$race_us[selr] <- "Multiple"
      
         so <- datt$ncatr == 2 & datt$ot == FALSE
         datt$race_us[so] <- "Multiple"
      
        # if race chosen as Hispanic and one other race also chosen, assign the more specific race
         se <- datt$ncatr == 2 & datt$ot == TRUE
         sse <- se & datt$race_us %in% "Other"
         datt <- datt[!sse, ]
        # take out the "Other" entry so slice(1) (taking first entry per subject)
      #    will capture the more specific race
      
         datt <- datt %>% filter(!is.na(race_us)) %>% slice(1) %>%
                select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-mesa_family"></a>
  * ### demographic/race_us_1 -- **MESA_Family**:
    * 1 component_study_variables: `phs000209.v13.pht001121.v3.phv00087074.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us and hispanic_or_latino for MESA Family
       # 1=white; 2=chinese american; 3=black;4=hispanic
      
          source_data <- phen_list$source_data
      
         # visit 1 data
          dat <- source_data[["pht001121"]]
      
         dat$race_us <- dat$racefc
         dat$race_us[dat$race_us %in% 1] <- "White"
         dat$race_us[dat$race_us %in% 2] <- "Asian"
         dat$race_us[dat$race_us %in% 3] <- "Black"
         dat$race_us[dat$race_us %in% 4] <- "Other"  # will set ethnicity = HL
      
         datt <- dat %>% filter(!is.na(race_us)) %>%
                select(topmed_subject_id, race_us)
      
         return(datt)
      }
      ```
<a id="race_us_1-mgh_af"></a>
  * ### demographic/race_us_1 -- **MGH_AF**:
    * 1 component_study_variables: `phs001001.v1.pht005655.v1.phv00265713.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        library(dplyr)
      
        dataset <- phen_list$source_data$pht005655
      
        dataset$race_cat <- ifelse(dataset$race == 'african_american', 'Black',
          ifelse(dataset$race == 'asian', 'Asian',
            ifelse(dataset$race == 'white', 'White',
              ifelse(dataset$race == 'american_indian', 'AI_AN',
                ifelse(dataset$race == 'other', 'Other',
                  ifelse(dataset$race == 'american_indian_black', 'Multiple',
                    ifelse(dataset$race == 'pacific_islanders', 'HI_PI', NA)))))))
      
        dataset <- select(dataset, topmed_subject_id, race_us = race_cat)
      
        return(dataset)
      }
      ```
<a id="race_us_1-partners"></a>
  * ### demographic/race_us_1 -- **Partners**:
    * 1 component_study_variables: `phs001024.v3.pht005693.v1.phv00265980.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005693
      
        #Race categories
        dataset$race_cat <- ifelse(dataset$race == 'white', 'White',
                                   ifelse(dataset$race == 'black', 'Black',
                                          ifelse(dataset$race == 'asian', 'Asian',
                                                 ifelse(dataset$race == 'hispanic', 'Other',
                                                        ifelse(dataset$race == 'other', 'Other', NA)))))
      
        #Variable selection and remove missing
        dataset <- select(dataset, topmed_subject_id, race_us = race_cat) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="race_us_1-sage"></a>
  * ### demographic/race_us_1 -- **SAGE**:
    * 1 component_study_variables: `phs000921.v3.pht004883.v3.phv00252285.v3`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        #Dataset
        dataset <- phen_list$source_data$pht004883 %>%
                   rename(race_us = RACE)
      
        #Relevel variable
        dataset$race_us <- as.factor(dataset$race_us)
        levels(dataset$race_us) <- c('Black', 'Multiple', 'Multiple', 'Multiple', 'Multiple', 'Multiple')
      
        return(dataset)
      }
      ```
<a id="race_us_1-vafar"></a>
  * ### demographic/race_us_1 -- **VAFAR**:
    * 1 component_study_variables: `phs000997.v3.pht005688.v3.phv00265924.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005688 %>%
                   rename(race_us = race)
      
        # Substitute encoded race values.
        dataset$race_us[dataset$race_us %in% 'white'] <- 'White'
      
        # Substitute the value of 'NA' to missing.
        dataset$race_us[dataset$race_us %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="race_us_1-vu_af"></a>
  * ### demographic/race_us_1 -- **VU_AF**:
    * 1 component_study_variables: `phs001032.v4.pht005675.v3.phv00265808.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005675 %>%
                   rename(race_us = race)
      
        # Substitute encoded race values.
        dataset$race_us[dataset$race_us %in% 'white'] <- 'White'
        dataset$race_us[dataset$race_us %in% 'black'] <- 'Black'
        dataset$race_us[dataset$race_us %in% 'asian'] <- 'Asian'
        dataset$race_us[dataset$race_us %in% 'native_american'] <- 'AI_AN'
      
        # Substitute the value of 'NA' to missing.
        dataset$race_us[dataset$race_us %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="race_us_1-wghs"></a>
  * ### demographic/race_us_1 -- **WGHS**:
    * 1 component_study_variables: `phs001040.v3.pht005682.v3.phv00328556.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
      
        #Dataset and rename race variable
        dataset <- phen_list$source_data$pht005682 %>%
                   rename(race_us = race)
      
        #Rename variable category
        dataset$race_us <- 'White'
      
        return(dataset)
      }
      ```
<a id="race_us_1-whi"></a>
  * ### demographic/race_us_1 -- **WHI**:
    * 16 component_study_variables: `phs000200.v11.pht000998.v6.phv00078450.v6`, `phs000200.v11.pht001009.v6.phv00079317.v6`, `phs000200.v11.pht001009.v6.phv00079318.v6`, `phs000200.v11.pht001009.v6.phv00079319.v6`, `phs000200.v11.pht001009.v6.phv00079320.v6`, `phs000200.v11.pht001009.v6.phv00079321.v6`, `phs000200.v11.pht001009.v6.phv00079322.v6`, `phs000200.v11.pht001009.v6.phv00079323.v6`, `phs000200.v11.pht001009.v6.phv00079324.v6`, `phs000200.v11.pht001009.v6.phv00079325.v6`, `phs000200.v11.pht001009.v6.phv00079326.v6`, `phs000200.v11.pht001009.v6.phv00079327.v6`, `phs000200.v11.pht001009.v6.phv00079328.v6`, `phs000200.v11.pht001009.v6.phv00079329.v6`, `phs000200.v11.pht001009.v6.phv00079330.v6`, `phs000200.v11.pht001009.v6.phv00079331.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
          library(dplyr)
          library(magrittr)
      
       # harmonize race_us for WHI
       # From WHI study investigator: Form 2 takes precedence, Form 41 can be used for more specificity
       #  Form 2 Asian or Pacific Islander category:
       #    can use Form 41 to identify Pacific Islander, assign rest Asian
       # all subjects were present for Form 2
      
          source_data <- phen_list$source_data
      
       ## baseline Form 2
       # 1=American Indian or Alaskan Native; 2=Asian or Pacific Islander; 3=Black or African American;
       # 4=Hispanic/Latino; 5=White (not of Hispanic origin); 8 = Other
      
         dat1 <- source_data[["pht000998"]]
      
         dat1$RACE[dat1$RACE %in% 8] <- 6
         dat1$RACE <- as.integer(dat1$RACE)
         rc <- c("AI_AN", "AsPacIsl", "Black", "Hispanic", "White", "Other")
         dat1$RACE <- rc[dat1$RACE]
      
       ## additional race information Form 41
       # variable SPANISH: 0 = not Hispanic, 1 = Puerto Rican, 2 = Mexican/MexicanAmerican, Chicano
       #  3 = Cuban, 4 = Other Hispanic
       # SPANISH: use for ethnicity and ethnic_subgroup variables
       # other variables are 0/1 for No/Yes for a given race category
      
         dat2 <- source_data[["pht001009"]]
      
        asian <- c("CHINESE", "JAPANESE", "KOREAN", "ASIAINDIAN", "OTHERASIAN", "VIETNAMESE", "FILIPINO")
        pacisl <- c("GUAMANIAN", "HAWAIIAN", "OTHRPACISL", "SAMOAN")
        rest <- c("WHITE", "BLACK", "AMERINDIAN", "OTHERRACE")
        rest2 <- c("White", "Black", "AI_AN", "Other")
        for (i in 1:length(rest)){
             names(dat2)[names(dat2) %in% rest[i]] <- rest2[i]
        }
      
        asel1 <- FALSE
        asel0 <- TRUE
        for (i in 1:length(asian)){
          asel1 <- asel1 | dat2[, asian[i]] %in% 1
          asel0 <- asel0 & dat2[, asian[i]] %in% 0
        }
        dat2$asian <- NA
        dat2$asian[asel1] <- 1
        dat2$asian[asel0] <- 0
      
        asel1 <- FALSE
        asel0 <- TRUE
        for (i in 1:length(pacisl)){
          asel1 <- asel1 | dat2[, pacisl[i]] %in% 1
          asel0 <- asel0 & dat2[, pacisl[i]] %in% 0
        }
        dat2$pacisl <- NA
        dat2$pacisl[asel1] <- 1
        dat2$pacisl[asel0] <- 0
      
        cnm <- c(rest2, "asian", "pacisl")
        for (cn in cnm){
          dat2[, cn] <- as.integer(dat2[, cn])
        }
      
        dat2$rs <- rowSums(dat2[, cnm], na.rm = TRUE)
      
        dat2$race2 <- NA
      
       # if only one category chosen, assign that category as the race
         s1 <- dat2$rs %in% 1
         ws1 <- which(s1)
         t2 <- dat2[s1, cnm]
         wa <- which(t2 == 1, arr.ind = TRUE)
         dat2$race2[ws1[wa[, 1]]] <- cnm[wa[, 2]]
      
         dat2$race2[dat2$race2 %in% "asian"] <- "Asian"
         dat2$race2[dat2$race2 %in% "pacisl"] <- "HI_PI"
      
         dat3 <- dat2 %>% select(topmed_subject_id, race2)
      
       ## combine to assess more specificity
       ## Form 2 takes precedence even if inconsistency
      
         datt <- full_join(dat1, dat3)
      
         datt$race_us <- NA
      
       #--- AsPacIsl: assign Asian unless there is more specific information
      #   to determine Hawaiian or Pacific Islander---
         x <- datt$RACE %in% "AsPacIsl"
      
         ps <- datt$race2 %in% "HI_PI"
         sel <- x & ps
         datt$race_us[sel] <- "HI_PI"
      
         n <- x & !sel
         datt$race_us[n] <- "Asian"
      
       #--- Hispanic ---
         x <- datt$RACE %in% "Hispanic"
        datt$race_us[x] <- datt$race2[x]
      
        s3 <- x & is.na(datt$race2)
        datt$race_us[s3] <- "Other"
      
       #--- Other ---
        x <- datt$RACE %in% "Other"
        s1 <- x & !is.na(datt$race2)
        datt$race_us[s1] <- datt$race2[s1]
        s2 <- x & is.na(datt$race2)
        datt$race_us[s2] <- "Other"
      
       #--- White ---
        x <- datt$RACE %in% "White"
        datt$race_us[x] <- "White"
      
       #--- Black ---
        x <- datt$RACE %in% "Black"
        datt$race_us[x] <- "Black"
      
       #--- AI_AN ---
        x <- datt$RACE %in% "AI_AN"
        datt$race_us[x] <- "AI_AN"
      
       #--- Unspecified ---
        x <- is.na(datt$RACE)
        datt$race_us[x] <- datt$race2[x]
      
        datt <- datt %>% filter(!is.na(race_us)) %>% select(topmed_subject_id, race_us)
      
        return(datt)
      }
      ```
<a id="subcohort_1"></a>
## demographic: **subcohort_1** (subcohort)
  A distinct subgroup within a study, generally indicating subjects who share similar characteristics due to study design. Subjects may belong to only one subcohort.
  * **Harmonization Units**:
    * [Amish](#subcohort_1-amish)
    * [ARIC](#subcohort_1-aric)
    * [BAGS](#subcohort_1-bags)
    * [CARDIA](#subcohort_1-cardia)
    * [CCAF](#subcohort_1-ccaf)
    * [CFS](#subcohort_1-cfs)
    * [CHS](#subcohort_1-chs)
    * [COPDGene](#subcohort_1-copdgene)
    * [CRA](#subcohort_1-cra)
    * [DHS](#subcohort_1-dhs)
    * [FHS](#subcohort_1-fhs)
    * [GALAII](#subcohort_1-galaii)
    * [GeneSTAR](#subcohort_1-genestar)
    * [GENOA_AfricanAmerican](#subcohort_1-genoa_africanamerican)
    * [GENOA_EuropeanAmerican](#subcohort_1-genoa_europeanamerican)
    * [GOLDN](#subcohort_1-goldn)
    * [HCHS_SOL](#subcohort_1-hchs_sol)
    * [HVH](#subcohort_1-hvh)
    * [JHS](#subcohort_1-jhs)
    * [Mayo_VTE_GENEVA](#subcohort_1-mayo_vte_geneva)
    * [Mayo_VTE_Olmsted](#subcohort_1-mayo_vte_olmsted)
    * [MESA_airnr](#subcohort_1-mesa_airnr)
    * [MESA_classic](#subcohort_1-mesa_classic)
    * [MESA_family](#subcohort_1-mesa_family)
    * [MGH_AF](#subcohort_1-mgh_af)
    * [Partners](#subcohort_1-partners)
    * [SAGE](#subcohort_1-sage)
    * [SAS](#subcohort_1-sas)
    * [VAFAR](#subcohort_1-vafar)
    * [VU_AF](#subcohort_1-vu_af)
    * [WGHS](#subcohort_1-wghs)
    * [WHI](#subcohort_1-whi)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 2, **`Has Age Variable`**: No, **`Date Harmonized`**: 2019-10-29 10:25:04
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0599755
  * **DCC Harmonization Comments**:

    The concept of "cohort" or "subcohort" varies among studies and its meaning is highly dependent on study design. This is intended to be a general-purpose variable, and analysts should consult study documentation before using this variable in analysis.
    
    If available, we recoded component study variables indicating subcohort membership. In instances where there was no variable indicating subcohort membership, we assigned the corresponding harmonized subcohort codes to the set of subject IDs included in subcohort-specific datasets. All consented subjects in studies with no subcohort structure were assigned a code of the form "`TOPMed_abbreviation_NoSubcohortStructure`" (e.g. "`JHS_NoSubcohortStructure`").
    
<a id="subcohort_1-amish"></a>
  * ### demographic/subcohort_1 -- **Amish**:
    * 1 component_study_variables: `phs000956.v3.pht005002.v1.phv00252974.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data[["pht005002"]]
        # Specify subcohort codes.
        cht <- c("HAPI", "Longevity", "Wellness")
        # Convert variable to integer.
        dat$baseline_study <- as.integer(dat$baseline_study)
        # Create new variable with new codes.
        dat$subcohort <- paste0("Amish_", cht[dat$baseline_study])
        # Select only ID and new subcohort variable.
        dat <- select(dat, topmed_subject_id, subcohort)
        return(dat)
      }
      ```
<a id="subcohort_1-aric"></a>
  * ### demographic/subcohort_1 -- **ARIC**:
    * 1 component_study_variables: `phs000280.v5.pht001440.v5.phv00098580.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht001440 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "ARIC_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-bags"></a>
  * ### demographic/subcohort_1 -- **BAGS**:
    * 1 component_study_variables: `phs001143.v2.pht005902.v1.phv00273200.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht005902 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "BAGS_NoSubcohortStructure")
      
        return(dataset)
      }
      ```
<a id="subcohort_1-cardia"></a>
  * ### demographic/subcohort_1 -- **CARDIA**:
    * 1 component_study_variables: `phs000285.v3.pht001554.v3.phv00112395.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht001554 %>%
          # Filter out unconsented individuals.
          filter(!(Consent %in% "0") & !is.na(Consent)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "CARDIA_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-ccaf"></a>
  * ### demographic/subcohort_1 -- **CCAF**:
    * 1 component_study_variables: `phs001189.v2.pht005977.v2.phv00273537.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005977
      
        # Filter for consented subjects.
        dataset <- filter(dataset, CONSENT == '1')
      
        # Create subcohort variable.
        dataset$subcohort <- 'CCAF_NoSubcohortStructure'
      
        # Select variables to return.
        dataset <- select(dataset, topmed_subject_id, subcohort)
      
        return(dataset)
      }
      ```
<a id="subcohort_1-cfs"></a>
  * ### demographic/subcohort_1 -- **CFS**:
    * 2 component_study_variables: `phs000284.v2.pht001899.v2.phv00122002.v2`, `phs000284.v2.pht001902.v1.phv00122012.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht001899 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "CFS_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-chs"></a>
  * ### demographic/subcohort_1 -- **CHS**:
    * 1 component_study_variables: `phs000287.v6.pht001452.v1.phv00100290.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        # Rename subcohort variable.
        harmonized <- dplyr::rename(phen_list$source_data$pht001452, subcohort = PERSTAT)
        # Get index of Original cohort.
        ind_old <- harmonized$subcohort == "1"
        # Specify new key.
        harmonized[ind_old, "subcohort"] <- "CHS_Original"
        # Get index of African-American cohort.
        ind_new <- harmonized$subcohort == "2"
        # Specify new key.
        harmonized[ind_new, "subcohort"] <- "CHS_AfricanAmerican"
        return(harmonized)
      }
      ```
<a id="subcohort_1-copdgene"></a>
  * ### demographic/subcohort_1 -- **COPDGene**:
    * 1 component_study_variables: `phs000179.v5.pht002237.v3.phv00159560.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht002237 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "COPDGene_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-cra"></a>
  * ### demographic/subcohort_1 -- **CRA**:
    * 1 component_study_variables: `phs000988.v2.pht005245.v2.phv00258637.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht005245 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "CRA_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-dhs"></a>
  * ### demographic/subcohort_1 -- **DHS**:
    * 1 component_study_variables: `phs001412.v1.pht006743.v1.phv00310005.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Dataset
        dataset <- phen_list$source_data$pht006743 %>%
        #Removing consent group 0
                   filter(!(CONSENT == 0))
        #Assigning cohort structure
        dataset$subcohort <- "DHS_NoSubcohortStructure"
        #Selecting final variables
        dataset <- dataset %>%
                   select(topmed_subject_id, subcohort) %>%
                   return()
      }
      ```
<a id="subcohort_1-fhs"></a>
  * ### demographic/subcohort_1 -- **FHS**:
    * 1 component_study_variables: `phs000007.v30.pht003099.v5.phv00177928.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data[["pht003099"]]
        # Create empty subcohort variable.
        dat$subcohort <- NA
        # Map codes to new subcohort variable.
        dat$subcohort[dat$idtype == "0"] <- "FHS_Original"
        dat$subcohort[dat$idtype == "1"] <- "FHS_Offspring"
        dat$subcohort[dat$idtype == "2"] <- "FHS_NewOffspringSpouse"
        dat$subcohort[dat$idtype == "3"] <- "FHS_Gen3"
        dat$subcohort[dat$idtype == "7"] <- "FHS_Omni1"
        dat$subcohort[dat$idtype == "72"] <- "FHS_Omni2"
        # Select only ID and new subcohort variable.
        dat <- select(dat, topmed_subject_id, subcohort)
        return(dat)
      }
      ```
<a id="subcohort_1-galaii"></a>
  * ### demographic/subcohort_1 -- **GALAII**:
    * 1 component_study_variables: `phs001180.v1.pht006988.v1.phv00320615.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht006988 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "GALAII_NoSubcohortStructure")
      
        return(dataset)
      }
      ```
<a id="subcohort_1-genestar"></a>
  * ### demographic/subcohort_1 -- **GeneSTAR**:
    * 1 component_study_variables: `phs001218.v1.pht007766.v1.phv00369267.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        int <- phen_list$source_data$pht007766
        #Order of levels
        int$VISIT <- int$VISIT %>%
                     as.factor() %>%
                     relevel('SSV')
        #Subset to baseline visits, SSV and PSV
        dataset <- int %>%
                   filter(VISIT %in% c('SSV', 'PSV')) %>%
                   mutate(VISIT = as.factor(VISIT)) %>%
                   group_by(topmed_subject_id) %>%
                   arrange(topmed_subject_id, VISIT) %>%
                   filter(row_number(topmed_subject_id) == 1) %>%
                   ungroup() %>%
                   data.frame()
      
        #Assigning values
        dataset$subcohort <- ifelse(dataset$VISIT == 'SSV',
                                    'GeneSTAR_Sibling',
                                    'GeneSTAR_CoparentOffspring')
      
        #Select variables and remove missing
        dataset <- select(dataset, topmed_subject_id, subcohort)
      
        return(dataset)
      }
      ```
<a id="subcohort_1-genoa_africanamerican"></a>
  * ### demographic/subcohort_1 -- **GENOA_AfricanAmerican**:
    * 1 component_study_variables: `phs001238.v2.pht006039.v1.phv00277508.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        pht6039 <- phen_list$source_data$pht006039 %>%
          # Select ID variable and code all subjects as AA.
          transmute(topmed_subject_id, subcohort = "GENOA_AfricanAmerican")
        return(pht6039)
      }
      ```
<a id="subcohort_1-genoa_europeanamerican"></a>
  * ### demographic/subcohort_1 -- **GENOA_EuropeanAmerican**:
    * 3 component_study_variables: `phs001238.v2.pht006649.v1.phv00307741.v1`, `phs001238.v2.pht006653.v1.phv00307789.v1`, `phs001238.v2.pht006659.v1.phv00307950.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(magrittr)
        # Get IDs from each dataset.
        ids <- sapply(phen_list$source_data, extract2, "topmed_subject_id") %>%
          # Unlist IDs into vector.
          unlist() %>%
          # Remove duplicate values.
          unique()
        # Create harmonized dataframe and add subcohort.
        harmonized <- data.frame(topmed_subject_id = ids, subcohort = "GENOA_EuropeanAmerican")
        return(harmonized)
      }
      ```
<a id="subcohort_1-goldn"></a>
  * ### demographic/subcohort_1 -- **GOLDN**:
    * 1 component_study_variables: `phs000741.v2.pht003915.v2.phv00202090.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht003915 %>%
          # Filter out unconsented individuals.
          filter(!(consent %in% "0") & !is.na(consent)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "GOLDN_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-hchs_sol"></a>
  * ### demographic/subcohort_1 -- **HCHS_SOL**:
    * 1 component_study_variables: `phs000810.v1.pht004713.v1.phv00226241.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht004713 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "HCHS_SOL_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-hvh"></a>
  * ### demographic/subcohort_1 -- **HVH**:
    * 3 component_study_variables: `phs001013.v3.pht005309.v3.phv00259370.v3`, `phs001013.v3.pht005311.v2.phv00259376.v2`, `phs001013.v3.pht005311.v2.phv00259377.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht005309 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "HVH_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-jhs"></a>
  * ### demographic/subcohort_1 -- **JHS**:
    * 1 component_study_variables: `phs000286.v5.pht001920.v4.phv00124546.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht001920 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "JHS_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-mayo_vte_geneva"></a>
  * ### demographic/subcohort_1 -- **Mayo_VTE_GENEVA**:
    * 1 component_study_variables: `phs000289.v2.pht001883.v1.phv00121830.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht001883 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "Mayo_VTE_GENEVA")
        return(dat)
      }
      ```
<a id="subcohort_1-mayo_vte_olmsted"></a>
  * ### demographic/subcohort_1 -- **Mayo_VTE_Olmsted**:
    * 1 component_study_variables: `phs001402.v1.pht008239.v1.phv00389900.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht008239 %>%
                   transmute(topmed_subject_id, subcohort = "Mayo_VTE_Olmsted")
      
        return(dataset)
      }
      ```
<a id="subcohort_1-mesa_airnr"></a>
  * ### demographic/subcohort_1 -- **MESA_airnr**:
    * 1 component_study_variables: `phs000209.v13.pht001111.v4.phv00082644.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Code subcohort as AirNR for all observations in dataframe.
        harmonized <- transmute(phen_list$source_data$pht001111, topmed_subject_id,
                                subcohort = "MESA_AirNR")
        return(harmonized)
      }
      ```
<a id="subcohort_1-mesa_classic"></a>
  * ### demographic/subcohort_1 -- **MESA_classic**:
    * 1 component_study_variables: `phs000209.v13.pht001116.v10.phv00084447.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Code subcohort as Classic for all observations in dataframe.
        harmonized <- transmute(phen_list$source_data$pht001116, topmed_subject_id,
                                subcohort = "MESA_Classic")
        return(harmonized)
      }
      ```
<a id="subcohort_1-mesa_family"></a>
  * ### demographic/subcohort_1 -- **MESA_family**:
    * 1 component_study_variables: `phs000209.v13.pht001121.v3.phv00087075.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Code subcohort as Family for all observations in dataframe.
        harmonized <- transmute(phen_list$source_data$pht001121, topmed_subject_id,
                                subcohort = "MESA_Family")
        return(harmonized)
      }
      ```
<a id="subcohort_1-mgh_af"></a>
  * ### demographic/subcohort_1 -- **MGH_AF**:
    * 1 component_study_variables: `phs001001.v1.pht005653.v1.phv00265704.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht005653 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "MGH_AF_NoSubcohortStructure")
      
        return(dataset)
      }
      ```
<a id="subcohort_1-partners"></a>
  * ### demographic/subcohort_1 -- **Partners**:
    * 1 component_study_variables: `phs001024.v3.pht005116.v2.phv00253774.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dataset <- phen_list$source_data$pht005116
        # Create subcohort variable.
        dataset$subcohort <- 'Partners_NoSubcohortStructure'
      
        dataset <- select(dataset, topmed_subject_id, subcohort)
        return(dataset)
      }
      ```
<a id="subcohort_1-sage"></a>
  * ### demographic/subcohort_1 -- **SAGE**:
    * 1 component_study_variables: `phs000921.v3.pht004881.v3.phv00252275.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dataset <- phen_list$source_data$pht004881
        # Create subcohort variable.
        dataset$subcohort <- "SAGE_NoSubcohortStructure"
      
        dataset <- select(dataset, topmed_subject_id, subcohort)
        return(dataset)
      }
      ```
<a id="subcohort_1-sas"></a>
  * ### demographic/subcohort_1 -- **SAS**:
    * 1 component_study_variables: `phs000914.v1.pht005251.v1.phv00258664.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data$pht005251 %>%
          # Filter out unconsented individuals.
          filter(!(CONSENT %in% "0") & !is.na(CONSENT)) %>%
          # Create subcohort variable.
          transmute(topmed_subject_id, subcohort = "SAS_NoSubcohortStructure")
        return(dat)
      }
      ```
<a id="subcohort_1-vafar"></a>
  * ### demographic/subcohort_1 -- **VAFAR**:
    * 1 component_study_variables: `phs000997.v3.pht005087.v3.phv00253604.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005087
      
        # Filter for consented subjects.
        dataset <- filter(dataset, CONSENT == '1')
      
        # Create subcohort variable.
        dataset$subcohort <- 'VAFAR_NoSubcohortStructure'
      
        # Select variables to return.
        dataset <- select(dataset, topmed_subject_id, subcohort)
      
        return(dataset)
      }
      ```
<a id="subcohort_1-vu_af"></a>
  * ### demographic/subcohort_1 -- **VU_AF**:
    * 1 component_study_variables: `phs001032.v4.pht005098.v2.phv00253678.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        dataset <- phen_list$source_data$pht005098
      
        # Filter for consented subjects.
        dataset <- filter(dataset, CONSENT == '1')
      
        # Create subcohort variable.
        dataset$subcohort <- 'VU_AF_NoSubcohortStructure'
      
        # Select variables to return.
        dataset <- select(dataset, topmed_subject_id, subcohort)
      
        return(dataset)
      }
      ```
<a id="subcohort_1-wghs"></a>
  * ### demographic/subcohort_1 -- **WGHS**:
    * 1 component_study_variables: `phs001040.v3.pht005203.v2.phv00258321.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht005203 %>%
        #subcohort variable
        transmute(topmed_subject_id, subcohort = "WGHS_NoSubcohortStructure")
      
        return(dataset)
      }
      ```
<a id="subcohort_1-whi"></a>
  * ### demographic/subcohort_1 -- **WHI**:
    * 2 component_study_variables: `phs000200.v11.pht001031.v6.phv00080424.v6`, `phs000200.v11.pht001031.v6.phv00080425.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        dat <- phen_list$source_data[["pht001031"]] %>%
          # Select ID and create new variable.
          transmute(topmed_subject_id, subcohort = ifelse(
            # Code CT cohort.
            CTFLAG %in% 1, "WHI_ClinicalTrial",
            # Code OS cohort.
            ifelse(OSFLAG %in% 1, "WHI_ObservationalStudy",
            # Specify NA for any remaining.
            NA
          )))
      }
      ```

# inflammation

### Variables in this section:
* [cd40_1](#cd40_1)
* [crp_1](#crp_1)
* [eselectin_1](#eselectin_1)
* [icam1_1](#icam1_1)
* [il10_1](#il10_1)
* [il18_1](#il18_1)
* [il1_beta_1](#il1_beta_1)
* [il6_1](#il6_1)
* [isoprostane_8_epi_pgf2a_1](#isoprostane_8_epi_pgf2a_1)
* [lppla2_act_1](#lppla2_act_1)
* [lppla2_mass_1](#lppla2_mass_1)
* [mcp1_1](#mcp1_1)
* [mmp9_1](#mmp9_1)
* [mpo_1](#mpo_1)
* [opg_1](#opg_1)
* [pselectin_1](#pselectin_1)
* [tnfa_1](#tnfa_1)
* [tnfa_r1_1](#tnfa_r1_1)
* [tnfr2_1](#tnfr2_1)

<a id="cd40_1"></a>
## inflammation: **cd40_1** (cd40)
  Cluster of differentiation 40 ligand (CD40) concentration in blood.
  * **Harmonization Units**:
    * [FHS](#cd40_1-fhs)
    * [MESA](#cd40_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: ng / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:02:25
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C2825885
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure CD40 concentration from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* Original, New Offspring Spouse, Generation 3, Omni 1, and Omni 2 Cohorts are not included in this harmonized phenotype at this time.
    
    #### MESA
    
    After careful consideration of normal CD40 ranges and assay limits, the units of the dbGaP variable (phv00085021) were inferred to be ng/mL instead of pg/mL as reported in the dbGaP metadata. These inferred units were used when harmonizing this component variable.
    
    The *_MESA_* AirNR and Family Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for CD40 measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | FHS_Offspring | Exam 7 |
    | MESA_Classic | Exam 1 Main |
    
    #### Assay and limits of detection for CD40 measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | FHS_Offspring | ELISA | 0.005 ng/mL | NA | No |
    | MESA_Classic | ELISA | 0.0042 ng/mL | NA | No | 
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for CD40 measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | FHS | Plasma |
    | MESA | Serum |
    
<a id="cd40_1-fhs"></a>
  * ### inflammation/cd40_1 -- **FHS**:
    * 2 component_study_variables: `phs000007.v29.pht000079.v6.phv00021687.v5`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht000079,
                             phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   rename(cd40 = CD40P, age = age7)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="cd40_1-mesa"></a>
  * ### inflammation/cd40_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085021.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht001116 %>%
                   rename(cd40 = cd40l1, age = age1c)
      
        #Converting to numeric values
        dataset <- replace(dataset, dataset == 'NA', NA) %>%
                   mutate_if(is.character, as.numeric)
      
        #Removing missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1"></a>
## inflammation: **crp_1** (crp)
  C-reactive protein (CRP) concentration in blood.
  * **Harmonization Units**:
    * [Amish](#crp_1-amish)
    * [ARIC](#crp_1-aric)
    * [CARDIA](#crp_1-cardia)
    * [CFS](#crp_1-cfs)
    * [CHS](#crp_1-chs)
    * [FHS_Gen3_Offspring](#crp_1-fhs_gen3_offspring)
    * [FHS_NewOffspringSpouse_Omni2](#crp_1-fhs_newoffspringspouse_omni2)
    * [FHS_Omni1](#crp_1-fhs_omni1)
    * [GENOA](#crp_1-genoa)
    * [HCHS_SOL](#crp_1-hchs_sol)
    * [JHS](#crp_1-jhs)
    * [MESA_AirNR](#crp_1-mesa_airnr)
    * [MESA_Classic_Family](#crp_1-mesa_classic_family)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: mg / L, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:07:16
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0428528
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure CRP concentration from serum or plasma differed by study and/or subcohort.
    
    #### ARIC
    
    A few negative measurement values were set to missing in the harmonization.
    
    #### CHS
    
    The component study variable used in harmonization contains measurements using different assays and was already adjusted for laboratory drift by the study. Original assay LODs are not applicable to this variable due to adjustment.
    
    #### FHS
    
    The *_FHS_* Original Cohort is not included in this harmonized phenotype at this time.
    
    #### GENOA
    
    The component study variable used in harmonization is the average of two CRP measurements at the Phase 2 Exam. 
    
    #### HCHS_SOL 
    
    Measurements outside the LLOD or the ULOD were set to missing by the study and therefore were not available.
    
    #### JHS 
    
    A small number of measurements not indicated as below the LLOD had a value of 0.0 mg/dL. After consulting with the study, these measurements were set to the LLOD in the harmonized variable.
    
    #### Exam visit for CRP measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | Amish | Baseline visit |
    | ARIC | Visit 5 |
    | CARDIA | Year 15/Exam 6 |
    | CFS | Visit 5 |
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | FHS_Offspring | Exam 7 |
    | FHS_NewOffspringSpouse | Exam 2 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    | FHS_Omni2 | Exam 2 |
    | GENOA | Phase 2 |
    | HCHS_SOL | Visit 1 |
    | JHS | Visit 1 |
    | MESA_Classic | Exam 1 Main |
    | MESA_Family | Family Exam Main |
    | MESA_AirNR | AirNR Exam Main | 
    
    #### Assay and limits of detection for CRP measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | Amish | Endpoint Nephelometry | 0.2 mg/L | NA | No |
    | ARIC | ELISA | 0.00035 mg/L |  NA  | No |
    | CARDIA | BNII nephelometer | 0.15 mg/L | 1100 mg/L | Yes |
    | CFS | Dade Behring BN II nephelometer | 0.15 mg/L | 1100 mg/L | Yes |
    | CHS | High-sensitivity ELISA | NA |  NA  | No |
    | FHS_Offspring | Particle Enhanced Immunonephelometry | 0.16 mg/L |  1100 mg/L | No |
    | FHS_NewOffspringSpouse | Immunoturbidometric assay | 0.15 mg/L | NA  | Yes |
    | FHS_Gen3 | Particle Enhanced Immunonephelometry | 0.15 mg/L |  550 mg/L  | No |
    | FHS_Omni1 | Immunoturbidometric assay | 0.15 mg/L | 262.5 mg/L | Yes |
    | FHS_Omni2 | Immunoturbidometric assay | 0.15 mg/L | NA | Yes |
    | GENOA | Immunoturbidimetric CRP-Latex assay | 0.1 mg/L | NA | No |
    | HCHS_SOL | Immunoturbidimetric assay | 0.1 mg/L |  NA  | No |
    | JHS | Immunoturbidimetric CRP-Latex assay | 0.1 mg/L |  NA  | Yes |
    | MESA_Classic  | BNII nephelometer, Siemens | 0.16 mg/L | 1100 mg/L |Yes |
    | MESA_Family  | BNII nephelometer, Siemens | 0.16 mg/L | 1100 mg/L | No | 
    | MESA_AirNR  | BNII nephelometer, Siemens | 0.16 mg/L | 1100 mg/L | Yes |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for CRP measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | CARDIA | Plasma |
    | CHS | Plasma |
    | FHS | Serum |
    | GENOA | Serum |
    
<a id="crp_1-amish"></a>
  * ### inflammation/crp_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00252992.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005002 %>%
                   rename(age = age_baseline, crp = crp_baseline)
      
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        dataset$age[dataset$age %in% '90+'] <- 90
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$crp[dataset$crp %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-aric"></a>
  * ### inflammation/crp_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht006431.v1.phv00295623.v1`, `phs000280.v4.pht006444.v1.phv00296696.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- inner_join(phen_list$source_data$pht006444,
                              phen_list$source_data$pht006431,
                              by = "topmed_subject_id") %>%
                   rename(age = AGE_STAGE_1, crp = LIP33)
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$crp[dataset$crp %in% 'NA'] <- NA
      
        # Substitute negative CRP values to missing.
        dataset$crp[dataset$crp < 0] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-cardia"></a>
  * ### inflammation/crp_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001851.v2.phv00120748.v2`, `phs000285.v3.pht001853.v2.phv00120759.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- inner_join(phen_list$source_data$pht001853,
                              phen_list$source_data$pht001851,
                              by = "topmed_subject_id") %>%
                   rename(age = EX6_AGE, crp = FL6CRPBN)
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$crp[dataset$crp %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-cfs"></a>
  * ### inflammation/crp_1 -- **CFS**:
    * 3 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00123990.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht001902 %>%
                   rename(crp = crpam)
      
        # Filter for Visit 5 only.
        dataset <- filter(dataset, visit == '5')
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$crp[dataset$crp %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Set CRP values below the lower limit of detection to the lower limit of detection.
        dataset$crp[dataset$crp == 0.075] <- 0.15
      
        # Select the output variables and remove records with NAs from dataset.
        dataset <- select(dataset, topmed_subject_id, crp, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="crp_1-chs"></a>
  * ### inflammation/crp_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001452.v1.phv00100499.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht001452 %>%
                   rename(age = AGEBL, crp = CRPBLADJ)
      
        # Substitute the value of 'NA' to missing.
        dataset$crp[dataset$crp %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-fhs_gen3_offspring"></a>
  * ### inflammation/crp_1 -- **FHS_Gen3_Offspring**:
    * 5 component_study_variables: `phs000007.v29.pht000082.v6.phv00021697.v5`, `phs000007.v29.pht000298.v5.phv00036343.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #OFFSPRING EXAM 7
        crp_of <- left_join(phen_list$source_data$pht000082, phen_list$source_data$pht003099,
                            by = 'topmed_subject_id') %>%
                  rename(crp = CRP, age = age7)
        crp_of <- select(crp_of, topmed_subject_id, crp, age)
      
        #GENERATION 3 EXAM 1
        crp_g3 <- left_join(phen_list$source_data$pht000298, phen_list$source_data$pht003099,
                            by = 'topmed_subject_id') %>%
                  rename(age = age1)
      
        crp_g3 <- select(crp_g3, topmed_subject_id, crp, age)
      
        dataset <- bind_rows(crp_of, crp_g3)
      
        #Changing variables to numeric
        dataset <- mutate(dataset, age = as.numeric(age), crp = as.numeric(crp))
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-fhs_newoffspringspouse_omni2"></a>
  * ### inflammation/crp_1 -- **FHS_NewOffspringSpouse_Omni2**:
    * 4 component_study_variables: `phs000007.v29.pht002889.v2.phv00172177.v2`, `phs000007.v29.pht002889.v2.phv00172203.v2`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177932.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- left_join(phen_list$source_data$pht002889, phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   rename(crp = CRP, age = age2)
        dataset <- subset(dataset, idtype == '2' | idtype == '72')
      
        #Converting to numeric values
        #dataset$crp[dataset$crp %in% 'NA'] <- NA
        #dataset$crp_i[dataset$crp_i %in% 'NA'] <- NA
      
        dataset <- mutate(dataset, crp = as.numeric(crp),
                          age = as.numeric(age),
                          crp_i = as.numeric(crp_i))
      
        #Assigning subjects below LOD to LLOD
        dataset$crp <- ifelse(dataset$crp_i == 1, 0.15, dataset$crp)
      
        dataset <- select(dataset, topmed_subject_id, crp, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-fhs_omni1"></a>
  * ### inflammation/crp_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht002888.v4.phv00172158.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- left_join(phen_list$source_data$pht002888, phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   rename(age = age3)
        dataset <- subset(dataset, idtype == '7')
      
        #Changing to numeric values
        dataset <- mutate(dataset, crp = as.numeric(crp), age = as.numeric(age))
      
        #Recoding values below LOD to LLOD
        dataset$crp <- ifelse(dataset$crp == 0.14, 0.15, dataset$crp)
      
        dataset <- select(dataset, topmed_subject_id, crp, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-genoa"></a>
  * ### inflammation/crp_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v1.pht006046.v1.phv00277758.v1`, `phs001238.v1.pht006048.v1.phv00277841.v1`, `phs001238.v1.pht006659.v1.phv00307949.v1`, `phs001238.v1.pht006661.v1.phv00308034.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        #AA dataset
        crp_aa <- left_join(phen_list$source_data$pht006048, phen_list$source_data$pht006046,
                            by = 'topmed_subject_id') %>%
                  rename(crp = CCRP,
                         age = AGE)
        #EA dataset
        crp_ea <- left_join(phen_list$source_data$pht006661, phen_list$source_data$pht006659,
                            by = 'topmed_subject_id') %>%
                  rename(crp = CCRP,
                         age = AGE)
        #Appending AA and EA datasets
        dataset <- bind_rows(crp_ea, crp_aa, .id = NULL)
      
        #Changing to numeric values
      
        dataset$crp[dataset$crp %in% 'NA'] <- NA
      
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Converting mg/dL to mg/L
        dataset$crp <- (dataset$crp * 10)
      
        dataset <- select(dataset, crp, age, topmed_subject_id)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-hchs_sol"></a>
  * ### inflammation/crp_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00258066.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht004715 %>%
          rename(age = AGE, crp = LABA91)
      
        # Substitute the value of 'NA' to missing.
        dataset$crp[dataset$crp %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-jhs"></a>
  * ### inflammation/crp_1 -- **JHS**:
    * 3 component_study_variables: `phs000286.v5.pht001945.v1.phv00125940.v1`, `phs000286.v5.pht001945.v1.phv00125941.v1`, `phs000286.v5.pht001949.v1.phv00126009.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- left_join(phen_list$source_data$pht001945, phen_list$source_data$pht001949,
                             by = 'topmed_subject_id') %>%
                   rename(crp_i = Hscrp_cresult,
                          crp = HSCRP,
                          age = AGE01)
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$crp[dataset$crp %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate(dataset, crp = as.numeric(crp), age = as.numeric(age))
      
        #Values below LOD being set to LLOD
        dataset$crp[dataset$crp_i == '<0.01'] <- 0.01
      
        #Setting crp values of 0 to LLOD
        dataset$crp[dataset$crp == 0] <- 0.01
      
        #Converting mg/dL to mg/L
      
        dataset$crp <- (dataset$crp * 10)
      
        #Selecting harmonized variables
        dataset <- select(dataset, topmed_subject_id, crp, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-mesa_airnr"></a>
  * ### inflammation/crp_1 -- **MESA_AirNR**:
    * 3 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082967.v1`, `phs000209.v13.pht001111.v4.phv00082968.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht001111 %>%
                   rename(crp = crp1,
                          crp_m = crp1m,
                          age = age1c)
      
        #Adding NAs and changing to numeric values
        dataset$crp[dataset$crp %in% 'NA'] <- NA
        dataset$crp_m[dataset$crp_m %in% 'NA'] <- NA
        dataset <- mutate(dataset, crp = as.numeric(crp),
                                   crp_m = as.numeric(crp_m),
                                   age = as.numeric(age))
      
        #Setting values below LOD to LLOD
        dataset$crp[dataset$crp_m == -333] <- 0.16
      
        dataset <- select(dataset, crp, age, topmed_subject_id)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="crp_1-mesa_classic_family"></a>
  * ### inflammation/crp_1 -- **MESA_Classic_Family**:
    * 4 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085015.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087661.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        main_crp <- phen_list$source_data$pht001116 %>%
                    rename(crp = crp1,
                           age = age1c)
        fam_crp <- phen_list$source_data$pht001121 %>%
                   rename(crp = crpf,
                   age = agefc)
      
        #Combining datasets
        dataset <- bind_rows(main_crp, fam_crp)
      
        #Adding NAs and changing to numeric values
        dataset$crp[dataset$crp %in% 'NA'] <- NA
        dataset <- mutate(dataset, crp = as.numeric(crp),
                                   age = as.numeric(age))
      
        #Setting values below LOD to LLOD
        dataset$crp[dataset$crp == 0.15] <- 0.16
      
        dataset <- select(dataset, crp, age, topmed_subject_id)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="eselectin_1"></a>
## inflammation: **eselectin_1** (eselectin)
  E-selectin concentration in blood.
  * **Harmonization Units**:
    * [MESA](#eselectin_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: ng / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:14:23
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C1316265
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure E-selectin concentration from serum or plasma differed by study and/or subcohort.
    
    #### MESA
    
    The *_MESA_* Family Cohort is not included in this harmonized phenotype at this time.
    
    #### Exam visit for E-selectin measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | MESA_Classic | Exam 1 Main |
    | MESA_AirNR | AirNR Exam Main | 
    
    #### Assay and limits of detection for E-selectin measurements
    
    | Study or subcohort | Assay | LLOD | ULOD^1^ | Differentiated^2^ |
    |---------|----------|---------|---------|---------|
    | MESA_Classic | ELISA |  0.1 ng/mL | NA  | No |
    | MESA_AirNR | ELISA | 0.47 ng/mL | 100 ng/mL | Yes |
    
    1. Values over the ULOD are valid and were obtained by dilution.
    2. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for E-selectin measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | MESA | Serum |
    
<a id="eselectin_1-mesa"></a>
  * ### inflammation/eselectin_1 -- **MESA**:
    * 5 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082969.v1`, `phs000209.v13.pht001111.v4.phv00082970.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085022.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables
        main <- phen_list$source_data$pht001116 %>%
                rename(eselectin = eselect1,
                       age = age1c)
        air <- phen_list$source_data$pht001111 %>%
               rename(eselectin = eselect1,
                age = age1c)
      
        dataset <- bind_rows(main, air)
      
        # Substitute the value of 'NA' to missing
        dataset$eselectin[dataset$eselectin %in% 'NA'] <- NA
      
        # Convert character values to numeric
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Select final variables
        dataset <- select(dataset, eselectin, age, topmed_subject_id)
      
        # Remove records with NAs from dataset
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="icam1_1"></a>
## inflammation: **icam1_1** (icam1)
  Intercellular adhesion molecule 1 (ICAM1) concentration in blood.
  * **Harmonization Units**:
    * [CARDIA](#icam1_1-cardia)
    * [CFS](#icam1_1-cfs)
    * [CHS](#icam1_1-chs)
    * [FHS_Gen3_Offspring](#icam1_1-fhs_gen3_offspring)
    * [FHS_NewOffspringSpouse_Omni1](#icam1_1-fhs_newoffspringspouse_omni1)
    * [MESA_AirNR](#icam1_1-mesa_airnr)
    * [MESA_Classic](#icam1_1-mesa_classic)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: ng / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:17:46
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C4084871
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure ICAM1 concentration from serum or plasma differed by study and/or subcohort.
    
    #### CFS
    
    The study identified values with low concentrations that had been extrapolated outside the assay range. These extrapolated values were set to the LLOD.
    
    #### FHS
    
    The *_FHS_* New Offspring Spouse and Omni 1 Cohorts included a variable on dbGaP (phv00172210) indicating which plate a sample was assayed on. Plate differences in ICAM1 concentration were observed in the Omni 1 Cohort after adjusting for age and sex. 
    
    The *_FHS_* Original and Omni 2 Cohorts are not included in this harmonized phenotype at this time.
    
    #### MESA
    
    The *_MESA_* Family Cohort is not included in this harmonized phenotype at this time.
    
    #### Exam visit for ICAM1 measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | CARDIA | Year 5/Exam 3 |
    | CFS | Visit 5 |
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | FHS_Offspring | Exam 7 |
    | FHS_NewOffspring Spouse | Exam 1|
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    | MESA_Classic | Exam 1 Main |
    | MESA_AirNR | AirNR Exam Main | 
    
    #### Assay and limits of detection for ICAM1 measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | CARDIA | ELISA | 0.031 ng/mL | NA | No |
    | CFS | Unknown | 1.13 ng/mL | 906 ng/mL | Yes |
    | CHS | ELISA | 0.35 ng/mL |  NA  | No |
    | FHS | ELISA  | < 0.35 ng/mL |  NA  | No |
    | MESA_Classic | ELISA | 0.35 ng/mL |  900 ng/mL | Yes |
    | MESA_AirNR | ELISA  |  20 ng/mL  | 1000 ng/mL | Yes |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for ICAM1 measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | FHS | Serum |
    | MESA | Plasma |
    
<a id="icam1_1-cardia"></a>
  * ### inflammation/icam1_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001697.v2.phv00116390.v2`, `phs000285.v3.pht001699.v2.phv00116396.v2`
    * Function:
      ```r
      harmonize <- function(phen_list) {
      
        library(dplyr)
      
        #working dataset
        dataset <- left_join(phen_list$source_data$pht001699,
                   phen_list$source_data$pht001697,
                   by = 'topmed_subject_id') %>%
                   rename(icam1 = sICAM1, age = EX3_AGE)
      
        #Converting to numeric variables
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$icam1[dataset$icam1 %in% 'NA'] <- NA
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Removing missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="icam1_1-cfs"></a>
  * ### inflammation/icam1_1 -- **CFS**:
    * 5 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00124095.v1`, `phs000284.v1.pht001902.v1.phv00124097.v1`, `phs000284.v1.pht001902.v1.phv00124098.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        #Dataset
        dataset <- phen_list$source_data$pht001902
      
        #Selecting subjects with visit 5 data
        dataset <- subset(dataset, visit == 5)
      
        #Converting values to numeric
        dataset$icam[dataset$icam %in% 'NA'] <- NA
        dataset$icam_flag[dataset$icam_flag %in% 'NA'] <- NA
      
        dataset <- mutate(dataset,
                         icam1 = as.numeric(icam),
                         icam_flag = as.numeric(icam_flag),
                         age = as.numeric(age))
      
        #Setting extrapolated values to the LLOD
        dataset$icam1[dataset$icam_flag == 1 & dataset$icam_comment == 'L'] <- 1.13
      
        #Selecting final varaibles and removing missing
        dataset <- select(dataset, topmed_subject_id, icam1, age)
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="icam1_1-chs"></a>
  * ### inflammation/icam1_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001449.v1.phv00098764.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht001449,
                             phen_list$source_data$pht001452,
                             by = 'topmed_subject_id') %>%
                   rename(icam1 = ICAM1, age = AGEBL)
      
        #Converting to numeric values
        dataset$icam1[dataset$icam1 %in% 'NA'] <- NA
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Removing missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="icam1_1-fhs_gen3_offspring"></a>
  * ### inflammation/icam1_1 -- **FHS_Gen3_Offspring**:
    * 4 component_study_variables: `phs000007.v29.pht000093.v6.phv00021939.v5`, `phs000007.v29.pht000303.v5.phv00036405.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Dataset
        icam_of <- left_join(phen_list$source_data$pht000093,
                             phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   select(topmed_subject_id, icam, age7) %>%
                   rename(age = age7, icam1 = icam)
        icam_g3 <- left_join(phen_list$source_data$pht000303,
                             phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   select(topmed_subject_id, G3ICAM, age1) %>%
                   rename(icam1 = G3ICAM, age = age1)
        dataset <- bind_rows(icam_of, icam_g3)
      
        #Convert to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="icam1_1-fhs_newoffspringspouse_omni1"></a>
  * ### inflammation/icam1_1 -- **FHS_NewOffspringSpouse_Omni1**:
    * 4 component_study_variables: `phs000007.v29.pht002890.v4.phv00172215.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Dataset
        dataset <- left_join(phen_list$source_data$pht002890,
                   phen_list$source_data$pht003099,
                   by = 'topmed_subject_id')
      
        #Selection correct age for visit
        dataset <- subset(dataset, idtype == 2 | idtype == 7)
        dataset$age <- ifelse(dataset$idtype == 2, dataset$age1, dataset$age3)
      
        #Selecting variables
        dataset <- select(dataset, topmed_subject_id, icam, age) %>%
                   rename(icam1 = icam)
      
        #Changing to numeric values
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="icam1_1-mesa_airnr"></a>
  * ### inflammation/icam1_1 -- **MESA_AirNR**:
    * 3 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082963.v1`, `phs000209.v13.pht001111.v4.phv00082964.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        #Dataset
        dataset <- phen_list$source_data$pht001111 %>%
                   rename(icam_m = icam1m, age = age1c)
      
        #Convert variables to numeric values
        dataset$icam1[dataset$icam1 %in% 'NA'] <- NA
        dataset$icam_m[dataset$icam_m %in% 'NA'] <- NA
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Limit of detection values
        dataset$icam1[dataset$icam_m == -333] <- 20.0
      
        #Select harmonizaed variables
        dataset <- select(dataset, topmed_subject_id, icam1, age)
      
        #Remove missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="icam1_1-mesa_classic"></a>
  * ### inflammation/icam1_1 -- **MESA_Classic**:
    * 3 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085117.v2`, `phs000209.v13.pht001116.v10.phv00085118.v2`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        #Dataset
        dataset <- phen_list$source_data$pht001116 %>%
                   rename(icam_m = icam11M, age = age1c)
      
        #Convert variables to numeric values
        dataset$icam1[dataset$icam1 %in% 'NA'] <- NA
        dataset$icam_m[dataset$icam_m %in% 'NA'] <- NA
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Limit of detection values
        dataset$icam1[dataset$icam_m == -333] <- 0.35
        dataset$icam1[dataset$icam_m == -555] <- 900
      
        #Select harmonizaed variables
        dataset <- select(dataset, topmed_subject_id, icam1, age)
      
        #Remove missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il10_1"></a>
## inflammation: **il10_1** (il10)
  Interleukin 10 (IL10) concentration in blood.
  * **Harmonization Units**:
    * [CFS](#il10_1-cfs)
    * [MESA](#il10_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:30:51
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0945416
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure IL10 concentration from serum or plasma differed by study and/or subcohort.
    
    #### CFS
     
    The study identified values with low concentrations that had been extrapolated outside the assay range. These extrapolated values were set to the LLOD.
    
    #### MESA
    
    The *_MESA_* Family and AirNR Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for IL10 measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | CFS | Visit 5 |
    | MESA_Classic | Exam 1 Main |
    
    #### Assay and limits of detection for IL10 measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | CFS | Human Cytokine/Chemokine | 0.1 pg/mL | NA  | Yes |
    | | LINCOplex Kit | | | |
    | MESA_Classic | Millipore CVD Panel 3 | < 0.13 pg/mL | > 10000 pg/mL | Yes |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
<a id="il10_1-cfs"></a>
  * ### inflammation/il10_1 -- **CFS**:
    * 4 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00124072.v1`, `phs000284.v1.pht001902.v1.phv00124075.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht001902
      
        #Subsetting data to visit 5
        dataset <- subset(dataset, visit == 5)
      
        #Converting age and il10 to numeric values
        dataset$il10[dataset$il10 %in% 'NA'] <- NA
        dataset <- mutate(dataset, il10 = as.numeric(il10), age = as.numeric(age))
      
        #Converting extrapolated values to LLOD
        dataset$il10[dataset$il10_comment %in% 'extrapolated'] <- 0.10
      
        #Selecting variables and removing missing
        dataset <- select(dataset, topmed_subject_id, il10, age)
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il10_1-mesa"></a>
  * ### inflammation/il10_1 -- **MESA**:
    * 3 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht002099.v2.phv00142666.v2`, `phs000209.v13.pht002099.v2.phv00142667.v2`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        #Dataset
        dataset <- left_join(phen_list$source_data$pht002099,
                             phen_list$source_data$pht001116,
                             by = 'topmed_subject_id') %>%
                   rename(il10 = il10a1, age = age1c, il10_m = il10a1m)
      
        #Converting to numeric varaibles
        dataset$il10[dataset$il10 %in% 'NA'] <- NA
        dataset$il10_m[dataset$il10_m %in% 'NA'] <- NA
      
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Samples outside of LOD to LLOD or ULOD
        dataset$il10[dataset$il10_m == -333] <- 0.13
        dataset$il10[dataset$il10_m == -555] <- 10000
      
        #Selecting varaibles
        dataset <- select(dataset, topmed_subject_id, il10, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il18_1"></a>
## inflammation: **il18_1** (il18)
  Interleukin 18 (IL18) concentration in blood.
  * **Harmonization Units**:
    * [FHS](#il18_1-fhs)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:32:49
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C1316287
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure IL18 concentration from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* Original, New Offspring Spouse, Generation 3, Omni 1, and Omni 2 Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for IL18 measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | FHS_Offspring | Exam 7 |
    
    #### Assay and limits of detection for IL18 measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | FHS_Offspring | ELISA | 128.0 pg/mL | 5000.0 pg/mL | No |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for IL18 measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | FHS | Serum |
    
<a id="il18_1-fhs"></a>
  * ### inflammation/il18_1 -- **FHS**:
    * 2 component_study_variables: `phs000007.v29.pht000671.v5.phv00066686.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht000671,
                             phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
        rename(age = age7)
      
        #Converting to numeric values
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il1_beta_1"></a>
## inflammation: **il1_beta_1** (il1_beta)
  Interleukin 1 beta (IL1b) concentration in blood.
  * **Harmonization Units**:
    * [CFS](#il1_beta_1-cfs)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:24:49
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0796820
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure IL1b concentration from serum or plasma differed by study and/or subcohort.
    
    #### CFS
    
    The study identified values with low concentrations that had been extrapolated outside the assay range. These extrapolated values were set to the LLOD.
    
    #### Exam visit for IL1b measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | CFS | Visit 5 |
    
    #### Assay and limits of detection for IL1b measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | CFS | Human Cytokine/Chemokine LINCOplex Kit | 0.06 pg/mL |  NA  | Yes |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
<a id="il1_beta_1-cfs"></a>
  * ### inflammation/il1_beta_1 -- **CFS**:
    * 4 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00124068.v1`, `phs000284.v1.pht001902.v1.phv00124071.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht001902
      
        #Subsetting to visit 5
        dataset <- subset(dataset, visit == 5)
      
        #Converting to numeric values
        dataset$il1b[dataset$il1b %in% 'NA'] <- NA
        dataset <- mutate(dataset, age = as.numeric(age), il1b = as.numeric(il1b))
      
        #Replacing extrapolated values with LLOD
        dataset$il1b[dataset$il1b_comment %in% 'extrapolated'] <- 0.06
      
        #Selection variables and removing missing
        dataset <- select(dataset, topmed_subject_id, il1b, age) %>%
                   rename(il1_beta = il1b)
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il6_1"></a>
## inflammation: **il6_1** (il6)
  Interleukin 6 (IL6) concentration in blood.
  * **Harmonization Units**:
    * [CARDIA](#il6_1-cardia)
    * [CFS](#il6_1-cfs)
    * [CHS](#il6_1-chs)
    * [FHS_Gen3](#il6_1-fhs_gen3)
    * [FHS_NewOffspringSpouse_Omni1](#il6_1-fhs_newoffspringspouse_omni1)
    * [FHS_Offspring](#il6_1-fhs_offspring)
    * [MESA](#il6_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:27:59
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0942776
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure IL6 concentration from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* New Offspring Spouse and Omni 1 Cohorts included a variable on dbGaP (phv00172218) indicating which plate a sample was assayed on. Plate differences in IL6 concentrations were not observed after adjusting for age and sex. 
    
    The *_FHS_* Original and Omni 2 Cohorts are not included in this harmonized phenotype at this time.
    
    #### MESA
    
    The *_MESA_* AirNR and Family Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for IL6 measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | CARDIA | Year 15/Exam 6 |
    | CFS | Visit 5 |
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | FHS_Offspring | Exam 7 |
    | FHS_NewOffspring Spouse | Exam 1 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    | MESA_Classic | Exam 1 Main |
    
    #### Assay and limits of detection for IL6 measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | CARIDA | ELISA | 0.10 pg/mL | 12 pg/mL | Yes |
    | CFS | ELISA | 0.08 pg/mL | 15 pg/mL | Yes |
    | CHS | ELISA  | < 0.7 pg/mL | 300 pg/mL | No |
    | FHS_Offspring | ELISA | < 0.7 pg/mL | 300 pg/mL | No |
    | FHS_Gen3 | ELISA | 0.039 pg/mL | NA  | No |
    | FHS_NewOffspringSpouse | ELISA |  0.15 pg/mL | NA  | No |
    | FHS_Omni1 | ELISA | 0.15 pg/mL | NA  | No |
    | MESA_Classic | ELISA  | 0.09 pg/mL | 13.0 pg/mL | Yes |
    
    1.  The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for IL6 measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | CHS | Serum |
    | FHS | Serum |
    
<a id="il6_1-cardia"></a>
  * ### inflammation/il6_1 -- **CARDIA**:
    * 3 component_study_variables: `phs000285.v3.pht001851.v2.phv00120748.v2`, `phs000285.v3.pht001862.v2.phv00121064.v2`, `phs000285.v3.pht001862.v2.phv00121065.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- inner_join(phen_list$source_data$pht001862,
                              phen_list$source_data$pht001851,
                              by = "topmed_subject_id") %>%
                   rename(age = EX6_AGE, il6 = FL6IL6)
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$il6[dataset$il6 %in% 'NA'] <- NA
      
        # Set IL6 values above the upper limit of detection to the upper limit of detection.
        dataset$il6[dataset$FL6IL6CM == 'High > 12'] <- 12
      
        # Select the output variables.
        dataset <- select(dataset, topmed_subject_id, il6, age)
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il6_1-cfs"></a>
  * ### inflammation/il6_1 -- **CFS**:
    * 3 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00124021.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht001902 %>%
                   rename(il6 = il6am)
      
        # Filter for Visit 5 only.
        dataset <- filter(dataset, visit == '5')
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$il6[dataset$il6 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Select the output variables and remove records with NAs from dataset.
        dataset <- select(dataset, topmed_subject_id, il6, age) %>%
                   na.omit()
      
        return(dataset)
      }
      ```
<a id="il6_1-chs"></a>
  * ### inflammation/il6_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001452.v1.phv00100500.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht001452 %>%
                   rename(age = AGEBL, il6 = IL6BL)
      
        # Substitute the value of 'NA' to missing.
        dataset$il6[dataset$il6 %in% 'NA'] <- NA
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il6_1-fhs_gen3"></a>
  * ### inflammation/il6_1 -- **FHS_Gen3**:
    * 4 component_study_variables: `phs000007.v29.pht001043.v4.phv00080999.v3`, `phs000007.v29.pht001043.v4.phv00081000.v3`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- left_join(phen_list$source_data$pht001043, phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   rename(age = age1)
      
        #Converting to numeric values
        dataset <- mutate(dataset, il6 = as.numeric(il6), age = as.numeric(age))
      
        dataset <- subset(dataset, flag == 1 | flag == 2)
      
        # Select final variables
        dataset <- select(dataset, il6, age, topmed_subject_id)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il6_1-fhs_newoffspringspouse_omni1"></a>
  * ### inflammation/il6_1 -- **FHS_NewOffspringSpouse_Omni1**:
    * 4 component_study_variables: `phs000007.v29.pht002891.v4.phv00172223.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- left_join(phen_list$source_data$pht002891, phen_list$source_data$pht003099,
                             by = 'topmed_subject_id')
      
        dataset <- subset(dataset, idtype == "2" | idtype == "7")
      
        #Selecting correct age for visit
        dataset$age <- ifelse(dataset$idtype == "2", dataset$age1, dataset$age3)
      
        #Convert to numeric values
        dataset <- mutate(dataset, il6 = as.numeric(il6), age = as.numeric(age))
      
        #Select final variables
        dataset <- select(dataset, il6, age, topmed_subject_id)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il6_1-fhs_offspring"></a>
  * ### inflammation/il6_1 -- **FHS_Offspring**:
    * 3 component_study_variables: `phs000007.v29.pht000161.v6.phv00023796.v5`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- left_join(phen_list$source_data$pht000161, phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   rename(age = age7)
      
        #Converting to numeric values
        dataset <- mutate(dataset, il6 = as.numeric(il6),
                          age = as.numeric(age))
      
        # Select final variables
        dataset <- select(dataset, il6, age, topmed_subject_id)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="il6_1-mesa"></a>
  * ### inflammation/il6_1 -- **MESA**:
    * 3 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085009.v2`, `phs000209.v13.pht001116.v10.phv00085010.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables
        dataset <- phen_list$source_data$pht001116 %>%
                   rename(il6 = il61,
                          il6_m = il61M,
                          age = age1c)
      
      
        # Substitute the value of 'NA' to missing
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$il6[dataset$il6 %in% 'NA'] <- NA
        dataset$il6_m[dataset$il6_m %in% 'NA'] <- NA
      
        # Convert character values to numeric
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Assinging values to subjects outside of LOD
        dataset$il6[dataset$il6_m == -333] <- 0.09
        dataset$il6[dataset$il6_m == -555] <- 13.0
      
        # Select final variables
        dataset <- select(dataset, il6, age, topmed_subject_id)
      
        # Remove records with NAs from dataset
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="isoprostane_8_epi_pgf2a_1"></a>
## inflammation: **isoprostane_8_epi_pgf2a_1** (isoprostane_8_epi_pgf2a)
  Isoprostane 8-epi-prostaglandin F2 alpha (8-epi-PGF2a) concentration in urine.
  * **Harmonization Units**:
    * [FHS](#isoprostane_8_epi_pgf2a_1-fhs)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:35:36
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C2700042
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure 8-epi-PGF2a concentration differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* Offspring Cohort included a variable on dbGaP (phv00023802) indicating which lot the ELISA test was from. Lot differences in 8-epi-PGF2a concentrations were observed after adjusting for age and sex. 
    
    The *_FHS_* Original and New Offspring Spouse Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for 8-epi-PGF2a measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | FHS_Offspring | Exam 7 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    | FHS_Omni2 | Exam 1 |
    
    #### Assay and limits of detection for 8-epi-PGF2a measurements
    
    | Study or subcohort | Assay | LLOD | ULOD^1^ | Differentiated^2^ |
    |---------|----------|---------|---------|---------|
    | FHS _Offspring | ELISA | 3.0 pg/mL | 500 pg/mL  | No |
    | FHS_Gen3 | ELISA | 0.8 pg/mL | 500 pg/mL | No |
    | FHS_Omni1 | ELISA | 2.7 pg/mL | 500 pg/mL  | No |
    | FHS_Omni2 | ELISA | 0.8 pg/mL | 500 pg/mL | No |
    
    1. Values over the ULOD are valid and were obtained by dilution.
    2. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for 8-epi-PGF2a measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | FHS | Urine |
    
<a id="isoprostane_8_epi_pgf2a_1-fhs"></a>
  * ### inflammation/isoprostane_8_epi_pgf2a_1 -- **FHS**:
    * 7 component_study_variables: `phs000007.v29.pht000162.v6.phv00023800.v5`, `phs000007.v29.pht002852.v2.phv00171864.v2`, `phs000007.v29.pht002853.v4.phv00171873.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        ##Offspring (exam 7)
        iso_of <- left_join(phen_list$source_data$pht000162,
                            phen_list$source_data$pht003099,
                            by = 'topmed_subject_id') %>%
                  select(topmed_subject_id, isoprostane_8_epi_pgf2a = iso, age = age7)
      
        ##Generation 3 / OMNI 2 (exam 1)
        iso_g3o2 <- left_join(phen_list$source_data$pht002852,
                              phen_list$source_data$pht003099,
                              by = 'topmed_subject_id') %>%
                    select(topmed_subject_id, isoprostane_8_epi_pgf2a = conc1, age = age1)
      
        ##Omni 1 - removing Offspring (exam 8)
        iso_o1 <- left_join(phen_list$source_data$pht002853,
                            phen_list$source_data$pht003099,
                            by = 'topmed_subject_id') %>%
                  subset(idtype == 7) %>%
                  select(topmed_subject_id, isoprostane_8_epi_pgf2a = res1, age = age3)
      
        ##Combining datasets
        dataset <- bind_rows(iso_of, iso_g3o2)
        dataset <- bind_rows(dataset, iso_o1)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="lppla2_act_1"></a>
## inflammation: **lppla2_act_1** (lppla2_act)
  Activity of lipoprotein-associated phospholipase A2 (LP-PLA2), also known as platelet-activating factor acetylhydrolase, measured in blood.
  * **Harmonization Units**:
    * [CHS](#lppla2_act_1-chs)
    * [FHS](#lppla2_act_1-fhs)
    * [MESA](#lppla2_act_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: nmol / min / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:38:09
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C4531983
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounted for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure LP-PLA2 activity from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* Omni 1 Cohort included a variable on dbGaP (phv00172228) indicating which plate a sample was assayed on. No plate differences in LP-PLA2 activity were observed after adjusting for age and sex.
    
    The *_FHS_* Original, New Offspring Spouse, and Omni 2 Cohorts are not included in this harmonized phenotype at this time.
    
    #### MESA
    
    The *_MESA_* Family and AirNR Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for LP-PLA2 activity measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | FHS_Offspring | Exam 7 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    | MESA_Classic | Exam 1 Main |
    
    #### Assay and limits of detection for LP-PLA2 activity measurements
    
    | Study or subcohort | Assay | LLOD | ULOD^1^ | Differentiated^2^ |
    |---------|----------|---------|---------|---------|
    | CHS | Tritiated PAF activity assay | NA | NA | No |
    | FHS | ELISA | 2.0 nmol/min/mL | 300.0 nmol/min/mL | No |
    | MESA | High-throughput radiometric assay | NA | NA | No |
    
    1. Values over the ULOD are valid and were obtained by dilution.
    2. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for LP-PLA2 activity measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | CHS | Plasma |
    | FHS | Plasma |
    | MESA | Serum |
    
<a id="lppla2_act_1-chs"></a>
  * ### inflammation/lppla2_act_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001449.v1.phv00098770.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht001449,
                             phen_list$source_data$pht001452,
                             by = 'topmed_subject_id') %>%
                   rename(lppla2_act = LPPLA2AC, age = AGEBL)
      
        #Converting to numeric variables
        dataset <- replace(dataset, dataset == 'NA', NA)
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Removing missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="lppla2_act_1-fhs"></a>
  * ### inflammation/lppla2_act_1 -- **FHS**:
    * 7 component_study_variables: `phs000007.v29.pht000164.v6.phv00023808.v5`, `phs000007.v29.pht000304.v5.phv00036408.v4`, `phs000007.v29.pht002892.v4.phv00172229.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        #Offspring exam 7
        offspring <- left_join(phen_list$source_data$pht000164,
                              phen_list$source_data$pht003099,
                              by = 'topmed_subject_id') %>%
                     select(topmed_subject_id, lppla2_act = Activity, age = age7)
      
        #Generation 3 exam 1
        gen3 <- left_join(phen_list$source_data$pht000304,
                               phen_list$source_data$pht003099,
                               by = 'topmed_subject_id') %>%
                select(topmed_subject_id, lppla2_act = Activity, age = age1)
      
        #Omni 1 exam 3
        omni1 <- left_join(phen_list$source_data$pht002892,
                           phen_list$source_data$pht003099,
                           by = 'topmed_subject_id') %>%
                 subset(idtype == 7) %>%
                 select(topmed_subject_id, lppla2_act = cam, age = age3)
      
        #Combined FHS data
        dataset <- bind_rows(offspring, gen3) %>%
                   bind_rows(omni1)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="lppla2_act_1-mesa"></a>
  * ### inflammation/lppla2_act_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht002512.v1.phv00165052.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht002512,
                             phen_list$source_data$pht001116,
                             by = 'topmed_subject_id') %>%
                     rename(lppla2_act = cam1a,
                            age = age1c)
      
        #Converting to numeric variables
        dataset <- replace(dataset, dataset == 'NA', NA)
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Removing numeric values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="lppla2_mass_1"></a>
## inflammation: **lppla2_mass_1** (lppla2_mass)
  Mass of lipoprotein-associated phospholipase A2 (LP-PLA2), also known as platelet-activating factor acetylhydrolase, measured in blood.
  * **Harmonization Units**:
    * [CHS](#lppla2_mass_1-chs)
    * [FHS](#lppla2_mass_1-fhs)
    * [MESA](#lppla2_mass_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: ng / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:40:39
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C1543846
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure LP-PLA2 mass from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* Omni 1 Cohort included a variable on dbGaP (phv00172226) indicating which plate a sample was assayed on. Plate differences in LP-PLA2 mass were observed after adjusting for age and sex. 
    
    The *_FHS_* Original, New Offspring Spouse, and Omni 2 Cohorts are not included in this harmonized phenotype at this time.
    
    #### MESA
    
    A variable (phv00165048) indicating which plate a sample was assayed on is available on dbGaP. Plate differences in LP-PLA2 concentrations were observed after adjusting for age and sex. 
    
    The *_MESA_* Family and AirNR Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for LP-PLA2 mass measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | CHS_Original | Baseline visit |
    | CHS_AfricanAmerican | Baseline visit |
    | FHS_Offspring | Exam 7 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    | MESA_Classic | Exam 1 Main |
    
    #### Assay and limits of detection for LP-PLA2 mass measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | CHS | ELISA | 1.3 ng/mL |  NA  | No |
    | FHS| ELISA | 1.3 ng/mL |  NA  | No |
    | MESA | ELISA | 0.34 ng/mL | NA | No |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for LP-PLA2 mass measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | CHS | Plasma |
    | FHS | Plasma |
    | MESA | Serum |
    
<a id="lppla2_mass_1-chs"></a>
  * ### inflammation/lppla2_mass_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001449.v1.phv00098769.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht001449,
                             phen_list$source_data$pht001452,
                             by = 'topmed_subject_id') %>%
                   rename(lppla2_mass = LPPLA2, age = AGEBL)
      
        #Converting to numeric varaibles
        dataset <- replace(dataset, dataset == 'NA', NA) %>%
                   mutate_if(is.character, as.numeric)
      
        #Removing missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="lppla2_mass_1-fhs"></a>
  * ### inflammation/lppla2_mass_1 -- **FHS**:
    * 7 component_study_variables: `phs000007.v29.pht000095.v6.phv00021963.v5`, `phs000007.v29.pht000305.v5.phv00036411.v4`, `phs000007.v29.pht002892.v4.phv00172227.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        #Offspring, exam 7
        lppla_of <- left_join(phen_list$source_data$pht000095,
                              phen_list$source_data$pht003099,
                              by = 'topmed_subject_id') %>%
                    select(topmed_subject_id, lppla2_mass = MASS, age = age7)
      
        #Generation 3, exam 1
        lppla_g3 <- left_join(phen_list$source_data$pht000305,
                              phen_list$source_data$pht003099,
                              by = 'topmed_subject_id') %>%
                    select(topmed_subject_id, lppla2_mass = mass, age = age1)
      
        #OMNI1, exam 3
        lppla_o1 <- left_join(phen_list$source_data$pht002892,
                              phen_list$source_data$pht003099,
                              by = 'topmed_subject_id') %>%
                    subset(idtype == 7) %>%
                    select(topmed_subject_id, lppla2_mass = plac, age = age3)
      
        #Combining subcohorts
        dataset <- bind_rows(lppla_of, lppla_g3) %>%
                   bind_rows(lppla_o1)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="lppla2_mass_1-mesa"></a>
  * ### inflammation/lppla2_mass_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht002512.v1.phv00165050.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht002512,
                            phen_list$source_data$pht001116,
                            by = 'topmed_subject_id') %>%
                    rename(lppla2_mass = plac1a, age = age1c)
      
        #Converting to numeric
        dataset <- replace(dataset, dataset == 'NA', NA)
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Removing missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="mcp1_1"></a>
## inflammation: **mcp1_1** (mcp1)
  Monocyte chemoattractant protein-1 (MCP1), also known as C-C motif chemokine ligand 2, concentration in blood.
  * **Harmonization Units**:
    * [FHS_Gen3_Offspring](#mcp1_1-fhs_gen3_offspring)
    * [FHS_NewOffspringSpouse_Omni1](#mcp1_1-fhs_newoffspringspouse_omni1)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:43:07
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C0128897
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure MCP1 concentration from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* New Offspring Spouse and Omni 1 Cohorts included a variable on dbGaP (phv00172235) indicating which plate a sample was assayed on. Plate differences in MCP1 concentrations were observed after adjusting for age and sex.  
    
    The *_FHS_* Original and Omni 2 Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for MCP1 measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | FHS_Offspring | Exam 7 |
    | FHS_NewOffspringSpouse | Exam 1 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    
    #### Assay and limits of detection for MCP1 measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | FHS | ELISA | < 5.0 pg/mL |  NA  | No |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for MCP1 measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | FHS | Serum |
    
<a id="mcp1_1-fhs_gen3_offspring"></a>
  * ### inflammation/mcp1_1 -- **FHS_Gen3_Offspring**:
    * 4 component_study_variables: `phs000007.v29.pht000165.v6.phv00023811.v5`, `phs000007.v29.pht000306.v6.phv00036415.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        ##Offspring, exam 7
        mcp_of <- left_join(phen_list$source_data$pht000165,
                            phen_list$source_data$pht003099,
                            by = 'topmed_subject_id') %>%
                  select(topmed_subject_id, mcp1, age = age7)
        ##Generation 3, exam 1
        mcp_g3 <- left_join(phen_list$source_data$pht000306,
                            phen_list$source_data$pht003099,
                            by = 'topmed_subject_id') %>%
                  select(topmed_subject_id, mcp1, age = age1)
        ##Combined
        dataset <- bind_rows(mcp_of, mcp_g3)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="mcp1_1-fhs_newoffspringspouse_omni1"></a>
  * ### inflammation/mcp1_1 -- **FHS_NewOffspringSpouse_Omni1**:
    * 4 component_study_variables: `phs000007.v29.pht002893.v4.phv00172239.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht002893,
                             phen_list$source_data$pht003099,
                             by = 'topmed_subject_id')
      
        #Removing Offspring subcohort
        dataset <- subset(dataset, idtype == 2 | idtype == 7)
      
        #Assigning correct age for visit
        dataset$age <- ifelse(dataset$idtype == 2, dataset$age1, dataset$age3)
      
        #Select age and MCP1
        dataset <- select(dataset, topmed_subject_id, mcp1, age)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="mmp9_1"></a>
## inflammation: **mmp9_1** (mmp9)
  Matrix metalloproteinase 9 (MMP9) concentration in blood.
  * **Harmonization Units**:
    * [MESA](#mmp9_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: ng / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:45:19
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C2698028
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure MMP9 concentration from serum or plasma differed by study and/or subcohort.
    
    #### MESA 
    
    The *_MESA_* Family and AirNR Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for MMP9 measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | MESA_Classic | Exam 1 Main |
    
    #### Assay and limits of detection for MMP9 measurements
    
    | Study or subcohort | Assay | LLOD | ULOD^1^ | Differentiated^2^ |
    |---------|----------|---------|---------|---------|
    | MESA_Classic | ELISA | 12 ng/mL  | 800 ng/mL | No |
    
    1. Values over the ULOD are valid and were obtained by dilution.
    2. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
<a id="mmp9_1-mesa"></a>
  * ### inflammation/mmp9_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085027.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        dataset <- phen_list$source_data$pht001116 %>%
                   rename(mmp9 = mmp91, age = age1c)
      
        # Converting to numeric values
        dataset$mmp9[dataset$mmp9 %in% 'NA'] <- NA
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Removing subjects with missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="mpo_1"></a>
## inflammation: **mpo_1** (mpo)
  Myeloperoxidase (MPO) concentration in blood.
  * **Harmonization Units**:
    * [FHS](#mpo_1-fhs)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: ng / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:47:50
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C2698399
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure MPO concentration from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* Offspring Cohort included a variable on dbGaP (phv00023853) indicating which lot an assay material was associated with was used for the assay. Lot differences in MPO concentrations were observed after adjusting for age and sex. 
    
    The *_FHS_* Original, New Offspring Spouse, Generation 3, Omni 1, and Omni 2 Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for MPO measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | FHS_Offspring | Exam 7 |
    
    #### Assay and limits of detection for MPO measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | FHS_Offspring | ELISA | 0.17 ng/mL | NA | No |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for MPO measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | FHS | Serum |
    
<a id="mpo_1-fhs"></a>
  * ### inflammation/mpo_1 -- **FHS**:
    * 2 component_study_variables: `phs000007.v29.pht000167.v6.phv00023854.v5`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht000167,
                             phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   rename(mpo = MPO, age = age7)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="opg_1"></a>
## inflammation: **opg_1** (opg)
  Osteoprotegerin (OPG) concentration in blood.
  * **Harmonization Units**:
    * [FHS_Gen3_Omni2](#opg_1-fhs_gen3_omni2)
    * [FHS_Offspring_Omni1](#opg_1-fhs_offspring_omni1)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pmol / L, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:50:07
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C1262886
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure OPG concentration from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    All *_FHS_* cohorts included a variable on dbGaP (phv00172359 Offspring and Omni 1, phv00156659 Generation 3 and Omni 2) indicating which plate a sample was assayed on. Plate differences in OPG concentrations were observed for all cohorts after adjusting for age and sex. Additionally, a lot variable (phv00156669) is available for the Generation 3 and Omni 2 cohorts. 
    
    The *_FHS_* Original and New Offspring Spouse Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for OPG measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | FHS_Offspring | Exam 8 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    | FHS_Omni2 | Exam 1 |
    
    #### Assay and limits of detection for OPG measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | FHS_Offspring | ELISA | 0.14 pmol/L | NA | No |
    | FHS_Gen3 | ELISA | 0.14 pmol/L | NA | Yes |
    | FHS_Omni1 | ELISA | 0.14 pmol/L | NA | No |
    | FHS_Omni2 | ELISA | 0.14 pmol/L | NA | Yes |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for OPG measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | FHS_Offspring | Serum |
    | FHS_Gen3 | Plasma |
    | FHS_Omni1 | Serum |
    | FHS_Omni2 | Plasma |
    
<a id="opg_1-fhs_gen3_omni2"></a>
  * ### inflammation/opg_1 -- **FHS_Gen3_Omni2**:
    * 3 component_study_variables: `phs000007.v29.pht002144.v3.phv00156665.v3`, `phs000007.v29.pht002144.v3.phv00156666.v3`, `phs000007.v29.pht003099.v4.phv00177930.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht002144,
                             phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   rename(age = age1)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Removing phantom samples
        dataset <- subset(dataset, flag == 1 | flag == 2)
      
        #Setting values below LOD to LLOD
        dataset$opg[dataset$opg == 0.13] <- 0.14
      
        #Selecting variables
        dataset <- select(dataset, topmed_subject_id, opg, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="opg_1-fhs_offspring_omni1"></a>
  * ### inflammation/opg_1 -- **FHS_Offspring_Omni1**:
    * 4 component_study_variables: `phs000007.v29.pht002896.v4.phv00172364.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`, `phs000007.v29.pht003099.v4.phv00177944.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- left_join(phen_list$source_data$pht002896,
                             phen_list$source_data$pht003099,
                             by = 'topmed_subject_id')
      
        #Selecting correct age
        dataset$age <- ifelse(dataset$idtype == 1, dataset$age8, dataset$age3)
      
        #Selecting variables
        dataset <- select(dataset, topmed_subject_id, opg, age)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="pselectin_1"></a>
## inflammation: **pselectin_1** (pselectin)
  P-selectin concentration in blood.
  * **Harmonization Units**:
    * [FHS_Gen3_Omni2](#pselectin_1-fhs_gen3_omni2)
    * [FHS_Offspring](#pselectin_1-fhs_offspring)
    * [FHS_Omni1](#pselectin_1-fhs_omni1)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: ng / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:52:08
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C3890352
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure P-selectin concentration from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* Omni 1 Cohort included a variable on dbGaP (phv00172367) indicating which plate a sample was assayed on. Plate differences in P-selectin concentrations were observed after adjusting for age and sex. 
    
    The *_FHS_* Original and New Offspring Spouse Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for P-selectin measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | FHS_Offspring | Exam 7 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    | FHS_Omni2 | Exam 1 |
    
    #### Assay and limits of detection for P-selectin measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | FHS_Offspring | ELISA | 0.5 ng/mL | NA | No |
    | FHS_Gen3 | ELISA | 0.5 ng/mL | NA  | Yes |
    | FHS_Omni1 | ELISA | 0.5 ng/mL | NA  | Yes |
    | FHS_Omni2 | ELISA | 0.5 ng/mL | NA  | Yes |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    
    #### Specimen type for P-selectin measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | FHS | Plasma |
    
<a id="pselectin_1-fhs_gen3_omni2"></a>
  * ### inflammation/pselectin_1 -- **FHS_Gen3_Omni2**:
    * 3 component_study_variables: `phs000007.v29.pht002145.v3.phv00156677.v3`, `phs000007.v29.pht002145.v3.phv00156678.v3`, `phs000007.v29.pht003099.v4.phv00177930.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        dataset <- left_join(phen_list$source_data$pht002145,
                                  phen_list$source_data$pht003099,
                                  by = 'topmed_subject_id') %>%
                        rename(age = age1)
      
        #Removing phantom samples (flag = 3)
        dataset <- subset(dataset, flag == 1 | flag == 2)
      
        #Converting to numeric values
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Selecting final variables
        dataset <- select(dataset, topmed_subject_id, pselectin, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="pselectin_1-fhs_offspring"></a>
  * ### inflammation/pselectin_1 -- **FHS_Offspring**:
    * 2 component_study_variables: `phs000007.v29.pht000171.v6.phv00023892.v5`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #dataset
        dataset <- left_join(phen_list$source_data$pht000171, phen_list$source_data$pht003099) %>%
                   rename(pselectin = psel, age = age7)
      
        #Changing to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="pselectin_1-fhs_omni1"></a>
  * ### inflammation/pselectin_1 -- **FHS_Omni1**:
    * 3 component_study_variables: `phs000007.v29.pht002897.v4.phv00172372.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        dataset <- left_join(phen_list$source_data$pht002897,
                               phen_list$source_data$pht003099,
                               by = 'topmed_subject_id') %>%
                      rename(age = age3) %>%
                      subset(idtype == 7)
      
        #Converting to numeric values
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Selecting final variables
        dataset <- select(dataset, topmed_subject_id, pselectin, age)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="tnfa_1"></a>
## inflammation: **tnfa_1** (tnfa)
  Tumor necrosis factor alpha (TNFa) concentration in blood.
  * **Harmonization Units**:
    * [CFS](#tnfa_1-cfs)
    * [FHS](#tnfa_1-fhs)
    * [MESA](#tnfa_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:54:39
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C1168005
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure TNFa concentration from serum or plasma differed by study and/or subcohort.
    
    #### CFS
    
    The study identified values with low concentrations that had been extrapolated outside the assay range. These extrapolated values were set to the LLOD.
    
    #### FHS
    
    The *_FHS_* Original, New Offspring Spouse, Generation 3, Omni 1, and Omni 2 Cohorts are not included in this harmonized phenotype at this time.
    
    #### MESA
    
    Measurements indicated as low or high were set to 0.16 pg/mL or 12.0 pg/mL, respectively, based on encoded values in the indicator variable (phv00160541). These values differed from the detection limits of the assay.
    
    The *_MESA_* Family and AirNR Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for TNFa measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | CFS | Visit 5 |
    | FHS_Offspring | Exam 7 |
    | MESA_Classic | Exam 2 or 3^1^ |
    
    1. TNFa was measured for an ancillary study that included randomly selected MESA Classic subjects during exams 2 and 3. No subjects were selected more than once in the ancillary study.
    
    #### Assay and limits of detection for TNFa measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | CFS | Human Serum Adipokine Panel B | 0.06 pg/mL |  NA  | Yes |
    | | LINCOplex Kit | | | |
    | FHS_Offspring | ELISA | 0.06-0.32 pg/mL |  NA  | No |
    | MESA_Classic | Millipore Panel B, Luminex | 0.13 pg/mL | 10000 pg/mL | Yes |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for TNFa measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | CFS | Serum |
    | FHS | Plasma |
    | MESA | Serum |
    
<a id="tnfa_1-cfs"></a>
  * ### inflammation/tnfa_1 -- **CFS**:
    * 4 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00124076.v1`, `phs000284.v1.pht001902.v1.phv00124079.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Data
        dataset <- phen_list$source_data$pht001902 %>%
                   rename(tnfa = tnfaam, tnfa_comment = tnfaam_comment)
      
        #Subset to visit 5
        dataset <- subset(dataset, visit == 5)
      
        #Converting age and tnfa to numeric
        dataset$tnfa[dataset$tnfa %in% 'NA'] <- NA
        dataset <- mutate(dataset, tnfa = as.numeric(tnfa), age = as.numeric(age))
      
        #Chaning extrapolated values to LLOD
        dataset$tnfa[dataset$tnfa_comment %in% 'extrapolated'] <- 0.06
      
        #Selecting final varaibles and removing missing
        dataset <- select(dataset, topmed_subject_id, tnfa, age)
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="tnfa_1-fhs"></a>
  * ### inflammation/tnfa_1 -- **FHS**:
    * 2 component_study_variables: `phs000007.v29.pht000111.v5.phv00022779.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables
        dataset <- left_join(phen_list$source_data$pht000111,
                             phen_list$source_data$pht003099,
                             by = 'topmed_subject_id') %>%
                   rename(tnfa = tnf7, age = age7)
      
        # Convert character values to numeric
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="tnfa_1-mesa"></a>
  * ### inflammation/tnfa_1 -- **MESA**:
    * 5 component_study_variables: `phs000209.v13.pht001118.v8.phv00085773.v3`, `phs000209.v13.pht001119.v8.phv00086259.v4`, `phs000209.v13.pht002198.v2.phv00160529.v1`, `phs000209.v13.pht002198.v2.phv00160540.v1`, `phs000209.v13.pht002198.v2.phv00160541.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables
        dataset <- left_join(phen_list$source_data$pht002198,
                             phen_list$source_data$pht001118,
                             by = 'topmed_subject_id')
        dataset <- left_join(dataset,
                   phen_list$source_data$pht001119,
                   by = 'topmed_subject_id') %>%
                   rename(tnfa = tnfa3,
                          tnfa_m = tnfa3m,
                          exam = exam3,
                          age2 = age2c,
                          age3 = age3c)
      
        #Selecting correct age for visit
        dataset$age <- ifelse(dataset$exam == 2, dataset$age2, dataset$age3)
      
        # Substitute the value of 'NA' to missing
        dataset$tnfa[dataset$tnfa %in% 'NA'] <- NA
        dataset$tnfa_m[dataset$tnfa_m %in% 'NA'] <- NA
        dataset$age[dataset$age %in% 'NA'] <- NA
      
        # Convert character values to numeric
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Assign values to tnfa_m = -333 or tnfa_m = -555
        dataset$tnfa[dataset$tnfa_m == -333] <- 0.16
        dataset$tnfa[dataset$tnfa_m == -555] <- 12.0
      
        # Select final variables
        dataset <- select(dataset, tnfa, age, topmed_subject_id)
      
        # Remove records with NAs from dataset
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="tnfa_r1_1"></a>
## inflammation: **tnfa_r1_1** (tnfa_r1)
  Tumor necrosis factor alpha receptor 1 (TNFa-R1) concentration in blood.
  * **Harmonization Units**:
    * [MESA](#tnfa_r1_1-mesa)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 15:56:50
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C4050424
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure TNFa-R1 concentration from serum or plasma differed by study and/or subcohort.
    
    #### MESA
    
    Values above the original assay ULOD (500 pg/mL) are valid and were assayed after dilution. Values that continued to be above the ULOD after dilution as indicated by the study were set to a 10-fold diluted ULOD (5000 pg/mL). 
    
    The *_MESA_* Family and AirNR Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for TNFa-R1 measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | MESA_Classic | Exam 1 Main |
    
    #### Assay and limits of detection for TNFa-R1 measurements
    
    | Study or subcohort | Assay | LLOD | ULOD^1^ | Differentiated^2^ |
    |---------|----------|---------|---------|---------|
    | MESA_Classic | ELISA | 6.03 pg/mL | 500 pg/mL | Yes |
    
    1. Values over the ULOD are valid and were obtained by dilution.
    2. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for TNFa-R1 measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | MESA | Serum |
    
<a id="tnfa_r1_1-mesa"></a>
  * ### inflammation/tnfa_r1_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085029.v3`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Dataset
        dataset <- phen_list$source_data$pht001116 %>%
                   rename(tnfa_r1 = tnfri1, age = age1c)
      
        #Changing to numeric values
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        #Samples with insufficient volume --> NA
        dataset$tnfa_r1[dataset$tnfa_r1 == -888] <- NA
      
        #Sample above the ULOD --> 5000
        dataset$tnfa_r1[dataset$tnfa_r1 == -555] <- 5000
      
        #Removing missing values
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="tnfr2_1"></a>
## inflammation: **tnfr2_1** (tnfr2)
  Tumor necrosis factor receptor 2 (TNFR2) concentration in blood.
  * **Harmonization Units**:
    * [FHS](#tnfr2_1-fhs)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: pg / mL, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-04-15 16:03:21
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2018AB, `ID:` C3897554
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting the component study variables to the appropriate unit of measure as needed and, when possible, accounting for measurements outside an assay's limits of detection (LOD). If the information was available, measurements below the lower limit of detection (LLOD) were set to the LLOD and measurements above the upper limit of detection (ULOD) were set to the ULOD unless otherwise indicated in the study-specific sections below. Some studies identified subjects with measurements outside the LOD; see table below for more details. The assay(s) used to measure TNFR2 concentration from serum or plasma differed by study and/or subcohort.
    
    #### FHS
    
    The *_FHS_* Omni 1 Cohort included a variable on dbGaP (phv00172386) indicating which plate a sample was assayed on. Plate differences in TNFR2 concentrations were observed after adjusting for age and sex. 
    
    The *_FHS_* Original and New Offspring Spouse Cohorts are not included in this harmonized phenotype at this time.
    
    #### Exam visit for TNFR2 measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | FHS_Offspring | Exam 7 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Omni1 | Exam 3 |
    | FHS_Omni2 | Exam 1 |
    
    #### Assay and limits of detection for TNFR2 measurements
    
    | Study or subcohort | Assay | LLOD | ULOD | Differentiated^1^ |
    |---------|----------|---------|---------|---------|
    | FHS_Offspring | ELISA | 0.2 pg/mL |  NA | No | 
    | FHS_Gen3 | ELISA | 0.6 pg/mL |  NA  | No | 
    | FHS_Omni1 | ELISA | 0.2 pg/mL |  NA | No |
    | FHS_Omni2 | ELISA | 0.6 pg/mL |  NA  | No |
    
    1. The study included information indicating which measurements were below or above the limit of detection. If "Yes", measurements outside the LOD can be identified using component study or subcohort variables.
    
    #### Specimen type for TNFR2 measurements
    
    Table includes studies or subcohorts with known specimen types only.
    
    | Study or subcohort | Specimen |
    |---------|----------|
    | FHS | Plasma |
    
<a id="tnfr2_1-fhs"></a>
  * ### inflammation/tnfr2_1 -- **FHS**:
    * 7 component_study_variables: `phs000007.v29.pht000175.v6.phv00023913.v5`, `phs000007.v29.pht002898.v2.phv00172383.v2`, `phs000007.v29.pht002899.v4.phv00172391.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177934.v4`, `phs000007.v29.pht003099.v4.phv00177942.v4`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        #Datasets
        #Offspring
        of_tnfr2 <- left_join(phen_list$source_data$pht000175,
                              phen_list$source_data$pht003099,
                              by = 'topmed_subject_id') %>%
                    select(topmed_subject_id, tnfr2, age = age7)
      
        #Generation 3 and Omni 2
        g3o2_tnfr2 <- left_join(phen_list$source_data$pht002898,
                                phen_list$source_data$pht003099,
                                by = 'topmed_subject_id') %>%
                      select(topmed_subject_id, tnfr2 = tnfr, age = age1)
      
        #Omni 1, remove Offspring
        o1_tnfr2 <- left_join(phen_list$source_data$pht002899,
                              phen_list$source_data$pht003099,
                              by = 'topmed_subject_id') %>%
                    subset(idtype == 7) %>%
                    select(topmed_subject_id, tnfr2 = tnf, age = age3)
      
        #Combined dataset
        dataset <- bind_rows(of_tnfr2, g3o2_tnfr2) %>%
                   bind_rows(o1_tnfr2)
      
        #Converting to numeric variables
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```

# lipids

### Variables in this section:
* [fasting_lipids_1](#fasting_lipids_1)
* [hdl_1](#hdl_1)
* [ldl_1](#ldl_1)
* [lipid_lowering_medication_1](#lipid_lowering_medication_1)
* [total_cholesterol_1](#total_cholesterol_1)
* [triglycerides_1](#triglycerides_1)

<a id="fasting_lipids_1"></a>
## lipids: **fasting_lipids_1** (fasting_lipids)
  Indicates whether participant fasted for at least eight hours prior to blood draw to measure lipids phenotypes.
  * **Harmonization Units**:
    * [Amish](#fasting_lipids_1-amish)
    * [ARIC](#fasting_lipids_1-aric)
    * [CARDIA](#fasting_lipids_1-cardia)
    * [CFS](#fasting_lipids_1-cfs)
    * [CHS](#fasting_lipids_1-chs)
    * [FHS_Gen3](#fasting_lipids_1-fhs_gen3)
    * [FHS_NewOffspringSpouse_Omni2](#fasting_lipids_1-fhs_newoffspringspouse_omni2)
    * [FHS_Offspring](#fasting_lipids_1-fhs_offspring)
    * [GENOA](#fasting_lipids_1-genoa)
    * [HCHS_SOL](#fasting_lipids_1-hchs_sol)
    * [JHS](#fasting_lipids_1-jhs)
    * [MESA](#fasting_lipids_1-mesa)
    * [SAS](#fasting_lipids_1-sas)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-12-12 15:39:19
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C1976106
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting fasting time in hours to a binary
    indicator as needed; or in the cases where all participants fasted prior to the
    blood draw at which lipids were measured, this variable was set to true for all
    participants.
    
    Exceptions to the eight-hour cutoff are the *_CARDIA_*, *_FHS_* Offspring cohort, *_GENOA_*
    and *_SAS_*. Subjects in *_CARDIA_* and the *_FHS_* Offspring cohort were asked to fast for
    _12 hours_ or more. Subjects in the studies *_GENOA_* and *_SAS_* were asked to
    fast for _10 hours_ or more and greater resolution is not available.
    
    Subjects in
    [*_ARIC_*](https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/document.cgi?study_id=phs000280.v3.p1&phv=182563&phd=4496&pha=&pht=4235&phvf=&phdf=387&phaf=&phtf=494&dssp=1&consent=&temp=1#sec9), *_CHS_* and *_HCHS/SOL_* were asked to fast for 12 hours prior to the blood draw. However,
    there are study variables available from all three studies that indicate
    specifically how long the subject fasted for. These variables were used for
    harmonization.
    
    #### FHS
    
    DCC analysts could not confirm that data from the *_FHS_* Original cohort
    available in dbGaP should be used for harmonization, and they are not included.
    
    
<a id="fasting_lipids_1-amish"></a>
  * ### lipids/fasting_lipids_1 -- **Amish**:
    * 1 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005002 %>%
          rename(age = age_baseline)
      
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        dataset$age[dataset$age %in% '90+'] <- 90
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Create fasting status for all subjects, since all subjects have fasted.
        dataset <- transmute(dataset, topmed_subject_id, age, fasting_lipids = "1")
      
        return(dataset)
      }
      ```
<a id="fasting_lipids_1-aric"></a>
  * ### lipids/fasting_lipids_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004063.v2.phv00204732.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht004063 %>%
          rename(age = V1AGE01, fasting_lipids = FAST0802) %>%
          mutate_at(vars(age), funs(as.numeric))
      
        # Encoded value "T" is NA
        dataset[which(dataset$fasting_lipids == "T"), ]$fasting_lipids <- NA
      
        # Exclude rows with missing data
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$fasting_lipids), ]
      
        return(dataset)
      }
      ```
<a id="fasting_lipids_1-cardia"></a>
  * ### lipids/fasting_lipids_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001563.v2.phv00112661.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Join fasting data with age data.
        dat <- full_join(source_data$pht001559, source_data$pht001563, "topmed_subject_id") %>%
          # Rename variables and convert to numeric.
          transmute(topmed_subject_id, age = as.numeric(A01AGE2), fasting_lipids = A05FAST)
      
        # Recode fasting_lipids.
        dat$fasting_lipids[dat$fasting_lipids == "YES"] <- "1"
        dat$fasting_lipids[dat$fasting_lipids == "NO"] <- "0"
        # Exclude rows with missing data.
        dat <- na.omit(dat)
        return(dat)
      }
      ```
<a id="fasting_lipids_1-cfs"></a>
  * ### lipids/fasting_lipids_1 -- **CFS**:
    * 2 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        phen_list$source_data$pht001902 %>%
          # Convert character vectors to numeric
          mutate_if(is.character, as.numeric) %>%
          # Subset to visit 5
          filter(visit == 5) %>%
          # Select only relevant variables
          transmute(topmed_subject_id, age, fasting_lipids = "1") %>%
          return()
      }
      ```
<a id="fasting_lipids_1-chs"></a>
  * ### lipids/fasting_lipids_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001451.v1.phv00099923.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
      
        # Join age dataset and fasting dataset
        inner_join(source_data$pht001451, source_data$pht001452) %>%
          # Convert AGEBL and FAST30 to numeric
          mutate_at(vars(AGEBL, FAST30), funs(as.numeric)) %>%
          # Select ID, rename age
          transmute(topmed_subject_id, age = AGEBL,
                    # Create binary fasting indicator
                    fasting_lipids = as.character(as.integer(FAST30 >= 8))) %>%
          # Exclude records with NAs
          na.omit() %>%
          return()
      }
      ```
<a id="fasting_lipids_1-fhs_gen3"></a>
  * ### lipids/fasting_lipids_1 -- **FHS_Gen3**:
    * 2 component_study_variables: `phs000007.v29.pht000074.v10.phv00021237.v4`, `phs000007.v29.pht006026.v1.phv00277020.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        source_data <- phen_list$source_data
        # Join fasting dataset with age dataset.
        dataset <- plyr::join_all(source_data) %>%
          # Convert AGE1 and G3A453 to numeric.
          mutate_at(vars(AGE1, G3A453), funs(as.numeric)) %>%
          # Select ID, rename age.
          transmute(topmed_subject_id, age = AGE1,
                    # Create binary fasting indicator
                    fasting_lipids = as.character(as.integer(G3A453 >= 8)))
      
        # Exclude records with NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="fasting_lipids_1-fhs_newoffspringspouse_omni2"></a>
  * ### lipids/fasting_lipids_1 -- **FHS_NewOffspringSpouse_Omni2**:
    * 2 component_study_variables: `phs000007.v29.pht005143.v1.phv00255347.v1`, `phs000007.v29.pht006026.v1.phv00277020.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        source_data <- phen_list$source_data
        # Join fasting dataset with age dataset.
        dataset <- plyr::join_all(source_data) %>%
          # Convert AGE1 to numeric.
          mutate_at(vars(AGE1), funs(as.numeric)) %>%
          # Select ID, rename age and fasting.
          transmute(topmed_subject_id, age = AGE1, fasting_lipids = FASTING)
      
        # Exclude records with NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="fasting_lipids_1-fhs_offspring"></a>
  * ### lipids/fasting_lipids_1 -- **FHS_Offspring**:
    * 2 component_study_variables: `phs000007.v29.pht000030.v7.phv00007550.v5`, `phs000007.v29.pht006027.v1.phv00277077.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        source_data <- phen_list$source_data
      
        # Join fasting dataset with age dataset.
        dataset <- plyr::join_all(source_data, by = "topmed_subject_id") %>%
          # Convert AGE1 to numeric.
          mutate_at(vars(AGE1), funs(as.numeric)) %>%
          # Select ID, rename age and fasting status.
          transmute(topmed_subject_id, age = AGE1, fasting_lipids = A23)
      
        # Exclude records with NAs.
        dataset <- na.omit(dataset)
      
        return(dataset)
      }
      ```
<a id="fasting_lipids_1-genoa"></a>
  * ### lipids/fasting_lipids_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v1.pht006039.v1.phv00277507.v1`, `phs001238.v1.pht006041.v1.phv00277572.v1`, `phs001238.v1.pht006653.v1.phv00307788.v1`, `phs001238.v1.pht006655.v1.phv00307853.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        source_data <- phen_list$source_data
        data_aa <- inner_join(source_data$pht006039,
                              source_data$pht006041,
                              by = "topmed_subject_id")
        data_ea <- inner_join(source_data$pht006653,
                              source_data$pht006655,
                              by = "topmed_subject_id")
        dataset <- union(data_aa, data_ea)
      
        # Rename variables.
        dataset <- rename(dataset, age = AGE, fasting_lipids = FAST10HR)
      
        # Encode the two-level factor values to binary values.
        dataset <- mutate_if(dataset, is.factor, as.character)
        dataset$fasting_lipids[dataset$fasting_lipids %in% 'No'] <- 0
        dataset$fasting_lipids[dataset$fasting_lipids %in% 'Yes'] <- 1
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$fasting_lipids), ]
      
        return(dataset)
      }
      ```
<a id="fasting_lipids_1-hchs_sol"></a>
  * ### lipids/fasting_lipids_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00253225.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$pht004715 %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename variables and create binary fasting variable.
          transmute(topmed_subject_id, age = AGE,
                    fasting_lipids = as.character(as.numeric(FASTTIME >= 8))) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="fasting_lipids_1-jhs"></a>
  * ### lipids/fasting_lipids_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001949.v1.phv00126044.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht001949 %>%
          rename(age = AGE01, fasting_lipids = LPF01)
      
        # Substitute the value of 'NA' to missing.
        dataset$fasting_lipids[dataset$fasting_lipids %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$fasting_lipids), ]
      
        # Convert character values to numeric.
        dataset <- mutate(dataset, age = as.numeric(age))
      
        return(dataset)
      }
      ```
<a id="fasting_lipids_1-mesa"></a>
  * ### lipids/fasting_lipids_1 -- **MESA**:
    * 6 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00083303.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084980.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087524.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get list of dataframes.
        source_data <- phen_list$source_data
        # Rename variables in the family exam to match variables in the other dataframes.
        source_data$pht001121 <- rename(source_data$pht001121, age1c = agefc,
                                        lastdrk1 = lastdrkf)
      
        # Bind datasets row-wise.
        dat <- bind_rows(source_data) %>%
          # Rename fasting and age variables. Convert age to numeric and fasting to binary.
          transmute(topmed_subject_id,
                    fasting_lipids = as.character(as.numeric(as.numeric(lastdrk1) >= 8)),
                    age = as.numeric(age1c)) %>%
          # Exclude rows with missing data.
          na.omit()
      
        return(dat)
      }
      ```
<a id="fasting_lipids_1-sas"></a>
  * ### lipids/fasting_lipids_1 -- **SAS**:
    * 1 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
        dataset <- phen_list$source_data$pht005253 %>%
          # Select/rename variables, convert age to numeric, set fasting to true
          # for all subjects.
          transmute(topmed_subject_id, age = as.numeric(Dec_Age),
                    fasting_lipids = "1") %>%
          # Exclude incomplete rows.
          na.omit()
        return(dataset)
      }
      ```
<a id="hdl_1"></a>
## lipids: **hdl_1** (hdl)
  Blood mass concentration of high-density lipoprotein cholesterol
  * **Harmonization Units**:
    * [Amish](#hdl_1-amish)
    * [ARIC](#hdl_1-aric)
    * [CARDIA](#hdl_1-cardia)
    * [CFS](#hdl_1-cfs)
    * [CHS](#hdl_1-chs)
    * [FHS_Gen3_NewOffspringSpouse_Omni2](#hdl_1-fhs_gen3_newoffspringspouse_omni2)
    * [FHS_Offspring](#hdl_1-fhs_offspring)
    * [GENOA](#hdl_1-genoa)
    * [HCHS_SOL](#hdl_1-hchs_sol)
    * [JHS](#hdl_1-jhs)
    * [MESA](#hdl_1-mesa)
    * [SAS](#hdl_1-sas)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: mg/dL, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-12-12 15:49:25
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C2603387
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting component study variables to the
    appropriate unit of measure as needed.
    
    #### FHS
    
    DCC analysts could not confirm that data from the Original cohort available in
    dbGaP should be used for harmonization, and they are not included.
    
    #### Assays and measurement
    
    Lipids were measured in a number of different methods across studies:
    
    | study | method |
    |-------|--------|
    | Amish | serum |
    | ARIC | plasma |
    | CARDIA | plasma |
    | CFS | plasma |
    | CHS | plasma |
    | FHS | plasma |
    | GENOA | serum |
    | HCHS/SOL | serum |
    | JHS | serum |
    | MESA | plasma |
    | SAS | serum |
    
    
<a id="hdl_1-amish"></a>
  * ### lipids/hdl_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253018.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005002 %>%
          rename(age = age_baseline, hdl = hdl_baseline)
      
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        dataset$age[dataset$age %in% '90+'] <- 90
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$hdl[dataset$hdl %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$hdl), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="hdl_1-aric"></a>
  * ### lipids/hdl_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004063.v2.phv00204761.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        phen_list$source_data$pht004063 %>%
          rename(age = V1AGE01, hdl = HDL01) %>%
          # Convert character values to numeric
          mutate_if(is.character, as.numeric) %>%
          # Exclude records with NAs
          na.omit() %>%
          return()
      }
      ```
<a id="hdl_1-cardia"></a>
  * ### lipids/hdl_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001588.v2.phv00113702.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Join lipids data with age data.
        dat <- full_join(source_data$pht001559, source_data$pht001588, "topmed_subject_id") %>%
          # Rename variables and convert to numeric.
          transmute(topmed_subject_id, age = as.numeric(A01AGE2), hdl = as.numeric(AL1HDL)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="hdl_1-cfs"></a>
  * ### lipids/hdl_1 -- **CFS**:
    * 3 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00123968.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        phen_list$source_data$pht001902 %>%
          # Convert character vectors to numeric
          mutate_if(is.character, as.numeric) %>%
          # Subset to visit 5
          filter(visit == 5) %>%
          # Select only necessary variables
          select(topmed_subject_id, age, hdl) %>%
          na.omit() %>%
          return()
      }
      ```
<a id="hdl_1-chs"></a>
  * ### lipids/hdl_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100426.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        source_data$pht001452 %>% rename(age = AGEBL, hdl = HDL44) %>%
          # Convert character values to numeric
          mutate_if(is.character, as.numeric) %>%
          # Exclude incomplete records
          na.omit() %>%
          return()
      }
      ```
<a id="hdl_1-fhs_gen3_newoffspringspouse_omni2"></a>
  * ### lipids/hdl_1 -- **FHS_Gen3_NewOffspringSpouse_Omni2**:
    * 2 component_study_variables: `phs000007.v29.pht006026.v1.phv00277020.v1`, `phs000007.v29.pht006026.v1.phv00277040.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006026 %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename age and HDL variables.
          select(topmed_subject_id, age = AGE1, hdl = HDL1) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dataset)
      }
      ```
<a id="hdl_1-fhs_offspring"></a>
  * ### lipids/hdl_1 -- **FHS_Offspring**:
    * 2 component_study_variables: `phs000007.v29.pht006027.v1.phv00277077.v1`, `phs000007.v29.pht006027.v1.phv00277162.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006027 %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename age and HDL variables.
          select(topmed_subject_id, age = AGE1, hdl = HDL1) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dataset)
      }
      ```
<a id="hdl_1-genoa"></a>
  * ### lipids/hdl_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v1.pht006039.v1.phv00277507.v1`, `phs001238.v1.pht006041.v1.phv00277575.v1`, `phs001238.v1.pht006653.v1.phv00307788.v1`, `phs001238.v1.pht006655.v1.phv00307856.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        source_data <- phen_list$source_data
        data_aa <- inner_join(source_data$pht006039,
                              source_data$pht006041,
                              by = "topmed_subject_id")
        data_ea <- inner_join(source_data$pht006653,
                              source_data$pht006655,
                              by = "topmed_subject_id")
        dataset <- union(data_aa, data_ea)
      
        # Rename variables.
        dataset <- rename(dataset, age = AGE, hdl = HDL)
      
        # Substitute the value of 'NA' to missing.
        dataset$hdl[dataset$hdl %in% 'NA'] <- NA
        dataset$age[dataset$age %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$hdl), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="hdl_1-hchs_sol"></a>
  * ### lipids/hdl_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00253239.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Rename and convert variables to numeric.
        dat <- transmute(phen_list$source_data$pht004715, topmed_subject_id,
                         age = as.numeric(AGE), hdl = as.numeric(LABA68)) %>%
          # Exclude rows with missing data
          na.omit()
        return(dat)
      }
      ```
<a id="hdl_1-jhs"></a>
  * ### lipids/hdl_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001945.v1.phv00125930.v1`, `phs000286.v5.pht001949.v1.phv00126009.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        source_data <- phen_list$source_data
        dataset <- inner_join(source_data$pht001949,
                              source_data$pht001945,
                              by = "topmed_subject_id") %>%
          rename(age = AGE01, hdl = HDLC)
      
        # Substitute the value of 'NA' to missing.
        dataset$hdl[dataset$hdl %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$hdl), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="hdl_1-mesa"></a>
  * ### lipids/hdl_1 -- **MESA**:
    * 6 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082952.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084972.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087099.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get list of dataframes.
        source_data <- phen_list$source_data
        # Rename variables in the family exam to match variables in the other dataframes.
        source_data$pht001121 <- rename(source_data$pht001121, age1c = agefc,
                                        hdl1 = hdlf)
        # Bind datasets row-wise.
        dat <- bind_rows(source_data) %>%
          # Rename hdl and age variables and convert to numeric.
          transmute(topmed_subject_id, hdl = as.numeric(hdl1), age = as.numeric(age1c)) %>%
          na.omit()
      
        return(dat)
      }
      ```
<a id="hdl_1-sas"></a>
  * ### lipids/hdl_1 -- **SAS**:
    * 2 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258743.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
        dataset <- phen_list$source_data$pht005253
      
        # Set string entries of "NA" to NA
        dataset[which(dataset$HDL_C == "NA"), ]$HDL_C <- NA
      
        # Convert character values to numeric and remove <NA>s from dataset
        dataset %>% mutate_if(is.character, as.numeric) %>%
          rename(age = Dec_Age, hdl = HDL_C) %>%
          na.omit() %>%
          return()
      }
      ```
<a id="ldl_1"></a>
## lipids: **ldl_1** (ldl)
  Blood mass concentration of low-density lipoprotein cholesterol
  * **Harmonization Units**:
    * [DCC_harmonized](#ldl_1-dcc_harmonized)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: mg/dL, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-12-12 16:13:48
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C2603388
  * **DCC Harmonization Comments**:

    The DCC-harmonized variables for HDL cholesterol, total cholesterol and
    triglycerides were used to derive this variable with the Friedewald
    formula[^1].
    
    #### Assays and measurement
    
    Lipids were measured in a number of different methods across studies:
    
    | study | method |
    |-------|--------|
    | Amish | serum |
    | ARIC | plasma |
    | CARDIA | plasma |
    | CFS | plasma |
    | CHS | plasma |
    | FHS | plasma |
    | GENOA | serum |
    | HCHS/SOL | serum |
    | JHS | serum |
    | MESA | plasma |
    | SAS | serum |
    
    ### QC Checks
    
    There are a small number of discrepancies between this variable and the
    *_Amish_* study variable `ldl_baseline` (phv00253017); the *_CFS_* study
    variable `ldl` (phv00123971); the *_CHS_* study variable `LDLADJ`
    (phv00100492); the *_JHS_* study variable `LDLC` (phv00125931); and the
    *_MESA_* study variables `ldl1` (phv00082951, phv00084971) and `ldlf`
    (phv00087098). These study variables contain LDL data calculated by the study,
    also derived with the Friedewald formula, and were used for quality checks.
    
    For one subject from *_CFS_*, there is a 25.9% difference in value between this
    variable and the CFS study variable.
    
    [^1]: Friedewald, W. T., Levy, R. I., and Fredrickson, D. S. (1972). Estimation
      of the concentration of low-density lipoprotein cholesterol in plasma,
      without use of the preparative ultracentrifuge. Clin. Chem., 18(6), 499-502.
    
    
<a id="ldl_1-dcc_harmonized"></a>
  * ### lipids/ldl_1 -- **DCC_harmonized**:
    * 3 component_harmonized_variables: `total_cholesterol_1`, `triglycerides_1`, `hdl_1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        harmonized_data <- phen_list$harmonized_data
        # Join harmonized datasets.
        srcd <-  plyr::join_all(harmonized_data, by = "topmed_subject_id",
                                type = "inner") %>%
          mutate_at(vars(total_cholesterol_1, hdl_1, triglycerides_1), funs(as.numeric)) %>%
          # Exclude incomplete records from source data.
          na.omit()
      
        # Use age_at_triglycerids for age.
        srcd$age <- srcd$age_at_triglycerides_1
      
        # Stop if all ages are not equal.
        if (!all(srcd$age == srcd$age_at_total_cholesterol_1) |
            !all(srcd$age == srcd$age_at_hdl_1)){
          stop("Age at measurement does not match for all source phenotypes")
        }
      
        # Friedewald formula to calculate LDL values.
        srcd$ldl <- srcd$total_cholesterol_1 - srcd$hdl_1 - (srcd$triglycerides_1 / 5)
      
        # If triglyceride >= 400, set LDL to NA.
        srcd[which(srcd$triglycerides_1 >= 400), ]$ldl <- NA
      
        # Set negative LDL values to NA.
        srcd[which(srcd$ldl < 0), ]$ldl <- NA
      
        # Exclude incomplete records.
        srcd <- na.omit(srcd) %>%
          # Select variables to return.
          select(topmed_subject_id, ldl, age)
        # Return harmonized dataset.
        return(srcd)
      }
      ```
<a id="lipid_lowering_medication_1"></a>
## lipids: **lipid_lowering_medication_1** (lipid_lowering_medication)
  Indicates whether participant was taking any lipid-lowering medication at blood draw to measure lipids phenotypes
  * **Harmonization Units**:
    * [Amish](#lipid_lowering_medication_1-amish)
    * [ARIC](#lipid_lowering_medication_1-aric)
    * [CFS](#lipid_lowering_medication_1-cfs)
    * [CHS](#lipid_lowering_medication_1-chs)
    * [FHS_Gen3_NewOffspringSpouse_Omni2](#lipid_lowering_medication_1-fhs_gen3_newoffspringspouse_omni2)
    * [FHS_Offspring](#lipid_lowering_medication_1-fhs_offspring)
    * [GENOA](#lipid_lowering_medication_1-genoa)
    * [HCHS_SOL](#lipid_lowering_medication_1-hchs_sol)
    * [JHS](#lipid_lowering_medication_1-jhs)
    * [MESA](#lipid_lowering_medication_1-mesa)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-12-13 08:44:44
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C2924556
  * **DCC Harmonization Comments**:

    This variable is not restricted to a single class of medications, and includes
    lipid lowering drugs like statins and fibrates.
    
    #### FHS
    
    DCC analysts could not confirm that data from the *_FHS_* Original cohort
    available in dbGaP should be used for harmonization, and they are not included.
    
    #### SAS
    
    There is no study variable to indicate whether a subject was taking
    lipid-lowering medication at the time of the lipids blood draw. Therefore, all
    *_SAS_* subjects have missing values for this harmonized variable.
    
    
<a id="lipid_lowering_medication_1-amish"></a>
  * ### lipids/lipid_lowering_medication_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253021.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005002 %>%
          rename(age = age_baseline, lipid_lowering_medication = lipid_med_baseline)
      
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        dataset$age[dataset$age %in% '90+'] <- 90
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$lipid_lowering_medication[dataset$lipid_lowering_medication %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$lipid_lowering_medication), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="lipid_lowering_medication_1-aric"></a>
  * ### lipids/lipid_lowering_medication_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004063.v2.phv00204802.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
        dataset <- phen_list$source_data$pht004063 %>%
          rename(age = V1AGE01, lipid_lowering_medication = CHOLMDCODE01)
      
        # Convert "T" entry to NA. "T" is interpreted as "forgot medications" or "missing data"
        dataset[which(dataset$lipid_lowering_medication == "T"), ]$lipid_lowering_medication <- NA
      
        # Exclude missing records
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$lipid_lowering_medication), ]
      
        # Convert character values to numeric
        dataset %>% mutate_if(is.character, as.numeric) %>%
          return()
      }
      ```
<a id="lipid_lowering_medication_1-cfs"></a>
  * ### lipids/lipid_lowering_medication_1 -- **CFS**:
    * 3 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00123030.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        phen_list$source_data$pht001902 %>%
          # Convert character vectors to numeric
          mutate_if(is.character, as.numeric) %>%
          # Subset to visit 5
          filter(visit == 5) %>%
          # Select only relevant variables
          select(topmed_subject_id, age, lipid_lowering_medication = statins) %>%
            return()
      
      }
      ```
<a id="lipid_lowering_medication_1-chs"></a>
  * ### lipids/lipid_lowering_medication_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001452.v1.phv00100594.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht001452 %>%
          rename(age = AGEBL, lipid_lowering_medication = LIPID06)
      
        # Remove records with NAs from dataset
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$lipid_lowering_medication), ]
      
        # Convert character values to numeric and return
        dataset %>% mutate_if(is.character, as.numeric) %>%
          return()
      }
      ```
<a id="lipid_lowering_medication_1-fhs_gen3_newoffspringspouse_omni2"></a>
  * ### lipids/lipid_lowering_medication_1 -- **FHS_Gen3_NewOffspringSpouse_Omni2**:
    * 2 component_study_variables: `phs000007.v29.pht006026.v1.phv00277020.v1`, `phs000007.v29.pht006026.v1.phv00277061.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006026 %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename age and medication variables.
          select(topmed_subject_id, age = AGE1, lipid_lowering_medication = LIPRX1) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dataset)
      }
      ```
<a id="lipid_lowering_medication_1-fhs_offspring"></a>
  * ### lipids/lipid_lowering_medication_1 -- **FHS_Offspring**:
    * 2 component_study_variables: `phs000007.v29.pht006027.v1.phv00277077.v1`, `phs000007.v29.pht006027.v1.phv00277254.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006027 %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename age and medication variables.
          select(topmed_subject_id, age = AGE1, lipid_lowering_medication = LIPRX1) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dataset)
      }
      ```
<a id="lipid_lowering_medication_1-genoa"></a>
  * ### lipids/lipid_lowering_medication_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v1.pht006039.v1.phv00277507.v1`, `phs001238.v1.pht006042.v1.phv00277586.v1`, `phs001238.v1.pht006653.v1.phv00307788.v1`, `phs001238.v1.pht006656.v1.phv00307867.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        source_data <- phen_list$source_data
        data_aa <- inner_join(source_data$pht006039,
                              source_data$pht006042,
                              by = "topmed_subject_id")
        data_ea <- inner_join(source_data$pht006653,
                              source_data$pht006656,
                              by = "topmed_subject_id")
        dataset <- union(data_aa, data_ea)
      
        # Rename variables.
        dataset <- rename(dataset, age = AGE, lipid_lowering_medication = meds_LIPIDS)
      
        # Encode the two-level factor values to binary values.
        dataset <- mutate_if(dataset, is.factor, as.character)
        dataset$lipid_lowering_medication[dataset$lipid_lowering_medication %in% 'NO'] <- 0
        dataset$lipid_lowering_medication[dataset$lipid_lowering_medication %in% 'YES'] <- 1
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$lipid_lowering_medication), ]
      
        return(dataset)
      }
      ```
<a id="lipid_lowering_medication_1-hchs_sol"></a>
  * ### lipids/lipid_lowering_medication_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00226349.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dat <- phen_list$source_data$ pht004715 %>%
          # Convert to numeric/rename variables.
          transmute(topmed_subject_id, age = as.numeric(AGE),
                    lipid_lowering_medication = as.numeric(MED_LLD)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="lipid_lowering_medication_1-jhs"></a>
  * ### lipids/lipid_lowering_medication_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001949.v1.phv00126053.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht001949 %>%
          rename(age = AGE01, lipid_lowering_medication = LPM01)
      
        # Substitute the value of 'X' to missing.
        dataset$lipid_lowering_medication[dataset$lipid_lowering_medication %in% 'X'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$lipid_lowering_medication), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="lipid_lowering_medication_1-mesa"></a>
  * ### lipids/lipid_lowering_medication_1 -- **MESA**:
    * 6 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00083162.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00085407.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087104.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get list of dataframes.
        source_data <- phen_list$source_data
        # Rename variables in the family exam to match variables in the other dataframes.
        source_data$pht001121 <- rename(source_data$pht001121, lipid1c = lipidfc,
                                        age1c = agefc)
        # Bind datasets row-wise.
        dat <- bind_rows(source_data) %>%
          # Rename treatment and age variables, and convert to numeric.
          transmute(topmed_subject_id, lipid_lowering_medication = as.numeric(lipid1c),
                    age = as.numeric(age1c)) %>%
          na.omit()
      
        return(dat)
      }
      ```
<a id="total_cholesterol_1"></a>
## lipids: **total_cholesterol_1** (total_cholesterol)
  Blood mass concentration of total cholesterol
  * **Harmonization Units**:
    * [Amish](#total_cholesterol_1-amish)
    * [ARIC](#total_cholesterol_1-aric)
    * [CARDIA](#total_cholesterol_1-cardia)
    * [CFS](#total_cholesterol_1-cfs)
    * [CHS](#total_cholesterol_1-chs)
    * [FHS_Gen3_NewOffspringSpouse_Omni2](#total_cholesterol_1-fhs_gen3_newoffspringspouse_omni2)
    * [FHS_Offspring](#total_cholesterol_1-fhs_offspring)
    * [GENOA](#total_cholesterol_1-genoa)
    * [HCHS_SOL](#total_cholesterol_1-hchs_sol)
    * [JHS](#total_cholesterol_1-jhs)
    * [MESA](#total_cholesterol_1-mesa)
    * [SAS](#total_cholesterol_1-sas)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: mg/dL, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-12-12 15:54:03
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0543421
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting study variables to the appropriate
    unit of measure as needed.
    
    #### CHS
    
    The component study variable `CHOLADJ` (phv00100491) was already adjusted for
    laboratory drift as provided.
    
    #### FHS
    
    DCC analysts could not confirm that data from the Original cohort available in
    dbGaP should be used for harmonization, and they are not included.
    
    #### Assays and measurement
    
    Lipids were measured in a number of different methods across studies:
    
    | study | method |
    |-------|--------|
    | Amish | serum |
    | ARIC | plasma |
    | CARDIA | plasma |
    | CFS | plasma |
    | CHS | plasma |
    | FHS | plasma |
    | GENOA | serum |
    | HCHS/SOL | serum |
    | JHS | serum |
    | MESA | plasma |
    | SAS | serum |
    
    ### QC Checks
    
    #### CFS
    
    The distribution of values for this phenotype is substantially lower than other
    studies. DCC analysts confirmed with study correspondents that the units are
    correct.
    
    
<a id="total_cholesterol_1-amish"></a>
  * ### lipids/total_cholesterol_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253020.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005002 %>%
          rename(age = age_baseline, total_cholesterol = totchol_baseline)
      
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        dataset$age[dataset$age %in% '90+'] <- 90
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$total_cholesterol[dataset$total_cholesterol %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$total_cholesterol), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="total_cholesterol_1-aric"></a>
  * ### lipids/total_cholesterol_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004063.v2.phv00204735.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
        dataset <- phen_list$source_data$pht004063 %>%
          rename(age = V1AGE01, total_cholesterol = TCHSIU01)
      
        # Convert chol from SI unit to mg/dL using given conversion on ARIC data form
      
          # https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/document.cgi?study_id=
          # phs000280.v4.p1&phv=204738&phd=2881&pha=&pht=1440&phvf=&phdf=&phaf=&phtf=
          # &dssp=1&consent=&temp=1#sec132
      
        dataset$total_cholesterol <- as.numeric(dataset$total_cholesterol) / 0.02586
      
        # Convert character values to numeric
        dataset %>% mutate_if(is.character, as.numeric) %>%
          na.omit() %>%
          return()
      }
      ```
<a id="total_cholesterol_1-cardia"></a>
  * ### lipids/total_cholesterol_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001588.v2.phv00113700.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Join lipids data with age data.
        dat <- full_join(source_data$pht001559, source_data$pht001588, "topmed_subject_id") %>%
          # Rename variables and convert to numeric.
          transmute(topmed_subject_id, age = as.numeric(A01AGE2),
                    total_cholesterol = as.numeric(AL1CHOL)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="total_cholesterol_1-cfs"></a>
  * ### lipids/total_cholesterol_1 -- **CFS**:
    * 3 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00123953.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        phen_list$source_data$pht001902 %>%
          # Convert character vectors to numeric
          mutate_if(is.character, as.numeric) %>%
          # Subset to visit 5
          filter(visit == 5) %>%
          # Select only relevant variables
          select(topmed_subject_id, age, total_cholesterol = cholesterol) %>%
          na.omit() %>%
          return()
      }
      ```
<a id="total_cholesterol_1-chs"></a>
  * ### lipids/total_cholesterol_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht001452.v1.phv00100491.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        phen_list$source_data$pht001452 %>%
          rename(age = AGEBL, total_cholesterol = CHOLADJ) %>%
          # Convert character values to numeric
          mutate_if(is.character, as.numeric) %>%
          # Exclude incomplete records
          na.omit() %>%
          return()
      }
      ```
<a id="total_cholesterol_1-fhs_gen3_newoffspringspouse_omni2"></a>
  * ### lipids/total_cholesterol_1 -- **FHS_Gen3_NewOffspringSpouse_Omni2**:
    * 2 component_study_variables: `phs000007.v29.pht006026.v1.phv00277020.v1`, `phs000007.v29.pht006026.v1.phv00277047.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006026 %>%
          # Convert character vectors to numeric
          mutate_if(is.character, as.numeric) %>%
          # Rename age and cholesterol variables.
          select(topmed_subject_id, age = AGE1, total_cholesterol = TC1) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dataset)
      }
      ```
<a id="total_cholesterol_1-fhs_offspring"></a>
  * ### lipids/total_cholesterol_1 -- **FHS_Offspring**:
    * 2 component_study_variables: `phs000007.v29.pht006027.v1.phv00277077.v1`, `phs000007.v29.pht006027.v1.phv00277194.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006027 %>%
          # Convert character vectors to numeric
          mutate_if(is.character, as.numeric) %>%
          # Rename age and cholesterol variables.
          select(topmed_subject_id, age = AGE1, total_cholesterol = TC1) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dataset)
      }
      ```
<a id="total_cholesterol_1-genoa"></a>
  * ### lipids/total_cholesterol_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v1.pht006039.v1.phv00277507.v1`, `phs001238.v1.pht006041.v1.phv00277573.v1`, `phs001238.v1.pht006653.v1.phv00307788.v1`, `phs001238.v1.pht006655.v1.phv00307854.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        source_data <- phen_list$source_data
        data_aa <- inner_join(source_data$pht006039,
                              source_data$pht006041,
                              by = "topmed_subject_id")
        data_ea <- inner_join(source_data$pht006653,
                              source_data$pht006655,
                              by = "topmed_subject_id")
        dataset <- union(data_aa, data_ea)
      
        # Rename variables.
        dataset <- rename(dataset, age = AGE, total_cholesterol = CHOL)
      
        # Substitute the value of 'NA' to missing.
        dataset$total_cholesterol[dataset$total_cholesterol %in% 'NA'] <- NA
        dataset$age[dataset$age %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$total_cholesterol), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="total_cholesterol_1-hchs_sol"></a>
  * ### lipids/total_cholesterol_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00253238.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Rename and convert variables to numeric.
        dat <- transmute(phen_list$source_data$pht004715, topmed_subject_id,
                         age = as.numeric(AGE),
                         total_cholesterol = as.numeric(LABA66)) %>%
        # Exclude rows with missing data
        na.omit()
        return(dat)
      }
      ```
<a id="total_cholesterol_1-jhs"></a>
  * ### lipids/total_cholesterol_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001945.v1.phv00125927.v1`, `phs000286.v5.pht001949.v1.phv00126009.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        source_data <- phen_list$source_data
        dataset <- inner_join(source_data$pht001949,
                              source_data$pht001945,
                              by = "topmed_subject_id") %>%
          rename(age = AGE01, total_cholesterol = CHR)
      
        # Substitute the value of 'NA' to missing.
        dataset$total_cholesterol[dataset$total_cholesterol %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$total_cholesterol), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="total_cholesterol_1-mesa"></a>
  * ### lipids/total_cholesterol_1 -- **MESA**:
    * 6 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082956.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084974.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087100.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get list of dataframes.
        source_data <- phen_list$source_data
        # Rename variables in the family exam to match variables in the other dataframes.
        source_data$pht001121 <- rename(source_data$pht001121, chol1 = cholf, age1c = agefc)
        # Bind datasets row-wise.
        dat <- bind_rows(source_data) %>%
          # Rename cholesterol and age variables, and convert to numeric.
          transmute(topmed_subject_id, total_cholesterol = as.numeric(chol1),
                    age = as.numeric(age1c)) %>%
          # Exclude rows with missing values.
          na.omit()
      
        return(dat)
      }
      ```
<a id="total_cholesterol_1-sas"></a>
  * ### lipids/total_cholesterol_1 -- **SAS**:
    * 2 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258733.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
        dataset <- phen_list$source_data$pht005253
      
        # Set string entries of "NA" to NA
        dataset[which(dataset$Cholesterol == "NA"), ]$Cholesterol <- NA
      
        # Convert character values to numeric and remove <NA>s from dataset
        dataset %>% mutate_if(is.character, as.numeric) %>%
          rename(age = Dec_Age, total_cholesterol = Cholesterol) %>%
          na.omit() %>%
          return()
      }
      ```
<a id="triglycerides_1"></a>
## lipids: **triglycerides_1** (triglycerides)
  Blood mass concentration of triglycerides
  * **Harmonization Units**:
    * [Amish](#triglycerides_1-amish)
    * [ARIC](#triglycerides_1-aric)
    * [CARDIA](#triglycerides_1-cardia)
    * [CFS](#triglycerides_1-cfs)
    * [CHS](#triglycerides_1-chs)
    * [FHS_Gen3_NewOffspringSpouse_Omni2](#triglycerides_1-fhs_gen3_newoffspringspouse_omni2)
    * [FHS_Offspring](#triglycerides_1-fhs_offspring)
    * [GENOA](#triglycerides_1-genoa)
    * [HCHS_SOL](#triglycerides_1-hchs_sol)
    * [JHS](#triglycerides_1-jhs)
    * [MESA](#triglycerides_1-mesa)
    * [SAS](#triglycerides_1-sas)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: mg/dL, **`Version`**: 3, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-12-12 15:58:14
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0428475
  * **DCC Harmonization Comments**:

    This variable was harmonized by converting study variables to the
    appropriate unit of measure as needed.
    
    #### FHS
    
    DCC analysts could not confirm that data from the Original cohort
    available in dbGaP should be used for harmonization, and they are not
    included.
    
    #### Assays and measurement
    
    Lipids were measured in a number of different methods across studies:
    
    | study | method |
    |-------|--------|
    | Amish | serum |
    | ARIC | plasma |
    | CARDIA | plasma |
    | CFS | plasma |
    | CHS | plasma |
    | FHS | plasma |
    | GENOA | serum |
    | HCHS/SOL | serum |
    | JHS | serum |
    | MESA | plasma |
    | SAS | serum |
    
    
<a id="triglycerides_1-amish"></a>
  * ### lipids/triglycerides_1 -- **Amish**:
    * 2 component_study_variables: `phs000956.v2.pht005002.v1.phv00252976.v1`, `phs000956.v2.pht005002.v1.phv00253019.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        dataset <- phen_list$source_data$pht005002 %>%
          rename(age = age_baseline, triglycerides = trigs_baseline)
      
        # Substitute the winsorized age value of '90+' to a numeric value 90.
        dataset$age[dataset$age %in% '90+'] <- 90
      
        # Substitute the value of 'NA' to missing.
        dataset$age[dataset$age %in% 'NA'] <- NA
        dataset$triglycerides[dataset$triglycerides %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$triglycerides), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="triglycerides_1-aric"></a>
  * ### lipids/triglycerides_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht004063.v2.phv00204738.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(magrittr)
        source_data <- phen_list$source_data
        source_data$pht004063 %<>% rename(age1 = V1AGE01, trig1 = TRGSIU01)
      
        # Convert trig from SI unit to mg/dL using given conversion on ARIC data form
      
        # https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/document.cgi?
        # study_id=phs000280.v4.p1&phv=204738&phd=2881&pha=&pht=1440&phvf=&phdf=
        # &phaf=&phtf=&dssp=1&consent=&temp=1#sec139
      
        source_data$pht004063$trig1 <- as.numeric(source_data$pht004063$trig1) / 0.01129
      
        # Convert character values to numeric
        source_data$pht004063 %>% mutate_if(is.character, as.numeric) %>%
          rename(age = age1, triglycerides = trig1) %>%
          # Exclude incomplete records
          na.omit() %>%
          return()
      }
      ```
<a id="triglycerides_1-cardia"></a>
  * ### lipids/triglycerides_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001559.v2.phv00112439.v2`, `phs000285.v3.pht001588.v2.phv00113701.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Join lipids data with age data.
        dat <- full_join(source_data$pht001559, source_data$pht001588, "topmed_subject_id") %>%
          # Rename variables and convert to numeric.
          transmute(topmed_subject_id, age = as.numeric(A01AGE2),
                    triglycerides = as.numeric(AL1NTRIG)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="triglycerides_1-cfs"></a>
  * ### lipids/triglycerides_1 -- **CFS**:
    * 3 component_study_variables: `phs000284.v1.pht001902.v1.phv00122012.v1`, `phs000284.v1.pht001902.v1.phv00122015.v1`, `phs000284.v1.pht001902.v1.phv00123974.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        phen_list$source_data$pht001902 %>%
          # Convert character vectors to numeric
          mutate_if(is.character, as.numeric) %>%
          # Subset to visit 5
          filter(visit == 5) %>%
          # Select only relevant variables
          select(topmed_subject_id, age, triglycerides = triglyceride) %>%
          na.omit() %>%
          return()
      }
      ```
<a id="triglycerides_1-chs"></a>
  * ### lipids/triglycerides_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100425.v1`, `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        phen_list$source_data$pht001452 %>%
          rename(age = AGEBL, triglycerides = TRIG44) %>%
          # Convert character values to numeric
          mutate_if(is.character, as.numeric) %>%
          # Exclude incomplete records
          na.omit() %>%
          return()
      }
      ```
<a id="triglycerides_1-fhs_gen3_newoffspringspouse_omni2"></a>
  * ### lipids/triglycerides_1 -- **FHS_Gen3_NewOffspringSpouse_Omni2**:
    * 2 component_study_variables: `phs000007.v29.pht006026.v1.phv00277020.v1`, `phs000007.v29.pht006026.v1.phv00277049.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006026 %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename age and triglyceride variables.
          select(topmed_subject_id, age = AGE1, triglycerides = TRIG1) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dataset)
      }
      ```
<a id="triglycerides_1-fhs_offspring"></a>
  * ### lipids/triglycerides_1 -- **FHS_Offspring**:
    * 2 component_study_variables: `phs000007.v29.pht006027.v1.phv00277077.v1`, `phs000007.v29.pht006027.v1.phv00277203.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht006027 %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename age and triglycerides variables.
          select(topmed_subject_id, age = AGE1, triglycerides = TRIG1) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dataset)
      }
      ```
<a id="triglycerides_1-genoa"></a>
  * ### lipids/triglycerides_1 -- **GENOA**:
    * 4 component_study_variables: `phs001238.v1.pht006039.v1.phv00277507.v1`, `phs001238.v1.pht006041.v1.phv00277574.v1`, `phs001238.v1.pht006653.v1.phv00307788.v1`, `phs001238.v1.pht006655.v1.phv00307855.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset.
        source_data <- phen_list$source_data
        data_aa <- inner_join(source_data$pht006039,
                              source_data$pht006041,
                              by = "topmed_subject_id")
        data_ea <- inner_join(source_data$pht006653,
                              source_data$pht006655,
                              by = "topmed_subject_id")
        dataset <- union(data_aa, data_ea)
      
        # Rename variables.
        dataset <- rename(dataset, age = AGE, triglycerides = TRIG)
      
        # Substitute the value of 'NA' to missing.
        dataset$triglycerides[dataset$triglycerides %in% 'NA'] <- NA
        dataset$age[dataset$age %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$triglycerides), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="triglycerides_1-hchs_sol"></a>
  * ### lipids/triglycerides_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00253240.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Rename and convert variables to numeric.
        dat <- transmute(phen_list$source_data$pht004715, topmed_subject_id,
                         age = as.numeric(AGE), triglycerides = as.numeric(LABA67)) %>%
          # Exclude rows with missing data
          na.omit()
        return(dat)
      }
      ```
<a id="triglycerides_1-jhs"></a>
  * ### lipids/triglycerides_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001945.v1.phv00125933.v1`, `phs000286.v5.pht001949.v1.phv00126009.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get dataset and rename variables.
        source_data <- phen_list$source_data
        dataset <- inner_join(source_data$pht001949,
                              source_data$pht001945,
                              by = "topmed_subject_id") %>%
          rename(age = AGE01, triglycerides = TRR)
      
        # Substitute the value of 'NA' to missing.
        dataset$triglycerides[dataset$triglycerides %in% 'NA'] <- NA
      
        # Remove records with NAs from dataset.
        dataset <- dataset[!is.na(dataset$age) & !is.na(dataset$triglycerides), ]
      
        # Convert character values to numeric.
        dataset <- mutate_if(dataset, is.character, as.numeric)
      
        return(dataset)
      }
      ```
<a id="triglycerides_1-mesa"></a>
  * ### lipids/triglycerides_1 -- **MESA**:
    * 6 component_study_variables: `phs000209.v13.pht001111.v4.phv00082639.v2`, `phs000209.v13.pht001111.v4.phv00082950.v1`, `phs000209.v13.pht001116.v10.phv00084442.v3`, `phs000209.v13.pht001116.v10.phv00084968.v2`, `phs000209.v13.pht001121.v3.phv00087071.v1`, `phs000209.v13.pht001121.v3.phv00087101.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
      
        # Get list of dataframes.
        source_data <- phen_list$source_data
        # Rename variables in the family exam to match variables in the other dataframes.
        source_data$pht001121 <- rename(source_data$pht001121, age1c = agefc, trig1 = trigf)
      
        # Bind datasets row-wise.
        dat <- bind_rows(source_data) %>%
          # Rename triglycerides and age variables, and convert to numeric.
          transmute(topmed_subject_id, age = as.numeric(age1c),
                    triglycerides = as.numeric(trig1)) %>%
          # Exclude incomplete records.
          na.omit()
      
          return(dat)
      }
      ```
<a id="triglycerides_1-sas"></a>
  * ### lipids/triglycerides_1 -- **SAS**:
    * 2 component_study_variables: `phs000914.v1.pht005253.v1.phv00258680.v1`, `phs000914.v1.pht005253.v1.phv00258736.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        dataset <- phen_list$source_data$pht005253 %>%
          rename_(age = "Dec_Age", triglycerides = "NetTG")
      
        # Recode the string "NA" as NA
        dataset[which(dataset$triglycerides == "NA"), ]$triglycerides <- NA
      
      
        dataset %>% mutate_if(is.character, as.numeric) %>%
          # Remove NAs from dataset
          na.omit() %>%
          return()
      }
      ```

# sleep

### Variables in this section:
* [sleep_duration_1](#sleep_duration_1)

<a id="sleep_duration_1"></a>
## sleep: **sleep_duration_1** (sleep_duration)
  Usual amount of time slept per day.
  * **Harmonization Units**:
    * [ARIC](#sleep_duration_1-aric)
    * [CARDIA](#sleep_duration_1-cardia)
    * [CFS](#sleep_duration_1-cfs)
    * [CHS](#sleep_duration_1-chs)
    * [FHS_Gen3](#sleep_duration_1-fhs_gen3)
    * [FHS_Offspring_Omni1](#sleep_duration_1-fhs_offspring_omni1)
    * [FHS_Original](#sleep_duration_1-fhs_original)
    * [HCHS_SOL](#sleep_duration_1-hchs_sol)
    * [JHS](#sleep_duration_1-jhs)
    * [MESA](#sleep_duration_1-mesa)
    * [WHI](#sleep_duration_1-whi)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: hours/day, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2019-09-03 17:10:19
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C0424574
  * **DCC Harmonization Comments**:

    ### Harmonization process
    
    This variable was harmonized either by converting the component study variables to the appropriate unit of measure, or by calculating from component study variables using the formula `sleep duration = waketime - bedtime` or `sleep duration = sleep hours + sleep minutes / 60`. All component study variables were self-reported. Sleep duration was recorded at multiple visits for some study subjects; one observation per subject was selected for the harmonized variable.
    
    #### ARIC
    
    Observations for subjects with sleep duration measured at multiple exams were selected from the largest visit in which that subject was represented (i.e. the visit with the greatest number of observations).
    
    #### CFS
    
    Observations for subjects with sleep duration measured at multiple exams were selected from most- to least-recent.
    
    #### FHS
    
    Observations for subjects with sleep duration measured at multiple exams were selected from the largest visit in which that subject was represented.
    
    #### WHI
    
    Values in the component variable used for harmonization were Winsorized at five and 10 hours at the lower and upper ends, respectively.
    
    #### Exam/visit for sleep duration measurements
    
    | Study or subcohort | Visit |
    |---------|----------|
    | ARIC | Visit 5; Sleep Health Heart Study |
    | Cardia | Year 15 |
    | CFS | Visit 1; Visit 2; Visit 3; Visit 5 |
    | CHS | SHHS 1 |
    | FHS_Gen3 | Exam 1 |
    | FHS_Offspring | Exam 2; Exam 4; Exam 6; Exam 7; Exam 8; Exam 9; SHHS|
    | FHS_Omni1 | Exam 4|
    | FHS_Original | Exam 12; Exam 20 |
    | HCHS/SOL | Visit 1 |
    | JHS | Visit 1 |
    | MESA | Exam 4 |
    | WHI | Year 0 |
    
    ### QC checks
    
    We compared self-reported sleep duration and sleep duration calculated from the formula `sleep duration = waketime - bedtime`, for subjects with both measurements. There are differences between the measurements, but not enough to suggest that there are errors with the harmonization algorithm.
    
    Some subjects in *_CARDIA_*, *_CHS_*, *_FHS_* Original Cohort, *_HCHS/SOL_* and *_MESA_* reported usual sleep duration of zero or greater than 24 hours per day and were removed from the harmonized dataset.
    
<a id="sleep_duration_1-aric"></a>
  * ### sleep/sleep_duration_1 -- **ARIC**:
    * 10 component_study_variables: `phs000280.v5.pht004228.v2.phv00214261.v1`, `phs000280.v5.pht004228.v2.phv00214262.v1`, `phs000280.v5.pht004228.v2.phv00214263.v1`, `phs000280.v5.pht004228.v2.phv00214268.v1`, `phs000280.v5.pht004228.v2.phv00214269.v1`, `phs000280.v5.pht004228.v2.phv00214270.v1`, `phs000280.v5.pht004228.v2.phv00214274.v1`, `phs000280.v5.pht004228.v2.phv00215388.v1`, `phs000280.v5.pht006431.v1.phv00295623.v1`, `phs000280.v5.pht006479.v1.phv00298019.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(lubridate)
        library(tidyr)
        source_data <- phen_list$source_data
        # Create date-time format string.
        fmt <- "IMp"
      
        # Join Visit 5 age data and sleep data.
        v5 <- inner_join(source_data$pht006431, source_data$pht006479, "topmed_subject_id") %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Change variable names.
          dplyr::rename(sleep_duration = RSE21, age = AGE_STAGE_1) %>%
          # Exclude rows with missing data.
          na.omit()
      
        shhs <- source_data$pht004228
        # Recode AM/PM variables.
        shhs_calc <- mutate_at(shhs, vars(TFAWDA02, TWUWDA02),
                  function(x) case_when(x == "1" ~ "AM", x == "2" ~ "PM")) %>%
          # Subset to rows where hour and AM/PM variables are non-missing.
          filter(!is.na(TFAWDH02), !is.na(TWUWDH02), !is.na(TFAWDA02), !is.na(TWUWDA02)) %>%
          # Treat missing "minutes" portion as 0.
          mutate_at(vars(TFAWDM02, TWUWDM02), function(x) case_when(is.na(x) ~ "0", TRUE ~ x)) %>%
          # Create bedtime and waketime variables as date_time.
          mutate(bt = paste0(TFAWDH02, ":", TFAWDM02, TFAWDA02) %>% parse_date_time(fmt),
                 wt = paste0(TWUWDH02, ":", TWUWDM02, TWUWDA02) %>% parse_date_time(fmt)) %>%
          # Calculate sleep duration form bedtime and waketime.
          mutate(offset = case_when(bt > wt ~ dhours(24), bt < wt ~ dhours(0)),
                 sleep_duration = as.numeric(wt - bt + offset) / 3600) %>%
          # Select necessary variables.
          select(topmed_subject_id, sleep_duration, AGE_S1) %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Select SHHS variables.
        dat <- select(shhs, topmed_subject_id, sleep_duration = HRSWD02, AGE_S1) %>%
          # Exclude rows with missing data.
          na.omit() %>%
          # Combine with calculated sleep duration.
          rbind(shhs_calc) %>%
          # Rename age variable.
          dplyr::rename(age = AGE_S1) %>%
          # Combine Visit 5 and SHHS.
          rbind(v5) %>%
          # Group by subject.
          group_by(topmed_subject_id) %>%
          # Subset to first observation for each subject.
          filter(row_number() == 1) %>%
          # Convert sleep duration and age to numeric.
          mutate_at(vars(sleep_duration, age), as.numeric)
      
        return(dat)
      }
      ```
<a id="sleep_duration_1-cardia"></a>
  * ### sleep/sleep_duration_1 -- **CARDIA**:
    * 2 component_study_variables: `phs000285.v3.pht001839.v2.phv00120534.v2`, `phs000285.v3.pht001851.v2.phv00120748.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Join age data with sleep data.
        dat <- inner_join(source_data$pht001839, source_data$pht001851, "topmed_subject_id") %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename harmonized variables.
          rename(sleep_duration = F67SLPHR, age = EX6_AGE) %>%
          # Exclude rows with missing data.
          na.omit() %>%
          # Keep subjects with sleep duration less than 24 hours.
          filter(sleep_duration < 24)
        return(dat)
      }
      ```
<a id="sleep_duration_1-cfs"></a>
  * ### sleep/sleep_duration_1 -- **CFS**:
    * 6 component_study_variables: `phs000284.v2.pht001902.v1.phv00122012.v1`, `phs000284.v2.pht001902.v1.phv00122015.v1`, `phs000284.v2.pht001902.v1.phv00122084.v1`, `phs000284.v2.pht001902.v1.phv00122088.v1`, `phs000284.v2.pht001902.v1.phv00122371.v1`, `phs000284.v2.pht001902.v1.phv00122372.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(lubridate)
        # Join age data with sleep data.
        source_data <- phen_list$source_data$pht001902
        # Specify NA values.
        na_values <- c(NA, "-2")
      
        # Select necessary variables.
        sdur <- select(source_data, -DAYBED, -DAYWAKE) %>%
          # Set DAYMIN to 0 if its value was missing.
          mutate_at(vars(DAYMIN), function(x) ifelse(x %in% na_values, 0, as.numeric(x))) %>%
          # Set DAYHRS to NA if its value was missing.
          mutate_at(vars(DAYHRS), function(x) ifelse(x %in% na_values, NA, x)) %>%
          # Calculate sleep duration from DAYHRS and DAYMIN.
          mutate(sleep_duration = as.numeric(DAYHRS) + (DAYMIN / 60)) %>%
          # Drop old variables.
          select(-DAYHRS, -DAYMIN) %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Select necessary variables.
        calc <- select(source_data, -DAYHRS, -DAYMIN) %>%
          # Filter out rows with missing component variables.
          filter(!(DAYBED %in% na_values), !(DAYWAKE %in% na_values)) %>%
          # Convert bedtime and waketime variables to date_time type.
          mutate_at(vars(DAYBED, DAYWAKE), function(x){
                      parse_date_time(sprintf("%04d", as.integer(x)), "HM")
          }) %>%
          # Calculate sleep duration from bedtime and waketime.
          mutate(offset = case_when(DAYBED > DAYWAKE ~ dhours(24), DAYBED < DAYWAKE ~ dhours(0)),
                 sleep_duration = as.numeric(DAYWAKE - DAYBED + offset) / 3600) %>%
          # Drop old variables.
          select(-DAYBED, -DAYWAKE, -offset)
        # Bind datasets row-wise
        dat <- rbind(sdur, calc) %>%
          # Group dataset by ID and visit.
          group_by(topmed_subject_id, visit) %>%
          # Subset to first observation for each subject.
          filter(row_number() == 1) %>%
          # Order observations from most-recent to least-recent.
          arrange(desc(visit)) %>%
          # Group dataset by ID.
          group_by(topmed_subject_id) %>%
          # Select only the most recent observation for each subject.
          filter(row_number() == 1) %>%
          # Drop visit variable.
          select(-visit)
      
        return(dat)
      }
      ```
<a id="sleep_duration_1-chs"></a>
  * ### sleep/sleep_duration_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001460.v1.phv00100694.v1`, `phs000287.v6.pht001460.v1.phv00100712.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Join age data with sleep data.
        dat <- phen_list$source_data$pht001460 %>%
          # Rename variables and convert to numeric.
          transmute(topmed_subject_id, age = as.numeric(AGE_S1),
                    sleep_duration = as.numeric(HRSWD02)) %>%
          # Exclude rows with missing data.
          na.omit() %>%
          # Filter out observations where sleep_duration is zero or less.
          filter(sleep_duration > 0)
        return(dat)
      }
      ```
<a id="sleep_duration_1-fhs_gen3"></a>
  * ### sleep/sleep_duration_1 -- **FHS_Gen3**:
    * 2 component_study_variables: `phs000007.v30.pht000074.v11.phv00021348.v5`, `phs000007.v30.pht003099.v5.phv00177930.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Join age data with sleep data.
        dat <- inner_join(source_data$pht000074, source_data$pht003099, "topmed_subject_id") %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename harmonized variables.
          rename(sleep_duration = G3A596, age = age1) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="sleep_duration_1-fhs_offspring_omni1"></a>
  * ### sleep/sleep_duration_1 -- **FHS_Offspring_Omni1**:
    * 30 component_study_variables: `phs000007.v30.pht000031.v8.phv00007754.v6`, `phs000007.v30.pht000033.v9.phv00009109.v6`, `phs000007.v30.pht000036.v9.phv00010680.v6`, `phs000007.v30.pht000098.v7.phv00022090.v6`, `phs000007.v30.pht000395.v9.phv00055458.v6`, `phs000007.v30.pht000395.v9.phv00055459.v6`, `phs000007.v30.pht000395.v9.phv00055460.v6`, `phs000007.v30.pht000395.v9.phv00055465.v6`, `phs000007.v30.pht000395.v9.phv00055466.v5`, `phs000007.v30.pht000395.v9.phv00055467.v5`, `phs000007.v30.pht000395.v9.phv00055471.v6`, `phs000007.v30.pht000395.v9.phv00056587.v6`, `phs000007.v30.pht000747.v6.phv00072369.v5`, `phs000007.v30.pht000747.v6.phv00072556.v5`, `phs000007.v30.pht003099.v5.phv00177932.v5`, `phs000007.v30.pht003099.v5.phv00177936.v5`, `phs000007.v30.pht003099.v5.phv00177940.v5`, `phs000007.v30.pht003099.v5.phv00177942.v5`, `phs000007.v30.pht003099.v5.phv00177944.v5`, `phs000007.v30.pht003099.v5.phv00177946.v5`, `phs000007.v30.pht005140.v2.phv00254011.v2`, `phs000007.v30.pht005140.v2.phv00254343.v2`, `phs000007.v30.pht005140.v2.phv00254561.v2`, `phs000007.v30.pht005140.v2.phv00254562.v2`, `phs000007.v30.pht005140.v2.phv00254563.v2`, `phs000007.v30.pht005140.v2.phv00254566.v2`, `phs000007.v30.pht005140.v2.phv00254567.v2`, `phs000007.v30.pht005140.v2.phv00254568.v2`, `phs000007.v30.pht005140.v2.phv00254569.v2`, `phs000007.v30.pht005140.v2.phv00254570.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(tidyr)
        library(lubridate)
        library(magrittr)
      
        source_data <- phen_list$source_data
        age <- source_data$pht003099
        # Rename age variables to exam number.
        age_tall <- set_names(age, gsub("age", "", names(age))) %>%
          # Create age-by-visit dataset.
          gather("visit", "age", -topmed_subject_id, na.rm = TRUE)
      
        # Join age data with exam 2 sleep data.
        ex2 <- left_join(source_data$pht000031, age, "topmed_subject_id") %>%
          # Convert character vectors to numeric; create visit variable
          transmute(topmed_subject_id, sleep_duration = as.numeric(B104), age = age2, visit = "2") %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Join age data with exam 4 sleep data.
        ex4 <- left_join(source_data$pht000033, age, "topmed_subject_id") %>%
          # Convert character vectors to numeric; create visit variable
          transmute(topmed_subject_id, sleep_duration = as.numeric(D426), age = age4, visit = "4") %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Join age data with exam 6 sleep data.
        ex6 <- left_join(source_data$pht000098, age, "topmed_subject_id") %>%
          # Convert character vectors to numeric; create visit variable
          transmute(topmed_subject_id, sleep_duration = as.numeric(EH_10A), age = age6, visit = "6") %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Join exam 7 data with age data.
        ex7 <- left_join(source_data$pht000036, age, "topmed_subject_id") %>%
          # Rename sleep variable/age variables and convert to numeric; create visit variable.
          transmute(topmed_subject_id, sleep_duration = as.numeric(G689), age = age7, visit = "7") %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Create visit variable for exam 8.
        ex8 <- mutate(source_data$pht000747, visit = "8") %>%
          # Join exam 8 data with age data.
          left_join(age_tall, c("topmed_subject_id", "visit")) %>%
          # Convert sleep variables to numeric.
          mutate_at(vars(H480, H726), as.numeric)
        # Create sleep dataset for exam 8-H480
        H480 <- select(ex8, topmed_subject_id, sleep_duration = H480, age, visit) %>%
          # Exclude rows with missing data.
          na.omit()
        # Create sleep dataset for exam 8-H726
        H726 <- select(ex8, topmed_subject_id, sleep_duration = H726, age, visit) %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Create visit variable for Offspring exam 9/Omni 1 exam 4 dataset.
        offs9_omni4 <- mutate(source_data$pht005140, visit = case_when(idtype == 1 ~ "9",
                                                                       idtype == 7 ~ "4")) %>%
          # Join with age data.
          left_join(age_tall, c("topmed_subject_id", "visit"))
      
        # Create exam 9/exam 4-j628 sleep dataset.
        j628 <- transmute(offs9_omni4, topmed_subject_id, sleep_duration = as.numeric(j628),
                          age, visit) %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Create exam 9/exam 4-j921/j922 sleep dataset.
        actual_sleep <- select(offs9_omni4, topmed_subject_id, idtype, visit, age, j921, j922) %>%
          # Subset to cases where "hours" portion is not missing.
          filter(!is.na(j921)) %>%
          # Convert sleep variables to numeric.
          mutate_at(vars(j921, j922), as.numeric) %>%
          # Treat missing "minutes" portion as 0.
          mutate_at(vars(j922), function(x) case_when(is.na(x) ~ 0, TRUE ~ x)) %>%
          # Convert hours and minutes to hours and fractional hours.
          mutate(sleep_duration = as.numeric(dhours(j921) + dminutes(j922)) / 3600) %>%
          # Drop old variables.
          select(-idtype, -j921, -j922) %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Rename bedtime and waketime variables, and drop unnecessary variables.
        offs9_omni4_calc <- transmute(offs9_omni4, bt_hour = j913, bt_min = j914,
                                      bt_ampm = j915, wt_hour = j918, wt_min = j919,
                                      wt_ampm = j920, visit, age, idtype,
                                      topmed_subject_id)
        # Rename SHHS variables.
        shhs <- rename(source_data$pht000395, sleep_duration = HrsWD02, age = age_s1) %>%
          # Create visit variable and convert sleep duration to numeric.
          mutate(visit = "shhs", sleep_duration = as.numeric(sleep_duration))
        # Create SHHS-HrsWD02 sleep dataset.
        HrsWD02 <- select(shhs, topmed_subject_id, sleep_duration, visit, age) %>%
          # Exclude rows with missing data.
          na.omit()
        # Rename bedtime and waketime variables, and drop unnecessary variables.
        shhs_calc <- transmute(shhs, bt_hour = TFAWDH02, bt_min = TFAWDM02,
                               bt_ampm = TFAWDA02, wt_hour = TWUWDH02,
                               wt_min = TWUWDM02, wt_ampm = TWUWDA02, visit,
                               topmed_subject_id, age)
        # Create date-time format string.
        fmt <- "IMp"
        # Bind SHHS and exam 9/exam 4 data row-wise.
        calc <- bind_rows(shhs_calc, offs9_omni4_calc) %>%
          # Recode AM/PM variables.
          mutate_at(vars(bt_ampm, wt_ampm), function(x) case_when(x == "1" ~ "AM", x == "2" ~ "PM")) %>%
          # Subset to rows where hour and AM/PM variables are non-missing.
          filter(!is.na(bt_hour), !is.na(wt_hour), !is.na(bt_ampm), !is.na(wt_ampm)) %>%
          # Treat missing "minutes" portion as 0.
          mutate_at(vars(bt_min, wt_min), function(x) case_when(is.na(x) ~ "0", TRUE ~ x)) %>%
          # Create bedtime and waketime variables as date_time.
          mutate(bt = paste0(bt_hour, ":", bt_min, bt_ampm) %>% parse_date_time(fmt),
                 wt = paste0(wt_hour, ":", wt_min, wt_ampm) %>% parse_date_time(fmt)) %>%
          # Calculate sleep duration form bedtime and waketime.
          mutate(offset = case_when(bt > wt ~ dhours(24), bt < wt ~ dhours(0)),
                 sleep_duration = as.numeric(wt - bt + offset) / 3600) %>%
          # Select necessary variables.
          select(topmed_subject_id, visit, sleep_duration, age)
      
        # Bind harmonized data row-wise in order of preference.
        dat <- rbind(
          ex4,
          ex2,
          H480,
          H726,
          ex7,
          actual_sleep,
          filter(calc, visit %in% c("4", "9")),
          j628,
          HrsWD02,
          filter(calc, visit == "shhs"),
          ex6
        ) %>%
          # Group by ID.
          group_by(topmed_subject_id) %>%
          # Select first observation for each subject.
          filter(row_number() == 1) %>%
          # Convert age to numeric.
          mutate_at(vars(age), as.numeric) %>%
          select(-visit) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="sleep_duration_1-fhs_original"></a>
  * ### sleep/sleep_duration_1 -- **FHS_Original**:
    * 3 component_study_variables: `phs000007.v30.pht000014.v3.phv00001902.v1`, `phs000007.v30.pht000022.v4.phv00004158.v1`, `phs000007.v30.pht003099.v5.phv00177930.v5`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        library(tidyr)
        library(lubridate)
        library(magrittr)
      
        source_data <- phen_list$source_data
      
        # Join age data with exam 12 sleep data.
        ex12 <- inner_join(source_data$pht000014, source_data$pht003099, "topmed_subject_id") %>%
          mutate(visit = "12") %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename harmonized variables.
          rename(sleep_duration = FE186, age = age1) %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Join age data with exam 20 sleep data.
        ex20 <- inner_join(source_data$pht000022, source_data$pht003099, "topmed_subject_id") %>%
          mutate(visit = "20") %>%
          # Convert character vectors to numeric.
          mutate_if(is.character, as.numeric) %>%
          # Rename harmonized variables.
          rename(sleep_duration = FM94, age = age1) %>%
          # Exclude rows with missing data.
          na.omit()
      
        # Bind harmonized data row-wise in order of preference.
        dat <- rbind(
          ex12,
          ex20
        ) %>%
          # Group by ID.
          group_by(topmed_subject_id) %>%
          # Select first observation for each subject.
          filter(row_number() == 1) %>%
          # Convert age to numeric.
          mutate_at(vars(sleep_duration, age), as.numeric) %>%
          # Drop visit variable.
          select(-visit) %>%
          # Exclude rows with missing data.
          na.omit() %>%
          # Keep subjects with sleep duration less than 24 hours.
          filter(sleep_duration < 24)
      
        return(dat)
      }
      ```
<a id="sleep_duration_1-hchs_sol"></a>
  * ### sleep/sleep_duration_1 -- **HCHS_SOL**:
    * 2 component_study_variables: `phs000810.v1.pht004715.v1.phv00226251.v1`, `phs000810.v1.pht004715.v1.phv00258046.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Join age data with sleep data.
        dat <- phen_list$source_data$pht004715 %>%
        # Change variable names and convert character vectors to numeric.
          transmute(topmed_subject_id, age = as.numeric(AGE),
                    sleep_duration = as.numeric(SLPDUR)) %>%
          # Exclude rows with mising data.
          na.omit() %>%
          # Subset to observations inside logical range.
          filter(sleep_duration > 0)
        return(dat)
      }
      ```
<a id="sleep_duration_1-jhs"></a>
  * ### sleep/sleep_duration_1 -- **JHS**:
    * 2 component_study_variables: `phs000286.v5.pht001949.v1.phv00126009.v1`, `phs000286.v5.pht001963.v1.phv00127678.v1`
    * Function:
      ```r
      harmonize <- function(phen_list){
        source_data <- phen_list$source_data
        # Join sleep data with age data.
        dat <- inner_join(source_data$pht001949, source_data$pht001963, "topmed_subject_id") %>%
          # Rename and convert variables to numeric.
          transmute(topmed_subject_id, age = as.numeric(AGE01), sleep_duration = as.numeric(MHXA7)) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```
<a id="sleep_duration_1-mesa"></a>
  * ### sleep/sleep_duration_1 -- **MESA**:
    * 2 component_study_variables: `phs000209.v13.pht001120.v10.phv00086727.v3`, `phs000209.v13.pht001120.v10.phv00087048.v2`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        # Join age data with sleep data.
        dat <- phen_list$source_data$pht001120 %>%
          # Rename harmonized variables and convert character vectors to numeric.
          transmute(topmed_subject_id, age = as.numeric(age4c),
                    sleep_duration = as.numeric(slpwkhr4)) %>%
          # Exclude rows with missing data.
          na.omit() %>%
          # Filter out rows outside of logical range.
          filter(sleep_duration < 24, sleep_duration > 0)
        return(dat)
      }
      ```
<a id="sleep_duration_1-whi"></a>
  * ### sleep/sleep_duration_1 -- **WHI**:
    * 5 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001005.v6.phv00078869.v6`, `phs000200.v11.pht001005.v6.phv00078870.v6`, `phs000200.v11.pht001005.v6.phv00079041.v6`
    * Function:
      ```r
      harmonize <- function(phen_list){
        library(dplyr)
        source_data <- phen_list$source_data
        # Filter data to baseline observations only.
        dat <- filter(source_data$pht001005, F37VY == "0") %>%
          # Join with age variables.
          left_join(source_data$pht000998, "topmed_subject_id") %>%
          # Convert variables to numeric.
          mutate_at(vars(F37DAYS, F2DAYS, AGE, HRSSLP), as.numeric) %>%
          # Set positive F2DAYS values to zero.
          mutate_at(vars(F2DAYS), ~ ifelse(. > 0, 0, .)) %>%
          # Calculate age, and sleep duration in hours.
          transmute(age = AGE + (abs(F2DAYS) + F37DAYS) / 365.25,
                    sleep_duration = HRSSLP + 4, topmed_subject_id) %>%
          # Exclude rows with missing data.
          na.omit()
        return(dat)
      }
      ```

# vte

### Variables in this section:
* [vte_case_status_1](#vte_case_status_1)
* [vte_followup_start_age_1](#vte_followup_start_age_1)
* [vte_prior_history_1](#vte_prior_history_1)

<a id="vte_case_status_1"></a>
## vte: **vte_case_status_1** (vte_case_status)
  An indicator of whether a subject experienced a venous thromboembolism event (VTE) that was verified by adjudication or by medical professionals.
  * **Harmonization Units**:
    * [ARIC](#vte_case_status_1-aric)
    * [CHS](#vte_case_status_1-chs)
    * [FHS_G3NOSOm12](#vte_case_status_1-fhs_g3nosom12)
    * [FHS_Offspring](#vte_case_status_1-fhs_offspring)
    * [FHS_Original](#vte_case_status_1-fhs_original)
    * [HVH](#vte_case_status_1-hvh)
    * [Mayo_GENEVA](#vte_case_status_1-mayo_geneva)
    * [Mayo_OC](#vte_case_status_1-mayo_oc)
    * [WHI_HRT](#vte_case_status_1-whi_hrt)
    * [WHI_MRCnonHRT](#vte_case_status_1-whi_mrcnonhrt)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-11-07 14:08:02
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C1861172
  * **DCC Harmonization Comments**:

    Venous thromboembolism (VTE) events include deep vein thrombosis (DVT) or pulmonary embolism (PE). If data included variable(s) distinguishing the type, information about the first event of either type was used. Throughout these comments, we refer to subjects that have experienced a verified VTE event as cases and to subjects that have not as controls.
    
    For cohort studies (where subjects were enrolled and then followed for a period of time), any subject with a verified event who also had no evidence of prior events was classified as a case , with the exception of *_FHS_* Original and Offspring subcohorts. The case determination process for these subcohorts is explained below. Subjects with no events recorded and with no evidence of prior events were classified as controls as long as the time at censoring was after the start of adjudication/medical review. The harmonized variable was set to missing for subjects with no events recorded for which time at censoring was before or at the start of adjudication/medical review, or for any subject with evidence of prior events. 
    For case-control studies, case status was as given in the case status study component variable, with some additional criteria for *_HVH_*.
    
    The cohort studies generally provided time-to-event data.  Time was the time to event for cases and time to censoring for controls, expressed in days from a reference point (usually visit 1 or enrollment).  The time data was used to compute the accompanying age variable for the case status harmonized variable.
    
    ### Study-specific comments
    
    #### FHS
    Censoring time was obtained by using days from Exam 1 to last exam attended.
    
    VTE event adjudication started January 1, 1995. We use the term "pre-specified exam" to refer to the exam for a given subcohort that was closest to the start of adjudication. The pre-specified exam was Exam 24  for the Original subcohort and Exam 6 for the Offspring subcohort. For all other cohorts, Exam 1 was the pre-specified exam.
    
    Consider subjects for whom there was a recorded event and for whom there was no evidence of events prior to the start of adjudication. If a subject attended the pre-specified exam and the event occurred after the pre-specified exam, the subject was classified as a case. If a subject did not attend the pre-specified exam, the subject was classified as a case if the number of days to the event was greater than the number of days to the exam immediately following the pre-specified exam or if the number of days to the event was outside the range of the pre-specified exam for all subjects in that subcohort; otherwise the harmonized variable was assigned as missing.
    
    #### HVH
    
    For this case-control study, the case-control study component variable identified three other conditions besides VTE ( myocardial infarction, atrial fibrillation, and stroke) and subjects identified as controls were free of any of these conditions at the time of initial inclusion in the study. Some subjects initially selected as controls could later be found to have a condition and were then also identified as a case for that condition with a later index date. 
    
    All subjects indicated as a case for VTE by the case-control component study variable were assigned case status; there were no prior events for these subjects nor multiple incident events. The corresponding age variable was assigned the given age at the VTE event.
    
    Subjects indicated as controls by the case-control study variable were assigned control status only if there was no entry indicating later case status for VTE. The corresponding age variable for these subjects was assigned the given age at the latest index date for which the subject was recorded as a control.
    
    #### Mayo_VTE
    
    For cases, the corresponding age variable was assigned as the age at the VTE event. For controls (no VTE event), the corresponding age variable was assigned as the age at enrollment. 
    Some subjects had age recorded as ">89". For these subjects, age was harmonized as 90.
    
    ### Adjudication or medical review process
    
    Below are references to documentation for descriptions of the medical review process for the studies.
    
    ##### FHS
    * dbGaP study accession: phs000007.v29
    * document name/document accession: Venous Thrombosis Review: Protocol / phd007074.1
    
    
    ##### WHI
    * dbGaP study accession: phs000200.v11
    * document name/document accession:
         * Section 1: Introduction to WHI outcomes / phd001942.1
         * Section 8: Other outcomes / phd001949.1
    	 * WHI Extension Study Protocol: Section 8 - Outcomes /phd004180.2 and phd004182.2
    
    ##### HVH
    * dbGaP study accession: phs001013.v3
    * document name/document accession: Manual of operations / phd005482.2
    
    ##### Mayo_VTE
    * dbGaP study accession: phs000289.v2
    * document name/document accession: Manual for recruitment and data entry / phd003193.1
    
    ##### ARIC and CHS
    VTE data for *_ARIC_* (phs000280) and *_CHS_* (phs000287) was from the _LITE_ project (Longitudinal Investigation of Thromboembolism Etiology). The _LITE_ study design, methods, and VTE incidence rates are reported in references 1 and 2 below [^1] [^2].
    
    In addition, brief descriptions for each of the studies can be found in Table S1 (Main Design and Sample Characteristics of the Analyzed VTE studies) of reference 3 [^3] below.
    
    
    ### Additional information for users of TOPMed data 
    
    For cohort studies with subcohort structure or differing protocols for certain subgroups, matching of cases and controls within a study should be done within each subcohort or subgroup and the subgroup/subcohort structure should be included as a covariate in analyses. For the studies with subcohorts, the variable `subcohort_1` in the DCC harmonized demographic dataset identifies the subcohorts. 
    
    Ascertainment of subjects for TOPMed sequencing in some of these studies favored certain conditions related to VTE processes (e.g. stroke and atrial fibrillation). In these situations, analysts should consider excluding controls with a history of these conditions from analyses.
    The following provides additional information  for individual studies. 
    
    #### WHI
    Two subgroups were defined as subjects in the Hormone Replacement Therapy trial (HRT) and subjects in the Medical Records Cohort (MRC) but not in HRT. The table below lists the dbGaP variables needed to identify these subgroups. Ascertainment for TOPMed sequencing favored stroke cases. The table includes dbGaP variables that identify stroke cases.
    
    |variable name| description| dataset accession| variable accession|
    |:---:|:---:|:---:|:---:|
    |HRTFLAG| HRT participant| pht001031|phv00080426.v6.p3|
    |EXT2MRC| MRC participant| pht003395| phv00192302.v3.p3|
    |STROKE| indicator of stroke event| pht003407| phv00193202.v3.p3|
    |STROKE| self-report of stroke at screening| pht000998| phv00078478.v6.p3|
    
    #### FHS
    
    *_FHS_* has the following subcohorts: Original, Offspring, New Spouse Offspring, Generation 3, Omni1 and Omni2. Some TOPMed-sequenced subjects for *_FHS_* were selected because they were AFib (atrial fibrillation) cases. The table below gives dbGaP variables needed to identify AFib cases. 
    
    |variable name| description| dataset accession| variable accession|
    |:---:|:---:|:---:|:---:|
    |afx| atrial fibrillation/flutter status   | pht003315| phv00273699.v1.p10|
    
    #### CHS 
    
    CHS has two subcohorts: Old and New.
    
    A selection of VTE cases for *_CHS_* were sequenced for TOPMed freeze5. Additional subjects from *_CHS_* were sequenced in freeze6 but at a different sequencing center. Analysts should check for potential batch effects.
    
    #### ARIC 
    
    *_ARIC_* has no subcohort structure. Some TOPMed sequenced subjects for *_ARIC_* were selected because they were AFib (atrial fibrillation) cases. It should be noted that the AFib cases for *_ARIC_* were sequenced at a different center than the remaining *_ARIC_* subjects.
    
    |variable name| description| dataset accession| variable accession|
    |:---:|:---:|:---:|:---:|
    |AFECGV1| prevalent AFib at visit 1| pht004118 |phv00207561.v1.p1|
    |AFINCBY05| incident AFib any source| pht004118|phv00207568.v1.p1|
    
    #### HVH 
    
    Some TOPMed sequenced subjects for *_HVH_* were selected because they were AFib (atrial fibrillation) cases. It should be noted that the AFib cases for *_HVH_* were sequenced at a different center than the remaining *_HVH_* subjects.
    The encoded value for `ccs` for AFib cases is 4.
    
    |variable name| description| dataset accession| variable accession|
    |:---:|:---:|:---:|:---:|
    |ccs| encoded value case status| pht005311 |phv00259376.v2.p2|
    
    
    
    [^1]: Cushman, M. et al (2004). Deep vein thrombosis and pulmonary embolism in two cohorts: the longitudinal investigation of thromboembolism etiology. Am J Med, 117(1) 19-25.
    
    [^2]: Tsai, A.W. et al (2002). Cardiovascular risk factors and venous thromboembolism incidence: the longitudinal investigation of thromboembolism etiology. Arch Intern Med, 162(10) 1182-1189.
    
    [^3]: Germain, M et al (2015). Meta-analysis of 65,734 individuals identifies TSPAN15 and SLC44A2 as two susceptibility loci for venous thromboembolism. Am J Hum Genet, 96(4) 532-542.
    
<a id="vte_case_status_1-aric"></a>
  * ### vte/vte_case_status_1 -- **ARIC**:
    * 3 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht006485.v1.phv00298125.v1`, `phs000280.v4.pht006485.v1.phv00298126.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # case status for ARIC
        # All ARIC cases were incident (i.e. no previous history)
        # follow-up started at visit1 so age = age at visit1
      
        # get dataset with age at visit 1 information
        # get dataset including the subjects followed for VTE
        # join to keep subjects followed for VTE
      
        dat1 <- phen_list$source_data$pht004063
        dat2 <- phen_list$source_data$pht006485
        dat <- left_join(dat2, dat1)
      
        # change age and time to numeric
        dat$V1AGE01 <- as.numeric(dat$V1AGE01)
        dat$PTime <- as.numeric(dat$PTime)
      
        # event: 0 = no event, 1 = event unprovoked, 2 = event provoked
        # PTime = time to event or censoring, given as days from visit 1
        # compute age = age at visit 1 + days from visit1/365.25
        # keep only non-missing information
      
         dat <- dat %>%
                mutate(vte_case_status = ifelse(event %in% c(1, 2), 1, NA)) %>%
                mutate(vte_case_status = ifelse(event %in% 0, 0, vte_case_status)) %>%
                mutate(age = V1AGE01 + PTime / 365.25 ) %>%
                filter(!is.na(vte_case_status) & !is.na(age)) %>%
                mutate(vte_case_status = as.character(vte_case_status)) %>%
                select(topmed_subject_id, vte_case_status, age)
      
        return(dat)
      }
      ```
<a id="vte_case_status_1-chs"></a>
  * ### vte/vte_case_status_1 -- **CHS**:
    * 4 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht005981.v1.phv00273565.v1`, `phs000287.v6.pht005981.v1.phv00273566.v1`, `phs000287.v6.pht005981.v1.phv00273567.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # case status for CHS
        # some prior history (self-report of DVT or PE at baseline)
      
        # get dataset with age at CHS baseline information
        # get dataset including the subjects followed for VTE
        # join to keep subjects followed for VTE
      
        dat1 <- phen_list$source_data$pht001452
        dat2 <- phen_list$source_data$pht005981
        dat <- left_join(dat2, dat1)
      
        # remove subjects with prior history
        dat <- dat %>% filter(!(vtpehx01 %in% 1))
      
        # change age and days variables to numeric
        dat$AGEBL <- as.numeric(dat$AGEBL)
        dat$ttoevent <- as.numeric(dat$ttoevent)
      
        # assign case status
        # assign age: age at CHS baseline + days from baseline to event/censoring/365.25
        # keep only non-missing information
      
         dat <- dat %>% mutate(vte_case_status = ifelse(vt %in% 1, 1, NA)) %>%
                mutate(vte_case_status = ifelse(vt %in% 0, 0, vte_case_status)) %>%
                mutate(age = AGEBL + ttoevent / 365.25) %>%
                filter(!is.na(vte_case_status) & !is.na(age)) %>%
               mutate(vte_case_status = as.character(vte_case_status)) %>%
               select(topmed_subject_id, vte_case_status, age)
      
        return(dat)
      }
      ```
<a id="vte_case_status_1-fhs_g3nosom12"></a>
  * ### vte/vte_case_status_1 -- **FHS_G3NOSOm12**:
    * 11 component_study_variables: `phs000007.v29.pht003099.v4.phv00177927.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177931.v4`, `phs000007.v29.pht003099.v4.phv00177933.v4`, `phs000007.v29.pht003099.v4.phv00177935.v4`, `phs000007.v29.pht003099.v4.phv00177985.v4`, `phs000007.v29.pht003099.v4.phv00177986.v4`, `phs000007.v29.pht003099.v4.phv00177987.v4`, `phs000007.v29.pht006025.v1.phv00276977.v1`, `phs000007.v29.pht006025.v1.phv00277005.v1`
    * 1 component_harmonized_variables: `vte_prior_history_1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # case status for FHS NOS, Gen3, Omni1, and Omni2
        # follow-up started at visit1
        # Omni1 had Exams 1 - 4, the rest only Exams 1 - 2
      
        # get dataset with sub-cohort indicator and visit information
        # select the given subcohorts: NOS = 2, Gen3 = 3, Omni1 = 7, Omni2 = 72
        # get dataset with VTE event information
        # join
      
        dat1 <- phen_list$source_data$pht003099 %>%
               filter(idtype %in% c(2, 3, 7, 72))
        dat2 <- phen_list$source_data$pht006025
        dat  <- left_join(dat1, dat2)
      
        # filter out prior history
        dat3 <- phen_list$harmonized_data$vte_prior_history_1
        dat <- left_join(dat, dat3)
        dat <- dat %>% filter(!(vte_prior_history_1 %in% 1))
      
        # change age and day variables to numeric
        dat$age1 <- as.numeric(dat$age1)
        dat$EDATE1 <- as.numeric(dat$EDATE1)
        for (i in 2:4){
          v <- paste0("date", i)
          dat[, v] <- as.numeric(dat[, v])
          v2 <- paste0("att", i)
          dat[, v2] <- as.numeric(dat[, v2])
        }
        dat$att1 <- as.numeric(dat$att1)
      
        # determine last exam attended (will need for controls)
        tmp <- as.matrix(dat[, paste0("att", 1:4)])
        w <- apply(tmp, 1, function(x) max(which(x %in% 1)))
        dat$last_exam <- w
      
        # define variable = days from visit1 to last exam
        for (i in 1:nrow(dat)){
          if (dat$last_exam[i] == 1){
            dat$days_last[i] <- 0
          } else {
            dat$days_last[i] <- dat[i, paste0("date", dat$last_exam[i])]
          }
        }
      
        # case status indicator
        dat <- dat %>% mutate(vte_case_status = ifelse(EVENT1 %in% c(1, 2, 3), 1, 0))
      
        # filter out controls if last exam is only at baseline visit1
        dat <- dat %>%
               filter(!(vte_case_status %in% 0 & last_exam == 1))
      
        #  for control age = age at last exam = age visit1 + date last exam/365.25
        #  for case age = age visit1 + days visit 1 to event/365.25
      
        dat <- dat %>%
               mutate(age = ifelse(vte_case_status %in% 1, age1 + EDATE1 / 365.25, NA)) %>%
               mutate(age = ifelse(vte_case_status %in% 0, age1 + days_last / 365.25, age)) %>%
               filter(!is.na(vte_case_status) & !is.na(age)) %>%
               mutate(vte_case_status = as.character(vte_case_status)) %>%
               select(topmed_subject_id, vte_case_status, age)
      
        return(dat)
      }
      ```
<a id="vte_case_status_1-fhs_offspring"></a>
  * ### vte/vte_case_status_1 -- **FHS_Offspring**:
    * 21 component_study_variables: `phs000007.v29.pht003099.v4.phv00177927.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177931.v4`, `phs000007.v29.pht003099.v4.phv00177933.v4`, `phs000007.v29.pht003099.v4.phv00177935.v4`, `phs000007.v29.pht003099.v4.phv00177937.v4`, `phs000007.v29.pht003099.v4.phv00177939.v4`, `phs000007.v29.pht003099.v4.phv00177941.v4`, `phs000007.v29.pht003099.v4.phv00177943.v4`, `phs000007.v29.pht003099.v4.phv00177945.v4`, `phs000007.v29.pht003099.v4.phv00177985.v4`, `phs000007.v29.pht003099.v4.phv00177986.v4`, `phs000007.v29.pht003099.v4.phv00177987.v4`, `phs000007.v29.pht003099.v4.phv00177988.v4`, `phs000007.v29.pht003099.v4.phv00177989.v4`, `phs000007.v29.pht003099.v4.phv00177990.v4`, `phs000007.v29.pht003099.v4.phv00177991.v4`, `phs000007.v29.pht003099.v4.phv00177992.v4`, `phs000007.v29.pht006025.v1.phv00276977.v1`, `phs000007.v29.pht006025.v1.phv00277005.v1`
    * 1 component_harmonized_variables: `vte_prior_history_1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # previous history for FHS Offspring
        # follow-up started at visit6
      
        # get dataset with sub-cohort indicator and visit information
        # select the given subcohorts: Offspring = 1
        # get dataset with VTE event information
        # join
      
        dat1 <- phen_list$source_data$pht003099 %>%
               filter(idtype %in% 1)
        dat2 <- phen_list$source_data$pht006025
        dat  <- left_join(dat1, dat2)
      
        # get dataset with harmonized vte_prior_history
        dat3 <- phen_list$harmonized_data$vte_prior_history_1
        dat <- left_join(dat, dat3)
      
        # to determine status if did not attend visit 6:
        # find max days for those who did attend visit6 before any exclusions
        max6 <- max(as.numeric(dat$date6), na.rm = TRUE)
      
        # remove subjects with prior history
        dat <- dat %>% filter(!(vte_prior_history_1 %in% 1))
      
        # change age and day variables to numeric
        # Offspring spans visits 1 - 9
        dat$age1 <- as.numeric(dat$age1)
        dat$EDATE1 <- as.numeric(dat$EDATE1)
        for (i in 2:9){
          v <- paste0("date", i)
          dat[, v] <- as.numeric(dat[, v])
          v2 <- paste0("att", i)
          dat[, v2] <- as.numeric(dat[, v2])
        }
        dat$att1 <- as.numeric(dat$att1)
      
        # determine last exam attended (will need for controls)
        tmp <- as.matrix(dat[, paste0("att", 1:9)])
        w <- apply(tmp, 1, function(x) max(which(x %in% 1)))
        dat$last_exam <- w
      
        # define variable = days from visit1 to last exam
        for (i in 1:nrow(dat)){
          if (dat$last_exam[i] == 1){
            dat$days_last[i] <- 0
          } else {
            dat$days_last[i] <- dat[i, paste0("date", dat$last_exam[i])]
          }
        }
      
        dat$vte_case_status <- NA
        dat$age <- NA
      
        # determine case: event and event time (EDATE1) >= visit6 time (date6)
        aa <- dat$EVENT1 %in% c(1, 2, 3)
        a <- aa & !is.na(dat$date6) & dat$EDATE1 >= dat$date6
        dat$vte_case_status[a] <- 1
      
        # event but did not attend visit 6:
        #   check if EDATE1 >= date7 (if attended visit 7)
        #   check if EDATE1 > max(date6) for subjects attending visit6
        b1 <- aa & is.na(dat$date6) & !is.na(dat$date7) & dat$EDATE1 >= dat$date7
        b2 <- aa & is.na(dat$date6) & dat$EDATE1 > max6
        b <- b1 | b2
        dat$vte_case_status[b] <- 1
      
        # determine control: no event and last exam > exam6
        ct <- is.na(dat$EVENT1) & dat$last_exam > 6
        dat$vte_case_status[ct] <- 0
      
        # age for cases = age at event = age1 + EDATE1/365.25
        # age for controls = age1 + days to last exam/365.25
        #  will not keep missing
      
        s1 <- dat$vte_case_status %in% 1
        dat$age[s1] <- dat$age1[s1] + dat$EDATE1[s1] / 365.25
        s2 <- dat$vte_case_status %in% 0
        dat$age[s2] <- dat$age1[s2] + dat$days_last[s2] / 365.25
      
        dat <- dat %>%
               filter(!is.na(vte_case_status) & !is.na(age)) %>%
               mutate(vte_case_status = as.character(vte_case_status)) %>%
               select(topmed_subject_id, vte_case_status, age)
      
        return(dat)
      }
      ```
<a id="vte_case_status_1-fhs_original"></a>
  * ### vte/vte_case_status_1 -- **FHS_Original**:
    * 67 component_study_variables: `phs000007.v29.pht003099.v4.phv00177927.v4`, `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177931.v4`, `phs000007.v29.pht003099.v4.phv00177933.v4`, `phs000007.v29.pht003099.v4.phv00177935.v4`, `phs000007.v29.pht003099.v4.phv00177937.v4`, `phs000007.v29.pht003099.v4.phv00177939.v4`, `phs000007.v29.pht003099.v4.phv00177941.v4`, `phs000007.v29.pht003099.v4.phv00177943.v4`, `phs000007.v29.pht003099.v4.phv00177945.v4`, `phs000007.v29.pht003099.v4.phv00177947.v4`, `phs000007.v29.pht003099.v4.phv00177949.v4`, `phs000007.v29.pht003099.v4.phv00177951.v4`, `phs000007.v29.pht003099.v4.phv00177953.v4`, `phs000007.v29.pht003099.v4.phv00177955.v4`, `phs000007.v29.pht003099.v4.phv00177957.v4`, `phs000007.v29.pht003099.v4.phv00177959.v4`, `phs000007.v29.pht003099.v4.phv00177961.v4`, `phs000007.v29.pht003099.v4.phv00177963.v4`, `phs000007.v29.pht003099.v4.phv00177965.v4`, `phs000007.v29.pht003099.v4.phv00177967.v4`, `phs000007.v29.pht003099.v4.phv00177969.v4`, `phs000007.v29.pht003099.v4.phv00177971.v4`, `phs000007.v29.pht003099.v4.phv00177973.v4`, `phs000007.v29.pht003099.v4.phv00177975.v4`, `phs000007.v29.pht003099.v4.phv00177977.v4`, `phs000007.v29.pht003099.v4.phv00177979.v4`, `phs000007.v29.pht003099.v4.phv00177981.v4`, `phs000007.v29.pht003099.v4.phv00177983.v4`, `phs000007.v29.pht003099.v4.phv00177985.v4`, `phs000007.v29.pht003099.v4.phv00177986.v4`, `phs000007.v29.pht003099.v4.phv00177987.v4`, `phs000007.v29.pht003099.v4.phv00177988.v4`, `phs000007.v29.pht003099.v4.phv00177989.v4`, `phs000007.v29.pht003099.v4.phv00177990.v4`, `phs000007.v29.pht003099.v4.phv00177991.v4`, `phs000007.v29.pht003099.v4.phv00177992.v4`, `phs000007.v29.pht003099.v4.phv00177993.v4`, `phs000007.v29.pht003099.v4.phv00177994.v4`, `phs000007.v29.pht003099.v4.phv00177995.v4`, `phs000007.v29.pht003099.v4.phv00177996.v4`, `phs000007.v29.pht003099.v4.phv00177997.v4`, `phs000007.v29.pht003099.v4.phv00177998.v4`, `phs000007.v29.pht003099.v4.phv00177999.v4`, `phs000007.v29.pht003099.v4.phv00178000.v4`, `phs000007.v29.pht003099.v4.phv00178001.v4`, `phs000007.v29.pht003099.v4.phv00178002.v4`, `phs000007.v29.pht003099.v4.phv00178003.v4`, `phs000007.v29.pht003099.v4.phv00178004.v4`, `phs000007.v29.pht003099.v4.phv00178005.v4`, `phs000007.v29.pht003099.v4.phv00178006.v4`, `phs000007.v29.pht003099.v4.phv00178007.v4`, `phs000007.v29.pht003099.v4.phv00178008.v4`, `phs000007.v29.pht003099.v4.phv00178009.v4`, `phs000007.v29.pht003099.v4.phv00178010.v4`, `phs000007.v29.pht003099.v4.phv00178011.v4`, `phs000007.v29.pht003099.v4.phv00226997.v1`, `phs000007.v29.pht003099.v4.phv00226998.v1`, `phs000007.v29.pht003099.v4.phv00227000.v1`, `phs000007.v29.pht003099.v4.phv00227001.v1`, `phs000007.v29.pht003099.v4.phv00227003.v1`, `phs000007.v29.pht003099.v4.phv00227004.v1`, `phs000007.v29.pht003099.v4.phv00227006.v1`, `phs000007.v29.pht003099.v4.phv00227007.v1`, `phs000007.v29.pht006025.v1.phv00276977.v1`, `phs000007.v29.pht006025.v1.phv00277005.v1`
    * 1 component_harmonized_variables: `vte_prior_history_1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # previous history for FHS Original
        # follow-up started at visit24
      
        # get dataset with sub-cohort indicator and visit information
        # select the given subcohorts: Original = 0
        # get dataset with VTE event information
        # join
      
        dat1 <- phen_list$source_data$pht003099 %>%
               filter(idtype %in% 0)
        dat2 <- phen_list$source_data$pht006025
        dat  <- left_join(dat1, dat2)
      
        # get dataset with harmonized vte_prior_history
        dat3 <- phen_list$harmonized_data$vte_prior_history_1
        dat <- left_join(dat, dat3)
      
        # to determine status if did not attend visit 24:
        # find max days for those who did attend visit24 before any exclusions
        max24 <- max(as.numeric(dat$date24), na.rm = TRUE)
      
        # remove subjects with prior history
        dat <- dat %>% filter(!(vte_prior_history_1 %in% 1))
      
        # change age and day variables to numeric
        # Original spans visits 1 - 32
        dat$age1 <- as.numeric(dat$age1)
        dat$EDATE1 <- as.numeric(dat$EDATE1)
        for (i in 2:32){
          v <- paste0("date", i)
          dat[, v] <- as.numeric(dat[, v])
          v2 <- paste0("att", i)
          dat[, v2] <- as.numeric(dat[, v2])
        }
        dat$att1 <- as.numeric(dat$att1)
      
        # determine last exam attended (will need for controls)
        tmp <- as.matrix(dat[, paste0("att", 1:32)])
        w <- apply(tmp, 1, function(x) max(which(x %in% 1)))
        dat$last_exam <- w
      
        # define variable = days from visit1 to last exam
        for (i in 1:nrow(dat)){
          if (dat$last_exam[i] == 1){
            dat$days_last[i] <- 0
          } else {
            dat$days_last[i] <- dat[i, paste0("date", dat$last_exam[i])]
          }
        }
      
        dat$vte_case_status <- NA
        dat$age <- NA
      
        # determine case: event and event time (EDATE1) >= visit24 time (date24)
        aa <- dat$EVENT1 %in% c(1, 2, 3)
        a <- aa & !is.na(dat$date24) & dat$EDATE1 >= dat$date24
        dat$vte_case_status[a] <- 1
      
        # event but did not attend visit 24:
        #   check if EDATE1 >= date25 (if attended visit 25)
        #   check if EDATE1 > max(date24) for subjects attending visit24
        b1 <- aa & is.na(dat$date24) & !is.na(dat$date25) & dat$EDATE1 >= dat$date25
        b2 <- aa & is.na(dat$date24) & dat$EDATE1 > max24
        b <- b1 | b2
        dat$vte_case_status[b] <- 1
      
        # determine control: no event and last exam > exam24
        ct <- is.na(dat$EVENT1) & dat$last_exam > 24
        dat$vte_case_status[ct] <- 0
      
        # age for cases = age at event = age1 + EDATE1/365.25
        # age for controls = age1 + days to last exam/365.25
        #  will not keep missing
      
        s1 <- dat$vte_case_status %in% 1
        dat$age[s1] <- dat$age1[s1] + dat$EDATE1[s1] / 365.25
        s2 <- dat$vte_case_status %in% 0
        dat$age[s2] <- dat$age1[s2] + dat$days_last[s2] / 365.25
      
        dat <- dat %>%
               filter(!is.na(vte_case_status) & !is.na(age)) %>%
               mutate(vte_case_status = as.character(vte_case_status)) %>%
               select(topmed_subject_id, vte_case_status, age)
      
        return(dat)
      }
      ```
<a id="vte_case_status_1-hvh"></a>
  * ### vte/vte_case_status_1 -- **HVH**:
    * 4 component_study_variables: `phs001013.v3.pht005311.v2.phv00259376.v2`, `phs001013.v3.pht005311.v2.phv00259377.v2`, `phs001013.v3.pht005311.v2.phv00259378.v2`, `phs001013.v3.pht005311.v2.phv00259384.v2`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # VTE case status for HVH
        # get phenotype dataset
        datt <- phen_list$source_data$pht005311
      
        # choose VTE cases - manual says all are incident
        dat1 <- datt %>% filter(ccs %in% 3)
      
        # take out subjects identified as cases then choose controls from remaining
        # necessary since controls at one time could have event to become case
        dat2 <- anti_join(datt, dat1, by = "topmed_subject_id")
      
          # choose controls from remaining
        dat2 <- dat2 %>% filter(ccs %in% 0)
      
        # some controls have duplicate entries
        # arrange by index year in descending order and choose later year
        dat3 <- dat2 %>% arrange(desc(indexy)) %>% group_by(topmed_subject_id) %>%
                     slice(1)
      
        # further restrict controls to those with index year after the start of recruitment 2002
        #  and remove controls with prior vt indication
        dat3 <- dat3 %>% filter(as.numeric(indexy) >= 2002 & !(priorvt %in% 1))
      
        dat <- rbind(dat1, as.data.frame(dat3))
      
        # create case status indicator
        # age: age in years at date of VT diagnosis (cases) or at selection (controls)
        # keep only non-missing information
      
         dat <- dat %>% mutate(vte_case_status = ifelse(ccs %in% 3, 1, 0)) %>%
                filter(!is.na(vte_case_status) & !is.na(age)) %>%
                mutate(vte_case_status = as.character(vte_case_status)) %>%
                select(topmed_subject_id, vte_case_status, age)
      
        return(dat)
      }
      ```
<a id="vte_case_status_1-mayo_geneva"></a>
  * ### vte/vte_case_status_1 -- **Mayo_GENEVA**:
    * 3 component_study_variables: `phs000289.v2.pht001886.v2.phv00121844.v1`, `phs000289.v2.pht001886.v2.phv00121846.v1`, `phs000289.v2.pht001886.v2.phv00121861.v2`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # VTE case status for Mayo GENEVA study
        # get phenotype dataset
        dat <- phen_list$source_data$pht001886
      
        # case control variable VTE selects
        # create case status indicator; 0 = control, 1 = case
      
        dat <- dat %>% filter(!is.na(phenotype) & phenotype != -9) %>%
                mutate(vte_case_status = ifelse(phenotype == 2, 1, 0))
      
        # age: age at clot for cases, age at enrollment for controls
        # keep only non-missing information
      
         dat <- dat %>% mutate(age = ifelse(vte_case_status %in% 1, age_clot, NA)) %>%
                mutate(age = ifelse(vte_case_status %in% 0, enrollage, age)) %>%
                filter(!is.na(vte_case_status) & !is.na(age)) %>%
                mutate(vte_case_status = as.character(vte_case_status)) %>%
                select(topmed_subject_id, vte_case_status, age)
      
        return(dat)
      }
      ```
<a id="vte_case_status_1-mayo_oc"></a>
  * ### vte/vte_case_status_1 -- **Mayo_OC**:
    * 3 component_study_variables: `phs001402.v1.pht008239.v1.phv00389900.v1`, `phs001402.v1.pht008239.v1.phv00389902.v1`, `phs001402.v1.pht008239.v1.phv00389917.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # VTE case status for Mayo OC study
        # get phenotype dataset
        dat <- phen_list$source_data$pht008239
      
        # case control variable VTE selects
        # create case status indicator; 0 = control, 1 = case
      
        dat <- dat %>% filter(!is.na(phenotype) & phenotype != -9) %>%
                mutate(vte_case_status = ifelse(phenotype == 2, 1, 0))
      
        # age: age at clot for cases, age at enrollment for controls
        # keep only non-missing information
      
         dat <- dat %>% mutate(age = ifelse(vte_case_status %in% 1, age_clot, NA)) %>%
                mutate(age = ifelse(vte_case_status %in% 0, enrollage, age)) %>%
                filter(!is.na(vte_case_status) & !is.na(age)) %>%
                mutate(vte_case_status = as.character(vte_case_status)) %>%
                select(topmed_subject_id, vte_case_status, age)
      
        # change age value ">89" to 90
         dat$age[dat$age %in% ">89"] <- 90
      
        return(dat)
      }
      ```
<a id="vte_case_status_1-whi_hrt"></a>
  * ### vte/vte_case_status_1 -- **WHI_HRT**:
    * 8 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001031.v6.phv00080426.v6`, `phs000200.v11.pht003407.v3.phv00193178.v3`, `phs000200.v11.pht003407.v3.phv00193179.v3`, `phs000200.v11.pht003407.v3.phv00193193.v3`, `phs000200.v11.pht003407.v3.phv00193194.v3`, `phs000200.v11.pht003407.v3.phv00193505.v3`
    * 1 component_harmonized_variables: `vte_prior_history_1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # VTE case status
        # follow-up started at baseline
        # age = age at enrollment + (days from enrollment to event or censoring)/365.25
      
        # get dataset with screening information
        dat1 <- phen_list$source_data$pht000998
      
        # get dataset with membership flags and select HRT participants
        # combine datasets
        dat2 <- phen_list$source_data$pht001031 %>% filter(HRTFLAG %in% 1)
        datt <- left_join(dat2, dat1)
      
        # get previous history data set
        # filter out subjects with known or self-reported previous VTE history
        dath <- phen_list$harmonized_data$vte_prior_history_1
        datt <- left_join(datt, dath)
        dat <- datt %>% filter(!(vte_prior_history_1 %in% 1))
      
        # get dataset with outcomes and combine with previous
        outc <- phen_list$source_data$pht003407
        dat <- left_join(dat, outc)
      
        # AGE is measured at screening on form F2
        # abs(F2DAYS) is days between screening and enrollment
        # do not use F2DAYS when F2DAYS > 0
        # correct for erroneous F2DAYS being positive
        dat$F2DAYS <- as.numeric(dat$F2DAYS)
        dat$F2DAYS[dat$F2DAYS > 0] <- 0
      
        # case/control status: case = either DVT or PE or both
        # controls: not known to have VTE event
        dat <- dat %>% mutate(vte_case_status = ifelse( (DVT %in% 1 | PE %in% 1), 1, 0))
      
        # change age and days variables to numeric
        dat$AGE <- as.numeric(dat$AGE)
        dat$DVTDY <- as.numeric(dat$DVTDY)
        dat$PEDY <- as.numeric(dat$PEDY)
        dat$ENDFOLLOWDY <- as.numeric(dat$ENDFOLLOWDY)
      
        dat$age <- NA
        # age for CASES
        # age at event: age at enrollment + (days to event)/365.25
        # age at enrollment is age at screening + |F2DAYS|
        # if both types of events happen, choose the days to earliest event
      
        sel <- dat$vte_case_status %in% 1
        dat$age[sel] <- dat$AGE[sel] +
           (abs(dat$F2DAYS[sel]) + pmin(dat$PEDY[sel], dat$DVTDY[sel], na.rm = TRUE)) / 365.25
      
        # age for CONTROLS = age at enrollment + (days to end of followup)/365.25
        dat$age[!sel] <- dat$AGE[!sel] + (abs(dat$F2DAYS[!sel]) + dat$ENDFOLLOWDY[!sel]) / 365.25
      
        # final selection
        dat <- dat %>% filter(!is.na(vte_case_status) & !is.na(age)) %>%
               mutate(vte_case_status = as.character(vte_case_status)) %>%
               select(topmed_subject_id, vte_case_status, age)
        return(dat)
      }
      ```
<a id="vte_case_status_1-whi_mrcnonhrt"></a>
  * ### vte/vte_case_status_1 -- **WHI_MRCnonHRT**:
    * 10 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001031.v6.phv00080426.v6`, `phs000200.v11.pht003395.v3.phv00192301.v3`, `phs000200.v11.pht003395.v3.phv00192302.v3`, `phs000200.v11.pht003407.v3.phv00193178.v3`, `phs000200.v11.pht003407.v3.phv00193179.v3`, `phs000200.v11.pht003407.v3.phv00193193.v3`, `phs000200.v11.pht003407.v3.phv00193194.v3`, `phs000200.v11.pht003407.v3.phv00193505.v3`
    * 1 component_harmonized_variables: `vte_prior_history_1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # previous history for WHI MRC non-HRT participants
        # follow-up started at beginning of Extension 2
      
        # get dataset with screening information
        dat1 <- phen_list$source_data$pht000998
      
        # get datasets with membership flags and combine
        dat2 <- phen_list$source_data$pht001031
        dat3 <- phen_list$source_data$pht003395
        datt <- full_join(dat3, dat2)
      
        # select subjects in MRC but not in HRT
        datt <- datt %>% filter(EXT2MRC %in% 1 & HRTFLAG %in% 0)
      
        # combine with screening info
        datt <- left_join(datt, dat1)
      
        # get previous history data set
        # filter out subjects with known or self-reported previous VTE history
        dath <- phen_list$harmonized_data$vte_prior_history_1
        datt <- left_join(datt, dath)
        dat <- datt %>% filter(!(vte_prior_history_1 %in% 1))
      
        # get dataset with outcomes and combine with previous
        outc <- phen_list$source_data$pht003407
        dat <- left_join(dat, outc)
      
        # AGE is measured at screening on form F2
        # abs(F2DAYS) is days between screening and enrollment
        # do not use F2DAYS when F2DAYS > 0
        # correct for erroneous F2DAYS being positive
        dat$F2DAYS <- as.numeric(dat$F2DAYS)
        dat$F2DAYS[dat$F2DAYS > 0] <- 0
      
        # case/control status: case = either DVT or PE or both
        # controls: not known to have VTE event
        dat <- dat %>% mutate(vte_case_status = ifelse( (DVT %in% 1 | PE %in% 1), 1, 0))
      
        # change age and days variables to numeric
        dat$AGE <- as.numeric(dat$AGE)
        dat$DVTDY <- as.numeric(dat$DVTDY)
        dat$PEDY <- as.numeric(dat$PEDY)
        dat$ENDFOLLOWDY <- as.numeric(dat$ENDFOLLOWDY)
        dat$EXT2DAYS <- as.numeric(dat$EXT2DAYS)
      
        # age for CASES
        # age at event: age at enrollment + (days to event)/365.25
        # age at enrollment is age at screening + |F2DAYS|
        # if both types of events happen, choose the days to earliest event
      
        dat$age <- NA
        sel <- dat$vte_case_status %in% 1
        dat$age[sel] <- dat$AGE[sel] +
           (abs(dat$F2DAYS[sel]) + pmin(dat$PEDY[sel], dat$DVTDY[sel], na.rm = TRUE)) / 365.25
      
        # age for CONTROLS = age at enrollment + (days to end of followup)/365.25
        # don't include subjects whose last followup is before EXT2
        sel2 <- !is.na(dat$ENDFOLLOWDY) & !is.na(dat$EXT2DAYS) & dat$ENDFOLLOWDY > dat$EXT2DAYS
        sel3 <- !sel & sel2
        dat$age[sel3] <- dat$AGE[sel3] + (abs(dat$F2DAYS[sel3]) + dat$ENDFOLLOWDY[sel3]) / 365.25
      
        # final selection
        dat <- dat %>% filter(!is.na(vte_case_status) & !is.na(age)) %>%
               mutate(vte_case_status = as.character(vte_case_status)) %>%
               select(topmed_subject_id, vte_case_status, age)
        return(dat)
      }
      ```
<a id="vte_followup_start_age_1"></a>
## vte: **vte_followup_start_age_1** (vte_followup_start_age)
  Age of subject at the start of the follow up period during which venous thromboembolism (VTE) events were reviewed and adjudicated.
  * **Harmonization Units**:
    * [ARIC](#vte_followup_start_age_1-aric)
    * [CHS](#vte_followup_start_age_1-chs)
    * [FHS_G3NOSOm12](#vte_followup_start_age_1-fhs_g3nosom12)
    * [FHS_Offspring](#vte_followup_start_age_1-fhs_offspring)
    * [FHS_Original](#vte_followup_start_age_1-fhs_original)
    * [WHI_HRT](#vte_followup_start_age_1-whi_hrt)
    * [WHI_MRCnonHRT](#vte_followup_start_age_1-whi_mrcnonhrt)
  * **Metadata**:
    **`Data Type`**: decimal, **`Measurement Units`**: years, **`Version`**: 1, **`Has Age Variable`**: No, **`Date Harmonized`**: 2018-10-29 15:19:09
  * **DCC Harmonization Comments**:

    This phenotype is harmonized for the large cohort studies to facilitate the creation of age strata to be used in matching cases and controls within a study.
    
    For studies/sub-cohorts where the adjudication started at the beginning of the study, the age at enrollment into the study was used. For studies/sub-cohorts where the adjudication started at a later time point, harmonization was specific to the study. In general, the ages were computed as: 
    ```
          age at reference time + (days between reference time and adjudication start) / 365.25
    ```
    For more details on adjudication processes, see the analyst comments for the harmonized case status variable.
    
    ### Study-specific comments
    
    #### WHI
    
    VTE events were adjudicated from the start of the study for subjects in the HRT (hormone replacement therapy) trial. The harmonized variable for HRT subjects was set to the age at enrollment, which was computed from age at screening and days between screening and enrollment.
    
    VTE events for subjects from the MRC (medical records cohort; not in the HRT trial) were adjudicated starting with the beginning of Extension 2.  For these MRC subjects, the harmonized variable was set to the age at the beginning of Extension 2, computed from age at enrollment and the days between enrollment and the start of Extension 2.
    
    #### FHS
    ##### Original and Offspring sub-cohorts
     
    VTE event adjudication started January 1, 1995. For the Original sub-cohort, the exam closest to the start was Exam 24. For the Offspring sub-cohort, the exam closest to the start was Exam 6. If a subject attended the pre-specified exam, the age at the start of adjudication was computed using the age at Exam 1 and the number of days between Exam 1 and the pre-specified exam. If a subject did not attend the pre-specified exam but did attend either the exam immediately preceding or immediately following the pre-specified exam, the number of days to the pre-specified exam was approximated using the average number of days between exams over all subjects who did attend the pre-specified exam. If a subject did not attend either the pre-specified exam or the immediately preceding or following exam, no age was assigned.
    
    (Note that for the Generation 3, New Offspring Spouse, Omni1 and Omni2 cohorts, adjudication started at Exam 1 so the harmonized variable was set to the age at Exam 1.)
    
<a id="vte_followup_start_age_1-aric"></a>
  * ### vte/vte_followup_start_age_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht006485.v1.phv00298125.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # age at start of VTE follow-up for ARIC
        # follow-up started at visit1 so age = age at visit1
      
        # get dataset with age at visit 1 information
        # get dataset including the subjects followed for VTE
        # join to keep subjects followed for VTE
      
        dat1 <- phen_list$source_data$pht004063
        dat2 <- phen_list$source_data$pht006485
        dat <- left_join(dat2, dat1)
      
        # assign age as age at visit 1
        # keep only non-missing information
      
         dat <- dat %>% mutate(vte_followup_start_age = as.numeric(V1AGE01)) %>%
               filter(!is.na(vte_followup_start_age)) %>%
               select(topmed_subject_id, vte_followup_start_age)
      
        return(dat)
      }
      ```
<a id="vte_followup_start_age_1-chs"></a>
  * ### vte/vte_followup_start_age_1 -- **CHS**:
    * 1 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # age at start of VTE follow-up for CHS
        # follow-up started at baseline so age = age at CHS baseline
      
        # get dataset with age at CHS baseline information
      
        dat <- phen_list$source_data$pht001452
      
        # assign age as age at CHS baseline
        # keep only non-missing information
      
         dat <- dat %>% mutate(vte_followup_start_age = as.numeric(AGEBL)) %>%
               filter(!is.na(vte_followup_start_age)) %>%
               select(topmed_subject_id, vte_followup_start_age)
      
        return(dat)
      }
      ```
<a id="vte_followup_start_age_1-fhs_g3nosom12"></a>
  * ### vte/vte_followup_start_age_1 -- **FHS_G3NOSOm12**:
    * 2 component_study_variables: `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # age at start of VTE follow-up for FHS NOS, Gen3, Omni1, and Omni2
        # follow-up started at visit1 so age = age at visit1
      
        # get dataset with sub-cohort indicator and visit information
        # select the given subcohorts: NOS = 2, Gen3 = 3, Omni1 = 7, Omni2 = 72
        # assign age as age at visit 1
        # keep only non-missing information
      
        dat <- phen_list$source_data$pht003099 %>%
               filter(idtype %in% c(2, 3, 7, 72)) %>%
               mutate(vte_followup_start_age = as.numeric(age1)) %>%
               filter(!is.na(vte_followup_start_age)) %>%
               select(topmed_subject_id, vte_followup_start_age)
      
        return(dat)
      }
      ```
<a id="vte_followup_start_age_1-fhs_offspring"></a>
  * ### vte/vte_followup_start_age_1 -- **FHS_Offspring**:
    * 8 component_study_variables: `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177937.v4`, `phs000007.v29.pht003099.v4.phv00177939.v4`, `phs000007.v29.pht003099.v4.phv00177941.v4`, `phs000007.v29.pht003099.v4.phv00177988.v4`, `phs000007.v29.pht003099.v4.phv00177989.v4`, `phs000007.v29.pht003099.v4.phv00177990.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # age at start of VTE follow-up for FHS Offspring
        # follow-up started at visit6 so age = age at visit6
        # unless subject did not attend visit6 - will then need to approximate
        # will use visit5 and/or visit7 in approximation
      
        # get dataset with sub-cohort indicator and visit information
        # select the given subcohorts: idtype for Offspring = 1
      
        dat <- phen_list$source_data$pht003099 %>%
               filter(idtype %in% 1)
      
        # change age and days to numeric
        dat$age1 <- as.numeric(dat$age1)
        dat$date6 <- as.numeric(dat$date6)
        dat$date5 <- as.numeric(dat$date5)
        dat$date7 <- as.numeric(dat$date7)
      
        # approximate date6 for subjects that did not attend visit6
        # find average number of days between visit5 and visit6
        #   for subjects attending both visit5 and visit6
        # find average number of days between visit7 and visit6
        #   for subjects attending both visit7 and visit6
      
        days56 <- mean(dat$date6 - dat$date5, na.rm = TRUE)
        days67 <- mean(dat$date7 - dat$date6, na.rm = TRUE)
      
        a <- dat$att6 %in% 0
        b1 <- dat$att5 %in% 1
        b2 <- dat$att7 %in% 1
      
        # approximate date6 for subjects not attending visit6
        # use days56 if attended visit 5 but not 7
        s1 <- a & b1 & !b2
        dat$date6[s1] <- dat$date5[s1] + days56
      
        # use days67 if attended visit 7 but not 5
        s2 <- a & !b1 & b2
        dat$date6[s2] <- dat$date7[s2] - days67
      
        # use average if attended both 5 and 7
        s3 <- a & b1 & b2
        tmp <- rbind(dat$date5[s3] + days56, dat$date7[s3] - days67)
        dat$date6[s3] <- colMeans(tmp)
      
        # assign age at vte followup start as age at visit6 (some approximate)
        # if did not attend visit 5 or 6 or 7, will be missing and then deleted
        dat <- dat %>%
               mutate(vte_followup_start_age = age1 + date6 / 365.25) %>%
               filter(!is.na(vte_followup_start_age)) %>%
               select(topmed_subject_id, vte_followup_start_age)
      
        return(dat)
      }
      ```
<a id="vte_followup_start_age_1-fhs_original"></a>
  * ### vte/vte_followup_start_age_1 -- **FHS_Original**:
    * 8 component_study_variables: `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177973.v4`, `phs000007.v29.pht003099.v4.phv00177975.v4`, `phs000007.v29.pht003099.v4.phv00177977.v4`, `phs000007.v29.pht003099.v4.phv00178006.v4`, `phs000007.v29.pht003099.v4.phv00178007.v4`, `phs000007.v29.pht003099.v4.phv00178008.v4`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # age at start of VTE follow-up for FHS Original
        # follow-up started at visit24 so age = age at visit24
        # unless subject did not attend visit24 - will then need to approximate
        # will use visit23 and/or visit25 in approximation
      
        # get dataset with sub-cohort indicator and visit information
        # select the given subcohorts: idtype for Original = 0
      
        dat <- phen_list$source_data$pht003099 %>%
               filter(idtype %in% 0)
      
        # change age and days to numeric
        dat$age1 <- as.numeric(dat$age1)
        dat$date24 <- as.numeric(dat$date24)
        dat$date23 <- as.numeric(dat$date23)
        dat$date25 <- as.numeric(dat$date25)
      
        # approximate date24 for subjects that did not attend visit24
        # find average number of days between visit23 and visit24
        #   for subjects attending both visit23 and visit24
        # find average number of days between visit25 and visit24
        #   for subjects attending both visit25 and visit24
      
        days2324 <- mean(dat$date24 - dat$date23, na.rm = TRUE)
        days2425 <- mean(dat$date25 - dat$date24, na.rm = TRUE)
      
        a <- dat$att24 %in% 0
        b1 <- dat$att23 %in% 1
        b2 <- dat$att25 %in% 1
      
        # approximate date24 for subjects not attending visit24
        # use days2324 if attended visit 23 but not 25
        s1 <- a & b1 & !b2
        dat$date24[s1] <- dat$date23[s1] + days2324
      
        # use days2425 if attended visit 25 but not 23
        s2 <- a & !b1 & b2
        dat$date24[s2] <- dat$date25[s2] - days2425
      
        # use average if attended both 23 and 25
        s3 <- a & b1 & b2
        tmp <- rbind(dat$date23[s3] + days2324, dat$date25[s3] - days2425)
        dat$date24[s3] <- colMeans(tmp)
      
        # assign age at vte followup start as age at visit24 (some approximate)
        # if did not attend visit23 or 24 or 25, will be missing and then deleted
        dat <- dat %>%
               mutate(vte_followup_start_age = age1 + date24 / 365.25) %>%
               filter(!is.na(vte_followup_start_age)) %>%
               select(topmed_subject_id, vte_followup_start_age)
      
        return(dat)
      }
      ```
<a id="vte_followup_start_age_1-whi_hrt"></a>
  * ### vte/vte_followup_start_age_1 -- **WHI_HRT**:
    * 3 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001031.v6.phv00080426.v6`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # age at start of VTE follow-up for WHI HRT participants
        # follow-up started at baseline so age = age at enrollment
      
        # get dataset with screening information
        # get dataset with membership flags and select HRT participants
        # combine datasets
      
        dat1 <- phen_list$source_data$pht000998
        dat2 <- phen_list$source_data$pht001031 %>% filter(HRTFLAG %in% 1)
        dat <- left_join(dat2, dat1)
      
        # create desired age variable = age at enrollment
        # AGE is measured at screening on form F2
        # abs(F2DAYS) is days between screening and enrollment
        # do not use F2DAYS when F2DAYS > 0
      
        dat$F2DAYS <- as.numeric(dat$F2DAYS)
        dat$AGE <- as.numeric(dat$AGE)
      
        dat <- dat %>%
               mutate(F2DAYS = ifelse(F2DAYS > 0, 0, F2DAYS)) %>%
               mutate(vte_followup_start_age = AGE + abs(F2DAYS) / 365.25) %>%
               filter(!is.na(vte_followup_start_age)) %>%
               select(topmed_subject_id, vte_followup_start_age)
      
        return(dat)
      }
      ```
<a id="vte_followup_start_age_1-whi_mrcnonhrt"></a>
  * ### vte/vte_followup_start_age_1 -- **WHI_MRCnonHRT**:
    * 5 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht001031.v6.phv00080426.v6`, `phs000200.v11.pht003395.v3.phv00192301.v3`, `phs000200.v11.pht003395.v3.phv00192302.v3`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
        # age at start of VTE follow-up for WHI MRC non-HRT participants
        # follow-up started at beginning of Extension 2
        # so age = age at enrollment + (days to Ext2)/365.25
      
        # get dataset with screening information to compute age at enrollment
        dat1 <- phen_list$source_data$pht000998
      
        # get datasets with membership flags and combine
        dat2 <- phen_list$source_data$pht001031  # HRTFLAG
        dat3 <- phen_list$source_data$pht003395  # EXT2MRC, EXT2DAYS
        datt <- full_join(dat3, dat2)
      
        # select subjects in MRC but not in HRT
        datt <- datt %>% filter(EXT2MRC %in% 1 & HRTFLAG %in% 0)
      
        # combine with screening info
        dat <- left_join(datt, dat1)
      
        # create desired age variable = age at enrollment + (days to Ext2)/365.25
        # AGE is measured at screening on form F2
        # abs(F2DAYS) is days between screening and enrollment
        # do not use F2DAYS when F2DAYS > 0
        # age at enrollment = AGE + abs(F2DAYS)/365.25
      
        # change to numeric variables
        dat$F2DAYS <- as.numeric(dat$F2DAYS)
        dat$AGE <- as.numeric(dat$AGE)
        dat$EXT2DAYS <- as.numeric(dat$EXT2DAYS)
      
        dat <- dat %>%
               mutate(F2DAYS = ifelse(F2DAYS > 0, 0, F2DAYS)) %>%
               mutate(vte_followup_start_age = AGE + (abs(F2DAYS) + EXT2DAYS) / 365.25) %>%
               filter(!is.na(vte_followup_start_age)) %>%
               select(topmed_subject_id, vte_followup_start_age)
      
        return(dat)
      }
      ```
<a id="vte_prior_history_1"></a>
## vte: **vte_prior_history_1** (vte_prior_history)
  An indicator of whether a subject had a venous thromboembolism (VTE) event prior to the start of the medical review process (including self-reported events).
  * **Harmonization Units**:
    * [ARIC](#vte_prior_history_1-aric)
    * [CHS](#vte_prior_history_1-chs)
    * [FHS_G3NOSOm12](#vte_prior_history_1-fhs_g3nosom12)
    * [FHS_Offspring](#vte_prior_history_1-fhs_offspring)
    * [FHS_Original](#vte_prior_history_1-fhs_original)
    * [HVH](#vte_prior_history_1-hvh)
    * [WHI_HRT](#vte_prior_history_1-whi_hrt)
    * [WHI_MRCnonHRT](#vte_prior_history_1-whi_mrcnonhrt)
  * **Metadata**:
    **`Data Type`**: encoded, **`Measurement Units`**: None, **`Version`**: 1, **`Has Age Variable`**: Yes, **`Date Harmonized`**: 2018-11-01 07:54:04
  * **Controlled Vocabulary**:
    `Source:` UMLS, `Version:` 2019AA, `ID:` C4540929
  * **DCC Harmonization Comments**:

    Venous thromboembolism (VTE) events include deep vein thrombosis (DVT) or pulmonary embolism (PE). If data included variable(s) distinguishing the type, information about the first event of either type was used. 
    
    The main task in creating this variable was to determine whether or not a VTE event occurred before the start of adjudication or the medical review process. For some studies, this information was obtained through self-report (questionnaire). For these studies, the corresponding age variable was chosen as the age at which the questionnaire was administered. The harmonized variable and corresponding age were set to missing if a subject did not answer the relevant questions.
    
    For some studies where adjudication/medical review occurred at enrollment into the study, the dataset contained a variable indicating prior event or not. The corresponding age variable was recorded as the age at enrollment.
    
    For other studies, time to event information was provided in the form of days from some reference point (usually visit 1 or enrollment in the study) to the event. For these studies, if an event was recorded, the number of days from the reference point to the event was compared with the number of days from the reference point to the the start of adjudication or review. If the event was determined to have happened before the start of adjudication or review, the subject  was classified as having a prior event and the corresponding age variable was assigned the age at event, calculated using the age at the reference point plus the time to the event. If the event was determined to have happened after the start of adjudication or review, the subject was classified as not having a prior event and the corresponding age variable was assigned as the age at the start of adjudication/medical review. If there was no event recorded, the subject was classified as not having a prior event and the corresponding age variable was assigned as the age at the start of adjudication/medical review.
    
    ### Study-specific comments
    
    #### WHI
    ##### HRT (Hormone replacement therapy)
    
    Medical review (adjudication) began at enrollment. Prior history information was self-report, obtained from a questionnaire at screening. 
    
    ##### MRC-nonHRT (Medical Records cohort but not enrolled in HRT)
    
    Medical review (adjudication) began at the start of Extension 2. Prior event history was determined from a combination of self-report at screening and time to event information for recorded events during the study but before the start of adjudication.
    
    #### FHS
    ##### Generation 3, New Offspring Spouse, Omni1 and Omni2
    
    Adjudication started at Exam 1. Time to event data was provided and prior events were determined by days to event being negative.
    
    ##### Original and Offspring 
     
    VTE event adjudication started January 1, 1995. We use the term "pre-specified exam" to refer to the exam for a given subcohort that was closest to the start of adjudication. The pre-specified exam was Exam 24 for the Original subcohort and Exam 6 for the Offspring subcohort.
    
    For these subcohorts, a recorded event could be classified as prior, not prior, or indeterminate. If a subject attended the pre-specified exam, then prior or not prior could be readily established. For some subjects with recorded events who did not attend the pre-specified exam, it could not be determined if the recorded event was before or after the start of adjudication. For a subject who did not attend the pre-specified exam, a combination of the following information was used to classify the event as prior, not prior, or indeterminate: days from Exam 1 to event, days from Exam 1 to the exam immediately preceding the pre-specified exam, days from Exam 1 to the exam immediately following the pre-specified exam, and the minimum and maximum number of days from Exam 1 to the pre-specified exam calculated over all subjects in the subcohort who attended the pre-specified exam. If a subject's recorded event was classified as indeterminate, the harmonized variable and corresponding age were set to missing.
    
    ##### CHS 
    
    Adjudication started at the baseline exam for each of the *_CHS_* subcohorts. *_CHS_* dbGaP data included a variable indicating self-report of prior VTE event. Age at the respective baseline exams was used for the corresponding age variable.
    
    ##### ARIC 
    
    Adjudication started at Visit 1. Study investigators confirmed that subjects included in the VTE sub-study had no history of VTE.
    
    ##### HVH 
    
    This is a case-control study. The dbGaP dataset included variables indicating prior VTE and appropriate age. 
    
    ##### Mayo_VTE 
    
    This is a case-control study. There was no information relevant to prior history so values for this variable and the corresponding age variable were assigned as missing.
    
    
<a id="vte_prior_history_1-aric"></a>
  * ### vte/vte_prior_history_1 -- **ARIC**:
    * 2 component_study_variables: `phs000280.v4.pht004063.v2.phv00204712.v1`, `phs000280.v4.pht006485.v1.phv00298125.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # prior VTE history for ARIC
        # All ARIC cases were incident (i.e. no previous history)
        # follow-up started at visit1 so age = age at visit1
      
        # get dataset with age at visit 1 information
        # get dataset including the subjects followed for VTE
        # join to keep subjects followed for VTE
      
        dat1 <- phen_list$source_data$pht004063
        dat2 <- phen_list$source_data$pht006485
        dat <- left_join(dat2, dat1)
      
        # assign 0 to prior history indicator
        # assign age as age at visit 1
        # keep only non-missing information
      
         dat <- dat %>% mutate(vte_prior_history = "0") %>%
                mutate(age = V1AGE01) %>%
                filter(!is.na(vte_prior_history) & !is.na(age)) %>%
                select(topmed_subject_id, vte_prior_history, age)
      
        return(dat)
      }
      ```
<a id="vte_prior_history_1-chs"></a>
  * ### vte/vte_prior_history_1 -- **CHS**:
    * 2 component_study_variables: `phs000287.v6.pht001452.v1.phv00100487.v1`, `phs000287.v6.pht005981.v1.phv00273567.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # prior VTE history for CHS
        # some self-report of DVT or PE at baseline
      
        # get dataset with age at CHS baseline information
        # get dataset including the subjects followed for VTE
        # join to keep subjects followed for VTE
      
        dat1 <- phen_list$source_data$pht001452
        dat2 <- phen_list$source_data$pht005981
        dat <- left_join(dat2, dat1)
      
        # use self-report indicator: 0 (no), 1 (yes), or missing code
        # follow-up started at CHS baseline so age = age at CHS baseline
        # keep only non-missing information
      
         dat <- dat %>% mutate(vte_prior_history = as.character(vtpehx01)) %>%
                mutate(age = AGEBL) %>%
                filter(is.element(vte_prior_history, c(0, 1)) & !is.na(age)) %>%
                select(topmed_subject_id, vte_prior_history, age)
      
        return(dat)
      }
      ```
<a id="vte_prior_history_1-fhs_g3nosom12"></a>
  * ### vte/vte_prior_history_1 -- **FHS_G3NOSOm12**:
    * 4 component_study_variables: `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht006025.v1.phv00276977.v1`, `phs000007.v29.pht006025.v1.phv00277005.v1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # prior history for FHS NOS, Gen3, Omni1, and Omni2
        # follow-up started at visit1 so
      
        # get dataset with sub-cohort indicator and visit information
        # select the given subcohorts: NOS = 2, Gen3 = 3, Omni1 = 7, Omni2 = 72
        # get dataset with VTE event information
        # join
      
        dat1 <- phen_list$source_data$pht003099 %>%
               filter(idtype %in% c(2, 3, 7, 72))
        dat2 <- phen_list$source_data$pht006025
        dat  <- left_join(dat1, dat2)
      
        # change age and day variables to numeric
        dat$age1 <- as.numeric(dat$age1)
        dat$EDATE1 <- as.numeric(dat$EDATE1)
      
        # prior history indicator = 1 if EDATE1 < 0 (i.e. before visit 1)
        dat <- dat %>%
               mutate(vte_prior_history = ifelse(EVENT1 %in% c(1, 2, 3) & EDATE1 < 0, "1", "0"))
      
        #  age = age at visit 1 if no previous event
        #  otherwise age = age visit 1 + days to visit1/365.25 (days negative)
      
        dat <- dat %>%
               mutate(age = ifelse(vte_prior_history %in% 1, age1 + EDATE1 / 365.25, age1)) %>%
               filter(!is.na(vte_prior_history) & !is.na(age)) %>%
               select(topmed_subject_id, vte_prior_history, age)
      
        return(dat)
      }
      ```
<a id="vte_prior_history_1-fhs_offspring"></a>
  * ### vte/vte_prior_history_1 -- **FHS_Offspring**:
    * 7 component_study_variables: `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00177988.v4`, `phs000007.v29.pht003099.v4.phv00177989.v4`, `phs000007.v29.pht003099.v4.phv00177990.v4`, `phs000007.v29.pht006025.v1.phv00276977.v1`, `phs000007.v29.pht006025.v1.phv00277005.v1`
    * 1 component_harmonized_variables: `vte_followup_start_age_1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # prior history for FHS Offspring
        # follow-up started at visit6
      
        # get dataset with sub-cohort indicator and visit information
        # select the given subcohorts: Offspring = 1
        # get dataset with VTE event information
        # join
      
        dat1 <- phen_list$source_data$pht003099 %>%
               filter(idtype %in% 1)
        dat2 <- phen_list$source_data$pht006025
        dat  <- left_join(dat1, dat2)
      
        # get dataset with harmonized vte_followup_start_age
        dat3 <- phen_list$harmonized_data$vte_followup_start_age_1
        dat <- left_join(dat, dat3)
      
        # change age and day variables to numeric
        dat$age1 <- as.numeric(dat$age1)
        dat$EDATE1 <- as.numeric(dat$EDATE1)
        dat$date6 <- as.numeric(dat$date6)
        dat$date5 <- as.numeric(dat$date5)
        dat$date7 <- as.numeric(dat$date7)
        dat$vte_followup_start_age_1 <- as.numeric(dat$vte_followup_start_age_1)
      
        # prior history indicator = 1 if EDATE1 is before visit6
        # can use date6 if subject attended visit6
      
        # if didn't attend visit6:
        #   will need to decide if event date is after adjudication start
        # find range of date6 for subjects who attended visit6
        r1 <- min(dat$date6, na.rm = TRUE)
        r2 <- max(dat$date6, na.rm = TRUE)
      
        # if event days to visit1 < r1, can claim is prior event
        # if event days to visit1 > r2, can claim event is after adjudication start
        # since ranges of consecutive visits can overlap:
        #   if subject attended visit7 and event days >= date7: after adjuciation start
        #   if subject attended visit 5 and event days <= date5: prior event
        # otherwise there is uncertainty so assign as missing
      
        dat$vte_prior_history <- 0
        aa <- dat$EVENT1 %in% c(1, 2, 3) # event recorded
      
        # if attended visit6
        a <- aa & !is.na(dat$date6) & dat$EDATE1 < dat$date6
        dat$vte_prior_history[a] <- 1
      
        # if did not attend visit6 and event before min days to visit6
        b <- aa & is.na(dat$date6) & dat$EDATE1 < r1
        dat$vte_prior_history[b] <- 1
      
        # if did not attend visit6 but did attend visit5 and event before visit5
        f <- aa & is.na(dat$date6) & !is.na(dat$date5) & dat$date5 >= dat$EDATE1
        dat$vte_prior_history[f] <- 1
      
        # if uncertainty about whether event is after adjucation start, assign NA
        g <- aa & is.na(dat$date6) & !(dat$vte_prior_history %in% 1) &
             dat$EDATE1 >= r1 & dat$EDATE1 <= r2
        dat$vte_prior_history[g] <- NA
      
        # check visit 7 to possibly clarify some of the missing
        h <- aa & is.na(dat$date6) & !is.na(dat$date7) & dat$date7 <= dat$EDATE1
        dat$vte_prior_history[h] <- 0
      
        #  age = age at start of followup/adjudication if no prior event
        #  if event, age = age visit 1 + days event to visit1/365.25
        #  will not keep missing
      
        dat <- dat %>%
               mutate(age = ifelse(vte_prior_history %in% 1, age1 + EDATE1 / 365.25, NA)) %>%
               mutate(age = ifelse(vte_prior_history %in% 0, vte_followup_start_age_1, age)) %>%
               filter(!is.na(vte_prior_history) & !is.na(age)) %>%
               mutate(vte_prior_history = as.character(vte_prior_history)) %>%
               select(topmed_subject_id, vte_prior_history, age)
      
          return(dat)
      }
      ```
<a id="vte_prior_history_1-fhs_original"></a>
  * ### vte/vte_prior_history_1 -- **FHS_Original**:
    * 7 component_study_variables: `phs000007.v29.pht003099.v4.phv00177928.v4`, `phs000007.v29.pht003099.v4.phv00177930.v4`, `phs000007.v29.pht003099.v4.phv00178006.v4`, `phs000007.v29.pht003099.v4.phv00178007.v4`, `phs000007.v29.pht003099.v4.phv00178008.v4`, `phs000007.v29.pht006025.v1.phv00276977.v1`, `phs000007.v29.pht006025.v1.phv00277005.v1`
    * 1 component_harmonized_variables: `vte_followup_start_age_1`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # prior history for FHS Original
        # follow-up started at visit24
      
        # get dataset with sub-cohort indicator and visit information
        # select the given subcohorts: Original = 0
        # get dataset with VTE event information
        # join
      
        dat1 <- phen_list$source_data$pht003099 %>%
               filter(idtype %in% 0)
        dat2 <- phen_list$source_data$pht006025
        dat  <- left_join(dat1, dat2)
      
        # get dataset with harmonized vte_followup_start_age
        dat3 <- phen_list$harmonized_data$vte_followup_start_age_1
        dat <- left_join(dat, dat3)
      
        # change age and day variables to numeric
        dat$age1 <- as.numeric(dat$age1)
        dat$EDATE1 <- as.numeric(dat$EDATE1)
        dat$date24 <- as.numeric(dat$date24)
        dat$date23 <- as.numeric(dat$date23)
        dat$date25 <- as.numeric(dat$date25)
        dat$vte_followup_start_age_1 <- as.numeric(dat$vte_followup_start_age_1)
      
        # prior history indicator = 1 if EDATE1 is after visit24
        # can use date24 if subject attended visit24
      
        # if didn't attend visit24:
        #   will need to decide if event date is after adjudication start
        # find range of date24 for subjects who attended visit24
        r1 <- min(dat$date24, na.rm = TRUE)
        r2 <- max(dat$date24, na.rm = TRUE)
      
        # if event days to visit1 < r1, can claim is prior event
        # if event days to visit1 > r2, can claim event is after adjudication start
        # since ranges of consecutive visits can overlap:
        #   if subject attended visit25 and event days >= date25: after adjuciation start
        #   if subject attended visit 23 and event days <= date23: prior event
        # otherwise there is uncertainty so assign as missing
      
        dat$vte_prior_history <- 0 # start with assuming no prior history
        aa <- dat$EVENT1 %in% c(1, 2, 3) # event recorded
      
        # if attended visit24
        a <- aa & !is.na(dat$date24) & dat$EDATE1 < dat$date24
        dat$vte_prior_history[a] <- 1
      
        # if did not attend visit24 and event before min days to visit24
        b <- aa & is.na(dat$date24) & dat$EDATE1 < r1
        dat$vte_prior_history[b] <- 1
      
        # if did not attend visit24 but did attend visit23 and event before visit23
        f <- aa & is.na(dat$date24) & !is.na(dat$date23) & dat$date23 >= dat$EDATE1
        dat$vte_prior_history[f] <- 1
      
        # if uncertainty about whether event is after adjucation start, assign NA
        g <- aa & is.na(dat$date24) & !(dat$vte_prior_history %in% 1) &
             dat$EDATE1 >= r1 & dat$EDATE1 <= r2
        dat$vte_prior_history[g] <- NA
      
        # check visit 25 to possibly clarify some of the missing
        h <- aa & is.na(dat$date24) & !is.na(dat$date25) & dat$date25 <= dat$EDATE1
        dat$vte_prior_history[h] <- 0
      
        #  age = age at start of followup/adjudication if no prior event
        #  if event, age = age visit 1 + days event to visit1/365.25
        #  will not keep missing
      
        dat <- dat %>%
               mutate(age = ifelse(vte_prior_history %in% 1, age1 + EDATE1 / 365.25, NA)) %>%
               mutate(age = ifelse(vte_prior_history %in% 0, vte_followup_start_age_1, age)) %>%
               filter(!is.na(vte_prior_history) & !is.na(age)) %>%
               mutate(vte_prior_history = as.character(vte_prior_history)) %>%
               select(topmed_subject_id, vte_prior_history, age)
      
        return(dat)
      }
      ```
<a id="vte_prior_history_1-hvh"></a>
  * ### vte/vte_prior_history_1 -- **HVH**:
    * 4 component_study_variables: `phs001013.v3.pht005311.v2.phv00259376.v2`, `phs001013.v3.pht005311.v2.phv00259377.v2`, `phs001013.v3.pht005311.v2.phv00259378.v2`, `phs001013.v3.pht005311.v2.phv00259384.v2`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # VTE prior history for HVH
      
        # get phenotype dataset
        datt <- phen_list$source_data$pht005311
      
        # choose VTE cases - manual says all are incident
        dat1 <- datt %>% filter(ccs %in% 3)
      
        # take out subjects identified as cases then choose controls from remaining
        # necessary since controls at one time could have event to become case
        dat2 <- anti_join(datt, dat1, by = "topmed_subject_id")
      
          # choose controls from remaining
        dat2 <- dat2 %>% filter(ccs %in% 0)
      
        # some controls have duplicate entries
        # arrange by index year in descending order and choose later year
        dat3 <- dat2 %>% arrange(desc(indexy)) %>% group_by(topmed_subject_id) %>%
                     slice(1)
      
        dat <- rbind(dat1, as.data.frame(dat3))
      
        # create prior history indicator
        # age: age in years at date of VT diagnosis (cases) or at selection (controls)
        # keep only non-missing information
      
         dat <- dat %>% mutate(vte_prior_history = ifelse(priorvt %in% 1, 1, NA)) %>%
                mutate(vte_prior_history = ifelse(priorvt %in% 0, 0, vte_prior_history)) %>%
                filter(!is.na(vte_prior_history) & !is.na(age)) %>%
                mutate(vte_prior_history = as.character(vte_prior_history)) %>%
                select(topmed_subject_id, vte_prior_history, age)
      
        return(dat)
      }
      ```
<a id="vte_prior_history_1-whi_hrt"></a>
  * ### vte/vte_prior_history_1 -- **WHI_HRT**:
    * 4 component_study_variables: `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht000998.v6.phv00078472.v6`, `phs000200.v11.pht000998.v6.phv00078475.v6`, `phs000200.v11.pht001031.v6.phv00080426.v6`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # previous VTE history for WHI HRT participants
        # self-report on Form F2 (screening)
        # no further info so record age as age at screening
      
        # get dataset with screening information
        # get dataset with membership flags and select HRT participants
        # combine datasets
      
        dat1 <- phen_list$source_data$pht000998
        dat2 <- phen_list$source_data$pht001031 %>% filter(HRTFLAG %in% 1)
        dat <- left_join(dat2, dat1)
      
         # define vte_prior_history = 1 if any self-report of DVT or PE
         # vte_prior_history = 0 if answered 0 for both DVT and PE on Form 2
         # otherwise keep as missing
        dat <- dat %>% mutate(age = as.numeric(AGE)) %>%
               mutate(vte_prior_history = ifelse(DVT %in% 1 | PE %in% 1, 1, NA)) %>%
               mutate(vte_prior_history = ifelse(DVT %in% 0 & PE %in% 0, 0, vte_prior_history)) %>%
               filter(!is.na(vte_prior_history) & !is.na(age)) %>%
               mutate(vte_prior_history = as.character(vte_prior_history)) %>%
               select(topmed_subject_id, vte_prior_history, age)
      
        return(dat)
      }
      ```
<a id="vte_prior_history_1-whi_mrcnonhrt"></a>
  * ### vte/vte_prior_history_1 -- **WHI_MRCnonHRT**:
    * 13 component_study_variables: `phs000200.v11.pht000998.v6.phv00078436.v6`, `phs000200.v11.pht000998.v6.phv00078437.v6`, `phs000200.v11.pht000998.v6.phv00078472.v6`, `phs000200.v11.pht000998.v6.phv00078475.v6`, `phs000200.v11.pht001031.v6.phv00080426.v6`, `phs000200.v11.pht002770.v4.phv00170649.v4`, `phs000200.v11.pht002770.v4.phv00170650.v4`, `phs000200.v11.pht002770.v4.phv00170651.v4`, `phs000200.v11.pht002770.v4.phv00170652.v4`, `phs000200.v11.pht003395.v3.phv00192301.v3`, `phs000200.v11.pht003395.v3.phv00192302.v3`, `phs000200.v11.pht003407.v3.phv00193179.v3`, `phs000200.v11.pht003407.v3.phv00193194.v3`
    * Function:
      ```r
      harmonize <- function(phen_list) {
        library(dplyr)
      
        # previous history for WHI MRC non-HRT participants
        # follow-up started at beginning of Extension 2
      
        # get dataset with screening information
        # AGE is measured at screening on form F2
        # abs(F2DAYS) is days between screening and enrollment
        # do not use F2DAYS when F2DAYS > 0
        # age at enrollment = AGE + abs(F2DAYS)/365.25
        dat1 <- phen_list$source_data$pht000998
      
        # get datasets with membership flags and combine
        dat2 <- phen_list$source_data$pht001031
        dat3 <- phen_list$source_data$pht003395
        datt <- full_join(dat3, dat2)
      
        # select subjects in MRC but not in HRT
        datt <- datt %>% filter(EXT2MRC %in% 1 & HRTFLAG %in% 0)
      
        # combine with screening info
        dat <- left_join(datt, dat1)
      
        # change names for screening self-report for DVT or PE
        dat <- dat %>% rename(F2DVT = DVT, F2PE = PE)
      
        # there are three sources of previous history
        # screening self-report, up to EXT2 self-report (FORM 33), event decision before start of Ext2
        # screening self-report: use age = age at screening
      
        # get datasets for self-report (up to Ext2) and for outcomes
        f33 <- phen_list$source_data$pht002770
        outc <- phen_list$source_data$pht003407
      
        # combine
        dt <- left_join(outc, f33)
        datt <- left_join(dat, dt)
      
        # change AGE, days to numeric variables
        datt$AGE <- as.numeric(datt$AGE)
        datt$F2DAYS <- as.numeric(datt$F2DAYS)
        datt$F2DAYS[datt$F2DAYS > 0] <- 0   # correction
        datt$F33DVTDY <- as.numeric(datt$F33DVTDY)
        datt$F33PEDY <- as.numeric(datt$F33PEDY)
        datt$DVTDY <- as.numeric(datt$DVTDY)
        datt$PEDY <- as.numeric(datt$PEDY)
        datt$EXT2DAYS <- as.numeric(datt$EXT2DAYS)
      
        # create some intermediate variables flagging previous history from the three sources
        datt <- datt %>% mutate(F2h = F2DVT %in% 1 | F2PE %in% 1) %>%
                mutate(F33h = F33DVT %in% 1 | F33PE %in% 1)
        se1 <- !is.na(datt$DVTDY) & !is.na(datt$EXT2DAYS) & datt$DVTDY < datt$EXT2DAYS
        se2 <- !is.na(datt$PEDY) & !is.na(datt$EXT2DAYS) & datt$PEDY < datt$EXT2DAYS
        datt$outch <- se1 | se2
      
        # previous history indicator
        datt <- datt %>% mutate(vte_prior_history = ifelse(F2h | F33h | outch, 1, NA))
        sel <- datt$F2DVT %in% 0 & datt$F2PE %in% 0
        sel <- sel & datt$F33DVT %in% 0 & datt$F33PE %in% 0 & !datt$outch
        datt$vte_prior_history[sel] <- 0
      
        datt$age <- NA
        # for subjects with no indication of previous history, set age to start of followup
        a <- datt$vte_prior_history %in% 0
        datt$age[a] <- datt$AGE[a]  + (abs(datt$F2DAYS[a]) + datt$EXT2DAYS[a]) / 365.25
      
        # if indicated previous history at screening, that is first date
        b <- datt$F2h
        datt$age[b] <- datt$AGE[b] # age at screening
      
        # if no indication at F2 but self-report at F33:
        # use time to event if given, else use start of Ext2
        datt$days <- NA
        c1 <- datt$F33h & !datt$F2h & (!is.na(datt$F33DVTDY) | !is.na(datt$F33PEDY))
        c2 <- datt$F33h & !datt$F2h & is.na(datt$F33DVTDY) & is.na(datt$F33PEDY)
        datt$days[c1] <- pmin(datt$F33DVTDY[c1], datt$F33PEDY[c1], na.rm = TRUE)
        datt$days[c2] <- datt$EXT2DAYS[c2]
      
        # if event before adjudication and no baseline self-report, find min days
        d <- datt$outch & !datt$F2h
        datt$days[d] <- pmin(datt$DVTDY[d], datt$PEDY[d], datt$days[d], na.rm = TRUE)
      
        sel <- c1 | c2 | d
        datt$age[sel] <- datt$AGE[sel] + (abs(datt$F2DAYS[sel]) + datt$days[sel]) / 365.25
      
        # final selection
        dat <- datt %>% filter(!is.na(vte_prior_history) & !is.na(age)) %>%
               mutate(vte_prior_history = as.character(vte_prior_history)) %>%
               select(topmed_subject_id, vte_prior_history, age)
      
        return(dat)
      }
      ```
